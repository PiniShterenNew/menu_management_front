import{r as w,j as e,a as Oe}from"./react-CeYxiRmC.js";import{c as At}from"./react-dom-Bwn-WS6j.js";import{u as O,a as Ue,P as qt}from"./react-redux-BueUvsQ2.js";import{a as q}from"./axios-CCb-kr4I.js";import{s as I,L as le,C as J,R as A,F as G,D as z,B as T,a as dt,M as re,b as H,c as k,S as X,T as te,d as L,I as K,e as ye,A as Rt,f as Je,g as oe,h as Re,i as Ge,j as Le,P as De,k as ct,l as be,m as Lt,n as Ht,o as Vt,p as He,q as Ot,r as ut,t as Ut}from"./antd-DlnLO6_M.js";import{u as he}from"./react-responsive-BvfnkcyR.js";import{L as Dt}from"./rc-virtual-list-C7_giQpG.js";import{F as R,f as xt,a as pt,b as mt,c as ht,d as Be,e as Bt,g as Wt,h as zt,i as we,j as ve,k as We,l as Ce,m as Me,n as gt,o as Yt,p as Qt,q as Jt,r as Gt}from"./@fortawesome-C0L5sp0l.js";import{v as ze,a2 as xe,R as Se,a1 as Ye,a3 as Kt}from"./@ant-design-DdFivUGV.js";import{i as Xt}from"./lodash-c2uuq3A4.js";import{D as Zt,B as Ke}from"./react-chartjs-2-_DSQRZ-q.js";import{C as es,A as ts,p as ss,a as ns,b as rs,L as as,c as is}from"./chart.js-BkMDj0WH.js";import{L as ee,B as ls}from"./react-router-dom-wwaf5TwT.js";import{m as ie,h as Xe}from"./moment-DAXtSDIU.js";import{c as Qe,a as de,b as os}from"./@reduxjs-DkgbS889.js";import{l as ds}from"./socket.io-client-CDVIIGn8.js";import{d as cs,e as pe,b as us}from"./react-router-LxoAU2QN.js";import"./classnames-BK5ccKcQ.js";import"./scheduler-CzFDRTuY.js";import"./use-sync-external-store-DVf9xoj9.js";import"./rc-util-Dfq69fzz.js";import"./@babel-BZ1DyXOP.js";import"./rc-resize-observer-DeFxiL4a.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./rc-motion-BzJF__u1.js";import"./@rc-component-BD1ecEfG.js";import"./rc-overflow-9-dkHgxx.js";import"./rc-picker-DbUcv_uP.js";import"./dayjs-Cjk_ngT2.js";import"./rc-tabs-Dc3LrWqC.js";import"./rc-dropdown-Da3MgyDj.js";import"./rc-menu-e0_DzC_N.js";import"./rc-select-DpePyUm5.js";import"./rc-input-number-BwB4iNCr.js";import"./rc-input-BRLy7sut.js";import"./@ctrl-DOFZgDuz.js";import"./rc-drawer-C8quB5B7.js";import"./rc-field-form-PoB2IUsc.js";import"./scroll-into-view-if-needed-BZeNfFF0.js";import"./compute-scroll-into-view-DWa9QgjM.js";import"./rc-image-r5lEuzw7.js";import"./rc-dialog-BJ6kepq5.js";import"./rc-notification-BNK1IKot.js";import"./rc-tooltip-0PE3otFq.js";import"./rc-switch-paHhadbx.js";import"./rc-table-DhOsINyF.js";import"./rc-tree-CfIotKiT.js";import"./rc-checkbox-ae98rr8G.js";import"./rc-pagination-A9xLk7rH.js";import"./throttle-debounce-CUWDS_la.js";import"./rc-textarea-DxqSq3sC.js";import"./copy-to-clipboard-iuHVwNMD.js";import"./toggle-selection-BHUZwh74.js";import"./matchmediaquery-sVpnrumr.js";import"./css-mediaquery-DcYbJrVh.js";import"./hyphenate-style-name-HOLnhz8K.js";import"./shallow-equal-BQUY1Bas.js";import"./prop-types-CGJacfSb.js";import"./@emotion-CW87jbl0.js";import"./stylis-OW4gUFyn.js";import"./@kurkle-BZxJdD1U.js";import"./@remix-run-Br25Cn4W.js";import"./redux-DITMfSWq.js";import"./immer-DqxjFn0G.js";import"./redux-thunk-ClJT1hhx.js";import"./engine.io-client-C44f3zIw.js";import"./engine.io-parser-BiEtp6m2.js";import"./@socket.io-Dkula2eQ.js";import"./socket.io-parser-BBkuslX-.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const m of r)if(m.type==="childList")for(const g of m.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&i(g)}).observe(document,{childList:!0,subtree:!0});function s(r){const m={};return r.integrity&&(m.integrity=r.integrity),r.referrerPolicy&&(m.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?m.credentials="include":r.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function i(r){if(r.ep)return;r.ep=!0;const m=s(r);fetch(r.href,m)}})();const ae="https://menu-server-c2b952e2c698.herokuapp.com/api",xs=t=>q.post(`${ae}/products`,t),ps=t=>{const n=encodeURIComponent(t._id);return q.put(`${ae}/products/${n}`,t)},ms=t=>q.delete(`${ae}/products/${t}`),hs=()=>q.get(`${ae}/products`),gs=(t,n)=>q.post(`${ae}/sizes/${t}`,n),ys=(t,n)=>q.put(`${ae}/sizes/${t}`,n),js=(t,n)=>q.delete(`${ae}/sizes/${t}/${n}`),fs=t=>q.post(`${ae}/variations`,t),bs=(t,n)=>q.put(`${ae}/variations/${t}`,n),ws=t=>q.delete(`${ae}/variations/${t}`),yt=w.createContext(),jt=()=>w.useContext(yt),vs=({children:t})=>{const[n,s]=w.useState(!1),[i,r]=w.useState(!1),[m,g]=w.useState("add"),[u,y]=w.useState(null),b=p=>new Promise(async(o,l)=>{var f,C;s(!0);try{const S=await xs(p);s(!1),(f=S==null?void 0:S.data)!=null&&f.error?(I.error((C=S==null?void 0:S.data)==null?void 0:C.error),l(!1)):(I.success("המוצר נוסף בהצלחה"),o(!0))}catch(S){console.error("Error adding product:",S),I.error("שגיאה בהוספת המוצר"),s(!1)}}),j=p=>new Promise(async(o,l)=>{var f;s(!0);try{const C=await ps(p);s(!1),(f=C==null?void 0:C.data)!=null&&f.error||(I.success("המוצר עודכן בהצלחה"),o(!0)),l(!1)}catch(C){console.error("Error updating product:",C),I.error("שגיאה בעדכון המוצר"),s(!1)}}),v=async p=>{s(!0);try{await ms(p),I.success("המוצר נמחק בהצלחה"),s(!1)}catch(o){console.error("Error deleting product:",o),I.error("שגיאה במחיקת המוצר"),s(!1)}},F=(p,o)=>(s(!0),new Promise(async(l,f)=>{try{const C=await gs(p,o);I.success("הגודל נוסף בהצלחה"),s(!1),l(C.data)}catch(C){console.error("Error adding size:",C),I.error("שגיאה בהוספת הגודל"),s(!1),f(C)}})),h=(p,o)=>(s(!0),new Promise(async(l,f)=>{try{const C=await ys(p,o);I.success("הגודל עודכן בהצלחה"),s(!1),l(C.data)}catch(C){console.error("Error updating size:",C),I.error("שגיאה בעדכון הגודל"),s(!1),f(C)}})),c=(p,o)=>(s(!0),new Promise(async(l,f)=>{try{await js(p,o),I.success("הגודל נמחק בהצלחה"),s(!1),l(!0)}catch(C){console.error("Error deleting size:",C),I.error("שגיאה במחיקת הגודל"),s(!1),f(C)}})),x=p=>(s(!0),new Promise(async(o,l)=>{try{const f=await fs(p);I.success("הווריאציה נוספה בהצלחה"),s(!1),o(f.data)}catch(f){console.error("Error adding variation:",f),I.error("שגיאה בהוספת הווריאציה"),s(!1),l(f)}})),a=(p,o)=>(s(!0),new Promise(async(l,f)=>{try{const C=await bs(p,o);I.success("הווריאציה עודכנה בהצלחה"),s(!1),l(C.data)}catch(C){console.error("Error updating variation:",C),I.error("שגיאה בעדכון הווריאציה"),s(!1),f(C)}})),d=p=>(s(!0),new Promise(async(o,l)=>{try{await ws(p),I.success("הווריאציה נמחקה בהצלחה"),s(!1),o(!0)}catch(f){console.error("Error deleting variation:",f),I.error("שגיאה במחיקת הווריאציה"),s(!1),l(f)}}));return e.jsx(yt.Provider,{value:{addProduct:b,updateProduct:j,deleteProduct:v,addSize:F,updateSize:h,deleteSize:c,addVariation:x,updateVariation:a,deleteVariation:d,loading:n,isModalVisible:i,setIsModalVisible:r,modalMode:m,setModalMode:g,selectedItem:u,setSelectedItem:y},children:t})};function Cs({data:t,type:n,tableKeys:s,mobileKeys:i,openModal:r,Dtitle:m,Dcontent:g,onDelete:u}){const y=he({query:"(max-width: 1200px)"}),b=j=>{re.confirm({title:m,content:g,okText:"מחק",cancelText:"בטל",onOk:()=>u(j==null?void 0:j._id)})};return y?e.jsx(e.Fragment,{children:e.jsx(le,{style:{maxHeight:"55vh",overflowY:"auto",minHeight:"80%",height:"80%"},children:e.jsx(Dt,{data:t,itemHeight:47,itemKey:"_id",children:j=>{var v,F,h;return e.jsx(le.Item,{className:"width-100",style:{padding:"0"},children:e.jsxs(J,{className:"width-100 padding-card",style:{margin:"8px",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)"},children:[e.jsxs(A,{align:"middle",justify:"space-between",style:{margin:"1em 0em"},children:[e.jsx(G,{flex:1,children:e.jsx("strong",{style:{fontSize:"1.3em"},children:j==null?void 0:j.name})}),e.jsxs(G,{flex:1,style:{flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("strong",{children:(v=s==null?void 0:s.find(c=>c.key==="usedCount"))==null?void 0:v.title}),e.jsx("p",{children:j==null?void 0:j.usedCount})]}),(F=s==null?void 0:s.find(c=>c.key==="type"||c.key==="category"))==null?void 0:F.render("",j,"view")]}),s.filter(c=>c.key!=="name"&&c.key!=="type"&&(c==null?void 0:c.key)!=="category"&&(c==null?void 0:c.key)!=="actions"&&(i==null?void 0:i.includes(c==null?void 0:c.key))).map((c,x,a)=>e.jsxs(Oe.Fragment,{children:[e.jsxs("div",{style:{fontSize:"0.9em",display:"flex",justifyContent:"space-between"},children:[c.title&&e.jsxs("strong",{children:[c.title,":"]}),e.jsx("span",{children:c.render?c.render(null,j,"view"):j[c.dataIndex]||"—"})]}),x<2&&e.jsx(z,{style:{margin:"0.2em"}})]},`${j==null?void 0:j._id}-${c.key}`)),e.jsxs(A,{className:"card-actions",align:"middle",justify:"center",children:[(h=s==null?void 0:s.find(c=>c.key==="actions"))==null?void 0:h.render(null,j),n==="P"&&e.jsx(z,{type:"vertical"}),e.jsxs(G,{align:"center",justify:"center",children:[e.jsx(T,{type:"text",onClick:()=>b(j),children:e.jsx(R,{icon:xt})}),e.jsx(T,{type:"text",onClick:()=>r("edit",j),children:e.jsx(R,{icon:pt})}),e.jsx(T,{type:"text",onClick:()=>r("view",j),children:e.jsx(R,{icon:mt})})]})]})]})},j==null?void 0:j._id)}})})}):e.jsx(G,{style:{maxWidth:"100%",overflowY:"auto",overflowX:"auto"},children:e.jsx(dt,{columns:s,dataSource:t,scroll:{x:"max-content"},sticky:!0,style:{maxWidth:"100%"},direction:"rtl"})})}const Ss=({title:t,value:n=[],onChange:s,ingredientsArr:i=[],indexSize:r,nameArr:m,nameArrType:g})=>{const u=he({query:"(max-width: 1200px)"}),y=()=>{const h={ingredientId:null,quantity:null,unit:null};s([...n,h])},b=h=>{const c=[...n];c.splice(h,1),s(c)},j=(h,c,x)=>{const a=[...n];if(a[h][c]=x,c==="ingredientId"){const d=i.find(p=>p._id===x);d&&(a[h].unit=d.unit)}s(a)},v=h=>{switch(h){case"weight":return'ק"ג';case"volume":return"ליטר";case"units":return"יחידות";default:return""}},F=(h,c)=>{const x=i.find(d=>d._id===h.ingredientId),a=h.unit||x!=null&&x.unit?v(h.unit||(x==null?void 0:x.unit)):"";return e.jsxs(A,{gutter:[20,20],align:"middle",justify:"center",children:[e.jsx(H,{span:u?24:10,children:e.jsx(k.Item,{name:[m,r,g,c,"ingredientId"],rules:[{required:!0,message:"יש לבחור רכיב"}],children:e.jsx(X,{placeholder:"בחר רכיב",style:{width:"100%"},value:h.ingredientId||null,onChange:d=>j(c,"ingredientId",d),showSearch:!0,filterOption:(d,p)=>{var o;return(o=p==null?void 0:p.label)==null?void 0:o.toLowerCase().includes(d.toLowerCase())},options:i.map(d=>({value:d._id,label:d.name})),size:"small"})})}),e.jsx(H,{span:u?20:10,children:e.jsx(k.Item,{name:[m,r,g,c,"quantity"],rules:[{required:!0,message:"יש למלא כמות"},{type:"number",min:0,message:"כמות חייבת להיות חיובית"}],children:e.jsx(te,{placeholder:`כמות ${a?`(${a})`:""}`,style:{width:"100%"},value:h.quantity||null,onChange:d=>j(c,"quantity",d),min:0,step:h.unit==="units"?1:.001,precision:h.unit==="units"?0:3,size:"small",addonAfter:a})})}),e.jsx(H,{span:4,style:{alignSelf:"flex-start",textAlign:"right"},children:e.jsx(T,{type:"text",danger:!0,icon:e.jsx(xe,{}),onClick:()=>b(c),size:"small"})})]})};return e.jsxs("div",{children:[e.jsx(T,{type:"dashed",onClick:y,style:{width:"100%",marginBottom:"8px"},icon:e.jsx(ze,{}),size:"small",children:t}),e.jsx("div",{children:n.map((h,c)=>F(h,c))})]})},{Option:ge}=X,{Text:Ze}=L,{TextArea:Is}=K;function Ps({mode:t="view",fields:n=[],onSubmit:s,initialValues:i={},onClose:r,tableKeys:m,ingredientsArr:g}){var h;const[u]=k.useForm(),[y,b]=w.useState(i.unit||null),[j,v]=w.useState(i.subUnit||null);w.useEffect(()=>{if(i){const c=i.quantity<1?i.quantity*1e3:i.quantity;u.setFieldsValue({...i,quantity:c}),b(i.unit),v(i.subUnit||"kg")}},[i,u]);const F=c=>{let x=c.quantity;(c.subUnit==="g"||c.subUnit==="ml")&&(x=c.quantity/1e3);const a={...c,quantity:x};s&&s(a),u.resetFields(),r&&r()};return t==="view"?e.jsxs(J,{style:{},children:[e.jsx(L.Title,{level:4,style:{marginBottom:"16px"},children:"פרטי הרכיב"}),e.jsxs(A,{align:"middle",justify:"space-between",style:{margin:"1em 0em"},children:[e.jsx(Ze,{strong:!0,style:{fontSize:"1.5em"},children:i==null?void 0:i.name}),(h=m==null?void 0:m.find(c=>c.key==="type"))==null?void 0:h.render("",i,"view")]}),m==null?void 0:m.filter(c=>c.key!=="type"&&(c==null?void 0:c.key)!=="name").map((c,x,a)=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"12px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(G,{flex:1,children:e.jsxs(Ze,{strong:!0,children:[c.title,":"]})}),e.jsx(G,{flex:1,children:e.jsx("p",{style:{},children:(c==null?void 0:c.render)&&(c==null?void 0:c.render("",i,t,"view"))||i[c.key]||"—"})})]},c.key),x<(a==null?void 0:a.length)-1&&e.jsx(z,{style:{margin:"8px 0"}})]}))]}):e.jsx(J,{children:e.jsxs(k,{form:u,layout:"vertical",onFinish:F,initialValues:i,children:[n.map(c=>{const{key:x,title:a,type:d,options:p,rules:o,props:l,hiddenInForm:f,coin:C,divider:S}=c;if(f)return null;switch(d){case"text":return e.jsxs(e.Fragment,{children:[e.jsx(k.Item,{name:x,label:a,rules:o,children:e.jsx(K,{...l})},x),S&&e.jsx(z,{style:{margin:"0.2em"}})]});case"number":return e.jsxs(e.Fragment,{children:[e.jsx(k.Item,{name:x,label:a,rules:o==null?void 0:o.map($=>$.validator?{...$,validator:(_,V)=>$.validator(_,V,i)}:$),children:e.jsx(te,{suffix:C&&"₪",min:0,style:{width:"100%"},...l})},x),S&&e.jsx(z,{style:{margin:"0.2em"}})]});case"float":return e.jsxs(e.Fragment,{children:[e.jsx(k.Item,{name:x,label:a,rules:o,children:e.jsx(te,{suffix:C&&"₪",min:0,step:.01,style:{width:"100%"},...l})},x),S&&e.jsx(z,{style:{margin:"0.2em"}})]});case"select":return e.jsxs(e.Fragment,{children:[e.jsx(k.Item,{name:x,label:a,rules:o,children:e.jsx(X,{...l,showSearch:!0,onChange:$=>{x==="unit"&&(b($),u.setFieldsValue({subUnit:void 0}))},children:p.map($=>e.jsx(ge,{value:$.value,children:$.label},$.value))})},x),x==="unit"&&(u.getFieldValue("unit")==="weight"||u.getFieldValue("unit")==="volume")&&e.jsx(k.Item,{name:"subUnit",initialValue:u.getFieldValue("subUnit")||(u.getFieldValue("unit")==="weight"?(i==null?void 0:i.quantity)>=1?"kg":"g":u.getFieldValue("unit")==="volume"?(i==null?void 0:i.quantity)>=1?"liter":"ml":void 0),label:u.getFieldValue("unit")==="weight"?'בחר יחידת משקל (ק"ג / גרם)':'בחר יחידת נפח (ליטר / מ"ל)',rules:[{required:!0,message:"אנא בחר יחידת משנה"}],children:e.jsx(X,{onChange:$=>u.setFieldsValue({subUnit:$}),children:u.getFieldValue("unit")==="weight"?e.jsxs(e.Fragment,{children:[e.jsx(ge,{value:"kg",children:'ק"ג'}),e.jsx(ge,{value:"g",children:"גרם"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ge,{value:"liter",children:"ליטר"}),e.jsx(ge,{value:"ml",children:'מ"ל'})]})})}),S&&e.jsx(z,{style:{margin:"0.2em"}})]});case"ingredientsManager":return e.jsxs(e.Fragment,{children:[e.jsx(z,{style:{margin:"0.5em"}}),e.jsx(k.Item,{name:x,label:a,rules:o,children:e.jsx(Ss,{value:u.getFieldValue(x),onChange:$=>u.setFieldsValue({[x]:$}),fields:c==null?void 0:c.fields,ingredientsArr:g})},x)]});case"custom":return e.jsxs(e.Fragment,{children:[c.render&&c.render("",i,"edit",u),S&&e.jsx(z,{style:{margin:"0.2em"}})]});case"textArea":return e.jsxs(e.Fragment,{children:[e.jsx(k.Item,{name:x,label:a,rules:o,children:e.jsx(Is,{style:{resize:"none"},showCount:!0,maxLength:c==null?void 0:c.maxLength})},x),S&&e.jsx(z,{style:{margin:"0.2em"}})]});default:return null}}),t!=="view"&&e.jsx(k.Item,{children:e.jsx(T,{type:"primary",htmlType:"submit",style:{width:"100%"},children:t==="add"?"הוסף":"עדכן"})})]})})}const{TabPane:ks}=ye,et=w.forwardRef(({value:t=[],onChange:n,ingredients:s,mixes:i,onSubmit:r,onDelete:m,sizeSummary:g,priceExcludingVAT:u},y)=>{const[b,j]=w.useState(null),[v,F]=w.useState("0"),[h]=k.useForm(),c=()=>({value:t}),x=()=>{const l={idNew:Date.now(),label:`גודל ${t.length+1}`,price:null,preparationTime:null,ingredients:[],mixes:[]},f=[...t,l];n(f),h.setFieldsValue(c()),j(l.idNew),F(t.length.toString())},a=l=>{const f=t[l];if(f!=null&&f._id)re.confirm({title:"האם אתה בטוח שברצונך למחוק את הגודל הזה?",content:`המחיקה תסיר לצמיתות את ${f.label}.`,okText:"מחק",okType:"danger",cancelText:"ביטול",onOk:()=>{m(f==null?void 0:f.productId,f._id).then(()=>{const C=[...t];C.splice(l,1),n(C),h.setFieldsValue({sizes:C}),F(Math.max(0,l-1).toString())}).catch(C=>{console.error("Error deleting size:",C)})}});else{const C=[...t];C.splice(l,1),n(C),h.setFieldsValue(c()),F(Math.max(0,l-1).toString()),j(null)}},d=l=>{const f=[...t];f[l]={...f[l],edit:!0},n(f)},p=l=>{switch(l){case"weight":return'ק"ג';case"volume":return"ליטר";case"units":return"יחידות";default:return""}},o=(l,f,C)=>{var _;const S=f[l];if(!S)return null;const $=(_=C[l])==null?void 0:_.priceExcludingVAT;return e.jsx(A,{children:e.jsxs(H,{children:[e.jsxs(A,{children:[e.jsx(L.Text,{strong:!0,children:'מחיר ללא מע"מ:'}),e.jsxs(L.Text,{style:{marginRight:8},children:["₪",$]})]}),e.jsxs(A,{children:[e.jsx(L.Text,{strong:!0,children:"עלות עבודה:"}),e.jsxs(L.Text,{style:{marginRight:8},children:["₪",S==null?void 0:S.laborCost]})]}),e.jsxs(A,{children:[e.jsx(L.Text,{strong:!0,children:"עלות מרכיבים:"}),e.jsxs(L.Text,{style:{marginRight:8},children:["₪",S==null?void 0:S.ingredientCost]})]}),e.jsxs(A,{children:[e.jsx(L.Text,{strong:!0,children:"עלות מיקסים:"}),e.jsxs(L.Text,{style:{marginRight:8},children:["₪",S==null?void 0:S.mixCost]})]}),e.jsxs(A,{children:[e.jsx(L.Text,{strong:!0,children:"עלות הוצאות קבועות:"}),e.jsx(L.Text,{style:{marginRight:8},children:"₪"})]}),e.jsxs(A,{children:[e.jsx(L.Text,{strong:!0,children:"אחוז רווח:"}),e.jsxs(L.Text,{style:{marginRight:8},children:[S==null?void 0:S.profitMargin,"%"]})]}),e.jsxs(A,{children:[e.jsx(L.Text,{strong:!0,children:"סך הכל עלות:"}),e.jsxs(L.Text,{style:{marginRight:8},children:["₪",S==null?void 0:S.totalCost]})]})]})})};return e.jsxs(k,{form:h,initialValues:{sizes:t},onFinish:(l,f)=>{var C;r({sizes:(C=l==null?void 0:l.sizes)==null?void 0:C.filter(S=>S)})},children:[e.jsx(T,{type:"default",icon:e.jsx(ze,{}),onClick:x,children:"הוסף גודל"}),e.jsx(ye,{activeKey:v,onChange:l=>F(l),tabBarStyle:{direction:"rtl"},style:{margin:"1vw 0"},type:"card",tabPosition:"top",children:t==null?void 0:t.map((l,f)=>{var C,S;return e.jsx(ks,{tab:(l==null?void 0:l.label)||`גודל ${f+1}`,children:!(l!=null&&l._id)||l!=null&&l.edit?e.jsxs("div",{className:l.idNew===b?"highlight-new":"",style:{border:`1px ${l!=null&&l.idNew?"dashed":"solid #e6e6e6"}`,borderRadius:"8px",padding:"16px",background:"#fafafa",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},children:[e.jsxs(A,{justify:"space-between",align:"middle",style:{marginBottom:"12px"},children:[e.jsx(k.Item,{name:["sizes",f,"_id"],hidden:!0,children:e.jsx(K,{})}),e.jsx(k.Item,{name:["sizes",f,"label"],label:"שם הגודל",rules:[{required:!0,message:"חייב למלא שם גודל"}],children:e.jsx(K,{placeholder:"שם הגודל",size:"middle",style:{width:"auto",minWidth:"200px"}})}),e.jsx(T,{type:"text",style:{alignSelf:"flex-start"},danger:!0,icon:e.jsx(xe,{}),title:"מחק גודל",onClick:()=>a(f),children:"מחק גודל"})]}),e.jsxs(A,{gutter:[16,16],children:[e.jsx(H,{span:12,children:e.jsx(k.Item,{name:["sizes",f,"price"],label:"מחיר",rules:[{required:!0,message:"יש למלא מחיר"},{type:"number",min:0,message:"המחיר חייב להיות חיובי"}],children:e.jsx(te,{placeholder:"מחיר",style:{width:"100%"}})})}),e.jsx(H,{span:12,children:e.jsx(k.Item,{label:"זמן הכנה (דקות)",name:["sizes",f,"preparationTime"],rules:[{required:!0,message:"חייב לציין זמן הכנה"}],children:e.jsx(te,{placeholder:"זמן הכנה",style:{width:"100%"}})})})]}),e.jsx(z,{style:{margin:"12px 0"}}),e.jsx(L.Text,{strong:!0,style:{display:"block",marginBottom:"8px"},children:"מרכיבים:"}),e.jsx(k.List,{name:["sizes",f,"ingredients"],children:($,{add:_,remove:V})=>e.jsxs(e.Fragment,{children:[e.jsx(T,{type:"dashed",style:{marginBottom:"0.5vw"},onClick:()=>_(),children:"הוסף מרכיב"}),e.jsx("div",{style:{maxHeight:"12vw",overflowY:"auto",overflowX:"hidden"},children:$.map(({key:B,name:E,fieldKey:P})=>e.jsxs(A,{gutter:16,children:[e.jsx(H,{span:10,children:e.jsx(k.Item,{name:[E,"ingredientId"],fieldKey:[P,"ingredientId"],rules:[{required:!0,message:"בחר רכיב"}],children:e.jsx(X,{placeholder:"בחר רכיב",showSearch:!0,filterOption:(N,U)=>{var D;return(D=U==null?void 0:U.label)==null?void 0:D.toLowerCase().includes(N.toLowerCase())},options:s.map(N=>({value:N._id,label:N.name,unit:N==null?void 0:N.unit})),onChange:N=>{const U=s.find(se=>se._id===N),D=[...t],W=h.getFieldValue(["sizes",f]);W.ingredients[E]={...W.ingredients[E],ingredientId:N,unit:(U==null?void 0:U.unit)||""},D[f]=W,n(D),h.setFieldsValue({sizes:D})}})})}),e.jsx(H,{span:10,children:e.jsx(k.Item,{name:[E,"quantity"],fieldKey:[P,"quantity"],rules:[{required:!0,message:"הזן כמות"}],children:e.jsx(te,{addonAfter:p(h.getFieldValue(["sizes",f,"ingredients",E,"unit"])||"")})})}),e.jsx(H,{span:4,children:e.jsx(T,{type:"text",danger:!0,icon:e.jsx(Se,{}),onClick:()=>V(E)})})]},B))})]})}),e.jsx(z,{style:{margin:"12px 0"}}),e.jsx(L.Text,{strong:!0,style:{display:"block",marginBottom:"8px"},children:"מיקסים:"}),e.jsx(k.List,{name:["sizes",f,"mixes"],children:($,{add:_,remove:V})=>e.jsxs(e.Fragment,{children:[e.jsx(T,{type:"dashed",style:{marginBottom:"0.5vw"},onClick:()=>_(),children:"הוסף מיקס"}),e.jsx("div",{style:{maxHeight:"12vw",overflowY:"auto",overflowX:"hidden"},children:$.map(({key:B,name:E,fieldKey:P})=>e.jsxs(A,{gutter:16,children:[e.jsx(H,{span:10,children:e.jsx(k.Item,{name:[E,"mixId"],fieldKey:[P,"mixId"],rules:[{required:!0,message:"בחר מיקס"}],children:e.jsx(X,{placeholder:"בחר מיקס",showSearch:!0,filterOption:(N,U)=>{var D;return(D=U==null?void 0:U.label)==null?void 0:D.toLowerCase().includes(N.toLowerCase())},options:i.map(N=>({value:N._id,label:N.name,unit:N==null?void 0:N.unit})),onChange:N=>{const U=i.find(se=>se._id===N),D=[...t],W=h.getFieldValue(["sizes",f,"mixes"]);W[E]={...W[E],unit:(U==null?void 0:U.unit)||"weight"},D[f].mixes=W,n(D),h.setFieldsValue({sizes:D})}})})}),e.jsx(H,{span:10,children:e.jsx(k.Item,{name:[E,"quantity"],fieldKey:[P,"quantity"],rules:[{required:!0,message:"הזן כמות"}],children:e.jsx(te,{addonAfter:p(h.getFieldValue(["sizes",f,"mixes",E,"unit"])||"")})})}),e.jsx(H,{span:4,children:e.jsx(T,{type:"text",danger:!0,icon:e.jsx(Se,{}),onClick:()=>V(E)})})]},B))})]})})]},l.idNew||f):e.jsxs("div",{style:{border:"1px solid #e6e6e6",borderRadius:"8px",padding:"16px",background:"#fafafa",boxShadow:"0 1px 2px rgba(0,0,0,0.05)",marginBottom:"16px"},children:[e.jsx(G,{flex:1,style:{padding:"0em 1em"},justify:"space-between",align:"middle",children:e.jsxs(H,{className:"width-100",children:[e.jsx(G,{flex:1,style:{marginBottom:"8px"},children:e.jsxs(A,{className:"width-100",align:"middle",justify:"space-between",children:[e.jsx(L.Text,{strong:!0,style:{fontSize:"1.2em"},children:l==null?void 0:l.label}),e.jsxs(G,{children:[e.jsx(T,{type:"text",icon:e.jsx(Ye,{}),onClick:()=>d(f)}),e.jsx(T,{type:"text",danger:!0,icon:e.jsx(xe,{}),onClick:()=>a(f)})]})]})}),e.jsxs(G,{flex:1,align:"middle",style:{gap:"12px",marginBottom:"8px"},children:[e.jsxs(A,{align:"middle",style:{gap:"8px"},children:[e.jsxs(L.Text,{style:{color:"#007acc",fontSize:"1.1em",fontWeight:"bold",display:"flex",alignItems:"center",gap:"4px"},children:["₪",l==null?void 0:l.price]}),e.jsx(R,{style:{fontSize:"0.9em",color:"#007acc"},icon:ht})]}),e.jsxs(A,{align:"middle",style:{gap:"8px"},children:[e.jsxs(L.Text,{style:{fontSize:"1.1em",fontWeight:"bold",display:"flex",alignItems:"center",gap:"4px"},children:[l==null?void 0:l.preparationTime," דקות"]}),e.jsx(R,{style:{fontSize:"0.9em"},icon:Be})]})]}),o(f,g,u)]})}),e.jsx(z,{style:{margin:"12px 0"}}),e.jsx(L.Text,{strong:!0,style:{display:"block",marginBottom:"8px"},children:"מרכיבים:"}),e.jsx("ul",{style:{paddingLeft:"20px",margin:"0"},children:(C=l==null?void 0:l.ingredients)==null?void 0:C.map(($,_)=>{var B;const V=(()=>{switch($.unit){case"weight":return'ק"ג';case"volume":return"ליטר";case"units":return"יחידות";default:return""}})();return e.jsx("li",{style:{marginBottom:"4px"},children:e.jsxs(L.Text,{children:[(B=s==null?void 0:s.find(E=>(E==null?void 0:E._id)===($==null?void 0:$.ingredientId)))==null?void 0:B.name," -"," ",$.quantity," ",V]})},_)})}),e.jsx(z,{style:{margin:"12px 0"}}),e.jsx(L.Text,{strong:!0,style:{display:"block",marginBottom:"8px"},children:"מיקסים:"}),e.jsx("ul",{style:{paddingLeft:"20px",margin:"0"},children:(S=l==null?void 0:l.mixes)==null?void 0:S.map(($,_)=>{var B;const V=(()=>{switch($.unit){case"weight":return'ק"ג';case"volume":return"ליטר";case"units":return"יחידות";default:return""}})();return e.jsx("li",{style:{marginBottom:"4px"},children:e.jsxs(L.Text,{children:[(B=i==null?void 0:i.find(E=>(E==null?void 0:E._id)===($==null?void 0:$.mixId)))==null?void 0:B.name," -"," ",$.quantity," ",V]})},_)})})]},l.idNew||f)},f)})}),e.jsx(T,{type:"primary",htmlType:"submit",disabled:t.length===0,onClick:()=>j(null),children:"שמור"})]})}),{TabPane:tt}=ye,st=w.forwardRef(({value:t=[],sizes:n,onChange:s,ingredients:i,onSubmit:r,onDelete:m},g)=>{const[u,y]=w.useState(null),[b,j]=w.useState("0"),[v]=k.useForm(),F=()=>({value:t}),h=()=>{const d={idNew:Date.now(),label:`וריאציה - ${t.length+1}`,sizeAdjustments:[...n==null?void 0:n.map(o=>({sizeId:o==null?void 0:o._id,label:o==null?void 0:o.label,priceAdjustment:null,preparationTimeAdjustment:null,ingredients:o==null?void 0:o.ingredients,mixes:o==null?void 0:o.mixes,add:[],remove:[],update:[]}))]},p=[...t,d];s(p),v.setFieldsValue({variations:p}),y(d.idNew),j(t.length.toString())},c=d=>{const p=t[d];if(p!=null&&p._id)re.confirm({title:"האם אתה בטוח שברצונך למחוק את הוריאציה הזו?",content:`המחיקה תסיר לצמיתות את ${p.label}.`,okText:"מחק",okType:"danger",cancelText:"ביטול",onOk:()=>{m(p==null?void 0:p.productId,p._id).then(()=>{const o=[...t];o.splice(d,1),s(o),v.setFieldsValue({sizes:o}),j(Math.max(0,d-1).toString())}).catch(o=>{console.error("Error deleting vatiation:",o)})}});else{const o=[...t];o.splice(d,1),s(o),v.setFieldsValue(F()),j(Math.max(0,d-1).toString()),y(null)}},x=d=>{const p=[...t];p[d]={...p[d],edit:!0},s(p)},a=d=>{switch(d){case"weight":return'ק"ג';case"volume":return"ליטר";case"units":return"יחידות";default:return""}};return e.jsxs(k,{form:v,initialValues:{variations:t},onFinish:(d,p)=>{var o;r({variations:(o=d==null?void 0:d.variations)==null?void 0:o.filter(l=>l)})},children:[!n.length&&e.jsx(Rt,{message:"לא ניתן להוסיף וריאציות",description:"יש להוסיף לפחות גודל אחד לפני שניתן להוסיף וריאציות.",type:"warning",showIcon:!0,style:{marginBottom:"16px"}}),e.jsx(T,{type:"default",icon:e.jsx(ze,{}),disabled:(n==null?void 0:n.length)===0||!n,onClick:h,children:"הוסף וריאציה"}),e.jsx(k.List,{name:["variations","sizeAdjustments"],children:(d,{add:p,remove:o})=>{ye,d.map(({key:l,name:f,fieldKey:C})=>{var $;const S=v.getFieldValue(["variations","sizeAdjustments",l]);return e.jsx(tt,{tab:(S==null?void 0:S.label)||`גודל ${l+1}`,children:!(S!=null&&S._id)||S!=null&&S.edit?e.jsxs("div",{className:S.idNew===u?"highlight-new":"",style:{border:`1px ${S!=null&&S.idNew?"dashed":"solid #e6e6e6"}`,borderRadius:"8px",padding:"16px",background:"#fafafa",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},children:[e.jsxs(A,{justify:"space-between",align:"middle",style:{marginBottom:"12px"},children:[e.jsx(k.Item,{name:["variations","sizeAdjustments",l,"_id"],hidden:!0,children:e.jsx(K,{})}),e.jsx(k.Item,{name:["variations","sizeAdjustments",l,"label"],label:"שם הוריאציה",rules:[{required:!0,message:"חייב למלא שם גודל"}],children:e.jsx(K,{placeholder:"שם הוריאציה",size:"middle",style:{width:"auto",minWidth:"200px"}})}),e.jsx(T,{type:"text",style:{alignSelf:"flex-start"},danger:!0,icon:e.jsx(xe,{}),title:"מחק וריאציה",onClick:()=>c(l),children:"מחק וריאציה"})]}),e.jsx(k.List,{name:["variations","sizeAdjustments",l],children:(_,{add:V,remove:B})=>e.jsx(ye,{tabBarStyle:{direction:"rtl"},style:{margin:"1vw 0"},type:"card",tabPosition:"top",children:_.map(({key:E,name:P,fieldKey:N})=>{const U=v.getFieldValue(["variations",index,"sizeAdjustments",P]);return e.jsxs(tt,{tab:(U==null?void 0:U.label)||`Size ${P}`,children:[e.jsxs(A,{gutter:[16,16],children:[e.jsx(H,{span:12,children:e.jsx(k.Item,{name:["variations",index,"price"],label:"תוספת מחיר",rules:[{required:!1,message:"יש למלא מחיר"},{type:"number",min:0,message:"המחיר חייב להיות חיובי"}],children:e.jsx(te,{placeholder:"מחיר",style:{width:"100%"}})})}),e.jsx(H,{span:12,children:e.jsx(k.Item,{label:"תוספת זמן הכנה (דקות)",name:["sizes",index,"preparationTime"],rules:[{required:!1,message:"חייב לציין זמן הכנה"}],children:e.jsx(te,{placeholder:"זמן הכנה",style:{width:"100%"}})})})]}),e.jsx(L.Text,{strong:!0,style:{display:"block",marginBottom:"8px"},children:"מרכיבים:"}),e.jsx(k.List,{name:["sizes",index,"ingredients"],children:(D,{add:W,remove:se})=>e.jsxs(e.Fragment,{children:[e.jsx(T,{type:"dashed",style:{marginBottom:"0.5vw"},onClick:()=>W({ingredientId:null,quantity:null,unit:null}),children:"הוסף מרכיב"}),e.jsx("div",{style:{maxHeight:"12vw",overflowY:"auto",overflowX:"hidden"},children:D.map(({key:Ne,name:M,fieldKey:Q})=>e.jsxs(A,{gutter:16,children:[e.jsx(H,{span:10,children:e.jsx(k.Item,{name:[M,"ingredientId"],fieldKey:[Q,"ingredientId"],rules:[{required:!0,message:"בחר רכיב"}],children:e.jsx(X,{placeholder:"בחר מרכיב",showSearch:!0,filterOption:(Y,Z)=>{var ne;return(ne=Z==null?void 0:Z.label)==null?void 0:ne.toLowerCase().includes(Y.toLowerCase())},options:i.map(Y=>({value:Y._id,label:Y.name,unit:Y==null?void 0:Y.unit}))})})}),e.jsx(H,{span:10,children:e.jsx(k.Item,{name:[M,"quantity"],fieldKey:[Q,"quantity"],rules:[{required:!0,message:"הזן כמות"}],children:e.jsx(te,{placeholder:"כמות",addonAfter:a(v.getFieldValue(["sizes",index,"ingredients",M,"unit"])||"")})})}),e.jsx(H,{span:4,children:e.jsx(T,{type:"text",danger:!0,icon:e.jsx(Se,{}),onClick:()=>se(M)})})]},Ne))})]})})]},E)})})}),e.jsx(z,{style:{margin:"12px 0"}})]},S.idNew||l):e.jsxs("div",{style:{border:"1px solid #e6e6e6",borderRadius:"8px",padding:"16px",background:"#fafafa",boxShadow:"0 1px 2px rgba(0,0,0,0.05)",marginBottom:"16px"},children:[e.jsx(G,{flex:1,style:{padding:"0em 1em"},justify:"space-between",align:"middle",children:e.jsxs(H,{className:"width-100",children:[e.jsx(G,{flex:1,style:{marginBottom:"8px"},children:e.jsxs(A,{className:"width-100",align:"middle",justify:"space-between",children:[e.jsx(L.Text,{strong:!0,style:{fontSize:"1.2em"},children:size==null?void 0:size.label}),e.jsxs(G,{children:[e.jsx(T,{type:"text",icon:e.jsx(Ye,{}),onClick:()=>x(index)}),e.jsx(T,{type:"text",danger:!0,icon:e.jsx(xe,{}),onClick:()=>c(index)})]})]})}),e.jsxs(G,{flex:1,align:"middle",style:{gap:"12px",marginBottom:"8px"},children:[e.jsxs(A,{align:"middle",style:{gap:"8px"},children:[e.jsxs(L.Text,{style:{color:"#007acc",fontSize:"1.1em",fontWeight:"bold",display:"flex",alignItems:"center",gap:"4px"},children:["₪",size==null?void 0:size.price]}),e.jsx(R,{style:{fontSize:"0.9em",color:"#007acc"},icon:ht})]}),e.jsxs(A,{align:"middle",style:{gap:"8px"},children:[e.jsxs(L.Text,{style:{fontSize:"1.1em",fontWeight:"bold",display:"flex",alignItems:"center",gap:"4px"},children:[size==null?void 0:size.preparationTime," דקות"]}),e.jsx(R,{style:{fontSize:"0.9em"},icon:Be})]})]})]})}),e.jsx(z,{style:{margin:"12px 0"}}),e.jsx(L.Text,{strong:!0,style:{display:"block",marginBottom:"8px"},children:"מרכיבים:"}),e.jsx("ul",{style:{paddingLeft:"20px",margin:"0"},children:($=size==null?void 0:size.ingredients)==null?void 0:$.map((_,V)=>{var E;const B=(()=>{switch(_.unit){case"weight":return'ק"ג';case"volume":return"ליטר";case"units":return"יחידות";default:return""}})();return e.jsx("li",{style:{marginBottom:"4px"},children:e.jsxs(L.Text,{children:[(E=i==null?void 0:i.find(P=>(P==null?void 0:P._id)===(_==null?void 0:_.ingredientId)))==null?void 0:E.name," -"," ",_.quantity," ",B]})},V)})})]},size.idNew||index)},l)})}}),e.jsx(T,{type:"primary",htmlType:"submit",disabled:t.length===0,onClick:()=>y(null),children:"שמור"})]})}),{Title:Ka,Text:nt}=L,_s=({})=>{const{isModalVisible:t,setIsModalVisible:n,modalMode:s,setModalMode:i,selectedItem:r,setSelectedItem:m,addProduct:g,updateProduct:u,deleteProduct:y,addSize:b,updateSize:j,deleteSize:v}=jt(),F=he({query:"(max-width: 1200px)"}),h=O(_=>_.categories),c=O(_=>_.ingredients),x=O(_=>_.mixes),a=O(_=>_.products),d=w.useCallback(()=>{if(!r||!a)return;const _=a.find(V=>V._id===r._id);_&&(Xt(r,_)||m(_))},[r,a]);w.useEffect(()=>{d()},[a]);const[p]=k.useForm(),[o]=k.useForm(),[l]=k.useForm(),f=(_,V,B)=>{if(_==="product")switch(V){case"add":return"הוספת מוצר";case"edit":return"עדכון מוצר";case"view":return"צפייה במוצר";default:return"הוספת מוצר"}else switch(_){case"size":return`ניהול גדלים - ${B==null?void 0:B.name}`;case"variation":return`ניהול וריאציות - ${B==null?void 0:B.name}`}};w.useEffect(()=>{r?(p.setFieldsValue(r),o.setFieldsValue((r==null?void 0:r.sizes)||{}),l.setFieldsValue((r==null?void 0:r.variations)||{})):(p.resetFields(),o.resetFields(),l.resetFields())},[r]);const C=_=>{var V;switch(t){case"product":const B=p.getFieldsValue();s==="edit"?u({...B,_id:r==null?void 0:r._id}).then(()=>{n(!1),m(null)}).catch(N=>{console.error("שגיאה בעריכת מוצר:",N)}):g(B).then(()=>{n(!1),m(null)}).catch(N=>{console.error("שגיאה בהוספת מוצר:",N)});break;case"size":const E=_,P=((V=E==null?void 0:E.sizes)==null?void 0:V.map(N=>{var U,D;return{productId:r==null?void 0:r._id,label:N.label,price:N.price,preparationTime:N.preparationTime,ingredients:((U=N.ingredients)==null?void 0:U.map(W=>{var se;return{ingredientId:((se=W.ingredientId)==null?void 0:se._id)||W.ingredientId,quantity:W.quantity,unit:W.unit}}))||[],mixes:((D=N.mixes)==null?void 0:D.map(W=>({mixId:W.mixId,quantity:W.quantity,unit:W.unit})))||[],_id:N._id}}))||[];Promise.all(P.map(N=>N._id?j(N._id,N):b(r==null?void 0:r._id,N))).then(()=>{}).catch(N=>{console.error("Error managing sizes:",N)});break}},S=()=>{switch(t){case"product":return e.jsxs(k,{form:p,layout:"vertical",onFinish:C,children:[e.jsx(k.Item,{name:"name",label:"שם מוצר",rules:[{required:!0,message:"אנא הזן שם מוצר"}],children:e.jsx(K,{})}),e.jsx(k.Item,{name:"category",label:"קטגוריה",rules:[{required:!0,message:"אנא בחר קטגוריה"}],children:e.jsx(X,{showSearch:!0,placeholder:"בחר קטגוריה",optionFilterProp:"children",filterOption:(_,V)=>V.children.toLowerCase().indexOf(_.toLowerCase())>=0,children:h.map(_=>e.jsx(X.Option,{value:_._id,children:_==null?void 0:_.name},_._id))})}),e.jsx(k.Item,{name:"isFeatured",label:"פעיל",children:e.jsx(Je,{checkedChildren:"פעיל",unCheckedChildren:"לא פעיל"})}),e.jsx(k.Item,{name:"isOnSale",label:"מוצר מכירה",children:e.jsx(Je,{checkedChildren:"פעיל",unCheckedChildren:"לא פעיל"})}),e.jsx(k.Item,{name:"notes",label:"הערות",rules:[{required:!1,message:"אנא הזן הערות"}],children:e.jsx(K.TextArea,{rows:4})}),e.jsx(k.Item,{children:e.jsx(T,{type:"primary",htmlType:"submit",children:"שמור מוצר"})})]});case"size":return e.jsx(et,{value:r==null?void 0:r.sizes,form:o,setValue:m,ingredients:c,sizeSummary:r==null?void 0:r.sizeSummary,priceExcludingVAT:r==null?void 0:r.priceExcludingVAT,mixes:x,onDelete:v,onSubmit:C,onChange:_=>m({...r,sizes:_})});case"variation":return e.jsx(st,{value:r==null?void 0:r.variations,form:l,setValue:m,sizes:r==null?void 0:r.sizes,ingredients:c,onChange:_=>m({...r,variations:_})});default:return null}},$=()=>{var _;switch(t){case"product":return e.jsxs(J,{children:[e.jsxs(A,{align:"middle",justify:"space-between",style:{margin:"1em 0em"},children:[e.jsx(nt,{strong:!0,style:{fontSize:"1.5em"},children:r==null?void 0:r.name}),e.jsxs(A,{style:{gap:"0.5em"},children:[e.jsx(oe,{className:r!=null&&r.isFeatured?"green":"red",children:r!=null&&r.isFeatured?"פעיל":"לא פעיל"}),e.jsx(oe,{className:r!=null&&r.isOnSale?"blue":"yellow",children:r!=null&&r.isOnSale?"במבצע":"לא במבצע"})]}),e.jsx(oe,{children:(_=h==null?void 0:h.find(V=>V._id===(r==null?void 0:r.category)))==null?void 0:_.name})]}),e.jsxs("div",{style:{marginBottom:"12px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(G,{flex:1,children:e.jsxs(nt,{strong:!0,children:["הערות",":"]})}),e.jsx(G,{flex:1,children:e.jsx("p",{style:{},children:r==null?void 0:r.notes})})]}),e.jsx(z,{style:{margin:"8px 0"}})]});case"size":return e.jsx(et,{value:r==null?void 0:r.sizes,sizeSummary:r==null?void 0:r.sizeSummary,priceExcludingVAT:r==null?void 0:r.priceExcludingVAT,mode:"view",ingredients:c,mixes:x,onChange:V=>m({...r,sizes:V})});case"variation":return e.jsx(st,{value:r==null?void 0:r.variations,mode:"view",ingredients:c,onChange:V=>m({...r,variations:V})});default:return null}};return e.jsx(re,{style:{top:F?"3em":""},title:f(t,s,r),open:t,onCancel:()=>{n(!1),m()},footer:null,destroyOnClose:!0,width:F?"100%":600,styles:{gap:"0.5em"},children:s==="view"?$():S()})},{Search:Fs}=K;function Ie({dataPrint:t,data:n,tableKeys:s,newTitle:i,setDataPrint:r,searchKeys:m,sortKeys:g,mobileKeys:u,Dtitle:y,Dcontent:b,onAdd:j,onEdit:v,onDelete:F,width:h,ingredientsArr:c,iconADD:x,floatAction:a,type:d,openModalProduct:p}){const[o,l]=w.useState([]),[f,C]=w.useState(!1),[S,$]=w.useState(!1),[_,V]=w.useState("add"),[B,E]=w.useState(null),P=he({query:"(max-width: 1200px)"}),N=g.map(M=>({key:M==null?void 0:M.key,label:e.jsx("span",{className:"width-100",onClick:()=>{const Q=[...t].sort((Y,Z)=>{const ne=Y[M==null?void 0:M.key],ce=Z[M==null?void 0:M.key];return typeof ne=="number"&&typeof ce=="number"?ce-ne:ne==null?void 0:ne.toString().localeCompare(ce==null?void 0:ce.toString())});r(Q)},children:M==null?void 0:M.title})})),U=M=>{if(M==="all")l(s);else{let Q=o.findIndex(Z=>Z.key===M),Y=[...o];Q!==-1?Y=Y.filter(Z=>Z.key!==M):Y=[...Y,s.find(Z=>Z.key===M)],l(Y)}},D=[{key:"all",label:e.jsx(Re,{className:"width-100",rootClassName:"width-100",checked:o.length===s.length,disabled:o.length===s.length,onChange:()=>U("all"),onClick:M=>M.stopPropagation(),children:"הכל"})},...s.filter(M=>!(M!=null&&M.required)).map(({title:M,dataIndex:Q})=>({key:Q,label:e.jsx(Re,{className:"width-100",rootClassName:"width-100",checked:o.some(Y=>Y.key===Q),disabled:o.length<=3&&o.some(Y=>Y.key===Q),onChange:()=>U(Q),onClick:Y=>Y.stopPropagation(),children:M})}))],W=(M,Q=null)=>{if(d==="P")return p(M,Q);V(M),E(Q),$(!0)},se=()=>{$(!1),E(null)},Ne=M=>{re.confirm({title:y,content:b,okText:"מחק",cancelText:"בטל",onOk:()=>F(M==null?void 0:M._id)})};return w.useEffect(()=>{l(s)},[s]),e.jsxs(G,{flex:1,vertical:!0,style:{maxWidth:"100%"},gap:"1em",className:"container",children:[e.jsxs(A,{align:"middle",style:{flexFlow:""},justify:"space-between",children:[!P&&e.jsx(A,{style:{},children:e.jsx(T,{onClick:()=>W("add"),type:"primary",children:i})}),e.jsx(A,{style:{},children:e.jsx(Fs,{placeholder:"חיפוש ...",allowClear:!0,onChange:({target:M})=>{r(n==null?void 0:n.filter(Q=>m.some(Y=>{var Z,ne,ce;return(ce=(ne=(Z=Q[Y])==null?void 0:Z.toString())==null?void 0:ne.toLowerCase())==null?void 0:ce.includes(M.value.toLowerCase())})))},style:{width:200}})}),e.jsxs(A,{style:{gap:"0.5em"},children:[!P&&e.jsx(Ge,{menu:{items:D},trigger:["click"],open:f,onOpenChange:M=>C(M),children:e.jsxs(T,{children:[e.jsx(R,{icon:Bt,style:{marginLeft:"8px"}}),P?e.jsx(e.Fragment,{children:`${o.length} / ${s.length}`}):e.jsx(e.Fragment,{children:`בחרת ${o.length} מתוך ${s.length}`})]})}),e.jsx(Ge,{menu:{items:N},trigger:["click"],children:e.jsxs(T,{type:P?"link":"default",children:[e.jsx(R,{icon:Wt,style:{marginLeft:"8px"}}),"מיון"]})})]})]}),e.jsxs(Le.Group,{trigger:"click",type:"primary",icon:e.jsx(R,{icon:zt}),children:[e.jsx(Le,{type:"primary",onClick:()=>W("add"),icon:x}),a==null?void 0:a.map((M,Q)=>e.jsx(Oe.Fragment,{children:M},`float-action-${Q}`))]}),e.jsx(Cs,{data:t,tableKeys:[{title:"פעולות",key:"action",width:140,render:(M,Q)=>e.jsxs(A,{className:"card-actions",align:"middle",justify:"center",children:[e.jsx(T,{type:"text",onClick:()=>Ne(Q),children:e.jsx(R,{icon:xt})}),e.jsx(T,{type:"text",onClick:()=>W("edit",Q),children:e.jsx(R,{icon:pt})}),e.jsx(T,{type:"text",onClick:()=>W("view",Q),children:e.jsx(R,{icon:mt})})]})},...o],openModal:W,mobileKeys:u,type:d,Dtitle:y,Dcontent:b,onDelete:F}),e.jsx(re,{style:{top:P?"3em":""},title:_==="add"?"הוסף פריט חדש":_==="edit"?"ערוך פריט":"צפייה בפרטי פריט",open:S,onCancel:se,footer:null,destroyOnClose:!0,width:P?"100%":h||600,children:d!=="P"&&e.jsx(Ps,{mode:_,tableKeys:o,ingredientsArr:c,fields:s.filter(M=>M.editable||_==="view"),onSubmit:M=>{_==="add"&&j(M),_==="edit"&&v({...B,...M}),se()},initialValues:B||{},onClose:se})})]})}const Pe="https://menu-server-c2b952e2c698.herokuapp.com/api",Es=t=>q.post(`${Pe}/categories`,t),Ts=t=>{const n=encodeURIComponent(t._id);return q.put(`${Pe}/categories/${n}`,t)},Ns=t=>q.delete(`${Pe}/categories/${t}`),Ms=()=>q.get(`${Pe}/categories`),ft=w.createContext(),$s=()=>w.useContext(ft),As=({children:t})=>{const[n,s]=w.useState(!1),i=async g=>{s(!0);try{await Es(g),I.success("הקטגוריה נוספה בהצלחה"),s(!1)}catch(u){console.error("Error adding category:",u),I.error("שגיאה בהוספת הקטגוריה"),s(!1)}},r=async g=>{s(!0);try{await Ts(g),I.success("הקטגוריה עודכנה בהצלחה"),s(!1)}catch(u){console.error("Error updating category:",u),I.error("שגיאה בעדכון הקטגוריה"),s(!1)}},m=async g=>{s(!0);try{await Ns(g),I.success("הקטגוריה נמחקה בהצלחה"),s(!1)}catch(u){console.error("Error deleting category:",u),I.error("שגיאה במחיקת הקטגוריה"),s(!1)}};return e.jsx(ft.Provider,{value:{addCategory:i,updateCategory:r,deleteCategory:m,loading:n},children:t})},{Title:rt,Text:qs}=L,Rs=({isCategoryModalVisible:t,setIsCategoryModalVisible:n})=>{const{addCategory:s,updateCategory:i,deleteCategory:r}=$s(),m=O(d=>d.categories),[g,u]=w.useState(""),[y,b]=w.useState(null),[j,v]=w.useState(""),F=()=>{if(g.trim()===""){v("אנא הזן שם קטגוריה תקין");return}if(m.some(d=>d.name===g.trim()&&d!==y)){v("קטגוריה זו כבר קיימת");return}y?i({...y,name:g.trim()}):s({name:g.trim()}),u(""),b(null),v("")},h=d=>{b(d),u(d.name)},c=()=>{if(g.trim()===""){v("אנא הזן שם קטגוריה תקין");return}i({...y,name:g.trim()}),u(""),b(null),v("")},x=d=>{r(d)},a=()=>{u(""),b(null),v(""),n(!1)};return e.jsxs(re,{title:y?"ערוך קטגוריה":"הוסף קטגוריה חדשה",open:t,onCancel:a,footer:null,className:"category-modal popup-modal",children:[e.jsxs("div",{className:"category-form-section",children:[e.jsx(rt,{level:4,children:y?"ערוך קטגוריה":"הוסף קטגוריה חדשה"}),e.jsx(K,{placeholder:"הזן שם קטגוריה",value:g,onChange:d=>u(d.target.value),onPressEnter:F}),j&&e.jsx(qs,{type:"danger",className:"error-message",children:j}),e.jsx(T,{type:"primary",onClick:F,style:{marginTop:"10px"},children:y?"עדכן קטגוריה":"הוסף קטגוריה"})]}),e.jsxs("div",{className:"category-list-section",children:[e.jsx(rt,{level:4,style:{marginTop:"20px"},children:"קטגוריות קיימות:"}),e.jsx(le,{dataSource:m,renderItem:d=>e.jsx(le.Item,{className:y&&y._id===d._id?"editing-item":"",actions:[y&&y._id===d._id?e.jsx(T,{type:"link",onClick:c,children:"שמור"}):e.jsx(T,{type:"link",onClick:()=>h(d),children:"ערוך"}),e.jsx(De,{title:"האם אתה בטוח שברצונך למחוק את הקטגוריה?",onConfirm:()=>x(d._id),okText:"כן",cancelText:"לא",children:e.jsx(T,{icon:e.jsx(xe,{}),type:"text",danger:!0})})],children:y&&y._id===d._id?e.jsx(K,{value:g,onChange:p=>u(p.target.value),onPressEnter:c,autoFocus:!0}):d.name})})]})]})};function Ls(){const{addProduct:t,updateProduct:n,deleteProduct:s,isModalVisible:i,setIsModalVisible:r,modalMode:m,setModalMode:g,selectedItem:u,setSelectedItem:y}=jt(),b=he({query:"(max-width: 1200px)"}),j=w.useRef(null),[v,F]=w.useState([]),[h,c]=w.useState([]),[x,a]=w.useState("all"),[d,p]=w.useState(!1),o=O(E=>E.products),l=O(E=>E.categories),f=O(E=>E.ingredients),C=["name","category"],S=["name","category","detailes","sizes","productSummary","actions"],$=[{key:"name",dataIndex:"name",title:"שם",required:!0},{key:"category",dataIndex:"category",title:"קטגוריה"},{key:"profitMargin",dataIndex:"profitMargin",title:"אחוז רווח"}],_=w.useMemo(()=>[{key:"name",dataIndex:"name",title:"שם המוצר",editable:!0,type:"text",rules:[{required:!0,message:"חייב להיות שם מוצר"},{min:2,message:"שם חייב להיות לפחות 2 תווים"}]},{key:"category",dataIndex:"category",title:"קטגוריה",editable:!0,type:"select",render:(E,P)=>{var N,U;return console.log(P==null?void 0:P.category),console.log(l),console.log((N=l==null?void 0:l.find(D=>D._id===(P==null?void 0:P.category)))==null?void 0:N.name),e.jsx(oe,{children:(U=l==null?void 0:l.find(D=>D._id===(P==null?void 0:P.category)))==null?void 0:U.name})},options:l.map(E=>({value:E._id,label:E.name})),rules:[{required:!0,message:"יש לבחור קטגוריה"}]},{key:"detailes",width:100,render:(E,P)=>e.jsxs(A,{style:{gap:"0.5em"},align:"middle",justify:"center",children:[e.jsx(oe,{className:P!=null&&P.isFeatured?"green":"red",children:P!=null&&P.isFeatured?"פעיל":"לא פעיל"}),e.jsx(oe,{className:P!=null&&P.isOnSale?"blue":"yellow",children:P!=null&&P.isOnSale?"במבצע":"לא במבצע"})]})},{key:"sizes",title:"גדלים",type:"custom",editable:!0,render:(E,P,N="view",U)=>{var D;return(D=P==null?void 0:P.sizes)==null?void 0:D.length}},{key:"variations",title:"ווריאציות",type:"custom",editable:!0,render:(E,P,N="view",U)=>{var D;return(D=P==null?void 0:P.variations)==null?void 0:D.length}},{key:"productSummary",dataIndex:"productSummary",title:"אחוז רווח (ממוצע)",width:150,render:(E,P)=>{var N;return`${((N=P==null?void 0:P.productSummary)==null?void 0:N.averageProfitMargin)||0}%`}},{key:"actions",dataIndex:"actions",width:200,render:(E,P)=>e.jsx("div",{className:"",style:{display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs(T,{type:"text",onClick:()=>{r("size"),y(P)},children:[e.jsx("p",{children:"גדלים"}),e.jsx(R,{icon:we})]})})}],[l]),V=()=>{j.current.scrollBy({left:-200,behavior:"smooth"})},B=()=>{j.current.scrollBy({left:200,behavior:"smooth"})};return w.useEffect(()=>{if(o){const E=x&&x!=="all"?o.filter(P=>P.category===x):o;F(E),c(E)}},[o,x]),e.jsxs("div",{style:{maxWidth:"100%",height:"100%",width:"100%",overflow:"hidden","- webkit - overflow - scrolling":"touch"},children:[e.jsx("div",{className:"menu-page-container",children:e.jsxs("div",{className:"bubble-category-wrapper",children:[e.jsx("button",{className:"scroll-button right",onClick:B,children:"<"}),e.jsxs("div",{className:"bubble-category-container",ref:j,children:[e.jsx("div",{className:`bubble-category-item ${x==="all"?"selected":""}`,onClick:()=>a("all"),children:"הכל"}),l.map(E=>e.jsx("div",{className:`bubble-category-item ${x===E._id?"selected":""}`,onClick:()=>a(E._id),children:E.name},E._id))]}),e.jsx("button",{className:"scroll-button left",onClick:V,children:">"}),!b&&e.jsx("div",{className:"bubble-add-category",onClick:()=>p(!0),children:"+"})]})}),e.jsx(Ie,{type:"P",data:v,mobileKeys:S,dataPrint:h,sortKeys:$,tableKeys:_,newTitle:"הוסף מוצר חדש",searchKeys:C,setDataPrint:c,onAdd:t,onEdit:n,onDelete:s,ingredientsArr:f,Dtitle:"אישור מחיקה",Dcontent:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"האם אתה בטוח שברצונך למחוק את המוצר?"}),e.jsx("p",{children:"שים לב! מחיקת מוצר עשויה להשפיע על מכירות ותערובות קשורות."})]}),iconADD:e.jsx(R,{icon:ve}),floatAction:[e.jsx(Le,{type:"primary",onClick:()=>p(!0),icon:e.jsx(R,{icon:we})})],openModalProduct:(E,P)=>{r("product"),g(E),P&&y(P)}}),e.jsx(Rs,{isCategoryModalVisible:d,setIsCategoryModalVisible:p}),e.jsx(_s,{})]})}const ke="https://menu-server-c2b952e2c698.herokuapp.com/api",Hs=t=>q.post(`${ke}/suppliers`,t),Vs=t=>{const n=encodeURIComponent(t._id);return q.put(`${ke}/suppliers/${n}`,t)},Os=t=>q.delete(`${ke}/suppliers/${t}`),Us=()=>q.get(`${ke}/suppliers`),bt=w.createContext(),Ds=()=>w.useContext(bt),Bs=({children:t})=>{const[n,s]=w.useState(!1),i=async g=>{s(!0);try{await Hs(g),I.success("הספק נוסף בהצלחה"),s(!1)}catch(u){console.error("Error adding supplier:",u),I.error("שגיאה בהוספת הספק"),s(!1)}},r=async g=>{s(!0);try{await Vs(g),I.success("הספק עודכן בהצלחה"),s(!1)}catch(u){console.error("Error updating supplier:",u),I.error("שגיאה בעדכון הספק"),s(!1)}},m=async g=>{s(!0);try{await Os(g),I.success("הספק נמחק בהצלחה"),s(!1)}catch(u){console.error("Error deleting supplier:",u),I.error("שגיאה במחיקת הספק"),s(!1)}};return e.jsx(bt.Provider,{value:{addSupplier:i,updateSupplier:r,deleteSupplier:m,loading:n},children:t})};function Ws(){const{addSupplier:t,updateSupplier:n,deleteSupplier:s}=Ds(),i=O(h=>h.suppliers),r=O(h=>h.ingredients),[m,g]=w.useState([]),[u,y]=w.useState([]),b=["name"],j=["name","phone","email","contect_name","address",,"second_phone","notes"],v=[{key:"name",dataIndex:"name",title:"שם",required:!0},{key:"usedCount",dataIndex:"usedCount",title:"כמות רכיבים"}],F=[{key:"name",dataIndex:"name",title:"שם הספק",editable:!0,type:"text",width:100,rules:[{required:!0,message:"חייב להיות שם ספק"},{min:3,message:"שם ספק חייב להיות לפחות 3 תווים"}]},{key:"usedCount",dataIndex:"usedCount",title:"כמות רכיבים",editable:!1},{key:"phone",dataIndex:"phone",title:"טלפון",editable:!0,type:"text",width:100,rules:[{required:!0,message:"חייב להיות מספר טלפון"},{pattern:/^[0-9]{9,10}$/,message:"טלפון חייב להיות מספר תקין באורך 9-10 ספרות"}]},{key:"email",dataIndex:"email",title:"אימייל",editable:!0,type:"text",width:100,rules:[{required:!0,message:"חייב להיות אימייל"},{type:"email",message:"אימייל לא תקין"}]},{key:"contect_name",dataIndex:"contect_name",title:"איש קשר",editable:!0,type:"text",width:100,rules:[{required:!0,message:"חייב להיות איש קשר"},{min:3,message:"איש קשר חייב להיות לפחות 3 תווים"}]},{key:"address",dataIndex:"address",title:"כתובת",editable:!0,type:"text",width:150,rules:[{required:!0,message:"חייבת להיות כתובת"},{min:5,message:"כתובת חייבת להיות לפחות 5 תווים"}]},{key:"second_phone",dataIndex:"second_phone",title:"טלפון נוסף",editable:!0,type:"text",width:100,rules:[{pattern:/^[0-9]{9,10}$/,message:"טלפון חייב להיות מספר תקין באורך 9-10 ספרות"}]},{key:"notes",dataIndex:"notes",title:"הערות",editable:!0,type:"textArea",maxLength:120,width:150,rules:[{required:!1},{max:120,message:"מקסימום 120 תווים"}],render:(h,c)=>{const x=(c==null?void 0:c.notes)||"—";return e.jsx(ct,{title:x,children:e.jsx("span",{style:{display:"inline-block",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",maxWidth:"150px"},children:x})})}}];return w.useEffect(()=>{if(i){const h=i.map(c=>{const x=r==null?void 0:r.filter(a=>a.supplierId===c._id).length;return{...c,usedCount:x}});g(h),y(h)}},[i,r]),e.jsx(Ie,{data:m,mobileKeys:j,dataPrint:u,sortKeys:v,tableKeys:F,newTitle:"הוסף חומר גלם חדש",searchKeys:b,setDataPrint:y,onAdd:t,onEdit:n,onDelete:s,Dtitle:"אישור מחיקה",iconADD:e.jsx(R,{icon:We}),Dcontent:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"האם אתה בטוח שברצונך למחוק את הספק?"}),e.jsx("p",{children:"שים לב! במחיקת ספק אתה תמחוק את כל הרכיבים שלו וכן הם כמובן ימחקו מכל התערובות והמוצרים."})]})})}const _e="https://menu-server-c2b952e2c698.herokuapp.com/api",zs=t=>q.post(`${_e}/ingredients`,t),Ys=t=>{const n=encodeURIComponent(t._id);return q.put(`${_e}/ingredients/${n}`,t)},Qs=t=>q.delete(`${_e}/ingredients/${t}`),Js=()=>q.get(`${_e}/ingredients`),wt=w.createContext(),Gs=()=>w.useContext(wt),Ks=({children:t})=>{const[n,s]=w.useState(!1),i=async g=>{s(!0);try{await zs(g),I.success("החומר גלם נוסף בהצלחה"),s(!1)}catch{I.error("שגיאה בהוספת חומר הגלם"),s(!1)}},r=async g=>{s(!0);try{await Ys(g),I.success("החומר גלם עודכן בהצלחה"),s(!1)}catch{I.error("שגיאה בעדכון חומר הגלם"),s(!1)}},m=async g=>{s(!0);try{await Qs(g),I.success("החומר גלם נמחק בהצלחה"),s(!1)}catch{I.error("שגיאה במחיקת חומר הגלם"),s(!1)}};return e.jsx(wt.Provider,{value:{addIngredient:i,updateIngredient:r,deleteIngredient:m,loading:n},children:t})},me=[{color:"magenta",value:"פירות טריים"},{color:"volcano",value:"פירות קפואים"},{color:"orange",value:"תמציות, ממרחים ותוספות"},{color:"gold",value:"אבקות"},{color:"lime",value:"גלידות וסורבה"},{color:"green",value:"מאפים ועוגיות"},{color:"cyan",value:"אריזות וחד פעמי"},{color:"blue",value:"מוצרי חלב"}],ue=[{value:"weight",label:"משקל",display:t=>t>=1?'ק"ג':"גרם"},{value:"volume",label:"נפח",display:t=>t>=1?"ליטר":'מ"ל'},{value:"units",label:"יחידות",display:()=>"יחידות"}],{Text:Xs}=L;function Zs(){const t=O(x=>x.suppliers),n=O(x=>x.ingredients),s=O(x=>x.products),i=O(x=>x.mixes),{addIngredient:r,updateIngredient:m,deleteIngredient:g}=Gs(),[u,y]=w.useState([]),[b,j]=w.useState([]),v=["name","type","supplierId"],F=["unit","unitPrice","supplierId","usedInMixes","usedInProducts"],h=[{key:"name",dataIndex:"name",title:"שם",required:!0},{key:"type",dataIndex:"type",title:"סוג"},{key:"usedCount",dataIndex:"usedCount",title:"בשימוש"},{key:"unit",dataIndex:"unit",title:"יחידת מידה"},{key:"supplierName",dataIndex:"supplierName",title:"שם ספק"}],c=[{key:"SKU",dataIndex:"SKU",title:'מק"ט',editable:!0,type:"number",width:100,rules:[{validator:async(x,a,d)=>a?typeof a!="number"?Promise.reject('מק"ט חייב להיות מספר תקין'):a.toString().length<6?Promise.reject('מק"ט חייב להיות מינימום 6 ספרות'):u.some(o=>o.SKU===a&&o._id!==(d==null?void 0:d._id))?Promise.reject('מק"ט זה כבר קיים במערכת'):Promise.resolve():Promise.resolve()}]},{key:"name",dataIndex:"name",title:"שם",required:!0,editable:!0,type:"text",width:100,rules:[{required:!0,message:"השדה חובה"},{min:3,message:"השם חייב להיות לפחות 3 תווים"},{pattern:/^[א-תa-zA-Z\s0-9%-]+$/,message:"השם יכול להכיל אותיות בעברית או אנגלית, מספרים והתווים הבאים: ' % ', ' - '"}]},{key:"supplierId",dataIndex:"supplierId",title:"שם ספק",editable:!0,type:"select",width:100,render:(x,a)=>{var d;return e.jsx("p",{children:(d=t==null?void 0:t.find(p=>(p==null?void 0:p._id)===(a==null?void 0:a.supplierId)))==null?void 0:d.name})},options:t==null?void 0:t.map(x=>({value:x._id,label:x==null?void 0:x.name})),rules:[{required:!0,message:"יש לבחור ספק"},{validator:(x,a)=>(t==null?void 0:t.some(p=>p._id===a))?Promise.resolve():Promise.reject("ספק לא חוקי נבחר")}]},{key:"usedCount",dataIndex:"usedCount",title:"בשימוש",editable:!1,width:100},{key:"type",dataIndex:"type",title:"סוג",render:(x,a)=>{var d;return e.jsx(oe,{color:(d=me==null?void 0:me.find(p=>p.value===(a==null?void 0:a.type)))==null?void 0:d.color,children:a==null?void 0:a.type})},type:"select",required:!0,editable:!0,options:me.map(x=>({value:x.value,label:x.value})),divider:!0,width:100,rules:[{required:!0,message:"יש לבחור סוג"},{validator:(x,a)=>(me==null?void 0:me.some(p=>p.value===a))?Promise.resolve():Promise.reject("סוג לא חוקי נבחר")}]},{key:"unit",dataIndex:"unit",title:"יחידת מידה",editable:!0,type:"select",options:ue,width:100,render:(x,a)=>{var d;return e.jsx("p",{children:((d=ue.find(p=>p.value===(a==null?void 0:a.unit)))==null?void 0:d.label)||(a==null?void 0:a.unit)})},rules:[{required:!0,message:"יש לבחור יחידת מידה"},{validator:(x,a)=>(ue==null?void 0:ue.some(p=>p.value===a))?Promise.resolve():Promise.reject("יחידת מידה לא חוקית")}]},{key:"quantity",dataIndex:"quantity",title:"כמות",editable:!0,type:"custom",width:100,render:(x,a,d,p)=>{if(d=="edit")return e.jsx(k.Item,{name:"quantity",label:"כמות",rules:[{required:!0,message:"אנא הזן כמות"},{validator:(f,C)=>(p.getFieldValue("subUnit"),C==null?Promise.reject("כמות נדרשת"):C<0?Promise.reject("הכמות לא יכולה להיות שלילית"):(p.getFieldValue("subUnit")==="g"||p.getFieldValue("subUnit")==="ml")&&(C<.1||C>999)?Promise.reject('עבור גרם או מ"ל הכמות חייבת להיות בין 0.1 ל-999'):(p.getFieldValue("subUnit")==="kg"||p.getFieldValue("subUnit")==="liter")&&(C<1||C>1e6)?Promise.reject('עבור ק"ג או ליטר הכמות חייבת להיות מ-1 ומעלה, ובתוך הטווח המותר'):Promise.resolve())}],children:e.jsx(te,{style:{width:"100%"}})},"quantity");let o=a.unit,l="";return o==="weight"?l=a.quantity>=1?'ק"ג':"גרם":o==="volume"?l=a.quantity>=1?"ליטר":'מ"ל':o==="units"&&(l="יחידות"),e.jsxs("p",{children:[a.quantity<1?a.quantity*1e3:a.quantity," ",l]})}},{key:"price",dataIndex:"price",title:"מחיר כולל מעמ",render:(x,a)=>e.jsxs("p",{children:["₪",a==null?void 0:a.price]}),editable:!0,type:"number",coin:!0,width:100,rules:[{required:!0,message:"מחיר חסר"}],show:!1},{key:"priceExcludingVAT",dataIndex:"priceExcludingVAT",width:100,title:"מחיר ללא מעמ",render:(x,a)=>e.jsxs("p",{children:["₪",a==null?void 0:a.priceExcludingVAT]}),editable:!1,hiddenInForm:!0},{key:"unitPrice",dataIndex:"unitPrice",title:"כמות מינימלית",width:100,render:(x,a)=>e.jsxs(H,{children:[e.jsxs(A,{children:[e.jsxs("p",{children:[a.unitQuantity<1?a.unitQuantity*1e3:a.unitQuantity," ",a==null?void 0:a.unitDescription]}),e.jsx("br",{})]}),e.jsxs("p",{children:["₪",a==null?void 0:a.unitPrice]})]})},{key:"juiceRatio",dataIndex:"juiceRatio",title:"יחס עיבוד (תפוקת חומר מעובד)",editable:!0,width:100,type:"custom",render:(x,a,d,p)=>d=="view"||d!=="edit"?e.jsx("p",{children:a!=null&&a.juiceRatio?`${((a==null?void 0:a.juiceRatio)*100).toFixed(0)}%`:""}):e.jsxs(e.Fragment,{children:[e.jsx(k.Item,{name:"isJuice",valuePropName:"checked",style:{marginBottom:0},children:e.jsx(Re,{onChange:o=>{p.setFieldsValue({isJuice:o.target.checked}),o.target.checked||p.setFieldsValue({juiceRatio:void 0})},children:"האם הרכיב דורש עיבוד?"})}),e.jsx(k.Item,{noStyle:!0,shouldUpdate:(o,l)=>o.isJuice!==l.isJuice,children:({getFieldValue:o})=>o("isJuice")&&e.jsx(k.Item,{name:"juiceRatio",label:"יחס המיץ (0.1 עד 0.99)",rules:[{required:!0,message:"אנא הזן יחס מיץ"},{type:"number",min:.1,max:.99,message:"היחס חייב להיות בין 0.1 ל-0.99"}],children:e.jsx(te,{style:{width:"100%"}})})})]})},{key:"processedPrice",dataIndex:"processedPrice",title:"מחיר לכמות מינימלית מעובדת",width:100,render:(x,a)=>e.jsx("p",{children:a!=null&&a.processedPrice?`₪${a==null?void 0:a.processedPrice}`:""}),editable:!1,hiddenInForm:!0},{key:"notes",dataIndex:"notes",title:"הערות",width:100,editable:!0,render:(x,a)=>{const d=(a==null?void 0:a.notes)||"—";return e.jsx(ct,{title:d,children:e.jsx(Xs,{style:{display:"inline-block",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",maxWidth:"150px",direction:"rtl"},children:d})})},type:"textArea",maxLength:120,rules:[{required:!1},{max:120,message:"מקסימום 120 תווים"}]}];return w.useEffect(()=>{if(n)if(t){let x=[...n==null?void 0:n.map(a=>{let d=t==null?void 0:t.find(l=>(l==null?void 0:l._id)===(a==null?void 0:a.supplierId));const p=(s==null?void 0:s.reduce((l,f)=>{var C;return l+((C=f.ingredients)==null?void 0:C.filter(S=>S.ingredientId===a._id).length)},0))||0,o=(i==null?void 0:i.reduce((l,f)=>{var C;return l+((C=f.ingredients)==null?void 0:C.filter(S=>S.ingredientId===a._id).length)},0))||0;return{...a,supplierName:d==null?void 0:d.name,usedCount:p+o}})];y(x),j(x)}else y([...n]),j([...n])},[t,n]),e.jsx(e.Fragment,{children:e.jsx(Ie,{data:u,mobileKeys:F,dataPrint:b,sortKeys:h,tableKeys:c,newTitle:"הוסף חומר גלם חדש",searchKeys:v,setDataPrint:j,onAdd:r,onEdit:m,onDelete:g,Dtitle:"אישור מחיקה",iconADD:e.jsx(R,{icon:Ce}),Dcontent:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"האם אתה בטוח שברצונך למחוק את הרכיב?"}),e.jsx("p",{children:"שים לב! הרכיב יימחק מכל המוצרים והתערובות בהם הוא נמצא."})]})})})}es.register(ts,ss,ns,rs,as,is);const{Text:en}=L,tn=["#4E79A7","#F28E2B","#E15759","#76B7B2","#59A14F"];function sn(){const t=O(h=>h.categories),n=O(h=>h.products),s=O(h=>h.suppliers),i=O(h=>h.ingredients),r=O(h=>h.mixes),m=O(h=>h.employees),g=he({query:"(max-width: 768px)"}),u=w.useMemo(()=>{const h=n.reduce((c,x)=>{var d;const a=((d=t.find(p=>p._id===x.category))==null?void 0:d.name)||"לא מוגדר";return c[a]=(c[a]||0)+1,c},{});return{labels:Object.keys(h),datasets:[{data:Object.values(h),backgroundColor:tn}]}},[n,t]),y=w.useMemo(()=>[...i].sort((h,c)=>(c.unitPrice||0)-(h.unitPrice||0)).slice(0,5).map(h=>({name:h.name,price:h.unitPrice})),[i]),b=w.useMemo(()=>[...r].map(h=>{const c=h.totalCost/h.totalWeight;return{name:h.name,costPerLiter:c}}).sort((h,c)=>(c.costPerLiter||0)-(h.costPerLiter||0)).slice(0,5),[r]),j={labels:y.map(h=>h.name),datasets:[{label:"מחיר ל-100 גרם",data:y.map(h=>h.price),backgroundColor:"#FF8042"}]},v={labels:b.map(h=>h.name),datasets:[{label:"עלות לליטר",data:b.map(h=>h.costPerLiter),backgroundColor:"#8884d8"}]},F=w.useMemo(()=>n.filter(h=>h.profitMargin<=90).slice(0,3).map(h=>({key:h._id,name:h.name,profitMargin:h.profitMargin})),[n]);return e.jsxs("div",{className:"dashboard-container",style:{padding:g?"10px":"20px"},children:[e.jsxs(A,{gutter:[5,5],wrap:!0,children:[e.jsx(H,{xs:12,sm:12,md:10,lg:8,xl:6,children:e.jsx(ee,{to:"/menu",children:e.jsxs(J,{className:"dashboard-card",children:[e.jsx("div",{className:"icon-circle green",children:e.jsx(R,{icon:ve})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-title",children:"מוצרים"}),e.jsx("div",{className:"stat-value",children:n.length})]})]})})}),e.jsx(H,{xs:12,sm:12,md:10,lg:8,xl:6,children:e.jsx(ee,{to:"/suppliers",children:e.jsxs(J,{className:"dashboard-card",children:[e.jsx("div",{className:"icon-circle red",children:e.jsx(R,{icon:We})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-title",children:"ספקים"}),e.jsx("div",{className:"stat-value",children:s.length})]})]})})}),e.jsx(H,{xs:12,sm:12,md:10,lg:8,xl:6,children:e.jsx(ee,{to:"/ingredients",children:e.jsxs(J,{className:"dashboard-card",children:[e.jsx("div",{className:"icon-circle blue",children:e.jsx(R,{icon:Ce})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-title",children:"חומרי גלם"}),e.jsx("div",{className:"stat-value",children:i.length})]})]})})}),e.jsx(H,{xs:12,sm:12,md:10,lg:8,xl:6,children:e.jsx(ee,{to:"/menu",children:e.jsxs(J,{className:"dashboard-card",children:[e.jsx("div",{className:"icon-circle yellow",children:e.jsx(R,{icon:we})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-title",children:"קטגוריות"}),e.jsx("div",{className:"stat-value",children:t.length})]})]})})}),e.jsx(H,{xs:12,sm:12,md:10,lg:8,xl:6,children:e.jsx(ee,{to:"/mixes",children:e.jsxs(J,{className:"dashboard-card",children:[e.jsx("div",{className:"icon-circle purple",children:e.jsx(R,{icon:Me})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-title",children:"תערובות"}),e.jsx("div",{className:"stat-value",children:r.length})]})]})})}),e.jsx(H,{xs:12,sm:12,md:10,lg:8,xl:6,children:e.jsx(ee,{to:"/employees",children:e.jsxs(J,{className:"dashboard-card",children:[e.jsx("div",{className:"icon-circle aqua",children:e.jsx(R,{icon:Me})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-title",children:"עובדים"}),e.jsx("div",{className:"stat-value",children:m==null?void 0:m.length})]})]})})})]}),e.jsx(z,{className:"no-margin"}),e.jsxs(A,{gutter:[16,16],children:[e.jsx(H,{xs:24,md:12,children:e.jsx(J,{className:"dashboard-card",title:e.jsxs("span",{children:[e.jsx(R,{icon:we,style:{marginLeft:"8px"}}),"מוצרים לפי קטגוריה"]}),children:e.jsx(Zt,{data:u,options:{responsive:!0,maintainAspectRatio:!1}})})}),e.jsx(H,{xs:24,md:12,children:e.jsx(J,{className:"dashboard-card",title:e.jsxs("span",{children:[e.jsx(R,{icon:Ce,style:{marginLeft:"8px"}}),"חומרי הגלם היקרים ביותר"]}),children:e.jsx(Ke,{data:j,options:{responsive:!0,maintainAspectRatio:!1}})})})]}),e.jsx(z,{className:"no-margin"}),e.jsxs(A,{gutter:[16,16],children:[e.jsx(H,{xs:24,md:12,children:e.jsx(J,{className:"dashboard-card",title:e.jsxs("span",{children:[e.jsx(R,{icon:Me,style:{marginLeft:"8px"}}),"התערובות היקרות ביותר"]}),children:e.jsx(Ke,{data:v,options:{responsive:!0,maintainAspectRatio:!1}})})}),e.jsx(H,{xs:24,md:12,children:e.jsx(J,{className:"dashboard-card",title:e.jsxs("span",{children:[e.jsx(R,{icon:ve,style:{marginLeft:"8px"}}),"מוצרים עם רווחיות נמוכה"]}),children:e.jsx(A,{gutter:[16,16],children:F.map(h=>e.jsx(H,{xs:24,sm:8,children:e.jsxs(J,{children:[e.jsx(be,{title:h.name,value:h.profitMargin,suffix:"%",valueStyle:{color:"#cf1322"}}),e.jsx(en,{type:"secondary",children:"רווחיות"})]})},h.key))})})})]})]})}const Fe="https://menu-server-c2b952e2c698.herokuapp.com/api",nn=t=>q.post(`${Fe}/mixes`,t),rn=t=>{const n=encodeURIComponent(t._id);return q.put(`${Fe}/mixes/${n}`,t)},an=t=>q.delete(`${Fe}/mixes/${t}`),ln=()=>q.get(`${Fe}/mixes`),vt=w.createContext(),on=()=>w.useContext(vt),dn=({children:t})=>{const[n,s]=w.useState(!1),i=async g=>{s(!0);try{await nn(g),I.success("התערובת נוספה בהצלחה"),s(!1)}catch(u){console.error("Error adding mix:",u),I.error("שגיאה בהוספת התערובת"),s(!1)}},r=async g=>{s(!0);try{await rn(g),I.success("התערובת עודכנה בהצלחה"),s(!1)}catch(u){console.error("Error updating mix:",u),I.error("שגיאה בעדכון התערובת"),s(!1)}},m=async g=>{s(!0);try{await an(g),I.success("התערובת נמחקה בהצלחה"),s(!1)}catch(u){console.error("Error deleting mix:",u),I.error("שגיאה במחיקת התערובת"),s(!1)}};return e.jsx(vt.Provider,{value:{addMix:i,updateMix:r,deleteMix:m,loading:n},children:t})};function cn(){const{addMix:t,updateMix:n,deleteMix:s}=on(),[i,r]=w.useState([]),[m,g]=w.useState([]),u=O(x=>x.mixes),y=O(x=>x.ingredients),b=O(x=>x.products),j=O(x=>x.employeeHours.overallAverageHourlyRate),v=["name","ingredients"],F=["name","preparationTime","totalCost","totalWeight","usedCount"],h=[{key:"name",dataIndex:"name",title:"שם",required:!0},{key:"preparationTime",dataIndex:"preparationTime",title:"זמן הכנה"},{key:"totalCost",dataIndex:"totalCost",title:"עלות כוללת"},{key:"totalWeight",dataIndex:"totalWeight",title:"משקל כולל"},{key:"usedCount",dataIndex:"usedCount",title:"בשימוש"}],c=[{key:"name",dataIndex:"name",title:"שם התערובת",editable:!0,type:"text",rules:[{required:!0,message:"חייב להיות שם תערובת"},{min:3,message:"שם חייב להיות לפחות 3 תווים"}]},{key:"usedCount",dataIndex:"usedCount",title:"בשימוש",editable:!1,width:100},{key:"preparationTime",dataIndex:"preparationTime",title:"זמן הכנה (דקות)",editable:!0,width:160,type:"number",rules:[{required:!0,message:"זמן הכנה נדרש"},{type:"number",min:0,message:"זמן הכנה חייב להיות מספר חיובי"}]},{key:"ingredients",title:"רכיבים",type:"ingredientsManager",editable:!0,width:500,fields:[{key:"ingredientId",type:"select",title:"רכיב",placeholder:"בחר רכיב",options:y.map(x=>({value:x._id,label:x.name})),required:!0,rules:[{required:!0,message:"יש לבחור רכיב"}]},{key:"quantity",type:"number",title:"כמות",placeholder:"הזן כמות",required:!0,rules:[{required:!0,message:"יש להזין כמות"},{type:"number",min:0,message:"כמות חייבת להיות חיובית"}]},{key:"unit",type:"text",title:"יחידה",readonly:!0}],render:(x,a)=>{let d=[...(a==null?void 0:a.ingredients)||[]].sort((p,o)=>o.quantity-p.quantity);return d=d==null?void 0:d.map(p=>{var o;return{name:p==null?void 0:p.ingredientId.name,quantity:(p==null?void 0:p.rawQuantityForJuice)||p.quantity,unit:(o=ue==null?void 0:ue.find(l=>l.value===p.unit))==null?void 0:o.display((p==null?void 0:p.rawQuantityForJuice)||p.quantity)}}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"5px"},children:d==null?void 0:d.map((p,o)=>e.jsx("span",{style:{whiteSpace:"normal"},children:`${p==null?void 0:p.name} (${p.quantity} ${p.unit}), `},o))})},rules:[{required:!0,message:"יש לבחור לפחות רכיב אחד"}]},{key:"totalCost",dataIndex:"totalCost",title:"עלות כוללת (₪)",render:(x,a)=>(a==null?void 0:a.totalCost)!=null&&(a==null?void 0:a.laborCost)!=null?`₪${(Number(a.totalCost)+Number(a.laborCost)).toFixed(2)}`:"—",editable:!1},{key:"unitCost",dataIndex:"unitCost",title:"עלות ל-100 גרם (₪)",render:(x,a)=>(a==null?void 0:a.totalWeight)!=null&&(a==null?void 0:a.totalCost)!=null?`₪${((Number(a.totalCost)+Number(a.laborCost||0))/(Number(a.totalWeight)*10)).toFixed(2)} / 100 גרם`:"—",editable:!1},{key:"laborCost",dataIndex:"laborCost",title:"עלות עבודה (₪)",render:(x,a)=>{var d;return`₪${(d=a==null?void 0:a.laborCost)==null?void 0:d.toFixed(2)}`||"—"},editable:!1},{key:"totalWeight",dataIndex:"totalWeight",title:'משקל כולל (ק"ג)',render:(x,a)=>{var d;return((d=a.totalWeight)==null?void 0:d.toFixed(2))||"—"},editable:!1}];return w.useEffect(()=>{if(u&&y){const x=u.map(a=>{const d=a.ingredients.reduce((l,f)=>l+(f.quantity||0),0),p=parseFloat(a==null?void 0:a.laborCost)||j/60*(a==null?void 0:a.preparationTime),o=(b==null?void 0:b.reduce((l,f)=>{var C;return l+((C=f.mixes)==null?void 0:C.filter(S=>S.mixId===a._id).length)},0))||0;return{...a,totalWeight:d,laborCost:p,usedCount:o}});r(x),g(x)}},[u,y,j]),e.jsx(Ie,{data:i,mobileKeys:F,dataPrint:m,sortKeys:h,tableKeys:c,newTitle:"הוסף תערובת חדשה",searchKeys:v,setDataPrint:g,onAdd:t,onEdit:n,onDelete:s,Dtitle:"אישור מחיקה",ingredientsArr:y,iconADD:e.jsx(R,{icon:gt}),Dcontent:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"האם אתה בטוח שברצונך למחוק את התערובת?"}),e.jsx("p",{children:"שים לב! מחיקת תערובת עשויה להשפיע על מוצרים המשתמשים בה."})]})})}const{Text:un}=L,{Option:fe}=X,Ct=({addEmployee:t,initialValues:n,onClose:s})=>{const[i]=k.useForm(),r=O(y=>y.employees),[m,g]=w.useState("");w.useEffect(()=>{n&&i.setFieldsValue(n)},[n,i]);const u=y=>{if(r.some(b=>b.name===y.name.trim()&&(!n||b._id!==n._id))){g("קיים כבר עובד בעל שם דומה");return}t({...n,...y}),i.resetFields(),s()};return e.jsx(J,{className:"employee-form-card",children:e.jsxs(k,{form:i,layout:"vertical",onFinish:u,initialValues:n,children:[e.jsx(k.Item,{label:"שם עובד",name:"name",rules:[{required:!0,message:"אנא הזן שם עובד"}],children:e.jsx(K,{})}),e.jsx(k.Item,{label:"תפקיד",name:"position",children:e.jsx(K,{placeholder:"הזן תפקיד"})}),e.jsx(k.Item,{label:"תעריף שעתי",name:"hourlyRate",rules:[{required:!0,message:"אנא הזן תעריף שעתי"}],children:e.jsx(te,{min:0,style:{width:"100%"}})}),e.jsx(k.Item,{label:"סטטוס",name:"status",initialValue:"active",rules:[{required:!0}],children:e.jsxs(X,{children:[e.jsx(fe,{value:"active",children:"פעיל"}),e.jsx(fe,{value:"inactive",children:"לא פעיל"}),e.jsx(fe,{value:"on_leave",children:"בחופשה"}),e.jsx(fe,{value:"terminated",children:"סיים העסקה"})]})}),m&&e.jsx(Lt,{style:{display:"block",marginBottom:"10px"},children:e.jsx(un,{type:"danger",className:"error-message",children:m})}),e.jsxs(k.Item,{children:[e.jsx(T,{type:"primary",htmlType:"submit",className:"employee-form-button",children:n?"עדכן עובד":"הוסף עובד"}),e.jsx(T,{className:"employee-form-button",onClick:s,style:{marginLeft:"8px"},children:"ביטול"})]})]})})},Ee="https://menu-server-c2b952e2c698.herokuapp.com/api",xn=t=>q.post(`${Ee}/employees`,t),pn=t=>{const n=encodeURIComponent(t._id);return q.put(`${Ee}/employees/${n}`,t)},mn=t=>q.delete(`${Ee}/employees/${t}`),hn=(t,n)=>q.get(`${Ee}/employees?`),St=w.createContext(),It=()=>w.useContext(St),gn=({children:t})=>{const[n,s]=w.useState(!1),i=async g=>{s(!0);try{await xn(g),I.success("העובד נוסף בהצלחה"),s(!1)}catch(u){console.error("Error adding employee:",u),I.error("שגיאה בהוספת עובד"),s(!1)}},r=async g=>{s(!0);try{await pn(g),I.success("העובד עודכן בהצלחה"),s(!1)}catch(u){console.error("Error updating employee:",u),I.error("שגיאה בעדכון עובד"),s(!1)}},m=async g=>{s(!0);try{await mn(g),I.success("העובד נמחק בהצלחה"),s(!1)}catch(u){console.error("Error deleting employee:",u),I.error("שגיאה במחיקת עובד"),s(!1)}};return e.jsx(St.Provider,{value:{addEmployee:i,updateEmployee:r,deleteEmployee:m,loading:n},children:t})},{Text:$e}=L,yn=({sortKey:t})=>{const{updateEmployee:n,deleteEmployee:s}=It(),i=O(v=>v.employees),[r,m]=w.useState(!1),[g,u]=w.useState(null),y=v=>{u(v),m(!0)},b=()=>{u(null),m(!1)},j=[...i].sort((v,F)=>t==="name"?v.name.localeCompare(F.name):0);return e.jsxs(J,{title:"רשימת עובדים",className:"employee-list-card",children:[e.jsx(le,{itemLayout:"vertical",dataSource:j,renderItem:v=>e.jsx(le.Item,{className:"employee-item",actions:[e.jsx(T,{type:"link",onClick:()=>y(v),children:"ערוך"}),e.jsx(De,{title:"האם אתה בטוח שברצונך למחוק את העובד הנוכחי?",onConfirm:()=>s(v._id),okText:"כן",cancelText:"לא",children:e.jsx(T,{icon:e.jsx(xe,{}),danger:!0})})],children:e.jsx(le.Item.Meta,{title:e.jsx($e,{strong:!0,children:v.name}),description:e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx($e,{strong:!0,children:"תפקיד:"})," ",v.position||"לא הוגדר"]}),e.jsxs("p",{children:[e.jsx($e,{strong:!0,children:"תעריף שעתי:"})," ",v.hourlyRate," ₪"]}),e.jsx("p",{children:e.jsx(Ht,{color:fn(v.status),text:jn(v.status),style:{marginLeft:"8px"}})})]})})},v._id)}),e.jsx(re,{title:g?"ערוך עובד":"הוסף עובד חדש",open:r,onCancel:b,footer:null,children:e.jsx(Ct,{addEmployee:n,initialValues:g,onClose:b})})]})},jn=t=>{switch(t){case"active":return"פעיל";case"inactive":return"לא פעיל";case"on_leave":return"בחופשה";case"terminated":return"סיים העסקה";default:return"לא ידוע"}},fn=t=>{switch(t){case"active":return"green";case"inactive":return"grey";case"on_leave":return"orange";case"terminated":return"red";default:return"blue"}};function bn(){const{addEmployee:t}=It(),[n,s]=w.useState(!1),[i,r]=w.useState(""),m=()=>{s(!0)},g=()=>{s(!1)};return e.jsxs("div",{style:{padding:"20px"},className:"scrollable-content employees-page-container",children:[e.jsxs("div",{className:"employees-controls",children:[e.jsx(T,{type:"primary",onClick:m,className:"add-employee-button",children:"הוסף עובד חדש"}),e.jsxs(X,{value:i,onChange:u=>r(u),className:"sort-select",children:[e.jsx(X.Option,{value:"",children:"מיין"}),e.jsx(X.Option,{value:"name",children:"מיין לפי שם"})]})]}),e.jsx(yn,{sortKey:i}),e.jsx(re,{title:"הוסף עובד חדש",open:n,onCancel:g,footer:null,destroyOnClose:!0,children:e.jsx(Ct,{addEmployee:t,onClose:g})})]})}const je="https://menu-server-c2b952e2c698.herokuapp.com/api",wn=(t,n)=>q.post(`${je}/employees/${t}/hours`,n),vn=(t,n)=>q.put(`${je}/employees/hours/${t}`,n),Cn=t=>q.delete(`${je}/employees/hours/${t}`),Sn=t=>q.get(`${je}/employees/${t}/hours`),In=(t,n)=>q.get(`${je}/employees/hours/${n}/${t}`),Pt=w.createContext(),Pn=()=>w.useContext(Pt),kn=({children:t})=>{const[n,s]=w.useState(!1),i=async(u,y)=>new Promise(async(b,j)=>{var v;s(!0);try{const F=await wn(u,y);if((F==null?void 0:F.status)===200){I.error((v=F.data)==null?void 0:v.message),j(!1);return}I.success("שעות העבודה נוספו בהצלחה"),b(!0)}catch(F){console.error("Error adding employee hours:",F),I.error("שגיאה בהוספת שעות עבודה"),j(!1)}finally{s(!1)}}),r=async(u,y)=>new Promise(async(b,j)=>{s(!0);try{(await vn(u,y)).status!==201?j(!1):(I.success("שעות העבודה עודכנו בהצלחה"),b(!0))}catch(v){console.error("Error updating employee hours:",v),I.error("שגיאה בעדכון שעות עבודה"),j(!1)}finally{s(!1)}}),m=async u=>{s(!0);try{const y=await Sn(u);return I.success("שעות העבודה נשלפו בהצלחה"),y.data}catch(y){console.error("Error fetching employee hours:",y),I.error("שגיאה בשליפת שעות עבודה")}finally{s(!1)}},g=async u=>{s(!0);try{await Cn(u),I.success("שעות העבודה נמחקו בהצלחה")}catch(y){console.error("Error deleting employee hours:",y),I.error("שגיאה במחיקת שעות עבודה")}finally{s(!1)}};return e.jsx(Pt.Provider,{value:{loading:n,addEmployeeHours:i,updateEmployeeHours:r,deleteEmployeeHours:g,fetchEmployeeHours:m},children:t})},{Option:_n}=X,Fn=({visible:t,onClose:n,dayData:s})=>{const{addEmployeeHours:i,updateEmployeeHours:r,deleteEmployeeHours:m}=Pn(),g=O(o=>o.employees),[u,y]=w.useState(),[b,j]=w.useState(),[v,F]=w.useState(!1),[h]=k.useForm();if(!s)return null;const c=()=>{const o=v?r:i,l=v?b:u;o(v?l==null?void 0:l.hoursId:l.employeeId,l).then(()=>{y(),F(!1),h.resetFields()}).catch(()=>{})},x=o=>{j({...o,employeeId:o.employeeId,startTime:o.hours.start,endTime:o.hours.end,date:s.date}),F(!0)},a=()=>{y(null),F(!1)},d=o=>{m(o)},p=g==null?void 0:g.filter(o=>!s.employees.some(l=>l.employeeId===o._id));return e.jsxs(re,{title:`ניהול שעות עבודה ליום ${s.date}`,open:t,onCancel:n,footer:null,width:800,style:{top:"1em"},destroyOnClose:!0,children:[e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("h3",{style:{fontWeight:"600",color:"#333"},children:"סיכום יום"}),e.jsxs("p",{children:["תאריך: ",s.date]}),e.jsxs("p",{children:["יום בשבוע: ",s.dayOfWeek]}),e.jsx(oe,{color:(s==null?void 0:s.status)==="חצי יום"?"orange":"green",children:s==null?void 0:s.status})]}),e.jsx(z,{}),e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("h3",{style:{fontWeight:"600",color:"#333"},children:v?"עריכת עובד":"הוספת עובד חדש"}),e.jsx(k,{form:h,layout:"vertical",onFinish:c,children:e.jsx(k.Item,{label:"בחר עובד",style:{maxWidth:"400px"},children:e.jsx(X,{showSearch:!0,placeholder:"חיפוש והוספת עובד",optionFilterProp:"children",value:(u==null?void 0:u.employeeId)||null,onChange:o=>{const l=p.find(f=>f._id===o);y({name:l==null?void 0:l.name,startTime:"",endTime:"",date:s==null?void 0:s.date,employeeId:l._id})},filterOption:(o,l)=>l.children.toLowerCase().includes(o.toLowerCase()),children:p==null?void 0:p.map(o=>e.jsx(_n,{value:o._id,children:o.name},o._id))})})})]}),e.jsx(z,{}),u&&e.jsxs(k,{layout:"inline",onFinish:c,initialValues:{startTime:u==null?void 0:u.startTime,endTime:u==null?void 0:u.endTime},children:[e.jsx(k.Item,{label:"שעת כניסה",children:e.jsx(K,{placeholder:"HH:mm",value:u==null?void 0:u.startTime,onChange:o=>y(l=>({...l,startTime:o.target.value}))})}),e.jsx(k.Item,{label:"שעת יציאה",children:e.jsx(K,{placeholder:"HH:mm",value:u==null?void 0:u.endTime,onChange:o=>y(l=>({...l,endTime:o.target.value}))})}),!(u!=null&&u._id)&&e.jsx(T,{type:"primary",onClick:c,children:"שמור שעות עבודה"})]}),e.jsx(z,{}),e.jsxs("div",{style:{marginTop:"20px"},children:[e.jsx("h3",{style:{fontWeight:"600",color:"#333"},children:"עובדים שנוספו"}),e.jsx(le,{bordered:!0,className:"scroll-content",style:{maxHeight:"25em",overflow:"auto"},dataSource:s==null?void 0:s.employees,renderItem:o=>{var l,f,C;return e.jsx(le.Item,{children:e.jsxs("div",{style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("h2",{style:{fontWeight:"500",width:"6em"},children:o.name}),v&&o.employeeId===(b==null?void 0:b.employeeId)?e.jsxs(e.Fragment,{children:[e.jsx(K,{placeholder:"שעת כניסה",value:b==null?void 0:b.startTime,onChange:S=>j($=>({...$,startTime:S.target.value})),style:{width:"100px",marginRight:"10px"}}),e.jsx(K,{placeholder:"שעת יציאה",value:b==null?void 0:b.endTime,onChange:S=>j($=>({...$,endTime:S.target.value})),style:{width:"100px",marginRight:"10px"}}),e.jsxs(A,{style:{gap:"0.5em"},children:[e.jsx(T,{type:"primary",icon:e.jsx(Kt,{}),onClick:c}),e.jsx(T,{icon:e.jsx(Se,{}),onClick:a,style:{marginLeft:"5px"}})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(be,{title:"כניסה",value:(l=o==null?void 0:o.hours)==null?void 0:l.start}),e.jsx(be,{title:"יציאה",value:(f=o==null?void 0:o.hours)==null?void 0:f.end}),e.jsx(be,{title:"סך שעות",value:(C=o==null?void 0:o.hoursWorked)==null?void 0:C.toFixed(2)}),e.jsxs(A,{style:{gap:"0.5em"},children:[e.jsx(T,{icon:e.jsx(Ye,{}),onClick:()=>x(o)}),e.jsx(De,{title:"האם אתה בטוח שברצונך למחוק את העובד?",onConfirm:()=>d(o.hoursId),okText:"כן",cancelText:"לא",children:e.jsx(T,{icon:e.jsx(xe,{}),danger:!0})})]})]})]})})}})]})]})},En=({monthData:t})=>{const[n,s]=w.useState(!1),[i,r]=w.useState(null),m=y=>{r(y),s(!0)},g=[{title:"תאריך",dataIndex:"date",key:"date"},{title:"יום בשבוע",dataIndex:"dayOfWeek",key:"dayOfWeek"},{title:"סטטוס",dataIndex:"status",key:"status",render:y=>e.jsx(oe,{color:y==="חצי יום"?"orange":"green",children:y})},{title:"מספר עובדים",dataIndex:"employeesCount",key:"employeesCount",render:y=>y??"לא ידוע"},{title:"סך הכל שעות",dataIndex:"totalHours",key:"totalHours",render:y=>(y==null?void 0:y.toFixed(2))??"לא ידוע"}],u=y=>{let b="";return y!=null&&y.hasError&&(b+="workhours-error "),y.isToday?b+="today-row":y.isPast&&(b+="past-row"),b};return e.jsxs(e.Fragment,{children:[e.jsx(dt,{columns:g,dataSource:t,rowKey:"date",pagination:!1,rowClassName:u,onRow:(y,b)=>({onClick:()=>(y.isToday||y.isPast)&&m(b)})}),e.jsx(Fn,{visible:n,onClose:()=>s(!1),dayData:t[i]})]})};ie.locale("he");const Tn=Qe("employeeHours/buildMonthData",async({selectedDate:t,employees:n,employeeHours:s},{dispatch:i})=>{const r=ie(t,"YYYY-MM").daysInMonth(),m=Array.from({length:r},(g,u)=>{const y=ie(t,"YYYY-MM").date(u+1),b=y.format("dddd"),j=b==="שישי"||b==="שבת",v=n.map(c=>{const x=s.find(d=>{var p;return((p=d==null?void 0:d.employeeId)==null?void 0:p._id)===(c==null?void 0:c._id)&&ie(d==null?void 0:d.date).isSame(y,"day")});if(!x)return null;const a=!x.startTime||!x.endTime;return{hoursId:x._id,employeeId:c._id,name:c.name,hourlyRate:c.hourlyRate,hoursWorked:x.hoursWorked,hours:{start:x.startTime,end:x.endTime},hasError:a}}).filter(Boolean),F=v.reduce((c,x)=>c+x.hoursWorked,0),h=v.length;return{date:y.format("YYYY-MM-DD"),dayOfWeek:b,status:j&&b==="שישי"?"חצי יום":"יום מלא",isPast:y.isBefore(ie(),"day"),isToday:y.isSame(ie(),"day"),employees:v,totalHours:F,employeesCount:h}});i(Nn(m))}),kt=de({name:"employeeHours",initialState:{data:[],selectedDate:ie().startOf("month").format("YYYY-MM"),overallAverageHourlyRate:34.39},reducers:{setEmployeeHoursState:(t,n)=>{t.data=n.payload},setSelectedDate:(t,n)=>{t.selectedDate=n.payload},setOverallAverageHourlyRate:(t,n)=>{t.overallAverageHourlyRate=n.payload},addOrUpdateEmployeeHoursState:(t,n)=>{const s=n.payload,i=t.data.findIndex(r=>r._id===s._id);i!==-1?t.data[i]=s:t.data.unshift(s)},updateEmployeeHoursState:(t,n)=>{const s=n.payload;t.data=t.data.map(i=>i._id===s._id?s:i)},deleteEmployeeHoursState:(t,n)=>{const s=n.payload._id;t.data=t.data.filter(i=>i._id!==s)}}}),{setEmployeeHoursState:Nn,addOrUpdateEmployeeHoursState:Mn,updateEmployeeHoursState:$n,deleteEmployeeHoursState:An,setSelectedDate:qn,setOverallAverageHourlyRate:Xa}=kt.actions,Rn=t=>t.employeeHours.overallAverageHourlyRate,Ln=kt.reducer,{MonthPicker:Hn}=Vt;ie.locale("he");const Vn=()=>{const t=Ue(),n=O(r=>r.employeeHours.data),s=O(r=>r.employeeHours.selectedDate),i=r=>{t(qn(r.format("YYYY-MM")))};return e.jsxs("div",{className:"workhours-container",children:[e.jsx("h1",{children:"ניהול שעות עבודה חודשיות"}),e.jsx(Hn,{onChange:i,placeholder:"בחר חודש ושנה",disabledDate:r=>r&&r>ie().endOf("month")},s),e.jsx(En,{monthData:n})," "]})},_t=de({name:"suppliers",initialState:[],reducers:{addSuppliersState:(t,n)=>n.payload,addOrUpdateSupplierState:(t,n)=>{const s=n.payload,i=t.findIndex(r=>r._id===s._id);i!==-1?t[i]=s:t.unshift(s)},updateSupplierState:(t,n)=>{const s=n.payload;return t.map(i=>i._id===s._id?s:i)},deleteSupplierState:(t,n)=>{const s=n.payload._id;return t.filter(i=>i._id!==s)}}}),{addSuppliersState:On,addOrUpdateSupplierState:Un,updateSupplierState:Dn,deleteSupplierState:Bn}=_t.actions,Wn=_t.reducer;function Ae(t){let n,s,i,r;const m=t.price/1.17;return t.unit==='ק"ג'||t.unit==="weight"?(n=.1,s="גרם",i=m/t.quantity*n):t.unit==="ליטר"||t.unit==="volume"?(n=.1,s='מ"ל',i=m/t.quantity*n):(t.unit==="יחידות"||t.unit==="units")&&(n=1,s="יחידה",i=m/t.quantity),t.isJuice&&(r=i/(t.juiceRatio||1)),{...t,priceExcludingVAT:m.toFixed(2),unitQuantity:n,unitDescription:s,unitPrice:i.toFixed(2),processedPrice:r?r.toFixed(2):null}}const Ft=de({name:"ingredients",initialState:[],reducers:{addIngerdientsState:(t,n)=>n.payload.map(Ae),addOrUpdateIngredientState:(t,n)=>{const s=Ae(n.payload),i=t.findIndex(r=>r._id===s._id);i!==-1?t[i]=s:t.unshift(s)},updateIngredientState:(t,n)=>{const s=Ae(n.payload);return t.map(i=>i._id===s._id?s:i)},deleteIngredientState:(t,n)=>{const s=n.payload._id;return t.filter(i=>i._id!==s)}}}),{addIngerdientsState:zn,addOrUpdateIngredientState:Yn,updateIngredientState:Qn,deleteIngredientState:Jn}=Ft.actions,Gn=Ft.reducer,Et=1.17,Kn=Qe("products/updateWithRate",async(t,{getState:n})=>{const s=n(),i=Rn(s);return s.products.map(g=>({...g,sizes:g.sizes.map(u=>{const y=u.ingredients.reduce((a,d)=>a+parseFloat(d.processedCost||d.actualCost||0),0),b=u.mixes.reduce((a,d)=>a+parseFloat(d.actualCost||0),0),j=y+b,v=i/60*u.preparationTime,F=u.price/Et,h=j+v,c=F-h,x=F>0?(c/F*100).toFixed(2):"0.00";return{...u,totalRawCost:j.toFixed(2),laborCost:v.toFixed(2),profitMargin:x}})}))});function at(t,n,s,i){return t.map(r=>({...r,sizes:r.sizes.map(m=>{const g=m.ingredients.map(a=>{const d=n.find(f=>f._id===a.ingredientId);if(!d)return a;const o=a.quantity/d.unitQuantity*d.unitPrice,l=d.isJuice?a.quantity/d.unitQuantity*d.processedPrice:null;return{...a,actualCost:o.toFixed(2),processedCost:l?l.toFixed(2):null}}),u=m.mixes.map(a=>{const d=s.find(l=>l._id===a.mixId);if(!d)return a;const p=a.quantity/d.totalWeight,o=p*d.totalCost;return{...a,actualCost:o.toFixed(2),realQuantity:p.toFixed(2)}}),y=g.reduce((a,d)=>a+parseFloat(d.processedCost||d.actualCost||0),0),b=u.reduce((a,d)=>a+parseFloat(d.actualCost||0),0),j=y+b,v=m.price/Et,F=i/60*m.preparationTime,h=j+F,c=v-h,x=v>0?(c/v*100).toFixed(2):"0.00";return{...m,ingredients:g,mixes:u,totalRawCost:j.toFixed(2),laborCost:F.toFixed(2),profitMargin:x}})}))}const Tt=de({name:"products",initialState:[],reducers:{setProductsState:(t,n)=>{const{products:s,ingredientsState:i,mixesState:r,averageHourlyRate:m}=n.payload;return s},addOrUpdateProductState:(t,n)=>{const{newProduct:s,ingredientsState:i,mixesState:r,averageHourlyRate:m}=n.payload,g=at([s],i,r,m)[0],u=t.findIndex(y=>y._id===s._id);u!==-1?t[u]=g:t.unshift(g)},updateProductState:(t,n)=>{const{updatedProduct:s,ingredientsState:i,mixesState:r,averageHourlyRate:m}=n.payload,g=at([s],i,r,m)[0];return t.map(u=>u._id===s._id?g:u)},deleteProductState:(t,n)=>{const s=n.payload._id;return t.filter(i=>i._id!==s)}},extraReducers:t=>{t.addCase(Kn.fulfilled,(n,s)=>s.payload)}}),{setProductsState:Xn,addOrUpdateProductState:it,updateProductState:Za,deleteProductState:Zn}=Tt.actions,er=Tt.reducer,Nt=de({name:"mixes",initialState:[],reducers:{setMixesState:(t,n)=>{const{mixes:s,ingredientsState:i}=n.payload;return s},addOrUpdateMixState:(t,n)=>{const{newMix:s,ingredientsState:i}=n.payload,r=s,m=t.findIndex(g=>g._id===s._id);m!==-1?t[m]=r:t.push(r)},updateMixState:(t,n)=>{const{updatedMix:s,ingredientsState:i}=n.payload,r=s,m=t.findIndex(g=>g._id===s._id);m!==-1&&(t[m]=r)},deleteMixState:(t,n)=>t.filter(s=>s._id!==n.payload._id)}}),{setMixesState:tr,addOrUpdateMixState:sr,updateMixState:nr,deleteMixState:rr}=Nt.actions,ar=Nt.reducer,Mt=de({name:"categories",initialState:[],reducers:{setCategories:(t,n)=>n.payload,addOrUpdateCategory:(t,n)=>{const s=n.payload,i=t.findIndex(r=>r._id===s._id);i!==-1?t[i]=s:t.unshift(s)},updateCategory:(t,n)=>{const s=n.payload,i=t.findIndex(r=>r._id===s._id);i!==-1&&(t[i]=s)},deleteCategory:(t,n)=>{const s=n.payload;return t.filter(i=>i._id!==s)}}}),{setCategories:ir,addOrUpdateCategory:lr,updateCategory:or,deleteCategory:dr}=Mt.actions,cr=Mt.reducer,$t=de({name:"employees",initialState:[],reducers:{setEmployees:(t,n)=>n.payload,addOrUpdateEmployee:(t,n)=>{const s=n.payload,i=t.findIndex(r=>r._id===s._id);i!==-1?t[i]=s:t.push(s)},updateEmployee:(t,n)=>{const s=n.payload,i=t.findIndex(r=>r._id===s._id);i!==-1&&(t[i]=s)},deleteEmployee:(t,n)=>t.filter(s=>s._id!==n.payload)}}),{setEmployees:ur,addOrUpdateEmployee:xr,updateEmployee:pr,deleteEmployee:mr}=$t.actions,hr=$t.reducer,gr=(t,n)=>{t.on("ingredientAdded",s=>{n(Yn(s))}),t.on("ingredientUpdated",s=>{n(Qn(s))}),t.on("ingredientDeleted",s=>{n(Jn(s))}),t.on("supplierAdded",s=>{n(Un(s))}),t.on("supplierUpdated",s=>{n(Dn(s))}),t.on("supplierDeleted",s=>{n(Bn(s))}),t.on("productAdded",s=>{n((i,r)=>{const m=r().ingredients,g=r().mixes;i(it({newProduct:s,ingredientsState:m,mixesState:g}))})}),t.on("productUpdated",s=>{n((i,r)=>{const m=r().ingredients,g=r().mixes;i(it({newProduct:s,ingredientsState:m,mixesState:g}))})}),t.on("productDeleted",s=>{n(Zn(s))}),t.on("categoryAdded",s=>{n(lr(s))}),t.on("categoryUpdated",s=>{n(or(s))}),t.on("categoryDeleted",s=>{n(dr(s._id))}),t.on("mixAdded",s=>{n((i,r)=>{const m=r().ingredients;i(sr({newMix:s,ingredientsState:m}))})}),t.on("mixUpdated",s=>{n((i,r)=>{const m=r().ingredients;i(nr({updatedMix:s,ingredientsState:m}))})}),t.on("mixDeleted",s=>{n(rr(s))}),t.on("employeeAdded",s=>{n(xr(s))}),t.on("employeeUpdated",s=>{n(pr(s))}),t.on("employeeDeleted",s=>{n(mr(s._id))}),t.on("employeeHoursAdded",s=>{n(Mn(s))}),t.on("employeeHoursUpdated",s=>{n($n(s))}),t.on("employeeHoursDeleted",s=>{n(An({_id:s._id}))})},lt="https://menu-server-c2b952e2c698.herokuapp.com/",yr=w.createContext(),jr=({children:t})=>{const n=Ue();return console.log(lt),w.useEffect(()=>{const s=ds(lt);return gr(s,n),()=>s.disconnect()},[n]),e.jsx(yr.Provider,{value:{},children:t})},Te="https://menu-server-c2b952e2c698.herokuapp.com/api",fr=()=>q.get(`${Te}/settings`),br=t=>q.post(`${Te}/settings`,t),wr=t=>{const n=encodeURIComponent(t.key);return q.put(`${Te}/settings/${n}`,t)},vr=t=>{const n=encodeURIComponent(t);return q.delete(`${Te}/settings/${n}`)},Cr=w.createContext(),Sr=({children:t})=>{const[n,s]=w.useState(!1),[i,r]=w.useState([]),m=async()=>{s(!0);try{const{data:b}=await fr();r(b),I.success("ההגדרות נטענו בהצלחה")}catch(b){console.error("Error fetching settings:",b),I.error("שגיאה בטעינת ההגדרות")}finally{s(!1)}},g=async b=>{s(!0);try{await br(b),I.success("ההגדרה נוספה בהצלחה"),await m()}catch(j){console.error("Error adding setting:",j),I.error("שגיאה בהוספת ההגדרה")}finally{s(!1)}},u=async b=>{s(!0);try{await wr(b),I.success("ההגדרה עודכנה בהצלחה"),await m()}catch(j){console.error("Error updating setting:",j),I.error("שגיאה בעדכון ההגדרה")}finally{s(!1)}},y=async b=>{s(!0);try{await vr(b),I.success("ההגדרה נמחקה בהצלחה"),await m()}catch(j){console.error("Error deleting setting:",j),I.error("שגיאה במחיקת ההגדרה")}finally{s(!1)}};return e.jsx(Cr.Provider,{value:{settings:i,loading:n,fetchSettings:m,addSetting:g,updateSetting:u,deleteSetting:y},children:t})};I.config({prefixCls:"my-message"});const Ir=({children:t,setLoading:n})=>{const s=Ue(),i=O(m=>m.employeeHours.selectedDate),r=O(m=>m.employeeHours.overallAverageHourlyRate);return w.useEffect(()=>{(async()=>{var y,b;n(!0);const g=Xe(i).year(),u=Xe(i).month()+1;try{const[j,v,F,h,c,x,a]=await Promise.all([Js(),Us(),hs(),Ms(),ln(),hn(),In(u,g)]);s(zn((y=j==null?void 0:j.data)==null?void 0:y.reverse())),s((d,p)=>{var l;const o=p().ingredients;d(tr({mixes:(l=c==null?void 0:c.data)==null?void 0:l.reverse(),ingredientsState:o}))}),s((d,p)=>{var f;const o=p().ingredients,l=p().mixes;d(Xn({products:(f=F.data)==null?void 0:f.reverse(),ingredientsState:o,mixesState:l,averageHourlyRate:r}))}),s(ir(h.data)),s(On((b=v==null?void 0:v.data)==null?void 0:b.reverse())),s(ur(x.data)),s(Tn({selectedDate:i,employees:x.data,employeeHours:a==null?void 0:a.data})),n(!1)}catch(j){console.error("Error fetching data:",j),n(!1)}})()},[s,n,i]),e.jsx(jr,{children:e.jsx(Ks,{children:e.jsx(Bs,{children:e.jsx(vs,{children:e.jsx(dn,{children:e.jsx(As,{children:e.jsx(gn,{children:e.jsx(kn,{children:e.jsx(Sr,{children:t})})})})})})})})})},Ve="/assets/logo-Ha-8mVYV.png",Pr=de({name:"profitabilitySettings",initialState:{materialCostRate:25,laborCostRate:12,fixedExpensesRate:30,profitRate:33,materialCostRange:{min:20,max:30},laborCostRange:{min:10,max:15},fixedExpensesRange:{min:25,max:35},profitRange:{min:25,max:35}},reducers:{setMaterialCostRate:(t,n)=>{t.materialCostRate=n.payload},setLaborCostRate:(t,n)=>{t.laborCostRate=n.payload},setFixedExpensesRate:(t,n)=>{t.fixedExpensesRate=n.payload},setProfitRate:(t,n)=>{t.profitRate=n.payload},setMaterialCostRange:(t,n)=>{t.materialCostRange=n.payload},setLaborCostRange:(t,n)=>{t.laborCostRange=n.payload},setFixedExpensesRange:(t,n)=>{t.fixedExpensesRange=n.payload},setProfitRange:(t,n)=>{t.profitRange=n.payload}}}),kr=Pr.reducer;function _r({drawerVisible:t,setDrawerVisible:n,isMobile:s}){return w.useState(!1),e.jsxs("div",{className:"top-bar",children:[e.jsx(He,{className:"logo-mobile",src:Ve,alt:"GainGuard",preview:!1}),e.jsxs("div",{children:[e.jsx("button",{className:"profile-button",children:e.jsx(R,{icon:Yt})}),s&&e.jsx("button",{className:"menu-button",onClick:()=>n(!t),children:e.jsx(R,{icon:Qt})})]})]})}const{Header:Fr,Content:Er,Footer:Tr}=ut;function Nr(){const[t,n]=w.useState(!1),[s,i]=w.useState(!1),r=he({query:"(max-width: 1200px)"});return e.jsxs(Ir,{setLoading:i,children:[e.jsx(Ot,{fullscreen:!0,spinning:s,size:"large"}),e.jsx(ls,{children:e.jsxs(ut,{className:"app-container",style:{minHeight:r?"85vh":"100vh"},children:[e.jsxs("div",{className:"nav-container",children:[e.jsx("div",{className:"nav-top",children:e.jsx(He,{className:"logo",src:Ve,alt:"GainGuard",preview:!1})}),e.jsx(ot,{})]}),e.jsxs("div",{className:"body-container",children:[e.jsxs(Fr,{className:"header",style:{padding:"0 20px"},children:[e.jsx(_r,{isMobile:r,drawerVisible:t,setDrawerVisible:n}),e.jsx(z,{className:"no-margin"})]}),e.jsx(Er,{className:"content",children:e.jsxs(cs,{children:[e.jsx(pe,{path:"/",element:e.jsx(sn,{})}),e.jsx(pe,{path:"/menu",element:e.jsx(Ls,{})}),e.jsx(pe,{path:"/suppliers",element:e.jsx(Ws,{})}),e.jsx(pe,{path:"/mixes",element:e.jsx(cn,{})}),e.jsx(pe,{path:"/ingredients",element:e.jsx(Zs,{})}),e.jsx(pe,{path:"/employees",element:e.jsx(bn,{})}),e.jsx(pe,{path:"/work-hours",element:e.jsx(Vn,{})})]})}),e.jsx(Tr,{className:"footer",children:"© 2024 מערכת ניהול תפריט ועץ מוצר"})]}),e.jsx(Ut,{title:e.jsxs(H,{children:[e.jsx(He,{className:"logo",src:Ve,alt:"GainGuard",preview:!1}),e.jsx("p",{children:"ניווט"})]}),placement:"right",closable:!0,onClose:()=>n(!1),open:t,width:300,children:e.jsx(ot,{onClose:()=>n(!1)})})]})})]})}function ot({onClose:t}){const n=us(),s=i=>n.pathname===i?"link-active":"link";return e.jsxs("div",{className:"nav-desktop-child",children:[e.jsx(z,{}),e.jsx(T,{type:"link",onClick:t,className:s("/"),children:e.jsxs(ee,{to:"/",children:[e.jsx(R,{icon:Jt})," ",e.jsx("p",{children:"לוח מחוונים"})]})}),e.jsx(T,{type:"link",onClick:t,className:s("/menu"),children:e.jsxs(ee,{to:"/menu",children:[e.jsx(R,{icon:ve})," ",e.jsx("p",{children:"תפריט"})]})}),e.jsx(T,{type:"link",onClick:t,className:s("/mixes"),children:e.jsxs(ee,{to:"/mixes",children:[e.jsx(R,{icon:gt})," ",e.jsx("p",{children:"מיקסים"})]})}),e.jsx(T,{type:"link",onClick:t,className:s("/ingredients"),children:e.jsxs(ee,{to:"/ingredients",children:[e.jsx(R,{icon:Ce})," ",e.jsx("p",{children:"חומרי גלם"})]})}),e.jsx(T,{type:"link",onClick:t,className:s("/suppliers"),children:e.jsxs(ee,{to:"/suppliers",children:[e.jsx(R,{icon:We})," ",e.jsx("p",{children:"ספקים"})]})}),e.jsx(T,{type:"link",onClick:t,className:s("/employees"),children:e.jsxs(ee,{to:"/employees",children:[e.jsx(R,{icon:Gt})," ",e.jsx("p",{children:"עובדים"})]})}),e.jsx(T,{type:"link",onClick:t,className:s("/work-hours"),children:e.jsxs(ee,{to:"/work-hours",children:[e.jsx(R,{icon:Be})," ",e.jsx("p",{children:"ניהול שעות עבודה"})]})})]})}const qe=Qe("dashboard/fetchDashboardData",async(t,{getState:n})=>(n(),{})),Mr=de({name:"dashboard",initialState:[],reducers:{},extraReducers:t=>{t.addCase(qe.pending,n=>{}).addCase(qe.fulfilled,(n,s)=>{}).addCase(qe.rejected,n=>{})}}),$r=Mr.reducer,Ar=os({reducer:{suppliers:Wn,ingredients:Gn,products:er,dashboard:$r,mixes:ar,categories:cr,employees:hr,employeeHours:Ln,profitabilitySettingsSlice:kr}});At.createRoot(document.getElementById("root")).render(e.jsx(Oe.StrictMode,{children:e.jsx(qt,{store:Ar,children:e.jsx(Nr,{})})}));"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(t=>{console.log("ServiceWorker registration successful with scope: ",t.scope)}).catch(t=>{console.error("ServiceWorker registration failed: ",t)})});
