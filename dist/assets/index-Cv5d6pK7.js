import{r as C,j as e,a as ze}from"./react-BoqISt01.js";import{c as Vt}from"./react-dom-Bk743r0W.js";import{u as V,a as Je,P as Dt}from"./react-redux-D3oi59tp.js";import{a as M}from"./axios-CCb-kr4I.js";import{s as k,L as ie,C as G,R as $,F as B,D as W,B as T,a as pt,T as ke,P as Ot,d as Ut,M as te,b as H,c as F,S as X,e as K,f as q,g as Le,h as be,I as z,i as ye,j as et,A as Wt,k as We,l as ae,m as tt,n as Be,o as Ge,p as mt,q as Ce,r as Bt,t as Yt,u as Ye,v as Qt,w as ht,x as zt}from"./antd-B0Pia2_b.js";import{u as he}from"./react-responsive-B9DcSnuZ.js";import{L as Jt}from"./rc-virtual-list-D8xMsbcw.js";import{F as N,f as gt,a as yt,b as jt,c as Fe,d as ft,e as Gt,g as Xt,h as Kt,i as Ie,j as Pe,k as Xe,l as _e,m as He,n as vt,o as Zt,p as es,q as ts,r as ss}from"./@fortawesome-qDWh2dRT.js";import{v as Te,a2 as ue,a3 as ns,a4 as rs,R as ve,a1 as Ke,r as is,s as as,a5 as ls}from"./@ant-design-BUx7cCFz.js";import"./lodash-Cvu4m7Jc.js";import{D as os,B as st}from"./react-chartjs-2-0Z_sSmBf.js";import{C as ds,A as cs,p as us,a as xs,b as ps,L as ms,c as hs}from"./chart.js-BkMDj0WH.js";import{L as Z,B as gs}from"./react-router-dom-UU0TJEQ6.js";import{m as re,h as nt}from"./moment-BAfwh5x7.js";import{c as Ze,a as le,b as ys}from"./@reduxjs-DkgbS889.js";import{l as js}from"./socket.io-client-CDVIIGn8.js";import{d as fs,e as pe,b as vs}from"./react-router-CBguhhk8.js";import"./@babel-D3CJPhrF.js";import"./scheduler-CzFDRTuY.js";import"./use-sync-external-store-BQxMxw6g.js";import"./rc-util-CNJZKBfo.js";import"./classnames-CAxFPVRb.js";import"./rc-resize-observer-DAFDewDD.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./rc-motion-DZL9tseL.js";import"./@rc-component-D3Jyz1Et.js";import"./rc-overflow-BihHMfjR.js";import"./rc-picker-DU-SeSEZ.js";import"./dayjs-DMN7meC7.js";import"./rc-tabs-nBifl7oy.js";import"./rc-dropdown-CEKgoMnO.js";import"./rc-menu-6cQwF6wH.js";import"./rc-select-bO4iRdo_.js";import"./rc-input-number-DM6-v3Ha.js";import"./rc-input-DGbryaDy.js";import"./@ctrl-DOFZgDuz.js";import"./rc-drawer-ZG0qxY9_.js";import"./rc-field-form-CF4yXyF_.js";import"./scroll-into-view-if-needed-BZeNfFF0.js";import"./compute-scroll-into-view-DWa9QgjM.js";import"./rc-image-Bn8iDi6l.js";import"./rc-dialog-D5aJXQ1X.js";import"./rc-notification-m3oA-fH0.js";import"./rc-tooltip-BKv-aIau.js";import"./rc-steps-jTTkhuna.js";import"./rc-progress-BECVEO62.js";import"./rc-switch-B_QRjvBh.js";import"./rc-table-DBZJJs2b.js";import"./rc-tree-BDK0sBoh.js";import"./rc-checkbox-XvbJzSrO.js";import"./rc-pagination-CZPuIcur.js";import"./throttle-debounce-CUWDS_la.js";import"./rc-textarea-BF1YsysJ.js";import"./copy-to-clipboard-DN2oU9Yq.js";import"./toggle-selection-BHUZwh74.js";import"./matchmediaquery-9DU1HNkU.js";import"./css-mediaquery-DcYbJrVh.js";import"./hyphenate-style-name-HOLnhz8K.js";import"./shallow-equal-BQUY1Bas.js";import"./prop-types-Bq5K3Feg.js";import"./@emotion-CW87jbl0.js";import"./stylis-OW4gUFyn.js";import"./@kurkle-BZxJdD1U.js";import"./@remix-run-Br25Cn4W.js";import"./redux-DITMfSWq.js";import"./immer-DqxjFn0G.js";import"./redux-thunk-ClJT1hhx.js";import"./engine.io-client-C44f3zIw.js";import"./engine.io-parser-BiEtp6m2.js";import"./@socket.io-Dkula2eQ.js";import"./socket.io-parser-BBkuslX-.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const x of r)if(x.type==="childList")for(const c of x.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function s(r){const x={};return r.integrity&&(x.integrity=r.integrity),r.referrerPolicy&&(x.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?x.credentials="include":r.crossOrigin==="anonymous"?x.credentials="omit":x.credentials="same-origin",x}function i(r){if(r.ep)return;r.ep=!0;const x=s(r);fetch(r.href,x)}})();const se="https://menu-server-c2b952e2c698.herokuapp.com/api",ws=t=>M.post(`${se}/products`,t),Ss=t=>{const n=encodeURIComponent(t._id);return M.put(`${se}/products/${n}`,t)},Cs=t=>M.delete(`${se}/products/${t}`),bs=()=>M.get(`${se}/products`),Is=(t,n)=>M.post(`${se}/sizes/${t}`,n),Ps=(t,n)=>M.put(`${se}/sizes/${t}`,n),_s=(t,n)=>M.delete(`${se}/sizes/${t}/${n}`),ks=t=>M.post(`${se}/variations`,t),Fs=(t,n)=>M.put(`${se}/variations/${t}`,n),Ts=t=>M.delete(`${se}/variations/${t}`),wt=C.createContext(),St=()=>C.useContext(wt),Es=({children:t})=>{const[n,s]=C.useState(!1),[i,r]=C.useState(!1),[x,c]=C.useState("add"),[h,g]=C.useState(null),w=y=>new Promise(async(d,l)=>{var j,b;s(!0);try{const I=await ws(y);s(!1),(j=I==null?void 0:I.data)!=null&&j.error?(k.error((b=I==null?void 0:I.data)==null?void 0:b.error),l(!1)):(k.success("המוצר נוסף בהצלחה"),d(!0))}catch(I){console.error("Error adding product:",I),k.error("שגיאה בהוספת המוצר"),s(!1)}}),v=y=>new Promise(async(d,l)=>{var j;s(!0);try{const b=await Ss(y);s(!1),(j=b==null?void 0:b.data)!=null&&j.error||(k.success("המוצר עודכן בהצלחה"),d(!0)),l(!1)}catch(b){console.error("Error updating product:",b),k.error("שגיאה בעדכון המוצר"),s(!1)}}),S=async y=>{s(!0);try{await Cs(y),k.success("המוצר נמחק בהצלחה"),s(!1)}catch(d){console.error("Error deleting product:",d),k.error("שגיאה במחיקת המוצר"),s(!1)}},f=(y,d)=>(s(!0),new Promise(async(l,j)=>{try{const b=await Is(y,d);k.success("הגודל נוסף בהצלחה"),s(!1),l(b.data)}catch(b){console.error("Error adding size:",b),k.error("שגיאה בהוספת הגודל"),s(!1),j(b)}})),u=(y,d)=>(s(!0),new Promise(async(l,j)=>{try{const b=await Ps(y,d);k.success("הגודל עודכן בהצלחה"),s(!1),l(b.data)}catch(b){console.error("Error updating size:",b),k.error("שגיאה בעדכון הגודל"),s(!1),j(b)}})),p=(y,d)=>(s(!0),new Promise(async(l,j)=>{try{await _s(y,d),k.success("הגודל נמחק בהצלחה"),s(!1),l(!0)}catch(b){console.error("Error deleting size:",b),k.error("שגיאה במחיקת הגודל"),s(!1),j(b)}})),m=y=>(s(!0),new Promise(async(d,l)=>{try{const j=await ks(y);k.success("הווריאציה נוספה בהצלחה"),s(!1),d(j.data)}catch(j){console.error("Error adding variation:",j),k.error("שגיאה בהוספת הווריאציה"),s(!1),l(j)}})),a=(y,d)=>(s(!0),new Promise(async(l,j)=>{try{const b=await Fs(y,d);k.success("הווריאציה עודכנה בהצלחה"),s(!1),l(b.data)}catch(b){console.error("Error updating variation:",b),k.error("שגיאה בעדכון הווריאציה"),s(!1),j(b)}})),o=y=>(s(!0),new Promise(async(d,l)=>{try{await Ts(y),k.success("הווריאציה נמחקה בהצלחה"),s(!1),d(!0)}catch(j){console.error("Error deleting variation:",j),k.error("שגיאה במחיקת הווריאציה"),s(!1),l(j)}}));return e.jsx(wt.Provider,{value:{addProduct:w,updateProduct:v,deleteProduct:S,addSize:f,updateSize:u,deleteSize:p,addVariation:m,updateVariation:a,deleteVariation:o,loading:n,isModalVisible:i,setIsModalVisible:r,modalMode:x,setModalMode:c,selectedItem:h,setSelectedItem:g},children:t})};function As({data:t,type:n,tableKeys:s,mobileKeys:i,openModal:r,Dtitle:x,Dcontent:c,onDelete:h}){const g=he({query:"(max-width: 500px)"}),[w,v]=C.useState(0),[S,f]=C.useState(1),[u,p]=C.useState(6),[m,a]=C.useState([]),o=(l,j)=>{const b=(l-1)*j,I=b+j;return t.slice(b,I)},y=(l,j)=>{f(l),p(j)};C.useEffect(()=>{v(t.length),a(o(S,u))},[S,u,t]);const d=l=>{te.confirm({title:x,content:c,okText:"מחק",cancelText:"בטל",onOk:()=>h(l==null?void 0:l._id)})};return g?e.jsx(e.Fragment,{children:e.jsx(ie,{style:{maxHeight:"55vh",overflowY:"auto",minHeight:"80%",height:"80%"},children:e.jsx(Jt,{data:t,itemHeight:47,itemKey:"_id",children:l=>{var j,b,I;return e.jsx(ie.Item,{className:"width-100",style:{padding:"0"},children:e.jsxs(G,{className:"width-100 padding-card",style:{margin:"8px",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)"},children:[e.jsxs($,{align:"middle",justify:"space-between",style:{margin:"1em 0em"},children:[e.jsx(B,{flex:1,children:e.jsx("strong",{style:{fontSize:"1.3em"},children:l==null?void 0:l.name})}),e.jsxs(B,{flex:1,style:{flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("strong",{children:(j=s==null?void 0:s.find(P=>P.key==="usedCount"))==null?void 0:j.title}),e.jsx("p",{children:l==null?void 0:l.usedCount})]}),(b=s==null?void 0:s.find(P=>P.key==="type"||P.key==="category"))==null?void 0:b.render("",l,"view")]}),s.filter(P=>P.key!=="name"&&P.key!=="type"&&(P==null?void 0:P.key)!=="category"&&(P==null?void 0:P.key)!=="actions"&&(i==null?void 0:i.includes(P==null?void 0:P.key))).map((P,D,E)=>e.jsxs(ze.Fragment,{children:[e.jsxs("div",{style:{fontSize:"0.9em",display:"flex",justifyContent:"space-between"},children:[P.title&&e.jsxs("strong",{children:[P.title,":"]}),e.jsx("span",{children:P.render?P.render(null,l,"view"):l[P.dataIndex]||"—"})]}),D<2&&e.jsx(W,{style:{margin:"0.2em"}})]},`${l==null?void 0:l._id}-${P.key}`)),e.jsxs($,{className:"card-actions",align:"middle",justify:"center",children:[(I=s==null?void 0:s.find(P=>P.key==="actions"))==null?void 0:I.render(null,l),n==="P"&&e.jsx(W,{type:"vertical"}),e.jsxs(B,{align:"center",justify:"center",children:[e.jsx(T,{type:"text",onClick:()=>d(l),children:e.jsx(N,{icon:gt})}),e.jsx(T,{type:"text",onClick:()=>r("edit",l),children:e.jsx(N,{icon:yt})}),e.jsx(T,{type:"text",onClick:()=>r("view",l),children:e.jsx(N,{icon:jt})})]})]})]})},l==null?void 0:l._id)}})})}):e.jsxs(B,{flex:1,style:{display:"flex",flexDirection:"column",overflow:"hidden",width:"100%"},children:[e.jsx(B,{flex:1,style:{maxWidth:"100%",maxHeight:"90%",overflowY:"auto",overflowX:"auto"},children:e.jsx(pt,{style:{minWidth:"100%"},columns:s.map(l=>({...l,title:e.jsx(ke,{title:l.title,children:e.jsx("span",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",display:"inline-block",maxWidth:"150px"},children:l.title})})})),dataSource:m,pagination:!1,direction:"rtl"})}),e.jsx(B,{align:"center",justify:"center",style:{marginTop:"2vh"},children:e.jsx(Ot,{current:S,total:w,pageSize:u,onChange:y,style:{direction:"ltr"},showSizeChanger:!0,pageSizeOptions:["6","10","20","50"],locale:Ut})})]})}const $s=({title:t,value:n=[],onChange:s,ingredientsArr:i=[],indexSize:r,nameArr:x,nameArrType:c})=>{const h=he({query:"(max-width: 500px)"}),g=()=>{const u={ingredientId:null,quantity:null,unit:null};s([...n,u])},w=u=>{const p=[...n];p.splice(u,1),s(p)},v=(u,p,m)=>{const a=[...n];if(a[u][p]=m,p==="ingredientId"){const o=i.find(y=>y._id===m);o&&(a[u].unit=o.unit)}s(a)},S=u=>{switch(u){case"weight":return'ק"ג';case"volume":return"ליטר";case"units":return"יחידות";default:return""}},f=(u,p)=>{const m=i.find(o=>o._id===u.ingredientId),a=u.unit||m!=null&&m.unit?S(u.unit||(m==null?void 0:m.unit)):"";return e.jsxs($,{gutter:[20,20],align:"middle",justify:"center",children:[e.jsx(H,{span:h?24:10,children:e.jsx(F.Item,{name:[x,r,c,p,"ingredientId"],rules:[{required:!0,message:"יש לבחור רכיב"}],children:e.jsx(X,{placeholder:"בחר רכיב",style:{width:"100%"},value:u.ingredientId||null,onChange:o=>v(p,"ingredientId",o),showSearch:!0,filterOption:(o,y)=>{var d;return(d=y==null?void 0:y.label)==null?void 0:d.toLowerCase().includes(o.toLowerCase())},options:i.map(o=>({value:o._id,label:o.name})),size:"small"})})}),e.jsx(H,{span:h?20:10,children:e.jsx(F.Item,{name:[x,r,c,p,"quantity"],rules:[{required:!0,message:"יש למלא כמות"},{type:"number",min:0,message:"כמות חייבת להיות חיובית"}],children:e.jsx(K,{placeholder:`כמות ${a?`(${a})`:""}`,style:{width:"100%"},value:u.quantity||null,onChange:o=>v(p,"quantity",o),min:0,step:u.unit==="units"?1:.001,precision:u.unit==="units"?0:3,size:"small",addonAfter:a})})}),e.jsx(H,{span:4,style:{alignSelf:"flex-start",textAlign:"right"},children:e.jsx(T,{type:"text",danger:!0,icon:e.jsx(ue,{}),onClick:()=>w(p),size:"small"})})]})};return e.jsxs("div",{children:[e.jsx(T,{type:"dashed",onClick:g,style:{width:"100%",marginBottom:"8px"},icon:e.jsx(Te,{}),size:"small",children:t}),e.jsx("div",{children:n.map((u,p)=>f(u,p))})]})},{Option:fe}=X,{Text:Ve}=q,{TextArea:Ns}=z;function Ms({mode:t="view",fields:n=[],onSubmit:s,initialValues:i={},onClose:r,groups:x,tableKeys:c,ingredientsArr:h}){var l;const[g]=F.useForm(),[w,v]=C.useState(0),[S,f]=C.useState({}),[u,p]=C.useState(i.unit||null),[m,a]=C.useState(i.subUnit||null),o=j=>{console.log("onChange:",j),v(j)},y=j=>{g.getFieldsValue();let b=j.quantity;(j.subUnit==="g"||j.subUnit==="ml")&&(b=j.quantity/1e3);const I={...i,...S,...j,quantity:b};s&&s(I),g.resetFields(),r&&r()};C.useEffect(()=>{if(i){const j=i.quantity<1?i.quantity*1e3:i.quantity;g.setFieldsValue({...i,quantity:j}),p(i.unit),a(i.subUnit||"kg")}},[i,g]);const d=j=>j.map(b=>{const{key:I,title:P,type:D,options:E,rules:_,props:L,hiddenInForm:U,coin:R,divider:J}=b;if(U)return null;switch(D){case"text":return e.jsxs(e.Fragment,{children:[e.jsx(F.Item,{name:I,label:P,rules:_,children:e.jsx(z,{...L})},I),J&&e.jsx(W,{style:{margin:"3vh 0vh"}})]});case"number":return e.jsxs(e.Fragment,{children:[e.jsx(F.Item,{name:I,label:P,rules:_==null?void 0:_.map(Y=>Y.validator?{...Y,validator:(xe,ne)=>Y.validator(xe,ne,i)}:Y),children:e.jsx(K,{suffix:R&&"₪",min:0,style:{width:"100%"},...L})},I),J&&e.jsx(W,{style:{margin:"3vh 0vh"}})]});case"float":return e.jsxs(e.Fragment,{children:[e.jsx(F.Item,{name:I,label:P,rules:_,children:e.jsx(K,{suffix:R&&"₪",min:0,step:.01,style:{width:"100%"},...L})},I),J&&e.jsx(W,{style:{margin:"3vh 0vh"}})]});case"select":return e.jsxs(e.Fragment,{children:[e.jsx(F.Item,{name:I,label:P,rules:_,children:e.jsx(X,{...L,showSearch:!0,onChange:Y=>{I==="unit"&&(p(Y),g.setFieldsValue({subUnit:void 0}))},children:E.map(Y=>e.jsx(fe,{value:Y.value,children:Y.label},Y.value))})},I),I==="unit"&&(g.getFieldValue("unit")==="weight"||g.getFieldValue("unit")==="volume")&&e.jsx(F.Item,{name:"subUnit",initialValue:g.getFieldValue("subUnit")||(g.getFieldValue("unit")==="weight"?(i==null?void 0:i.quantity)>=1?"kg":"g":g.getFieldValue("unit")==="volume"?(i==null?void 0:i.quantity)>=1?"liter":"ml":void 0),label:g.getFieldValue("unit")==="weight"?'בחר יחידת משקל (ק"ג / גרם)':'בחר יחידת נפח (ליטר / מ"ל)',rules:[{required:!0,message:"אנא בחר יחידת משנה"}],children:e.jsx(X,{onChange:Y=>g.setFieldsValue({subUnit:Y}),children:g.getFieldValue("unit")==="weight"?e.jsxs(e.Fragment,{children:[e.jsx(fe,{value:"kg",children:'ק"ג'}),e.jsx(fe,{value:"g",children:"גרם"})]}):e.jsxs(e.Fragment,{children:[e.jsx(fe,{value:"liter",children:"ליטר"}),e.jsx(fe,{value:"ml",children:'מ"ל'})]})})}),J&&e.jsx(W,{style:{margin:"3vh 0vh"}})]});case"ingredientsManager":return e.jsxs(e.Fragment,{children:[e.jsx(W,{style:{margin:"0.5em"}}),e.jsx(F.Item,{name:I,label:P,rules:_,children:e.jsx($s,{value:g.getFieldValue(I),onChange:Y=>g.setFieldsValue({[I]:Y}),fields:b==null?void 0:b.fields,ingredientsArr:h})},I)]});case"price":return e.jsxs(e.Fragment,{children:[e.jsx(F.Item,{name:"withVATFlag",initialValue:!0,valuePropName:"checked",children:e.jsx(be,{children:'עלות כולל מע"מ'})},"withVATFlag"),e.jsx(F.Item,{noStyle:!0,shouldUpdate:(Y,xe)=>Y.withVATFlag!==xe.withVATFlag,children:({getFieldValue:Y})=>Y("withVATFlag")?e.jsx(F.Item,{name:"price",label:'עלות (כולל מע"מ)',rules:[{required:!0,message:"חייב להזין עלות"}],children:e.jsx(K,{addonAfter:"₪",style:{width:"100%"}})},"price"):e.jsx(F.Item,{name:"priceExcludingVAT",label:'עלות (ללא מע"מ)',rules:[{required:!0,message:"חייב להזין עלות"}],children:e.jsx(K,{style:{width:"100%"},addonAfter:"₪"})},"priceExcludingVAT")})]});case"custom":return e.jsxs(e.Fragment,{children:[b.render&&b.render("",i,"edit",g),J&&e.jsx(W,{style:{margin:"3vh 0vh"}})]});case"textArea":return e.jsxs(e.Fragment,{children:[e.jsx(F.Item,{name:I,label:P,rules:_,children:e.jsx(Ns,{style:{resize:"none"},showCount:!0,maxLength:b==null?void 0:b.maxLength})},I),J&&e.jsx(W,{style:{margin:"3vh 0vh"}})]});default:return null}});return t==="view"?e.jsxs(G,{style:{},children:[e.jsx(q.Title,{level:4,style:{marginBottom:"16px"},children:"פרטי הרכיב"}),e.jsxs($,{align:"middle",justify:"space-between",style:{margin:"1em 0em"},children:[e.jsx(Ve,{strong:!0,style:{fontSize:"1.8em"},children:i==null?void 0:i.name}),(l=c==null?void 0:c.find(j=>j.key==="type"))==null?void 0:l.render("",i,"view")]}),c==null?void 0:c.filter(j=>j.key!=="type"&&(j==null?void 0:j.key)!=="name"&&!j.column).map((j,b,I)=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"12px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(B,{flex:1,children:e.jsxs(Ve,{strong:!0,children:[j.title,":"]})}),e.jsx(B,{flex:1,children:e.jsx("p",{style:{},children:(j==null?void 0:j.render)&&(j==null?void 0:j.render("",i,t,"view"))||i[j.key]||"—"})})]},j.key),b<(I==null?void 0:I.length)-1&&e.jsx(W,{style:{margin:"8px 0"}})]})),c==null?void 0:c.filter(j=>j.column).map((j,b,I)=>e.jsxs(e.Fragment,{children:[b===0&&e.jsx(W,{style:{margin:"8px 0"}}),e.jsxs("div",{style:{marginBottom:"12px",display:"flex",justifyContent:"space-between",flexDirection:"column"},children:[e.jsxs(Ve,{strong:!0,style:{fontSize:"1.4em"},children:[j.title,":"]}),e.jsx(B,{flex:1,children:e.jsx("p",{style:{},children:(j==null?void 0:j.render)&&(j==null?void 0:j.render("",i,t,"view"))||i[j.key]||"—"})})]},j.key),b<(I==null?void 0:I.length)-1&&e.jsx(W,{style:{margin:"8px 0"}})]}))]}):e.jsxs(e.Fragment,{children:[x&&e.jsxs(Le,{current:w,onChange:o,children:[e.jsx(Le.Step,{title:"מידע",stepIndex:1,icon:e.jsx(ns,{})},1),e.jsx(Le.Step,{title:"עלויות",stepIndex:2,icon:e.jsx(rs,{})},2)]}),e.jsxs(F,{form:g,layout:"vertical",onFinish:y,initialValues:i,children:[!x&&d(n),w===0&&e.jsx("div",{children:d(n==null?void 0:n.filter(j=>j.group===1))}),w===1&&e.jsx("div",{children:d(n==null?void 0:n.filter(j=>j.group===2))}),t!=="view"&&!x&&e.jsx(F.Item,{children:e.jsx(T,{type:"primary",htmlType:"submit",style:{width:"100%"},children:t==="add"?"הוסף":"עדכן"})}),x&&e.jsxs(e.Fragment,{children:[e.jsx(W,{style:{margin:"24px 0"}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[w>0&&e.jsx(T,{onClick:()=>v(w-1),children:"הקודם"}),w<1?e.jsx(T,{type:"primary",onClick:async()=>{try{const j=n.filter(I=>I.group===1).map(I=>I.key);await g.validateFields(j);const b=g.getFieldsValue();f(b),v(w+1)}catch(j){console.log("Validation failed:",j)}},children:"הבא"}):e.jsx(T,{type:"primary",htmlType:"submit",children:"סיום"})]})]})]})]})}const Rs=({sizes:t,ingredients:n,add:s,remove:i,form:r,fields:x,index:c,onChange:h,getUnitDisplay:g})=>e.jsxs(e.Fragment,{children:[e.jsx(T,{type:"dashed",style:{marginBottom:"0.5vw"},onClick:()=>s(),children:"הוסף מרכיב"}),e.jsx("div",{style:{maxHeight:"12vw",overflowY:"auto",overflowX:"hidden"},children:x.map(({key:w,name:v,fieldKey:S})=>e.jsxs($,{gutter:16,children:[e.jsx(H,{span:10,children:e.jsx(F.Item,{name:[v,"ingredientId"],fieldKey:[S,"ingredientId"],rules:[{required:!0,message:"בחר רכיב"}],children:e.jsx(X,{placeholder:"בחר רכיב",showSearch:!0,filterOption:(f,u)=>{var p;return(p=u==null?void 0:u.label)==null?void 0:p.toLowerCase().includes(f.toLowerCase())},options:n.map(f=>({value:f._id,label:f.name,unit:f==null?void 0:f.unit})),onChange:f=>{var a;const u=n.find(o=>o._id===f),p=[...t],m=r.getFieldValue(["sizes",c]);m.ingredients[v]={...m.ingredients[v],ingredientId:f,unit:(u==null?void 0:u.unit)||""},p[c]={...m,edit:((a=p[c])==null?void 0:a.edit)||!1},h(p),r.setFieldsValue({sizes:p})}})})}),e.jsx(H,{span:10,children:e.jsx(F.Item,{name:[v,"quantity"],fieldKey:[S,"quantity"],rules:[{required:!0,message:"הזן כמות"}],children:e.jsx(K,{onChange:f=>{var m;const u=[...t],p=r.getFieldValue(["sizes",c]);p.ingredients[v]={...p.ingredients[v],quantity:f},u[c]={...p,edit:((m=u[c])==null?void 0:m.edit)||!1},h(u),r.setFieldsValue({sizes:u})},addonAfter:g(r.getFieldValue(["sizes",c,"ingredients",v,"unit"])||"")})})}),e.jsx(H,{span:4,children:e.jsx(T,{type:"text",danger:!0,icon:e.jsx(ve,{}),onClick:()=>i(v)})})]},w))})]}),qs=({sizes:t,mixes:n,add:s,remove:i,form:r,fields:x,index:c,onChange:h,getUnitDisplay:g})=>e.jsxs(e.Fragment,{children:[e.jsx(T,{type:"dashed",style:{marginBottom:"0.5vw"},onClick:()=>s(),children:"הוסף מיקס"}),e.jsx("div",{style:{maxHeight:"12vw",overflowY:"auto",overflowX:"hidden"},children:x.map(({key:w,name:v,fieldKey:S})=>e.jsxs($,{gutter:16,children:[e.jsx(H,{span:10,children:e.jsx(F.Item,{name:[v,"mixId"],fieldKey:[S,"mixId"],rules:[{required:!0,message:"בחר מיקס"}],children:e.jsx(X,{placeholder:"בחר מיקס",showSearch:!0,filterOption:(f,u)=>{var p;return(p=u==null?void 0:u.label)==null?void 0:p.toLowerCase().includes(f.toLowerCase())},options:n.map(f=>({value:f._id,label:f.name,unit:f==null?void 0:f.unit})),onChange:f=>{var a;const u=n.find(o=>o._id===f),p=[...t],m=r.getFieldValue(["sizes",c,"mixes"]);m[v]={...m[v],unit:(u==null?void 0:u.unit)||"weight"},p[c]={...p[c],mixes:m,edit:((a=p[c])==null?void 0:a.edit)||!1},p[c].mixes=m,h(p),r.setFieldsValue({sizes:p})}})})}),e.jsx(H,{span:10,children:e.jsx(F.Item,{name:[v,"quantity"],fieldKey:[S,"quantity"],rules:[{required:!0,message:"הזן כמות"}],children:e.jsx(K,{onChange:f=>{var m;const u=[...t],p=r.getFieldValue(["sizes",c,"mixes"]);p[v]={...p[v],quantity:f},u[c]={...u[c],mixes:p,edit:((m=u[c])==null?void 0:m.edit)||!1},h(u),r.setFieldsValue({sizes:u})},addonAfter:g(r.getFieldValue(["sizes",c,"mixes",v,"unit"])||"")})})}),e.jsx(H,{span:4,children:e.jsx(T,{type:"text",danger:!0,icon:e.jsx(ve,{}),onClick:()=>i(v)})})]},w))})]});function Ls({size:t,sizes:n,index:s,handleCancelEdit:i,handleRemoveSize:r,newSizeId:x,form:c,ingredients:h,mixes:g,onChange:w,getUnitDisplay:v,activeSubTab:S,setActiveSubTab:f,setNewSizeId:u}){var m,a;const p=async()=>{var o;try{await c.validateFields(),u(null),w(n==null?void 0:n.map((y,d)=>d===s?{...y,edit:!1}:y))}catch(y){const l=(o=y.errorFields[0])==null?void 0:o.name;l!=null&&l.includes("ingredients")?f("1"):l!=null&&l.includes("mixes")&&f("2")}};return e.jsxs("div",{className:t.idNew===x?"highlight-new":"",style:{border:`1px ${t!=null&&t.idNew?"dashed":"solid #e6e6e6"}`,borderRadius:"8px",padding:"16px",background:"#fafafa",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},children:[e.jsxs($,{justify:"space-between",align:"middle",style:{marginBottom:"12px"},children:[e.jsxs(B,{flex:2,children:[e.jsx(F.Item,{name:["_id"],hidden:!0,children:e.jsx(z,{})}),e.jsx(F.Item,{name:["label"],label:"שם הגודל",rules:[{required:!0,message:"חייב למלא שם גודל"},{min:1,message:"שם גודל חייב להיות לפחות 1 תווים"},{max:25,message:"שם גודל לא יכול לחרוג מ-25 תווים"}],children:e.jsx(z,{placeholder:"שם הגודל",size:"middle",showCount:!0,style:{width:"auto",minWidth:"200px"},maxLength:25})})]}),e.jsxs(B,{flex:1,style:{alignSelf:"flex-start"},justify:"end",children:[e.jsx(T,{type:"text",icon:e.jsx(ve,{}),onClick:()=>i(s)}),e.jsx(T,{type:"text",danger:!0,icon:e.jsx(ue,{}),title:"מחק גודל",onClick:()=>r(s)})]})]}),e.jsxs($,{gutter:[16,16],children:[e.jsx(H,{span:12,children:e.jsx(F.Item,{name:["price"],label:"מחיר",rules:[{required:!0,message:"יש למלא מחיר"},{type:"number",min:0,message:"המחיר חייב להיות חיובי"}],children:e.jsx(K,{placeholder:"מחיר",style:{width:"100%"},addonAfter:"₪"})})}),e.jsx(H,{span:12,children:e.jsx(F.Item,{label:"זמן הכנה (דקות)",name:["preparationTime"],rules:[{required:!0,message:"חייב לציין זמן הכנה"}],children:e.jsx(K,{placeholder:"זמן הכנה",style:{width:"100%"},addonAfter:e.jsx(N,{style:{fontSize:"0.9em"},icon:Fe})})})})]}),e.jsxs(ye,{activeKey:S,onChange:o=>f(o),tabBarStyle:{direction:"rtl"},style:{margin:"1vw 0"},type:"card",tabPosition:"top",children:[e.jsxs(et,{tab:`מרכיבים (${((m=t==null?void 0:t.ingredients)==null?void 0:m.length)||0})`,children:[e.jsx(q.Text,{strong:!0,style:{display:"block",marginBottom:"8px"},children:"מרכיבים:"}),e.jsx(F.List,{name:["ingredients"],children:(o,{add:y,remove:d})=>e.jsx(Rs,{add:y,remove:d,fields:o,form:c,index:s,ingredients:h,onChange:w,getUnitDisplay:v,sizes:n})})]},1),e.jsxs(et,{tab:`מיקסים (${((a=t==null?void 0:t.mixes)==null?void 0:a.length)||0})`,children:[e.jsx(q.Text,{strong:!0,style:{display:"block",marginBottom:"8px"},children:"מיקסים:"}),e.jsx(F.List,{name:["mixes"],children:(o,{add:y,remove:d})=>e.jsx(qs,{add:y,remove:d,fields:o,form:c,index:s,mixes:g,onChange:w,getUnitDisplay:v,sizes:n})})]},2)]}),e.jsx(T,{type:"primary",htmlType:"submit",onClick:()=>p(),children:"שמור"})]},t.idNew||s)}function Ct({size:t,index:n,handleEditSize:s,handleRemoveSize:i,ingredients:r,mixes:x,sizeSummary:c,priceExcludingVAT:h}){var v,S;const g=V(f=>f.employeeHours.overallAverageHourlyRate),w=(f,u)=>{const p=f;if(!p)return null;const m=u;return e.jsx($,{children:e.jsxs(H,{children:[e.jsxs($,{children:[e.jsx(q.Text,{strong:!0,children:'מחיר ללא מע"מ:'}),e.jsxs(q.Text,{style:{marginRight:8},children:["₪",m," (₪",((t==null?void 0:t.price)-m).toFixed(2),")"]})]}),e.jsxs($,{children:[e.jsx(q.Text,{strong:!0,children:"עלות עבודה:"}),e.jsxs(q.Text,{style:{marginRight:8},children:["₪",p==null?void 0:p.laborCost," (₪",g,")"]})]}),e.jsxs($,{children:[e.jsx(q.Text,{strong:!0,children:"עלות מרכיבים:"}),e.jsxs(q.Text,{style:{marginRight:8},children:["₪",p==null?void 0:p.ingredientCost]})]}),e.jsxs($,{children:[e.jsx(q.Text,{strong:!0,children:"עלות מיקסים:"}),e.jsxs(q.Text,{style:{marginRight:8},children:["₪",p==null?void 0:p.mixCost]})]}),e.jsxs($,{children:[e.jsx(q.Text,{strong:!0,children:"עלות הוצאות קבועות:"}),e.jsx(q.Text,{style:{marginRight:8},children:"₪"})]}),e.jsxs($,{children:[e.jsx(q.Text,{strong:!0,children:"אחוז רווח:"}),e.jsxs(q.Text,{style:{marginRight:8},children:[p==null?void 0:p.profitMargin,"%"]})]}),e.jsxs($,{children:[e.jsx(q.Text,{strong:!0,children:"סך הכל עלות:"}),e.jsxs(q.Text,{style:{marginRight:8},children:["₪",p==null?void 0:p.totalCost]})]})]})})};return e.jsxs("div",{style:{border:"1px solid #e6e6e6",borderRadius:"8px",padding:"16px",background:"#fafafa",boxShadow:"0 1px 2px rgba(0,0,0,0.05)",marginBottom:"16px"},children:[e.jsx(B,{flex:1,style:{padding:"0em 1em"},justify:"space-between",align:"middle",children:e.jsxs(H,{className:"width-100",children:[e.jsx(B,{flex:1,style:{marginBottom:"8px"},children:e.jsxs($,{className:"width-100",align:"middle",justify:"space-between",children:[e.jsx(q.Text,{strong:!0,style:{fontSize:"1.2em"},children:t==null?void 0:t.label}),e.jsxs(B,{children:[s&&e.jsx(T,{type:"text",icon:e.jsx(Ke,{}),onClick:()=>s(n)}),i&&e.jsx(T,{type:"text",danger:!0,icon:e.jsx(ue,{}),onClick:()=>i(n)})]})]})}),e.jsxs(B,{flex:1,align:"start",style:{gap:"12px",marginBottom:"8px",flexDirection:"column"},children:[e.jsxs($,{align:"middle",style:{gap:"8px"},children:[e.jsx(N,{style:{fontSize:"0.9em"},icon:ft}),e.jsxs(q.Text,{style:{fontSize:"1.1em",fontWeight:"bold",display:"flex",alignItems:"center",gap:"4px"},children:["₪",t==null?void 0:t.price]})]}),e.jsxs($,{align:"middle",style:{gap:"8px"},children:[e.jsx(N,{style:{fontSize:"0.9em"},icon:Fe}),e.jsxs(q.Text,{style:{fontSize:"1.1em",fontWeight:"bold",display:"flex",alignItems:"center",gap:"4px"},children:[t==null?void 0:t.preparationTime," דקות"]})]})]}),w(c,h)]})}),e.jsx(W,{style:{margin:"12px 0"}}),e.jsx(q.Text,{strong:!0,style:{display:"block",marginBottom:"8px"},children:"מרכיבים:"}),e.jsx("ul",{style:{paddingLeft:"20px",margin:"0"},children:(v=t==null?void 0:t.ingredients)==null?void 0:v.map((f,u)=>{var m;const p=(()=>{switch(f.unit){case"weight":return'ק"ג';case"volume":return"ליטר";case"units":return"יחידות";default:return""}})();return e.jsx("li",{style:{marginBottom:"4px"},children:e.jsxs(q.Text,{children:[(m=r==null?void 0:r.find(a=>(a==null?void 0:a._id)===(f==null?void 0:f.ingredientId)))==null?void 0:m.name," -"," ",f.quantity," ",p," - ₪",f==null?void 0:f.costForQuantity]})},u)})}),e.jsx(W,{style:{margin:"12px 0"}}),e.jsx(q.Text,{strong:!0,style:{display:"block",marginBottom:"8px"},children:"מיקסים:"}),e.jsx("ul",{style:{paddingLeft:"20px",margin:"0"},children:(S=t==null?void 0:t.mixes)==null?void 0:S.map((f,u)=>{var m;const p=(()=>{switch(f.unit){case"weight":return'ק"ג';case"volume":return"ליטר";case"units":return"יחידות";default:return""}})();return e.jsx("li",{style:{marginBottom:"4px"},children:e.jsxs(q.Text,{children:[(m=x==null?void 0:x.find(a=>(a==null?void 0:a._id)===(f==null?void 0:f.mixId)))==null?void 0:m.name," -"," ",f.quantity," ",p," - ₪",f==null?void 0:f.costForQuantity]})},u)})})]},t.idNew||n)}const Hs=C.forwardRef(({size:t,index:n,sizes:s,onChange:i,onDelete:r,newSizeId:x,setNewSizeId:c,transformValueToForm:h,setActiveTabKey:g,ingredients:w,mixes:v,sizeSummary:S,priceExcludingVAT:f,activeSubTab:u,setActiveSubTab:p,onSubmit:m},a)=>{const[o]=F.useForm();C.useImperativeHandle(a,()=>({setFieldsValue:b=>o.setFieldsValue(b),getFieldsValue:()=>o.getFieldsValue(),resetFields:()=>o.resetFields()}));const y=()=>{const b=[...s];b[n]={...b[n],edit:!1,ingredients:t.ingredients.filter(I=>I==null?void 0:I._id),mixes:t.mixes.filter(I=>I==null?void 0:I._id)},i(b)},d=b=>{const I=[...s];I[b]={...I[b],edit:!0},i(I)},l=b=>{const I=s[b];if(I!=null&&I._id)te.confirm({title:"האם אתה בטוח שברצונך למחוק את הגודל הזה?",content:`המחיקה תסיר לצמיתות את ${I.label}.`,okText:"מחק",okType:"danger",cancelText:"ביטול",onOk:()=>{r(I==null?void 0:I.productId,I._id).then(()=>{const P=[...s];P.splice(b,1),i(P),o.setFieldsValue({...P[b]}),g(Math.max(0,b-1).toString())}).catch(P=>{console.error("Error deleting size:",P)})}});else{const P=[...s];P.splice(b,1),i(P),o.setFieldsValue(h()),g(Math.max(0,b-1).toString()),c(null)}},j=b=>{switch(b){case"weight":return'ק"ג';case"volume":return"ליטר";case"units":return"יחידות";default:return""}};return!(t!=null&&t._id)||t!=null&&t.edit?e.jsx(F,{form:o,initialValues:{...t},onFinish:async(b,I)=>{m(b)},children:e.jsx(Ls,{handleCancelEdit:y,handleRemoveSize:l,newSizeId:x,size:t,index:n,onChange:i,form:o,ingredients:w,mixes:v,setNewSizeId:c,setActiveSubTab:p,activeSubTab:u,sizes:s,getUnitDisplay:j})}):e.jsx(Ct,{handleEditSize:d,handleRemoveSize:l,index:n,size:t,ingredients:w,mixes:v,priceExcludingVAT:f,sizeSummary:S})}),{TabPane:Vs}=ye,rt=C.forwardRef(({value:t=[],onChange:n,ingredients:s,mixes:i,onSubmit:r,onDelete:x,sizeSummary:c,priceExcludingVAT:h},g)=>{const[w,v]=C.useState(null),[S,f]=C.useState("0"),[u,p]=C.useState("1"),m=C.useRef([]),a=y=>({value:y}),o=()=>{var l;const y={idNew:Date.now(),label:`גודל ${t.length+1}`,price:null,preparationTime:null,ingredients:[],mixes:[],edit:!0},d=[...t,y];n(d),(l=m.current[+S])==null||l.setFieldsValue({...y}),v(y.idNew),f(t.length.toString()),p("1")};return e.jsxs(B,{style:{flexDirection:"column"},children:[e.jsx(T,{type:"default",icon:e.jsx(Te,{}),onClick:o,children:"הוסף גודל"}),e.jsx(ye,{activeKey:S,onChange:y=>f(y),tabBarStyle:{direction:"rtl"},style:{margin:"1vw 0"},type:"card",tabPosition:"top",children:t==null?void 0:t.map((y,d)=>{var l;return e.jsx(Vs,{tab:(y==null?void 0:y.label)||`גודל ${d+1}`,children:e.jsx(Hs,{ref:j=>m.current[d]=j,size:y,index:d,sizes:t,onChange:n,onDelete:x,ingredients:s,transformValueToForm:a,setActiveTabKey:f,setActiveSubTab:p,activeSubTab:u,mixes:i,onSubmit:r,newSizeId:w,setNewSizeId:v,sizeSummary:c&&c[d],priceExcludingVAT:h&&((l=h[d])==null?void 0:l.priceExcludingVAT)})},d.toString())})})]})}),{TabPane:it}=ye,at=C.forwardRef(({value:t=[],sizes:n,onChange:s,ingredients:i,onSubmit:r,onDelete:x},c)=>{const[h,g]=C.useState(null),[w,v]=C.useState("0"),[S]=F.useForm(),f=()=>({value:t}),u=()=>{const o={idNew:Date.now(),label:`וריאציה - ${t.length+1}`,sizeAdjustments:[...n==null?void 0:n.map(d=>({sizeId:d==null?void 0:d._id,label:d==null?void 0:d.label,priceAdjustment:null,preparationTimeAdjustment:null,ingredients:d==null?void 0:d.ingredients,mixes:d==null?void 0:d.mixes,add:[],remove:[],update:[]}))]},y=[...t,o];s(y),S.setFieldsValue({variations:y}),g(o.idNew),v(t.length.toString())},p=o=>{const y=t[o];if(y!=null&&y._id)te.confirm({title:"האם אתה בטוח שברצונך למחוק את הוריאציה הזו?",content:`המחיקה תסיר לצמיתות את ${y.label}.`,okText:"מחק",okType:"danger",cancelText:"ביטול",onOk:()=>{x(y==null?void 0:y.productId,y._id).then(()=>{const d=[...t];d.splice(o,1),s(d),S.setFieldsValue({sizes:d}),v(Math.max(0,o-1).toString())}).catch(d=>{console.error("Error deleting vatiation:",d)})}});else{const d=[...t];d.splice(o,1),s(d),S.setFieldsValue(f()),v(Math.max(0,o-1).toString()),g(null)}},m=o=>{const y=[...t];y[o]={...y[o],edit:!0},s(y)},a=o=>{switch(o){case"weight":return'ק"ג';case"volume":return"ליטר";case"units":return"יחידות";default:return""}};return e.jsxs(F,{form:S,initialValues:{variations:t},onFinish:(o,y)=>{var d;r({variations:(d=o==null?void 0:o.variations)==null?void 0:d.filter(l=>l)})},children:[!n.length&&e.jsx(Wt,{message:"לא ניתן להוסיף וריאציות",description:"יש להוסיף לפחות גודל אחד לפני שניתן להוסיף וריאציות.",type:"warning",showIcon:!0,style:{marginBottom:"16px"}}),e.jsx(T,{type:"default",icon:e.jsx(Te,{}),disabled:(n==null?void 0:n.length)===0||!n,onClick:u,children:"הוסף וריאציה"}),e.jsx(F.List,{name:["variations","sizeAdjustments"],children:(o,{add:y,remove:d})=>{ye,o.map(({key:l,name:j,fieldKey:b})=>{var P;const I=S.getFieldValue(["variations","sizeAdjustments",l]);return e.jsx(it,{tab:(I==null?void 0:I.label)||`גודל ${l+1}`,children:!(I!=null&&I._id)||I!=null&&I.edit?e.jsxs("div",{className:I.idNew===h?"highlight-new":"",style:{border:`1px ${I!=null&&I.idNew?"dashed":"solid #e6e6e6"}`,borderRadius:"8px",padding:"16px",background:"#fafafa",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},children:[e.jsxs($,{justify:"space-between",align:"middle",style:{marginBottom:"12px"},children:[e.jsx(F.Item,{name:["variations","sizeAdjustments",l,"_id"],hidden:!0,children:e.jsx(z,{})}),e.jsx(F.Item,{name:["variations","sizeAdjustments",l,"label"],label:"שם הוריאציה",rules:[{required:!0,message:"חייב למלא שם גודל"}],children:e.jsx(z,{placeholder:"שם הוריאציה",size:"middle",style:{width:"auto",minWidth:"200px"}})}),e.jsx(T,{type:"text",style:{alignSelf:"flex-start"},danger:!0,icon:e.jsx(ue,{}),title:"מחק וריאציה",onClick:()=>p(l),children:"מחק וריאציה"})]}),e.jsx(F.List,{name:["variations","sizeAdjustments",l],children:(D,{add:E,remove:_})=>e.jsx(ye,{tabBarStyle:{direction:"rtl"},style:{margin:"1vw 0"},type:"card",tabPosition:"top",children:D.map(({key:L,name:U,fieldKey:R})=>{const J=S.getFieldValue(["variations",index,"sizeAdjustments",U]);return e.jsxs(it,{tab:(J==null?void 0:J.label)||`Size ${U}`,children:[e.jsxs($,{gutter:[16,16],children:[e.jsx(H,{span:12,children:e.jsx(F.Item,{name:["variations",index,"price"],label:"תוספת מחיר",rules:[{required:!1,message:"יש למלא מחיר"},{type:"number",min:0,message:"המחיר חייב להיות חיובי"}],children:e.jsx(K,{placeholder:"מחיר",style:{width:"100%"}})})}),e.jsx(H,{span:12,children:e.jsx(F.Item,{label:"תוספת זמן הכנה (דקות)",name:["sizes",index,"preparationTime"],rules:[{required:!1,message:"חייב לציין זמן הכנה"}],children:e.jsx(K,{placeholder:"זמן הכנה",style:{width:"100%"}})})})]}),e.jsx(q.Text,{strong:!0,style:{display:"block",marginBottom:"8px"},children:"מרכיבים:"}),e.jsx(F.List,{name:["sizes",index,"ingredients"],children:(Y,{add:xe,remove:ne})=>e.jsxs(e.Fragment,{children:[e.jsx(T,{type:"dashed",style:{marginBottom:"0.5vw"},onClick:()=>xe({ingredientId:null,quantity:null,unit:null}),children:"הוסף מרכיב"}),e.jsx("div",{style:{maxHeight:"12vw",overflowY:"auto",overflowX:"hidden"},children:Y.map(({key:je,name:ge,fieldKey:A})=>e.jsxs($,{gutter:16,children:[e.jsx(H,{span:10,children:e.jsx(F.Item,{name:[ge,"ingredientId"],fieldKey:[A,"ingredientId"],rules:[{required:!0,message:"בחר רכיב"}],children:e.jsx(X,{placeholder:"בחר מרכיב",showSearch:!0,filterOption:(O,Q)=>{var ee;return(ee=Q==null?void 0:Q.label)==null?void 0:ee.toLowerCase().includes(O.toLowerCase())},options:i.map(O=>({value:O._id,label:O.name,unit:O==null?void 0:O.unit}))})})}),e.jsx(H,{span:10,children:e.jsx(F.Item,{name:[ge,"quantity"],fieldKey:[A,"quantity"],rules:[{required:!0,message:"הזן כמות"}],children:e.jsx(K,{placeholder:"כמות",addonAfter:a(S.getFieldValue(["sizes",index,"ingredients",ge,"unit"])||"")})})}),e.jsx(H,{span:4,children:e.jsx(T,{type:"text",danger:!0,icon:e.jsx(ve,{}),onClick:()=>ne(ge)})})]},je))})]})})]},L)})})}),e.jsx(W,{style:{margin:"12px 0"}})]},I.idNew||l):e.jsxs("div",{style:{border:"1px solid #e6e6e6",borderRadius:"8px",padding:"16px",background:"#fafafa",boxShadow:"0 1px 2px rgba(0,0,0,0.05)",marginBottom:"16px"},children:[e.jsx(B,{flex:1,style:{padding:"0em 1em"},justify:"space-between",align:"middle",children:e.jsxs(H,{className:"width-100",children:[e.jsx(B,{flex:1,style:{marginBottom:"8px"},children:e.jsxs($,{className:"width-100",align:"middle",justify:"space-between",children:[e.jsx(q.Text,{strong:!0,style:{fontSize:"1.2em"},children:size==null?void 0:size.label}),e.jsxs(B,{children:[e.jsx(T,{type:"text",icon:e.jsx(Ke,{}),onClick:()=>m(index)}),e.jsx(T,{type:"text",danger:!0,icon:e.jsx(ue,{}),onClick:()=>p(index)})]})]})}),e.jsxs(B,{flex:1,align:"middle",style:{gap:"12px",marginBottom:"8px"},children:[e.jsxs($,{align:"middle",style:{gap:"8px"},children:[e.jsxs(q.Text,{style:{color:"#007acc",fontSize:"1.1em",fontWeight:"bold",display:"flex",alignItems:"center",gap:"4px"},children:["₪",size==null?void 0:size.price]}),e.jsx(N,{style:{fontSize:"0.9em",color:"#007acc"},icon:ft})]}),e.jsxs($,{align:"middle",style:{gap:"8px"},children:[e.jsxs(q.Text,{style:{fontSize:"1.1em",fontWeight:"bold",display:"flex",alignItems:"center",gap:"4px"},children:[size==null?void 0:size.preparationTime," דקות"]}),e.jsx(N,{style:{fontSize:"0.9em"},icon:Fe})]})]})]})}),e.jsx(W,{style:{margin:"12px 0"}}),e.jsx(q.Text,{strong:!0,style:{display:"block",marginBottom:"8px"},children:"מרכיבים:"}),e.jsx("ul",{style:{paddingLeft:"20px",margin:"0"},children:(P=size==null?void 0:size.ingredients)==null?void 0:P.map((D,E)=>{var L;const _=(()=>{switch(D.unit){case"weight":return'ק"ג';case"volume":return"ליטר";case"units":return"יחידות";default:return""}})();return e.jsx("li",{style:{marginBottom:"4px"},children:e.jsxs(q.Text,{children:[(L=i==null?void 0:i.find(U=>(U==null?void 0:U._id)===(D==null?void 0:D.ingredientId)))==null?void 0:L.name," -"," ",D.quantity," ",_]})},E)})})]},size.idNew||index)},l)})}}),e.jsx(T,{type:"primary",htmlType:"submit",disabled:t.length===0,onClick:()=>g(null),children:"שמור"})]})}),{Title:pa,Text:lt}=q,Ds=({})=>{var I;const{isModalVisible:t,setIsModalVisible:n,modalMode:s,setModalMode:i,selectedItem:r,setSelectedItem:x,addProduct:c,updateProduct:h,deleteProduct:g,addSize:w,updateSize:v,deleteSize:S}=St(),f=he({query:"(max-width: 500px)"}),u=V(P=>P.categories),p=(I=V(P=>P.ingredients))==null?void 0:I.filter(P=>P==null?void 0:P.is_active),m=V(P=>P.mixes),a=V(P=>P.products),o=C.useCallback(()=>{if(!r||!a)return;const P=a.find(D=>D._id===r._id);if(P){const D=((r==null?void 0:r.sizes)||[]).filter(_=>{var L;return _.edit||_._id&&((L=P.sizes)==null?void 0:L.some(U=>U._id===_._id))}).map(_=>{var U;const L=(U=P.sizes)==null?void 0:U.find(R=>R._id===_._id);return L||_}),E=(P.sizes||[]).filter(_=>!((r==null?void 0:r.sizes)||[]).some(L=>L._id===_._id));x({...P,sizes:[...D,...E]})}},[r,a]);C.useEffect(()=>{o()},[a]);const[y]=F.useForm(),d=(P,D,E)=>{if(P==="product")switch(D){case"add":return"הוספת מוצר";case"edit":return"עדכון מוצר";case"view":return"צפייה במוצר";default:return"הוספת מוצר"}else switch(P){case"size":return`ניהול גדלים - ${E==null?void 0:E.name}`;case"variation":return`ניהול וריאציות - ${E==null?void 0:E.name}`}};C.useEffect(()=>{r?y.setFieldsValue(r):y.resetFields()},[r]);const l=P=>{var D,E;switch(t){case"product":const _=y.getFieldsValue();s==="edit"?h({..._,_id:r==null?void 0:r._id}).then(()=>{n(!1),x(null)}).catch(R=>{console.error("שגיאה בעריכת מוצר:",R)}):c(_).then(()=>{n(!1),x(null)}).catch(R=>{console.error("שגיאה בהוספת מוצר:",R)});break;case"size":const L=P,U={productId:r==null?void 0:r._id,label:L.label,price:L.price,preparationTime:L.preparationTime,ingredients:((D=L.ingredients)==null?void 0:D.map(R=>{var J;return{ingredientId:((J=R.ingredientId)==null?void 0:J._id)||R.ingredientId,quantity:R.quantity,unit:R.unit}}))||[],mixes:((E=L.mixes)==null?void 0:E.map(R=>({mixId:R.mixId,quantity:R.quantity,unit:R.unit})))||[],_id:L._id};new Promise((R,J)=>U._id?v(U._id,U):w(r==null?void 0:r._id,U)).then(()=>{}).catch(R=>{console.error("Error managing sizes:",R)});break}},j=()=>{switch(t){case"product":return e.jsxs(F,{form:y,layout:"vertical",onFinish:l,children:[e.jsx(F.Item,{name:"name",label:"שם מוצר",rules:[{required:!0,message:"אנא הזן שם מוצר"},{max:25,message:"שם המוצר לא יכול להיות יותר מ-25 תווים"}],children:e.jsx(z,{maxLength:25,showCount:!0})}),e.jsx(F.Item,{name:"category",label:"קטגוריה",rules:[{required:!0,message:"אנא בחר קטגוריה"}],children:e.jsx(X,{showSearch:!0,placeholder:"בחר קטגוריה",optionFilterProp:"children",filterOption:(P,D)=>D.children.toLowerCase().indexOf(P.toLowerCase())>=0,children:u.map(P=>e.jsx(X.Option,{value:P._id,children:P==null?void 0:P.name},P._id))})}),e.jsx(F.Item,{name:"isFeatured",label:"פעיל",children:e.jsx(We,{checkedChildren:"פעיל",unCheckedChildren:"לא פעיל"})}),e.jsx(F.Item,{name:"isOnSale",label:"מוצר מכירה",children:e.jsx(We,{checkedChildren:"פעיל",unCheckedChildren:"לא פעיל"})}),e.jsx(F.Item,{name:"notes",label:"הערות",rules:[{required:!1,message:"אנא הזן הערות"},{max:250,message:"ההערות לא יכולות להיות יותר מ-250 תווים"}],children:e.jsx(z.TextArea,{rows:4,maxLength:250,showCount:!0})}),e.jsx(F.Item,{children:e.jsx(T,{type:"primary",htmlType:"submit",children:"שמור מוצר"})})]});case"size":return e.jsx(rt,{value:r==null?void 0:r.sizes,setValue:x,ingredients:p,sizeSummary:r==null?void 0:r.sizeSummary,priceExcludingVAT:r==null?void 0:r.priceExcludingVAT,mixes:m,onDelete:S,onSubmit:l,onChange:P=>x({...r,sizes:P})});case"variation":return e.jsx(at,{value:r==null?void 0:r.variations,form:formVariation,setValue:x,sizes:r==null?void 0:r.sizes,ingredients:p,onChange:P=>x({...r,variations:P})});default:return null}},b=()=>{var P,D;switch(t){case"product":return e.jsxs(G,{styles:{body:{display:"flex",flexDirection:"column"}},children:[e.jsxs($,{align:"middle",justify:"space-between",style:{margin:"1em 0em"},children:[e.jsx(lt,{strong:!0,style:{fontSize:"1.5em"},children:r==null?void 0:r.name}),e.jsxs($,{style:{gap:"0.5em"},children:[e.jsx(ae,{className:r!=null&&r.isFeatured?"green":"red",children:r!=null&&r.isFeatured?"פעיל":"לא פעיל"}),e.jsx(ae,{className:r!=null&&r.isOnSale?"blue":"yellow",children:r!=null&&r.isOnSale?"במבצע":"לא במבצע"})]}),e.jsx(ae,{children:(P=u==null?void 0:u.find(E=>E._id===(r==null?void 0:r.category)))==null?void 0:P.name})]}),e.jsxs("div",{style:{marginBottom:"12px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(B,{flex:1,children:e.jsxs(lt,{strong:!0,children:["הערות",":"]})}),e.jsx(B,{flex:1,children:e.jsx("p",{style:{},children:r==null?void 0:r.notes})})]}),e.jsx(W,{style:{margin:"8px 0"}}),e.jsx(B,{flex:1,style:{flexDirection:"column",maxHeight:"50vh",overflowY:"auto"},children:(D=r==null?void 0:r.sizes)==null?void 0:D.map((E,_)=>e.jsx(Ct,{handleEditSize:!1,handleRemoveSize:!1,index:_,size:E,ingredients:p,mixes:m,priceExcludingVAT:(r==null?void 0:r.priceExcludingVAT)&&(r==null?void 0:r.priceExcludingVAT[_].priceExcludingVAT),sizeSummary:(r==null?void 0:r.sizeSummary)&&(r==null?void 0:r.sizeSummary[_])}))})]});case"size":return e.jsx(rt,{value:r==null?void 0:r.sizes,setValue:x,ingredients:p,sizeSummary:r==null?void 0:r.sizeSummary,priceExcludingVAT:r==null?void 0:r.priceExcludingVAT,mixes:m,onDelete:S,onSubmit:l,onChange:E=>x({...r,sizes:E})});case"variation":return e.jsx(at,{value:r==null?void 0:r.variations,mode:"view",ingredients:p,onChange:E=>x({...r,variations:E})});default:return null}};return e.jsx(te,{style:{top:f?"3em":""},title:d(t,s,r),open:t,onCancel:()=>{n(!1),x()},footer:null,destroyOnClose:!0,width:f?"100%":600,styles:{gap:"0.5em"},children:s==="view"?b():j()})},{Search:Os}=z;function Ee({dataPrint:t,data:n,groups:s,tableKeys:i,newTitle:r,setDataPrint:x,searchKeys:c,sortKeys:h,mobileKeys:g,Dtitle:w,Dcontent:v,onAdd:S,onEdit:f,onDelete:u,width:p,ingredientsArr:m,iconADD:a,floatAction:o,type:y,openModalProduct:d}){const[l,j]=C.useState([]),[b,I]=C.useState(!1),[P,D]=C.useState(!1),[E,_]=C.useState("add"),[L,U]=C.useState(null),R=he({query:"(max-width: 500px)"}),J=h.map(A=>({key:A==null?void 0:A.key,label:e.jsx("span",{className:"width-100",onClick:()=>{const O=[...t].sort((Q,ee)=>{const oe=Q[A==null?void 0:A.key],de=ee[A==null?void 0:A.key];return typeof oe=="number"&&typeof de=="number"?de-oe:oe==null?void 0:oe.toString().localeCompare(de==null?void 0:de.toString())});x(O)},children:A==null?void 0:A.title})})),Y=A=>{if(A==="all")j(i);else{let O=l.findIndex(ee=>ee.key===A),Q=[...l];O!==-1?Q=Q.filter(ee=>ee.key!==A):Q=[...Q,i.find(ee=>ee.key===A)],j(Q)}},xe=[{key:"all",label:e.jsx(be,{className:"width-100",rootClassName:"width-100",checked:l.length===i.length,disabled:l.length===i.length,onChange:()=>Y("all"),onClick:A=>A.stopPropagation(),children:"הכל"})},...i.filter(A=>!(A!=null&&A.required)).map(({title:A,dataIndex:O})=>({key:O,label:e.jsx(be,{className:"width-100",rootClassName:"width-100",checked:l.some(Q=>Q.key===O),disabled:l.length<=3&&l.some(Q=>Q.key===O),onChange:()=>Y(O),onClick:Q=>Q.stopPropagation(),children:A})}))],ne=(A,O=null)=>{if(y==="P")return d(A,O);_(A),U(O),D(!0)},je=()=>{D(!1),U(null)},ge=A=>{te.confirm({title:w,content:v,okText:"מחק",cancelText:"בטל",onOk:()=>u(A==null?void 0:A._id)})};return C.useEffect(()=>{j(i)},[i]),e.jsxs(B,{flex:1,vertical:!0,style:{maxWidth:"100%"},gap:"1em",className:"container",children:[e.jsxs($,{align:"middle",style:{flexFlow:""},justify:"space-between",children:[!R&&e.jsx($,{style:{},children:e.jsx(T,{onClick:()=>ne("add"),type:"primary",children:r})}),e.jsx($,{style:{},children:e.jsx(Os,{placeholder:"חיפוש ...",allowClear:!0,onChange:({target:A})=>{x(n==null?void 0:n.filter(O=>c.some(Q=>{var ee,oe,de;return(de=(oe=(ee=O[Q])==null?void 0:ee.toString())==null?void 0:oe.toLowerCase())==null?void 0:de.includes(A.value.toLowerCase())})))},style:{width:200}})}),e.jsxs($,{style:{gap:"0.5em"},children:[!R&&e.jsx(tt,{menu:{items:xe},trigger:["click"],open:b,onOpenChange:A=>I(A),children:e.jsxs(T,{children:[e.jsx(N,{icon:Gt,style:{marginLeft:"8px"}}),R?e.jsx(e.Fragment,{children:`${l.length} / ${i.length}`}):e.jsx(e.Fragment,{children:`בחרת ${l.length} מתוך ${i.length}`})]})}),e.jsx(tt,{menu:{items:J},trigger:["click"],children:e.jsxs(T,{type:R?"link":"default",children:[e.jsx(N,{icon:Xt,style:{marginLeft:"8px"}}),"מיון"]})})]})]}),e.jsxs(Be.Group,{trigger:"click",type:"primary",icon:e.jsx(N,{icon:Kt}),children:[e.jsx(Be,{type:"primary",onClick:()=>ne("add"),icon:a}),o==null?void 0:o.map((A,O)=>e.jsx(ze.Fragment,{children:A},`float-action-${O}`))]}),e.jsx(As,{data:t,tableKeys:[{title:"פעולות",key:"action",minWidth:130,render:(A,O)=>e.jsxs($,{className:"card-actions",align:"middle",justify:"center",children:[e.jsx(T,{type:"text",onClick:()=>ge(O),children:e.jsx(N,{icon:gt})}),e.jsx(T,{type:"text",onClick:()=>ne("edit",O),children:e.jsx(N,{icon:yt})}),e.jsx(T,{type:"text",onClick:()=>ne("view",O),children:e.jsx(N,{icon:jt})})]})},...l],openModal:ne,mobileKeys:g,type:y,Dtitle:w,Dcontent:v,onDelete:u}),e.jsx(te,{style:{top:R?"3em":""},title:E==="add"?"הוסף פריט חדש":E==="edit"?"ערוך פריט":"צפייה בפרטי פריט",open:P,onCancel:je,footer:null,destroyOnClose:!0,width:R?"100%":p||600,children:y!=="P"&&e.jsx(Ms,{mode:E,groups:s,tableKeys:l,ingredientsArr:m,fields:i.filter(A=>A.editable||E==="view"),onSubmit:A=>{E==="add"&&S(A),E==="edit"&&f({...L,...A}),je()},initialValues:L||{},onClose:je})})]})}const Ae="https://menu-server-c2b952e2c698.herokuapp.com/api",Us=t=>M.post(`${Ae}/categories`,t),Ws=t=>{const n=encodeURIComponent(t._id);return M.put(`${Ae}/categories/${n}`,t)},Bs=t=>M.delete(`${Ae}/categories/${t}`),Ys=()=>M.get(`${Ae}/categories`),bt=C.createContext(),Qs=()=>C.useContext(bt),zs=({children:t})=>{const[n,s]=C.useState(!1),i=async c=>{s(!0);try{await Us(c),k.success("הקטגוריה נוספה בהצלחה"),s(!1)}catch(h){console.error("Error adding category:",h),k.error("שגיאה בהוספת הקטגוריה"),s(!1)}},r=async c=>{s(!0);try{await Ws(c),k.success("הקטגוריה עודכנה בהצלחה"),s(!1)}catch(h){console.error("Error updating category:",h),k.error("שגיאה בעדכון הקטגוריה"),s(!1)}},x=async c=>{s(!0);try{await Bs(c),k.success("הקטגוריה נמחקה בהצלחה"),s(!1)}catch(h){console.error("Error deleting category:",h),k.error("שגיאה במחיקת הקטגוריה"),s(!1)}};return e.jsx(bt.Provider,{value:{addCategory:i,updateCategory:r,deleteCategory:x,loading:n},children:t})},{Title:ot,Text:Js}=q,Gs=({isCategoryModalVisible:t,setIsCategoryModalVisible:n})=>{const{addCategory:s,updateCategory:i,deleteCategory:r}=Qs(),x=V(o=>o.categories),[c,h]=C.useState(""),[g,w]=C.useState(null),[v,S]=C.useState(""),f=()=>{if(c.trim()===""){S("אנא הזן שם קטגוריה תקין");return}if(x.some(o=>o.name===c.trim()&&o!==g)){S("קטגוריה זו כבר קיימת");return}g?i({...g,name:c.trim()}):s({name:c.trim()}),h(""),w(null),S("")},u=o=>{w(o),h(o.name)},p=()=>{if(c.trim()===""){S("אנא הזן שם קטגוריה תקין");return}i({...g,name:c.trim()}),h(""),w(null),S("")},m=o=>{r(o)},a=()=>{h(""),w(null),S(""),n(!1)};return e.jsxs(te,{title:g?"ערוך קטגוריה":"הוסף קטגוריה חדשה",open:t,onCancel:a,footer:null,className:"category-modal popup-modal",children:[e.jsxs("div",{className:"category-form-section",children:[e.jsx(ot,{level:4,children:g?"ערוך קטגוריה":"הוסף קטגוריה חדשה"}),e.jsx(z,{placeholder:"הזן שם קטגוריה",value:c,onChange:o=>h(o.target.value),onPressEnter:f}),v&&e.jsx(Js,{type:"danger",className:"error-message",children:v}),e.jsx(T,{type:"primary",onClick:f,style:{marginTop:"10px"},children:g?"עדכן קטגוריה":"הוסף קטגוריה"})]}),e.jsxs("div",{className:"category-list-section",children:[e.jsx(ot,{level:4,style:{marginTop:"20px"},children:"קטגוריות קיימות:"}),e.jsx(ie,{dataSource:x,renderItem:o=>e.jsx(ie.Item,{className:g&&g._id===o._id?"editing-item":"",actions:[g&&g._id===o._id?e.jsx(T,{type:"link",onClick:p,children:"שמור"}):e.jsx(T,{type:"link",onClick:()=>u(o),children:"ערוך"}),e.jsx(Ge,{title:"האם אתה בטוח שברצונך למחוק את הקטגוריה?",onConfirm:()=>m(o._id),okText:"כן",cancelText:"לא",children:e.jsx(T,{icon:e.jsx(ue,{}),type:"text",danger:!0})})],children:g&&g._id===o._id?e.jsx(z,{value:c,onChange:y=>h(y.target.value),onPressEnter:p,autoFocus:!0}):o.name})})]})]})},Xs=({categories:t,isMobile:n,selectedCategory:s,setSelectedCategory:i,setIsCategoryModalVisible:r})=>{const x=C.useRef(null),c=C.useRef({}),h=()=>{x.current.scrollBy({left:200,behavior:"smooth"})},g=()=>{x.current.scrollBy({left:-200,behavior:"smooth"})},w=v=>{i(v),c.current[v]&&c.current[v].scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})};return e.jsx("div",{style:{padding:"16px",backgroundColor:"#f0f2f5"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(T,{icon:e.jsx(is,{}),onClick:h}),e.jsxs("div",{ref:x,style:{display:"flex",overflowX:"auto",flexGrow:1,gap:"8px",padding:"8px 0",scrollbarWidth:"none",msOverflowStyle:"none"},children:[e.jsx(T,{type:s==="all"?"primary":"default",onClick:()=>w("all"),children:"הכל"}),t.map(v=>e.jsx(T,{ref:S=>c.current[v._id]=S,type:s===v._id?"primary":"default",onClick:()=>w(v._id),children:v.name},v._id))]}),e.jsx(T,{icon:e.jsx(as,{}),onClick:g}),!n&&e.jsx(T,{type:"primary",icon:e.jsx(Te,{}),onClick:()=>r(!0)})]})})};function Ks(){var D;const{addProduct:t,updateProduct:n,deleteProduct:s,isModalVisible:i,setIsModalVisible:r,modalMode:x,setModalMode:c,selectedItem:h,setSelectedItem:g}=St(),w=he({query:"(max-width: 500px)"});C.useRef(null);const[v,S]=C.useState([]),[f,u]=C.useState([]),[p,m]=C.useState("all"),[a,o]=C.useState(!1),y=V(E=>E.products),d=V(E=>E.categories),l=(D=V(E=>E.ingredients))==null?void 0:D.filter(E=>E==null?void 0:E.is_active),j=["name","category"],b=["name","category","detailes","sizes","productSummary","actions"],I=[{key:"name",dataIndex:"name",title:"שם",required:!0},{key:"category",dataIndex:"category",title:"קטגוריה"},{key:"profitMargin",dataIndex:"profitMargin",title:"אחוז רווח"}],P=C.useMemo(()=>[{key:"name",dataIndex:"name",title:"שם המוצר",editable:!0,type:"text",rules:[{required:!0,message:"חייב להיות שם מוצר"},{min:2,message:"שם חייב להיות לפחות 2 תווים"}]},{key:"category",dataIndex:"category",title:"קטגוריה",editable:!0,type:"select",render:(E,_)=>{var L,U;return console.log(_==null?void 0:_.category),console.log(d),console.log((L=d==null?void 0:d.find(R=>R._id===(_==null?void 0:_.category)))==null?void 0:L.name),e.jsx(ae,{children:(U=d==null?void 0:d.find(R=>R._id===(_==null?void 0:_.category)))==null?void 0:U.name})},options:d.map(E=>({value:E._id,label:E.name})),rules:[{required:!0,message:"יש לבחור קטגוריה"}]},{key:"detailes",width:100,render:(E,_)=>e.jsxs($,{style:{gap:"0.5em"},align:"middle",justify:"center",children:[e.jsx(ae,{className:_!=null&&_.isFeatured?"green":"red",children:_!=null&&_.isFeatured?"פעיל":"לא פעיל"}),e.jsx(ae,{className:_!=null&&_.isOnSale?"blue":"yellow",children:_!=null&&_.isOnSale?"במבצע":"לא במבצע"})]})},{key:"sizes",title:"גדלים",type:"custom",editable:!0,render:(E,_,L="view",U)=>{var R;return(R=_==null?void 0:_.sizes)==null?void 0:R.length}},{key:"variations",title:"ווריאציות",type:"custom",editable:!0,render:(E,_,L="view",U)=>{var R;return(R=_==null?void 0:_.variations)==null?void 0:R.length}},{key:"productSummary",dataIndex:"productSummary",title:"אחוז רווח (ממוצע)",width:150,render:(E,_)=>{var L;return`${((L=_==null?void 0:_.productSummary)==null?void 0:L.averageProfitMargin)||0}%`}},{key:"actions",dataIndex:"actions",width:200,render:(E,_)=>e.jsx("div",{className:"",style:{display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs(T,{type:"text",onClick:()=>{r("size"),g(_)},children:[e.jsx("p",{children:"גדלים"}),e.jsx(N,{icon:Ie})]})})}],[d]);return C.useEffect(()=>{if(y){const E=p&&p!=="all"?y.filter(_=>_.category===p):y;S(E),u(E)}},[y,p]),e.jsxs("div",{style:{display:"flex",flexDirection:"column",maxWidth:"100%",height:"100%",width:"100%",overflow:"hidden","- webkit - overflow - scrolling":"touch"},children:[e.jsx(Xs,{categories:d,isMobile:w,selectedCategory:p,setIsCategoryModalVisible:o,setSelectedCategory:m}),e.jsx(B,{flex:1,children:e.jsx(Ee,{type:"P",data:v,mobileKeys:b,dataPrint:f,sortKeys:I,tableKeys:P,newTitle:"הוסף מוצר חדש",searchKeys:j,setDataPrint:u,onAdd:t,onEdit:n,onDelete:s,ingredientsArr:l,Dtitle:"אישור מחיקה",Dcontent:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"האם אתה בטוח שברצונך למחוק את המוצר?"}),e.jsx("p",{children:"שים לב! מחיקת מוצר עשויה להשפיע על מכירות ותערובות קשורות."})]}),iconADD:e.jsx(N,{icon:Pe}),floatAction:[e.jsx(Be,{type:"primary",onClick:()=>o(!0),icon:e.jsx(N,{icon:Ie})})],openModalProduct:(E,_)=>{r("product"),c(E),_&&g(_)}})}),e.jsx(Gs,{isCategoryModalVisible:a,setIsCategoryModalVisible:o}),e.jsx(Ds,{})]})}const $e="https://menu-server-c2b952e2c698.herokuapp.com/api",Zs=t=>M.post(`${$e}/suppliers`,t),en=t=>{const n=encodeURIComponent(t._id);return M.put(`${$e}/suppliers/${n}`,t)},tn=t=>M.delete(`${$e}/suppliers/${t}`),sn=()=>M.get(`${$e}/suppliers`),It=C.createContext(),nn=()=>C.useContext(It),rn=({children:t})=>{const[n,s]=C.useState(!1),i=async c=>{s(!0);try{await Zs(c),k.success("הספק נוסף בהצלחה"),s(!1)}catch(h){console.error("Error adding supplier:",h),k.error("שגיאה בהוספת הספק"),s(!1)}},r=async c=>{s(!0);try{await en(c),k.success("הספק עודכן בהצלחה"),s(!1)}catch(h){console.error("Error updating supplier:",h),k.error("שגיאה בעדכון הספק"),s(!1)}},x=async c=>{s(!0);try{await tn(c),k.success("הספק נמחק בהצלחה"),s(!1)}catch(h){console.error("Error deleting supplier:",h),k.error("שגיאה במחיקת הספק"),s(!1)}};return e.jsx(It.Provider,{value:{addSupplier:i,updateSupplier:r,deleteSupplier:x,loading:n},children:t})};function an(){const{addSupplier:t,updateSupplier:n,deleteSupplier:s}=nn(),i=V(u=>u.suppliers),r=V(u=>u.ingredients),[x,c]=C.useState([]),[h,g]=C.useState([]),w=["name"],v=["name","phone","email","contect_name","address",,"second_phone","notes"],S=[{key:"name",dataIndex:"name",title:"שם",required:!0},{key:"usedCount",dataIndex:"usedCount",title:"כמות רכיבים"}],f=[{key:"name",dataIndex:"name",title:"שם הספק",editable:!0,type:"text",width:100,rules:[{required:!0,message:"חייב להיות שם ספק"},{min:3,message:"שם ספק חייב להיות לפחות 3 תווים"}]},{key:"usedCount",dataIndex:"usedCount",title:"כמות רכיבים",editable:!1},{key:"phone",dataIndex:"phone",title:"טלפון",editable:!0,type:"text",width:100,rules:[{required:!0,message:"חייב להיות מספר טלפון"},{pattern:/^[0-9]{9,10}$/,message:"טלפון חייב להיות מספר תקין באורך 9-10 ספרות"}]},{key:"email",dataIndex:"email",title:"אימייל",editable:!0,type:"text",width:100,rules:[{required:!0,message:"חייב להיות אימייל"},{type:"email",message:"אימייל לא תקין"}]},{key:"contect_name",dataIndex:"contect_name",title:"איש קשר",editable:!0,type:"text",width:100,rules:[{required:!0,message:"חייב להיות איש קשר"},{min:3,message:"איש קשר חייב להיות לפחות 3 תווים"}]},{key:"address",dataIndex:"address",title:"כתובת",editable:!0,type:"text",width:150,rules:[{required:!0,message:"חייבת להיות כתובת"},{min:5,message:"כתובת חייבת להיות לפחות 5 תווים"}]},{key:"second_phone",dataIndex:"second_phone",title:"טלפון נוסף",editable:!0,type:"text",width:100,rules:[{pattern:/^[0-9]{9,10}$/,message:"טלפון חייב להיות מספר תקין באורך 9-10 ספרות"}]},{key:"notes",dataIndex:"notes",title:"הערות",editable:!0,type:"textArea",maxLength:120,width:150,rules:[{required:!1},{max:120,message:"מקסימום 120 תווים"}],render:(u,p)=>{const m=(p==null?void 0:p.notes)||"—";return e.jsx(ke,{title:m,children:e.jsx("span",{style:{display:"inline-block",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",maxWidth:"150px"},children:m})})}}];return C.useEffect(()=>{if(i){const u=i.map(p=>{const m=r==null?void 0:r.filter(a=>a.supplierId===p._id).length;return{...p,usedCount:m}});c(u),g(u)}},[i,r]),e.jsx(Ee,{data:x,mobileKeys:v,dataPrint:h,sortKeys:S,tableKeys:f,newTitle:"הוסף ספק חדש",searchKeys:w,setDataPrint:g,onAdd:t,onEdit:n,onDelete:s,Dtitle:"אישור מחיקה",iconADD:e.jsx(N,{icon:Xe}),Dcontent:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"האם אתה בטוח שברצונך למחוק את הספק?"}),e.jsx("p",{children:"שים לב! במחיקת ספק אתה תמחוק את כל הרכיבים שלו וכן הם כמובן ימחקו מכל התערובות והמוצרים."})]})})}const Ne="https://menu-server-c2b952e2c698.herokuapp.com/api",ln=t=>M.post(`${Ne}/ingredients`,t),on=t=>{const n=encodeURIComponent(t._id);return M.put(`${Ne}/ingredients/${n}`,t)},dn=t=>M.delete(`${Ne}/ingredients/${t}`),cn=()=>M.get(`${Ne}/ingredients`),Pt=C.createContext(),un=()=>C.useContext(Pt),xn=({children:t})=>{const[n,s]=C.useState(!1),i=async c=>{s(!0);try{await ln(c),k.success("החומר גלם נוסף בהצלחה"),s(!1)}catch{k.error("שגיאה בהוספת חומר הגלם"),s(!1)}},r=async c=>{s(!0);try{await on(c),k.success("החומר גלם עודכן בהצלחה"),s(!1)}catch{k.error("שגיאה בעדכון חומר הגלם"),s(!1)}},x=async c=>{s(!0);try{await dn(c),k.success("החומר גלם נמחק בהצלחה"),s(!1)}catch{k.error("שגיאה במחיקת חומר הגלם"),s(!1)}};return e.jsx(Pt.Provider,{value:{addIngredient:i,updateIngredient:r,deleteIngredient:x,loading:n},children:t})},me=[{color:"magenta",value:"פירות טריים"},{color:"aquamarine",value:"פירות קפואים"},{color:"orange",value:"תמציות, ממרחים ותוספות"},{color:"gold",value:"אבקות"},{color:"lime",value:"גלידות וסורבה"},{color:"green",value:"מאפים ועוגיות"},{color:"cyan",value:"אריזות וחד פעמי"},{color:"blue",value:"מוצרי חלב"},{color:"purple",value:"חומרי ניקוי"},{color:"teal",value:"נוזלים"}],ce=[{value:"weight",label:"משקל",display:t=>t>=1?'ק"ג':"גרם"},{value:"volume",label:"נפח",display:t=>t>=1?"ליטר":'מ"ל'},{value:"units",label:"יחידות",display:()=>"יחידות"}],{Text:pn}=q;function mn(){const t=V(m=>m.suppliers),n=V(m=>m.ingredients),s=V(m=>m.products),i=V(m=>m.mixes),{addIngredient:r,updateIngredient:x,deleteIngredient:c}=un(),[h,g]=C.useState([]),[w,v]=C.useState([]);C.useState(!1);const S=["name","type","supplierId"],f=["unit","unitPrice","supplierId","usedInMixes","usedInProducts"],u=[{key:"name",dataIndex:"name",title:"שם",required:!0},{key:"type",dataIndex:"type",title:"סוג"},{key:"usedCount",dataIndex:"usedCount",title:"בשימוש"},{key:"unit",dataIndex:"unit",title:"יחידת מידה"},{key:"supplierName",dataIndex:"supplierName",title:"שם ספק"}],p=[{key:"SKU",dataIndex:"SKU",title:'מק"ט',editable:!0,type:"number",width:100,group:1,rules:[{validator:async(m,a,o)=>a?typeof a!="number"?Promise.reject('מק"ט חייב להיות מספר תקין'):a.toString().length<6?Promise.reject('מק"ט חייב להיות מינימום 6 ספרות'):h.some(d=>d.SKU===a&&d._id!==(o==null?void 0:o._id))?Promise.reject('מק"ט זה כבר קיים במערכת'):Promise.resolve():Promise.resolve()}]},{key:"name",dataIndex:"name",title:"שם",required:!0,editable:!0,group:1,type:"text",width:200,minWidth:200,rules:[{required:!0,message:"השדה חובה"},{min:3,message:"השם חייב להיות לפחות 3 תווים"},{pattern:/^[א-תa-zA-Z\s0-9%-]+$/,message:"השם יכול להכיל אותיות בעברית או אנגלית, מספרים והתווים הבאים: ' % ', ' - '"}]},{key:"supplierId",dataIndex:"supplierId",title:"שם ספק",editable:!0,group:1,type:"select",required:!0,width:100,render:(m,a)=>{var o;return e.jsx("p",{children:(o=t==null?void 0:t.find(y=>(y==null?void 0:y._id)===(a==null?void 0:a.supplierId)))==null?void 0:o.name})},options:t==null?void 0:t.map(m=>({value:m._id,label:m==null?void 0:m.name})),rules:[{required:!0,message:"יש לבחור ספק"},{validator:(m,a)=>(t==null?void 0:t.some(y=>y._id===a))?Promise.resolve():Promise.reject("ספק לא חוקי נבחר")}]},{key:"usedCount",dataIndex:"usedCount",title:"בשימוש",editable:!1,width:100},{key:"is_active",dataIndex:"is_active",title:"פעיל",editable:!0,group:1,type:"custom",render:(m,a,o,y)=>o==="edit"?e.jsx(e.Fragment,{children:e.jsx(F.Item,{name:"is_active",label:"פעיל",children:e.jsx(We,{checkedChildren:"פעיל",unCheckedChildren:"לא פעיל"})},"is_active")}):e.jsx(mt,{status:a!=null&&a.is_active?"success":"error",text:a!=null&&a.is_active?"פעיל":"לא פעיל"}),minWidth:120,width:120},{key:"type",dataIndex:"type",title:"סוג",render:(m,a)=>{var o;return e.jsx(ae,{color:(o=me==null?void 0:me.find(y=>y.value===(a==null?void 0:a.type)))==null?void 0:o.color,children:a==null?void 0:a.type})},type:"select",required:!0,editable:!0,group:2,options:me.map(m=>({value:m.value,label:m.value,color:m==null?void 0:m.color})),divider:!0,width:100,rules:[{required:!0,message:"יש לבחור סוג"},{validator:(m,a)=>(me==null?void 0:me.some(y=>y.value===a))?Promise.resolve():Promise.reject("סוג לא חוקי נבחר")}]},{key:"unit",dataIndex:"unit",title:"יחידת מידה",editable:!0,group:2,type:"select",options:ce,width:100,render:(m,a)=>{var o;return e.jsx("p",{children:((o=ce.find(y=>y.value===(a==null?void 0:a.unit)))==null?void 0:o.label)||(a==null?void 0:a.unit)})},rules:[{required:!0,message:"יש לבחור יחידת מידה"},{validator:(m,a)=>(ce==null?void 0:ce.some(y=>y.value===a))?Promise.resolve():Promise.reject("יחידת מידה לא חוקית")}]},{key:"quantity",dataIndex:"quantity",title:"כמות",editable:!0,group:2,type:"custom",width:100,render:(m,a,o,y)=>{if(o=="edit")return e.jsx(F.Item,{name:"quantity",label:"כמות",rules:[{required:!0,message:"אנא הזן כמות"},{validator:(j,b)=>(y.getFieldValue("subUnit"),b==null?Promise.reject("כמות נדרשת"):b<0?Promise.reject("הכמות לא יכולה להיות שלילית"):(y.getFieldValue("subUnit")==="g"||y.getFieldValue("subUnit")==="ml")&&(b<.001||b>999)?Promise.reject('עבור גרם או מ"ל הכמות חייבת להיות בין 0.001 ל-999'):(y.getFieldValue("subUnit")==="kg"||y.getFieldValue("subUnit")==="liter")&&(b<1||b>1e6)?Promise.reject('עבור ק"ג או ליטר הכמות חייבת להיות מ-1 ומעלה, ובתוך הטווח המותר'):Promise.resolve())}],children:e.jsx(K,{style:{width:"100%"}})},"quantity");let d=a.unit,l="";return d==="weight"?l=a.quantity>=1?'ק"ג':"גרם":d==="volume"?l=a.quantity>=1?"ליטר":'מ"ל':d==="units"&&(l="יחידות"),e.jsxs("p",{children:[a.quantity<1?a.quantity*1e3:a.quantity," ",l]})}},{key:"price",dataIndex:"price",title:"מחיר כולל מעמ",editable:!0,group:2,type:"price",width:100,show:!1,divider:!0,render:(m,a,o,y)=>{if(o!=="edit")return e.jsxs("p",{children:["₪",a==null?void 0:a.price]})}},{key:"priceExcludingVAT",dataIndex:"priceExcludingVAT",width:100,title:"מחיר ללא מעמ",render:(m,a)=>e.jsxs("p",{children:["₪",a==null?void 0:a.priceExcludingVAT]}),editable:!1,hiddenInForm:!0},{key:"unitPrice",dataIndex:"unitPrice",title:"כמות מינימלית",width:100,render:(m,a)=>e.jsxs(H,{children:[e.jsxs($,{children:[e.jsxs("p",{children:[a.unitQuantity<1?a.unitQuantity*1e3:a.unitQuantity," ",a==null?void 0:a.unitDescription]}),e.jsx("br",{})]}),e.jsxs("p",{children:["₪",a==null?void 0:a.unitPrice]})]})},{key:"juiceRatio",dataIndex:"juiceRatio",title:"יחס עיבוד (תפוקת חומר מעובד)",editable:!0,group:2,width:100,type:"custom",render:(m,a,o,y)=>o=="view"||o!=="edit"?e.jsx("p",{children:a!=null&&a.juiceRatio?`${((a==null?void 0:a.juiceRatio)*100).toFixed(0)}%`:""}):e.jsxs(e.Fragment,{children:[e.jsx(F.Item,{name:"isJuice",valuePropName:"checked",style:{marginBottom:0},children:e.jsx(be,{onChange:d=>{y.setFieldsValue({isJuice:d.target.checked}),d.target.checked||y.setFieldsValue({juiceRatio:void 0})},children:"האם הרכיב דורש עיבוד?"})}),e.jsx(F.Item,{noStyle:!0,shouldUpdate:(d,l)=>d.isJuice!==l.isJuice,children:({getFieldValue:d})=>d("isJuice")&&e.jsx(F.Item,{name:"juiceRatio",label:"יחס המיץ (0.1 עד 0.99)",rules:[{required:!0,message:"אנא הזן יחס מיץ"},{type:"number",min:.1,max:.99,message:"היחס חייב להיות בין 0.1 ל-0.99"}],children:e.jsx(K,{style:{width:"100%"}})})})]})},{key:"processedPrice",dataIndex:"processedPrice",title:"מחיר לכמות מינימלית מעובדת",width:100,render:(m,a)=>e.jsx("p",{children:a!=null&&a.processedPrice?`₪${a==null?void 0:a.processedPrice}`:""}),editable:!1,hiddenInForm:!0},{key:"notes",dataIndex:"notes",title:"הערות",width:100,editable:!0,group:1,render:(m,a)=>{const o=(a==null?void 0:a.notes)||"—";return e.jsx(ke,{title:o,children:e.jsx(pn,{style:{display:"inline-block",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",maxWidth:"150px",direction:"rtl"},children:o})})},type:"textArea",maxLength:120,rules:[{required:!1},{max:120,message:"מקסימום 120 תווים"}]}];return C.useEffect(()=>{if(n)if(t){let m=[...n==null?void 0:n.map(a=>{let o=t==null?void 0:t.find(l=>(l==null?void 0:l._id)===(a==null?void 0:a.supplierId));const y=(s==null?void 0:s.reduce((l,j)=>{var b;return l+((b=j.ingredients)==null?void 0:b.filter(I=>I.ingredientId===a._id).length)},0))||0,d=(i==null?void 0:i.reduce((l,j)=>{var b;return l+((b=j.ingredients)==null?void 0:b.filter(I=>I.ingredientId===a._id).length)},0))||0;return{...a,supplierName:o==null?void 0:o.name,usedCount:y+d}})];g(m),v(m)}else g([...n]),v([...n])},[t,n]),e.jsx(e.Fragment,{children:e.jsx(Ee,{data:h,groups:!0,mobileKeys:f,dataPrint:w,sortKeys:u,tableKeys:p,newTitle:"הוסף חומר גלם חדש",searchKeys:S,setDataPrint:v,onAdd:r,onEdit:x,onDelete:c,Dtitle:"אישור מחיקה",iconADD:e.jsx(N,{icon:_e}),Dcontent:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"האם אתה בטוח שברצונך למחוק את הרכיב?"}),e.jsx("p",{children:"שים לב! הרכיב יימחק מכל המוצרים והתערובות בהם הוא נמצא."})]})})})}ds.register(cs,us,xs,ps,ms,hs);const{Text:hn}=q,gn=["#4E79A7","#F28E2B","#E15759","#76B7B2","#59A14F"];function yn(){const t=V(u=>u.categories),n=V(u=>u.products),s=V(u=>u.suppliers),i=V(u=>u.ingredients),r=V(u=>u.mixes),x=V(u=>u.employees),c=he({query:"(max-width: 500px)"}),h=C.useMemo(()=>{const u=n.reduce((p,m)=>{var o;const a=((o=t.find(y=>y._id===m.category))==null?void 0:o.name)||"לא מוגדר";return p[a]=(p[a]||0)+1,p},{});return{labels:Object.keys(u),datasets:[{data:Object.values(u),backgroundColor:gn}]}},[n,t]),g=C.useMemo(()=>[...i].sort((u,p)=>(p.unitPrice||0)-(u.unitPrice||0)).slice(0,5).map(u=>({name:u.name,price:u.unitPrice})),[i]),w=C.useMemo(()=>[...r].map(u=>{const p=u.totalCost/u.totalWeight;return{name:u.name,costPerLiter:p}}).sort((u,p)=>(p.costPerLiter||0)-(u.costPerLiter||0)).slice(0,5),[r]),v={labels:g.map(u=>u.name),datasets:[{label:"מחיר ל-100 גרם",data:g.map(u=>u.price),backgroundColor:"#FF8042"}]},S={labels:w.map(u=>u.name),datasets:[{label:"עלות לליטר",data:w.map(u=>u.costPerLiter),backgroundColor:"#8884d8"}]},f=C.useMemo(()=>n.filter(u=>u.profitMargin<=90).slice(0,3).map(u=>({key:u._id,name:u.name,profitMargin:u.profitMargin})),[n]);return e.jsxs("div",{className:"dashboard-container",style:{padding:c?"10px":"20px"},children:[e.jsxs($,{gutter:[5,5],wrap:!0,children:[e.jsx(H,{xs:12,sm:12,md:10,lg:8,xl:6,children:e.jsx(Z,{to:"/menu",children:e.jsxs(G,{className:"dashboard-card",children:[e.jsx("div",{className:"icon-circle green",children:e.jsx(N,{icon:Pe})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-title",children:"מוצרים"}),e.jsx("div",{className:"stat-value",children:n.length})]})]})})}),e.jsx(H,{xs:12,sm:12,md:10,lg:8,xl:6,children:e.jsx(Z,{to:"/suppliers",children:e.jsxs(G,{className:"dashboard-card",children:[e.jsx("div",{className:"icon-circle red",children:e.jsx(N,{icon:Xe})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-title",children:"ספקים"}),e.jsx("div",{className:"stat-value",children:s.length})]})]})})}),e.jsx(H,{xs:12,sm:12,md:10,lg:8,xl:6,children:e.jsx(Z,{to:"/ingredients",children:e.jsxs(G,{className:"dashboard-card",children:[e.jsx("div",{className:"icon-circle blue",children:e.jsx(N,{icon:_e})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-title",children:"חומרי גלם"}),e.jsx("div",{className:"stat-value",children:i.length})]})]})})}),e.jsx(H,{xs:12,sm:12,md:10,lg:8,xl:6,children:e.jsx(Z,{to:"/menu",children:e.jsxs(G,{className:"dashboard-card",children:[e.jsx("div",{className:"icon-circle yellow",children:e.jsx(N,{icon:Ie})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-title",children:"קטגוריות"}),e.jsx("div",{className:"stat-value",children:t.length})]})]})})}),e.jsx(H,{xs:12,sm:12,md:10,lg:8,xl:6,children:e.jsx(Z,{to:"/mixes",children:e.jsxs(G,{className:"dashboard-card",children:[e.jsx("div",{className:"icon-circle purple",children:e.jsx(N,{icon:He})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-title",children:"תערובות"}),e.jsx("div",{className:"stat-value",children:r.length})]})]})})}),e.jsx(H,{xs:12,sm:12,md:10,lg:8,xl:6,children:e.jsx(Z,{to:"/employees",children:e.jsxs(G,{className:"dashboard-card",children:[e.jsx("div",{className:"icon-circle aqua",children:e.jsx(N,{icon:He})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-title",children:"עובדים"}),e.jsx("div",{className:"stat-value",children:x==null?void 0:x.length})]})]})})})]}),e.jsx(W,{className:"no-margin"}),e.jsxs($,{gutter:[16,16],children:[e.jsx(H,{xs:24,md:12,children:e.jsx(G,{className:"dashboard-card",title:e.jsxs("span",{children:[e.jsx(N,{icon:Ie,style:{marginLeft:"8px"}}),"מוצרים לפי קטגוריה"]}),children:e.jsx(os,{data:h,options:{responsive:!0,maintainAspectRatio:!1}})})}),e.jsx(H,{xs:24,md:12,children:e.jsx(G,{className:"dashboard-card",title:e.jsxs("span",{children:[e.jsx(N,{icon:_e,style:{marginLeft:"8px"}}),"חומרי הגלם היקרים ביותר"]}),children:e.jsx(st,{data:v,options:{responsive:!0,maintainAspectRatio:!1}})})})]}),e.jsx(W,{className:"no-margin"}),e.jsxs($,{gutter:[16,16],children:[e.jsx(H,{xs:24,md:12,children:e.jsx(G,{className:"dashboard-card",title:e.jsxs("span",{children:[e.jsx(N,{icon:He,style:{marginLeft:"8px"}}),"התערובות היקרות ביותר"]}),children:e.jsx(st,{data:S,options:{responsive:!0,maintainAspectRatio:!1}})})}),e.jsx(H,{xs:24,md:12,children:e.jsx(G,{className:"dashboard-card",title:e.jsxs("span",{children:[e.jsx(N,{icon:Pe,style:{marginLeft:"8px"}}),"מוצרים עם רווחיות נמוכה"]}),children:e.jsx($,{gutter:[16,16],children:f.map(u=>e.jsx(H,{xs:24,sm:8,children:e.jsxs(G,{children:[e.jsx(Ce,{title:u.name,value:u.profitMargin,suffix:"%",valueStyle:{color:"#cf1322"}}),e.jsx(hn,{type:"secondary",children:"רווחיות"})]})},u.key))})})})]})]})}const Me="https://menu-server-c2b952e2c698.herokuapp.com/api",jn=t=>M.post(`${Me}/mixes`,t),fn=t=>{const n=encodeURIComponent(t._id);return M.put(`${Me}/mixes/${n}`,t)},vn=t=>M.delete(`${Me}/mixes/${t}`),wn=()=>M.get(`${Me}/mixes`),_t=C.createContext(),Sn=()=>C.useContext(_t),Cn=({children:t})=>{const[n,s]=C.useState(!1),i=async c=>{s(!0);try{await jn(c),k.success("התערובת נוספה בהצלחה"),s(!1)}catch(h){console.error("Error adding mix:",h),k.error("שגיאה בהוספת התערובת"),s(!1)}},r=async c=>{s(!0);try{await fn(c),k.success("התערובת עודכנה בהצלחה"),s(!1)}catch(h){console.error("Error updating mix:",h),k.error("שגיאה בעדכון התערובת"),s(!1)}},x=async c=>{s(!0);try{await vn(c),k.success("התערובת נמחקה בהצלחה"),s(!1)}catch(h){console.error("Error deleting mix:",h),k.error("שגיאה במחיקת התערובת"),s(!1)}};return e.jsx(_t.Provider,{value:{addMix:i,updateMix:r,deleteMix:x,loading:n},children:t})};function bn(){var p;const{addMix:t,updateMix:n,deleteMix:s}=Sn(),[i,r]=C.useState([]),[x,c]=C.useState([]),h=V(m=>m.mixes),g=(p=V(m=>m.ingredients))==null?void 0:p.filter(m=>m.is_active);V(m=>m.products);const w=V(m=>m.employeeHours.overallAverageHourlyRate),v=["name","ingredients"],S=["name","preparationTime","totalCost","totalWeight","usedCount"],f=[{key:"name",dataIndex:"name",title:"שם",required:!0},{key:"preparationTime",dataIndex:"preparationTime",title:"זמן הכנה"},{key:"totalCost",dataIndex:"totalCost",title:"עלות כוללת"},{key:"totalWeight",dataIndex:"totalWeight",title:"משקל כולל"},{key:"usedCount",dataIndex:"usedCount",title:"בשימוש"}],u=[{key:"name",dataIndex:"name",title:"שם התערובת",editable:!0,type:"text",minWidth:100,rules:[{required:!0,message:"חייב להיות שם תערובת"},{min:3,message:"שם חייב להיות לפחות 3 תווים"}]},{key:"usedCount",dataIndex:"usedCount",title:"בשימוש",editable:!1,width:100},{key:"preparationTime",dataIndex:"preparationTime",title:"זמן הכנה (דקות)",editable:!0,minWidth:100,type:"number",rules:[{required:!0,message:"זמן הכנה נדרש"},{type:"number",min:0,message:"זמן הכנה חייב להיות מספר חיובי"}]},{key:"totalCost",dataIndex:"totalCost",title:"עלות כוללת (₪)",minWidth:100,render:(m,a)=>(a==null?void 0:a.totalCost)!=null&&(a==null?void 0:a.laborCost)!=null?`₪${(Number(a.totalCost)+Number(a.laborCost)).toFixed(2)}`:"—",editable:!1},{key:"unitCost",dataIndex:"unitCost",title:"עלות ל-100 גרם (₪)",minWidth:100,render:(m,a)=>(a==null?void 0:a.totalWeight)!=null&&(a==null?void 0:a.totalCost)!=null?`₪${((Number(a.totalCost)+Number(a.laborCost||0))/(Number(a.totalWeight)*10)).toFixed(2)} / 100 גרם`:"—",editable:!1},{key:"laborCost",dataIndex:"laborCost",title:"עלות עבודה (₪)",minWidth:100,render:(m,a)=>{var o;return`₪${(o=a==null?void 0:a.laborCost)==null?void 0:o.toFixed(2)} (₪${w})`||"—"},editable:!1},{key:"totalWeight",dataIndex:"totalWeight",title:'משקל כולל (ק"ג)',minWidth:100,render:(m,a)=>{var o;return((o=a.totalWeight)==null?void 0:o.toFixed(2))||"—"},editable:!1},{key:"ingredients",title:"רכיבים",type:"ingredientsManager",editable:!0,width:500,minWidth:500,column:!0,fields:[{key:"ingredientId",type:"select",title:"רכיב",placeholder:"בחר רכיב",options:g.map(m=>({value:m._id,label:m.name})),required:!0,rules:[{required:!0,message:"יש לבחור רכיב"}]},{key:"quantity",type:"number",title:"כמות",placeholder:"הזן כמות",required:!0,rules:[{required:!0,message:"יש להזין כמות"},{type:"number",min:0,message:"כמות חייבת להיות חיובית"}]},{key:"unit",type:"text",title:"יחידה",readonly:!0}],render:(m,a,o,y)=>{let d=[...(a==null?void 0:a.ingredients)||[]].sort((l,j)=>j.quantity-l.quantity);return d=d==null?void 0:d.map(l=>{var j;return{name:l==null?void 0:l.ingredientId.name,quantity:((l==null?void 0:l.rawQuantityForJuice)||l.quantity)<1&&l.unit!=="units"?((l==null?void 0:l.rawQuantityForJuice)||l.quantity)*100:(l==null?void 0:l.rawQuantityForJuice)||l.quantity,unit:(j=ce==null?void 0:ce.find(b=>b.value===l.unit))==null?void 0:j.display((l==null?void 0:l.rawQuantityForJuice)||l.quantity),costForQuantity:l==null?void 0:l.costForQuantity}}),y?e.jsx("ul",{style:{display:"flex",flexDirection:"column",gap:"5px",padding:0,margin:0,listStyleType:"none"},children:d==null?void 0:d.map((l,j)=>e.jsxs("li",{style:{whiteSpace:"normal",display:"flex"},children:[e.jsx(ke,{title:l==null?void 0:l.name,children:e.jsx("span",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",display:"inline-block",maxWidth:"150px"},children:l==null?void 0:l.name})}),` (${l.quantity} ${l.unit}) - ₪${l==null?void 0:l.costForQuantity}`]},j))}):e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"5px"},children:d==null?void 0:d.map((l,j)=>e.jsx("div",{children:`${l==null?void 0:l.name} (${l.quantity} ${l.unit}) - ₪${l==null?void 0:l.costForQuantity}, `},j))})},rules:[{required:!0,message:"יש לבחור לפחות רכיב אחד"}]}];return C.useEffect(()=>{h&&(r(h),c(h))},[h,g,w]),e.jsx(Ee,{data:i,mobileKeys:S,dataPrint:x,sortKeys:f,tableKeys:u,newTitle:"הוסף תערובת חדשה",searchKeys:v,setDataPrint:c,onAdd:t,onEdit:n,onDelete:s,Dtitle:"אישור מחיקה",ingredientsArr:g,iconADD:e.jsx(N,{icon:vt}),Dcontent:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"האם אתה בטוח שברצונך למחוק את התערובת?"}),e.jsx("p",{children:"שים לב! מחיקת תערובת עשויה להשפיע על מוצרים המשתמשים בה."})]})})}const{Text:In}=q,{Option:Se}=X,kt=({addEmployee:t,initialValues:n,onClose:s})=>{const[i]=F.useForm(),r=V(g=>g.employees),[x,c]=C.useState("");C.useEffect(()=>{n&&i.setFieldsValue(n)},[n,i]);const h=g=>{if(r.some(w=>w.name===g.name.trim()&&(!n||w._id!==n._id))){c("קיים כבר עובד בעל שם דומה");return}t({...n,...g}),i.resetFields(),s()};return e.jsx(G,{className:"employee-form-card",children:e.jsxs(F,{form:i,layout:"vertical",onFinish:h,initialValues:n,children:[e.jsx(F.Item,{label:"שם עובד",name:"name",rules:[{required:!0,message:"אנא הזן שם עובד"}],children:e.jsx(z,{})}),e.jsx(F.Item,{label:"תפקיד",name:"position",children:e.jsx(z,{placeholder:"הזן תפקיד"})}),e.jsx(F.Item,{label:"תעריף שעתי",name:"hourlyRate",rules:[{required:!0,message:"אנא הזן תעריף שעתי"}],children:e.jsx(K,{min:0,style:{width:"100%"}})}),e.jsx(F.Item,{label:"סטטוס",name:"status",initialValue:"active",rules:[{required:!0}],children:e.jsxs(X,{children:[e.jsx(Se,{value:"active",children:"פעיל"}),e.jsx(Se,{value:"inactive",children:"לא פעיל"}),e.jsx(Se,{value:"on_leave",children:"בחופשה"}),e.jsx(Se,{value:"terminated",children:"סיים העסקה"})]})}),x&&e.jsx(Bt,{style:{display:"block",marginBottom:"10px"},children:e.jsx(In,{type:"danger",className:"error-message",children:x})}),e.jsxs(F.Item,{children:[e.jsx(T,{type:"primary",htmlType:"submit",className:"employee-form-button",children:n?"עדכן עובד":"הוסף עובד"}),e.jsx(T,{className:"employee-form-button",onClick:s,style:{marginLeft:"8px"},children:"ביטול"})]})]})})},Re="https://menu-server-c2b952e2c698.herokuapp.com/api",Pn=t=>M.post(`${Re}/employees`,t),_n=t=>{const n=encodeURIComponent(t._id);return M.put(`${Re}/employees/${n}`,t)},kn=t=>M.delete(`${Re}/employees/${t}`),Fn=(t,n)=>M.get(`${Re}/employees?`),Ft=C.createContext(),Tt=()=>C.useContext(Ft),Tn=({children:t})=>{const[n,s]=C.useState(!1),i=async c=>{s(!0);try{await Pn(c),k.success("העובד נוסף בהצלחה"),s(!1)}catch(h){console.error("Error adding employee:",h),k.error("שגיאה בהוספת עובד"),s(!1)}},r=async c=>{s(!0);try{await _n(c),k.success("העובד עודכן בהצלחה"),s(!1)}catch(h){console.error("Error updating employee:",h),k.error("שגיאה בעדכון עובד"),s(!1)}},x=async c=>{s(!0);try{await kn(c),k.success("העובד נמחק בהצלחה"),s(!1)}catch(h){console.error("Error deleting employee:",h),k.error("שגיאה במחיקת עובד"),s(!1)}};return e.jsx(Ft.Provider,{value:{addEmployee:i,updateEmployee:r,deleteEmployee:x,loading:n},children:t})},{Text:De}=q,En=({sortKey:t})=>{const{updateEmployee:n,deleteEmployee:s}=Tt(),i=V(S=>S.employees),[r,x]=C.useState(!1),[c,h]=C.useState(null),g=S=>{h(S),x(!0)},w=()=>{h(null),x(!1)},v=[...i].sort((S,f)=>t==="name"?S.name.localeCompare(f.name):0);return e.jsxs(G,{title:"רשימת עובדים",className:"employee-list-card",children:[e.jsx(ie,{itemLayout:"vertical",dataSource:v,renderItem:S=>e.jsx(ie.Item,{className:"employee-item",actions:[e.jsx(T,{type:"link",onClick:()=>g(S),children:"ערוך"}),e.jsx(Ge,{title:"האם אתה בטוח שברצונך למחוק את העובד הנוכחי?",onConfirm:()=>s(S._id),okText:"כן",cancelText:"לא",children:e.jsx(T,{icon:e.jsx(ue,{}),danger:!0})})],children:e.jsx(ie.Item.Meta,{title:e.jsx(De,{strong:!0,children:S.name}),description:e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx(De,{strong:!0,children:"תפקיד:"})," ",S.position||"לא הוגדר"]}),e.jsxs("p",{children:[e.jsx(De,{strong:!0,children:"תעריף שעתי:"})," ",S.hourlyRate," ₪"]}),e.jsx("p",{children:e.jsx(mt,{color:$n(S.status),text:An(S.status),style:{marginLeft:"8px"}})})]})})},S._id)}),e.jsx(te,{title:c?"ערוך עובד":"הוסף עובד חדש",open:r,onCancel:w,footer:null,children:e.jsx(kt,{addEmployee:n,initialValues:c,onClose:w})})]})},An=t=>{switch(t){case"active":return"פעיל";case"inactive":return"לא פעיל";case"on_leave":return"בחופשה";case"terminated":return"סיים העסקה";default:return"לא ידוע"}},$n=t=>{switch(t){case"active":return"green";case"inactive":return"grey";case"on_leave":return"orange";case"terminated":return"red";default:return"blue"}};function Nn(){const{addEmployee:t}=Tt(),[n,s]=C.useState(!1),[i,r]=C.useState(""),x=()=>{s(!0)},c=()=>{s(!1)};return e.jsxs("div",{style:{padding:"20px"},className:"scrollable-content employees-page-container",children:[e.jsxs("div",{className:"employees-controls",children:[e.jsx(T,{type:"primary",onClick:x,className:"add-employee-button",children:"הוסף עובד חדש"}),e.jsxs(X,{value:i,onChange:h=>r(h),className:"sort-select",children:[e.jsx(X.Option,{value:"",children:"מיין"}),e.jsx(X.Option,{value:"name",children:"מיין לפי שם"})]})]}),e.jsx(En,{sortKey:i}),e.jsx(te,{title:"הוסף עובד חדש",open:n,onCancel:c,footer:null,destroyOnClose:!0,children:e.jsx(kt,{addEmployee:t,onClose:c})})]})}const we="https://menu-server-c2b952e2c698.herokuapp.com/api",Mn=(t,n)=>M.post(`${we}/employees/${t}/hours`,n),Rn=(t,n)=>M.put(`${we}/employees/hours/${t}`,n),qn=t=>M.delete(`${we}/employees/hours/${t}`),Ln=t=>M.get(`${we}/employees/${t}/hours`),Hn=(t,n)=>M.get(`${we}/employees/hours/${n}/${t}`),Et=C.createContext(),Vn=()=>C.useContext(Et),Dn=({children:t})=>{const[n,s]=C.useState(!1),i=async(h,g)=>new Promise(async(w,v)=>{var S;s(!0);try{const f=await Mn(h,g);if((f==null?void 0:f.status)===200){k.error((S=f.data)==null?void 0:S.message),v(!1);return}k.success("שעות העבודה נוספו בהצלחה"),w(!0)}catch(f){console.error("Error adding employee hours:",f),k.error("שגיאה בהוספת שעות עבודה"),v(!1)}finally{s(!1)}}),r=async(h,g)=>new Promise(async(w,v)=>{s(!0);try{(await Rn(h,g)).status!==201?v(!1):(k.success("שעות העבודה עודכנו בהצלחה"),w(!0))}catch(S){console.error("Error updating employee hours:",S),k.error("שגיאה בעדכון שעות עבודה"),v(!1)}finally{s(!1)}}),x=async h=>{s(!0);try{const g=await Ln(h);return k.success("שעות העבודה נשלפו בהצלחה"),g.data}catch(g){console.error("Error fetching employee hours:",g),k.error("שגיאה בשליפת שעות עבודה")}finally{s(!1)}},c=async h=>{s(!0);try{await qn(h),k.success("שעות העבודה נמחקו בהצלחה")}catch(g){console.error("Error deleting employee hours:",g),k.error("שגיאה במחיקת שעות עבודה")}finally{s(!1)}};return e.jsx(Et.Provider,{value:{loading:n,addEmployeeHours:i,updateEmployeeHours:r,deleteEmployeeHours:c,fetchEmployeeHours:x},children:t})},{Option:On}=X,Un=({visible:t,onClose:n,dayData:s})=>{const{addEmployeeHours:i,updateEmployeeHours:r,deleteEmployeeHours:x}=Vn(),c=V(d=>d.employees),[h,g]=C.useState(),[w,v]=C.useState(),[S,f]=C.useState(!1),[u]=F.useForm();if(!s)return null;const p=()=>{const d=S?r:i,l=S?w:h;d(S?l==null?void 0:l.hoursId:l.employeeId,l).then(()=>{g(),f(!1),u.resetFields()}).catch(()=>{})},m=d=>{v({...d,employeeId:d.employeeId,startTime:d.hours.start,endTime:d.hours.end,date:s.date}),f(!0)},a=()=>{g(null),f(!1)},o=d=>{x(d)},y=c==null?void 0:c.filter(d=>!s.employees.some(l=>l.employeeId===d._id));return e.jsxs(te,{title:`ניהול שעות עבודה ליום ${s.date}`,open:t,onCancel:n,footer:null,width:800,style:{top:"1em"},destroyOnClose:!0,children:[e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("h3",{style:{fontWeight:"600",color:"#333"},children:"סיכום יום"}),e.jsxs("p",{children:["תאריך: ",s.date]}),e.jsxs("p",{children:["יום בשבוע: ",s.dayOfWeek]}),e.jsx(ae,{color:(s==null?void 0:s.status)==="חצי יום"?"orange":"green",children:s==null?void 0:s.status})]}),e.jsx(W,{}),e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("h3",{style:{fontWeight:"600",color:"#333"},children:S?"עריכת עובד":"הוספת עובד חדש"}),e.jsx(F,{form:u,layout:"vertical",onFinish:p,children:e.jsx(F.Item,{label:"בחר עובד",style:{maxWidth:"400px"},children:e.jsx(X,{showSearch:!0,placeholder:"חיפוש והוספת עובד",optionFilterProp:"children",value:(h==null?void 0:h.employeeId)||null,onChange:d=>{const l=y.find(j=>j._id===d);g({name:l==null?void 0:l.name,startTime:"",endTime:"",date:s==null?void 0:s.date,employeeId:l._id})},filterOption:(d,l)=>l.children.toLowerCase().includes(d.toLowerCase()),children:y==null?void 0:y.map(d=>e.jsx(On,{value:d._id,children:d.name},d._id))})})})]}),e.jsx(W,{}),h&&e.jsxs(F,{layout:"inline",onFinish:p,initialValues:{startTime:h==null?void 0:h.startTime,endTime:h==null?void 0:h.endTime},children:[e.jsx(F.Item,{label:"שעת כניסה",children:e.jsx(z,{placeholder:"HH:mm",value:h==null?void 0:h.startTime,onChange:d=>g(l=>({...l,startTime:d.target.value}))})}),e.jsx(F.Item,{label:"שעת יציאה",children:e.jsx(z,{placeholder:"HH:mm",value:h==null?void 0:h.endTime,onChange:d=>g(l=>({...l,endTime:d.target.value}))})}),!(h!=null&&h._id)&&e.jsx(T,{type:"primary",onClick:p,children:"שמור שעות עבודה"})]}),e.jsx(W,{}),e.jsxs("div",{style:{marginTop:"20px"},children:[e.jsx("h3",{style:{fontWeight:"600",color:"#333"},children:"עובדים שנוספו"}),e.jsx(ie,{bordered:!0,className:"scroll-content",style:{maxHeight:"25em",overflow:"auto"},dataSource:s==null?void 0:s.employees,renderItem:d=>{var l,j,b;return e.jsx(ie.Item,{children:e.jsxs("div",{style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("h2",{style:{fontWeight:"500",width:"6em"},children:d.name}),S&&d.employeeId===(w==null?void 0:w.employeeId)?e.jsxs(e.Fragment,{children:[e.jsx(z,{placeholder:"שעת כניסה",value:w==null?void 0:w.startTime,onChange:I=>v(P=>({...P,startTime:I.target.value})),style:{width:"100px",marginRight:"10px"}}),e.jsx(z,{placeholder:"שעת יציאה",value:w==null?void 0:w.endTime,onChange:I=>v(P=>({...P,endTime:I.target.value})),style:{width:"100px",marginRight:"10px"}}),e.jsxs($,{style:{gap:"0.5em"},children:[e.jsx(T,{type:"primary",icon:e.jsx(ls,{}),onClick:p}),e.jsx(T,{icon:e.jsx(ve,{}),onClick:a,style:{marginLeft:"5px"}})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ce,{title:"כניסה",value:(l=d==null?void 0:d.hours)==null?void 0:l.start}),e.jsx(Ce,{title:"יציאה",value:(j=d==null?void 0:d.hours)==null?void 0:j.end}),e.jsx(Ce,{title:"סך שעות",value:(b=d==null?void 0:d.hoursWorked)==null?void 0:b.toFixed(2)}),e.jsxs($,{style:{gap:"0.5em"},children:[e.jsx(T,{icon:e.jsx(Ke,{}),onClick:()=>m(d)}),e.jsx(Ge,{title:"האם אתה בטוח שברצונך למחוק את העובד?",onConfirm:()=>o(d.hoursId),okText:"כן",cancelText:"לא",children:e.jsx(T,{icon:e.jsx(ue,{}),danger:!0})})]})]})]})})}})]})]})},Wn=({monthData:t})=>{const[n,s]=C.useState(!1),[i,r]=C.useState(null),x=g=>{r(g),s(!0)},c=[{title:"תאריך",dataIndex:"date",key:"date"},{title:"יום בשבוע",dataIndex:"dayOfWeek",key:"dayOfWeek"},{title:"סטטוס",dataIndex:"status",key:"status",render:g=>e.jsx(ae,{color:g==="חצי יום"?"orange":"green",children:g})},{title:"מספר עובדים",dataIndex:"employeesCount",key:"employeesCount",render:g=>g??"לא ידוע"},{title:"סך הכל שעות",dataIndex:"totalHours",key:"totalHours",render:g=>(g==null?void 0:g.toFixed(2))??"לא ידוע"}],h=g=>{let w="";return g!=null&&g.hasError&&(w+="workhours-error "),g.isToday?w+="today-row":g.isPast&&(w+="past-row"),w};return e.jsxs(e.Fragment,{children:[e.jsx(pt,{columns:c,dataSource:t,rowKey:"date",pagination:!1,rowClassName:h,onRow:(g,w)=>({onClick:()=>(g.isToday||g.isPast)&&x(w)})}),e.jsx(Un,{visible:n,onClose:()=>s(!1),dayData:t[i]})]})};re.locale("he");const Bn=Ze("employeeHours/buildMonthData",async({selectedDate:t,employees:n,employeeHours:s},{dispatch:i})=>{const r=re(t,"YYYY-MM").daysInMonth(),x=Array.from({length:r},(c,h)=>{const g=re(t,"YYYY-MM").date(h+1),w=g.format("dddd"),v=w==="שישי"||w==="שבת",S=n.map(p=>{const m=s.find(o=>{var y;return((y=o==null?void 0:o.employeeId)==null?void 0:y._id)===(p==null?void 0:p._id)&&re(o==null?void 0:o.date).isSame(g,"day")});if(!m)return null;const a=!m.startTime||!m.endTime;return{hoursId:m._id,employeeId:p._id,name:p.name,hourlyRate:p.hourlyRate,hoursWorked:m.hoursWorked,hours:{start:m.startTime,end:m.endTime},hasError:a}}).filter(Boolean),f=S.reduce((p,m)=>p+m.hoursWorked,0),u=S.length;return{date:g.format("YYYY-MM-DD"),dayOfWeek:w,status:v&&w==="שישי"?"חצי יום":"יום מלא",isPast:g.isBefore(re(),"day"),isToday:g.isSame(re(),"day"),employees:S,totalHours:f,employeesCount:u}});i(Yn(x))}),At=le({name:"employeeHours",initialState:{data:[],selectedDate:re().startOf("month").format("YYYY-MM"),overallAverageHourlyRate:34.39},reducers:{setEmployeeHoursState:(t,n)=>{t.data=n.payload},setSelectedDate:(t,n)=>{t.selectedDate=n.payload},setOverallAverageHourlyRate:(t,n)=>{t.overallAverageHourlyRate=n.payload},addOrUpdateEmployeeHoursState:(t,n)=>{const s=n.payload,i=t.data.findIndex(r=>r._id===s._id);i!==-1?t.data[i]=s:t.data.unshift(s)},updateEmployeeHoursState:(t,n)=>{const s=n.payload;t.data=t.data.map(i=>i._id===s._id?s:i)},deleteEmployeeHoursState:(t,n)=>{const s=n.payload._id;t.data=t.data.filter(i=>i._id!==s)}}}),{setEmployeeHoursState:Yn,addOrUpdateEmployeeHoursState:Qn,updateEmployeeHoursState:zn,deleteEmployeeHoursState:Jn,setSelectedDate:Gn,setOverallAverageHourlyRate:ma}=At.actions,Xn=t=>t.employeeHours.overallAverageHourlyRate,Kn=At.reducer,{MonthPicker:Zn}=Yt;re.locale("he");const er=()=>{const t=Je(),n=V(r=>r.employeeHours.data),s=V(r=>r.employeeHours.selectedDate),i=r=>{t(Gn(r.format("YYYY-MM")))};return e.jsxs("div",{className:"workhours-container",children:[e.jsx("h1",{children:"ניהול שעות עבודה חודשיות"}),e.jsx(Zn,{onChange:i,placeholder:"בחר חודש ושנה",disabledDate:r=>r&&r>re().endOf("month")},s),e.jsx(Wn,{monthData:n})," "]})},$t=le({name:"suppliers",initialState:[],reducers:{addSuppliersState:(t,n)=>n.payload,addOrUpdateSupplierState:(t,n)=>{const s=n.payload,i=t.findIndex(r=>r._id===s._id);i!==-1?t[i]=s:t.unshift(s)},updateSupplierState:(t,n)=>{const s=n.payload;return t.map(i=>i._id===s._id?s:i)},deleteSupplierState:(t,n)=>{const s=n.payload._id;return t.filter(i=>i._id!==s)}}}),{addSuppliersState:tr,addOrUpdateSupplierState:sr,updateSupplierState:nr,deleteSupplierState:rr}=$t.actions,ir=$t.reducer;function Oe(t){let n,s,i,r;const x=t.price/1.17;return t.unit==='ק"ג'||t.unit==="weight"?(n=.1,s="גרם",i=x/t.quantity*n):t.unit==="ליטר"||t.unit==="volume"?(n=.1,s='מ"ל',i=x/t.quantity*n):(t.unit==="יחידות"||t.unit==="units")&&(n=1,s="יחידה",i=x/t.quantity),t.isJuice&&(r=i/(t.juiceRatio||1)),{...t,priceExcludingVAT:x.toFixed(2),unitQuantity:n,unitDescription:s,unitPrice:i.toFixed(2),processedPrice:r?r.toFixed(2):null}}const Nt=le({name:"ingredients",initialState:[],reducers:{addIngerdientsState:(t,n)=>n.payload.map(Oe),addOrUpdateIngredientState:(t,n)=>{const s=Oe(n.payload),i=t.findIndex(r=>r._id===s._id);i!==-1?t[i]=s:t.unshift(s)},updateIngredientState:(t,n)=>{const s=Oe(n.payload);return t.map(i=>i._id===s._id?s:i)},deleteIngredientState:(t,n)=>{const s=n.payload._id;return t.filter(i=>i._id!==s)}}}),{addIngerdientsState:ar,addOrUpdateIngredientState:lr,updateIngredientState:or,deleteIngredientState:dr}=Nt.actions,cr=Nt.reducer,Mt=1.17,ur=Ze("products/updateWithRate",async(t,{getState:n})=>{const s=n(),i=Xn(s);return s.products.map(c=>({...c,sizes:c.sizes.map(h=>{const g=h.ingredients.reduce((a,o)=>a+parseFloat(o.processedCost||o.actualCost||0),0),w=h.mixes.reduce((a,o)=>a+parseFloat(o.actualCost||0),0),v=g+w,S=i/60*h.preparationTime,f=h.price/Mt,u=v+S,p=f-u,m=f>0?(p/f*100).toFixed(2):"0.00";return{...h,totalRawCost:v.toFixed(2),laborCost:S.toFixed(2),profitMargin:m}})}))});function dt(t,n,s,i){return t.map(r=>({...r,sizes:r.sizes.map(x=>{const c=x.ingredients.map(a=>{const o=n.find(j=>j._id===a.ingredientId);if(!o)return a;const d=a.quantity/o.unitQuantity*o.unitPrice,l=o.isJuice?a.quantity/o.unitQuantity*o.processedPrice:null;return{...a,actualCost:d.toFixed(2),processedCost:l?l.toFixed(2):null}}),h=x.mixes.map(a=>{const o=s.find(l=>l._id===a.mixId);if(!o)return a;const y=a.quantity/o.totalWeight,d=y*o.totalCost;return{...a,actualCost:d.toFixed(2),realQuantity:y.toFixed(2)}}),g=c.reduce((a,o)=>a+parseFloat(o.processedCost||o.actualCost||0),0),w=h.reduce((a,o)=>a+parseFloat(o.actualCost||0),0),v=g+w,S=x.price/Mt,f=i/60*x.preparationTime,u=v+f,p=S-u,m=S>0?(p/S*100).toFixed(2):"0.00";return{...x,ingredients:c,mixes:h,totalRawCost:v.toFixed(2),laborCost:f.toFixed(2),profitMargin:m}})}))}const Rt=le({name:"products",initialState:[],reducers:{setProductsState:(t,n)=>{const{products:s,ingredientsState:i,mixesState:r,averageHourlyRate:x}=n.payload;return s},addOrUpdateProductState:(t,n)=>{const{newProduct:s,ingredientsState:i,mixesState:r,averageHourlyRate:x}=n.payload,c=dt([s],i,r,x)[0],h=t.findIndex(g=>g._id===s._id);h!==-1?t[h]=c:t.unshift(c)},updateProductState:(t,n)=>{const{updatedProduct:s,ingredientsState:i,mixesState:r,averageHourlyRate:x}=n.payload,c=dt([s],i,r,x)[0];return t.map(h=>h._id===s._id?c:h)},deleteProductState:(t,n)=>{const s=n.payload._id;return t.filter(i=>i._id!==s)}},extraReducers:t=>{t.addCase(ur.fulfilled,(n,s)=>s.payload)}}),{setProductsState:xr,addOrUpdateProductState:ct,updateProductState:ha,deleteProductState:pr}=Rt.actions,mr=Rt.reducer,qt=le({name:"mixes",initialState:[],reducers:{setMixesState:(t,n)=>{const{mixes:s,ingredientsState:i}=n.payload;return s},addOrUpdateMixState:(t,n)=>{const{newMix:s,ingredientsState:i}=n.payload,r=s,x=t.findIndex(c=>c._id===s._id);x!==-1?t[x]=r:t.push(r)},updateMixState:(t,n)=>{const{updatedMix:s,ingredientsState:i}=n.payload,r=s,x=t.findIndex(c=>c._id===s._id);x!==-1&&(t[x]=r)},deleteMixState:(t,n)=>t.filter(s=>s._id!==n.payload._id)}}),{setMixesState:hr,addOrUpdateMixState:gr,updateMixState:yr,deleteMixState:jr}=qt.actions,fr=qt.reducer,Lt=le({name:"categories",initialState:[],reducers:{setCategories:(t,n)=>n.payload,addOrUpdateCategory:(t,n)=>{const s=n.payload,i=t.findIndex(r=>r._id===s._id);i!==-1?t[i]=s:t.unshift(s)},updateCategory:(t,n)=>{const s=n.payload,i=t.findIndex(r=>r._id===s._id);i!==-1&&(t[i]=s)},deleteCategory:(t,n)=>{const s=n.payload;return t.filter(i=>i._id!==s)}}}),{setCategories:vr,addOrUpdateCategory:wr,updateCategory:Sr,deleteCategory:Cr}=Lt.actions,br=Lt.reducer,Ht=le({name:"employees",initialState:[],reducers:{setEmployees:(t,n)=>n.payload,addOrUpdateEmployee:(t,n)=>{const s=n.payload,i=t.findIndex(r=>r._id===s._id);i!==-1?t[i]=s:t.push(s)},updateEmployee:(t,n)=>{const s=n.payload,i=t.findIndex(r=>r._id===s._id);i!==-1&&(t[i]=s)},deleteEmployee:(t,n)=>t.filter(s=>s._id!==n.payload)}}),{setEmployees:Ir,addOrUpdateEmployee:Pr,updateEmployee:_r,deleteEmployee:kr}=Ht.actions,Fr=Ht.reducer,Tr=(t,n)=>{t.on("ingredientAdded",s=>{n(lr(s))}),t.on("ingredientUpdated",s=>{n(or(s))}),t.on("ingredientDeleted",s=>{n(dr(s))}),t.on("supplierAdded",s=>{n(sr(s))}),t.on("supplierUpdated",s=>{n(nr(s))}),t.on("supplierDeleted",s=>{n(rr(s))}),t.on("productAdded",s=>{n((i,r)=>{const x=r().ingredients,c=r().mixes;i(ct({newProduct:s,ingredientsState:x,mixesState:c}))})}),t.on("productUpdated",s=>{n((i,r)=>{const x=r().ingredients,c=r().mixes;i(ct({newProduct:s,ingredientsState:x,mixesState:c}))})}),t.on("productDeleted",s=>{n(pr(s))}),t.on("categoryAdded",s=>{n(wr(s))}),t.on("categoryUpdated",s=>{n(Sr(s))}),t.on("categoryDeleted",s=>{n(Cr(s._id))}),t.on("mixAdded",s=>{n((i,r)=>{const x=r().ingredients;i(gr({newMix:s,ingredientsState:x}))})}),t.on("mixUpdated",s=>{n((i,r)=>{const x=r().ingredients;i(yr({updatedMix:s,ingredientsState:x}))})}),t.on("mixDeleted",s=>{n(jr(s))}),t.on("employeeAdded",s=>{n(Pr(s))}),t.on("employeeUpdated",s=>{n(_r(s))}),t.on("employeeDeleted",s=>{n(kr(s._id))}),t.on("employeeHoursAdded",s=>{n(Qn(s))}),t.on("employeeHoursUpdated",s=>{n(zn(s))}),t.on("employeeHoursDeleted",s=>{n(Jn({_id:s._id}))})},ut="https://menu-server-c2b952e2c698.herokuapp.com/",Er=C.createContext(),Ar=({children:t})=>{const n=Je();return console.log(ut),C.useEffect(()=>{const s=js(ut);return Tr(s,n),()=>s.disconnect()},[n]),e.jsx(Er.Provider,{value:{},children:t})},qe="https://menu-server-c2b952e2c698.herokuapp.com/api",$r=()=>M.get(`${qe}/settings`),Nr=t=>M.post(`${qe}/settings`,t),Mr=t=>{const n=encodeURIComponent(t.key);return M.put(`${qe}/settings/${n}`,t)},Rr=t=>{const n=encodeURIComponent(t);return M.delete(`${qe}/settings/${n}`)},qr=C.createContext(),Lr=({children:t})=>{const[n,s]=C.useState(!1),[i,r]=C.useState([]),x=async()=>{s(!0);try{const{data:w}=await $r();r(w),k.success("ההגדרות נטענו בהצלחה")}catch(w){console.error("Error fetching settings:",w),k.error("שגיאה בטעינת ההגדרות")}finally{s(!1)}},c=async w=>{s(!0);try{await Nr(w),k.success("ההגדרה נוספה בהצלחה"),await x()}catch(v){console.error("Error adding setting:",v),k.error("שגיאה בהוספת ההגדרה")}finally{s(!1)}},h=async w=>{s(!0);try{await Mr(w),k.success("ההגדרה עודכנה בהצלחה"),await x()}catch(v){console.error("Error updating setting:",v),k.error("שגיאה בעדכון ההגדרה")}finally{s(!1)}},g=async w=>{s(!0);try{await Rr(w),k.success("ההגדרה נמחקה בהצלחה"),await x()}catch(v){console.error("Error deleting setting:",v),k.error("שגיאה במחיקת ההגדרה")}finally{s(!1)}};return e.jsx(qr.Provider,{value:{settings:i,loading:n,fetchSettings:x,addSetting:c,updateSetting:h,deleteSetting:g},children:t})};k.config({prefixCls:"my-message"});const Hr=({children:t,setLoading:n})=>{const s=Je(),i=V(x=>x.employeeHours.selectedDate),r=V(x=>x.employeeHours.overallAverageHourlyRate);return C.useEffect(()=>{(async()=>{var g,w;n(!0);const c=nt(i).year(),h=nt(i).month()+1;try{const[v,S,f,u,p,m,a]=await Promise.all([cn(),sn(),bs(),Ys(),wn(),Fn(),Hn(h,c)]);s(ar((g=v==null?void 0:v.data)==null?void 0:g.reverse())),s((o,y)=>{var l;const d=y().ingredients;o(hr({mixes:(l=p==null?void 0:p.data)==null?void 0:l.reverse(),ingredientsState:d}))}),s((o,y)=>{var j;const d=y().ingredients,l=y().mixes;o(xr({products:(j=f.data)==null?void 0:j.reverse(),ingredientsState:d,mixesState:l,averageHourlyRate:r}))}),s(vr(u.data)),s(tr((w=S==null?void 0:S.data)==null?void 0:w.reverse())),s(Ir(m.data)),s(Bn({selectedDate:i,employees:m.data,employeeHours:a==null?void 0:a.data})),n(!1)}catch(v){console.error("Error fetching data:",v),n(!1)}})()},[s,n,i]),e.jsx(Ar,{children:e.jsx(xn,{children:e.jsx(rn,{children:e.jsx(Es,{children:e.jsx(Cn,{children:e.jsx(zs,{children:e.jsx(Tn,{children:e.jsx(Dn,{children:e.jsx(Lr,{children:t})})})})})})})})})},Qe="/assets/logo-Ha-8mVYV.png",Vr=le({name:"profitabilitySettings",initialState:{materialCostRate:25,laborCostRate:12,fixedExpensesRate:30,profitRate:33,materialCostRange:{min:20,max:30},laborCostRange:{min:10,max:15},fixedExpensesRange:{min:25,max:35},profitRange:{min:25,max:35}},reducers:{setMaterialCostRate:(t,n)=>{t.materialCostRate=n.payload},setLaborCostRate:(t,n)=>{t.laborCostRate=n.payload},setFixedExpensesRate:(t,n)=>{t.fixedExpensesRate=n.payload},setProfitRate:(t,n)=>{t.profitRate=n.payload},setMaterialCostRange:(t,n)=>{t.materialCostRange=n.payload},setLaborCostRange:(t,n)=>{t.laborCostRange=n.payload},setFixedExpensesRange:(t,n)=>{t.fixedExpensesRange=n.payload},setProfitRange:(t,n)=>{t.profitRange=n.payload}}}),Dr=Vr.reducer;function Or({drawerVisible:t,setDrawerVisible:n,isMobile:s}){return C.useState(!1),e.jsxs("div",{className:"top-bar",children:[e.jsx(Z,{to:"/",children:e.jsx(Ye,{className:"logo-mobile",src:Qe,alt:"GainGuard",preview:!1})}),e.jsxs("div",{children:[e.jsx("button",{className:"profile-button",children:e.jsx(N,{icon:Zt})}),s&&e.jsx("button",{className:"menu-button",onClick:()=>n(!t),children:e.jsx(N,{icon:es})})]})]})}const{Header:Ur,Content:Wr,Footer:Br}=ht;function Yr(){const[t,n]=C.useState(!1),[s,i]=C.useState(!1),r=he({query:"(max-width: 1200px)"});return e.jsxs(Hr,{setLoading:i,children:[e.jsx(Qt,{fullscreen:!0,spinning:s,size:"large"}),e.jsx(gs,{children:e.jsxs(ht,{className:"app-container",style:{minHeight:r?"85vh":"100vh"},children:[e.jsxs("div",{className:"nav-container",children:[e.jsx("div",{className:"nav-top",children:e.jsx(Ye,{className:"logo",src:Qe,alt:"GainGuard",preview:!1})}),e.jsx(xt,{})]}),e.jsxs("div",{className:"body-container",children:[e.jsxs(Ur,{className:"header",style:{padding:"0 20px"},children:[e.jsx(Or,{isMobile:r,drawerVisible:t,setDrawerVisible:n}),e.jsx(W,{className:"no-margin"})]}),e.jsx(Wr,{className:"content",children:e.jsxs(fs,{children:[e.jsx(pe,{path:"/",element:e.jsx(yn,{})}),e.jsx(pe,{path:"/menu",element:e.jsx(Ks,{})}),e.jsx(pe,{path:"/suppliers",element:e.jsx(an,{})}),e.jsx(pe,{path:"/mixes",element:e.jsx(bn,{})}),e.jsx(pe,{path:"/ingredients",element:e.jsx(mn,{})}),e.jsx(pe,{path:"/employees",element:e.jsx(Nn,{})}),e.jsx(pe,{path:"/work-hours",element:e.jsx(er,{})})]})}),e.jsx(Br,{className:"footer",children:"© 2024 מערכת ניהול תפריט ועץ מוצר"})]}),e.jsx(zt,{title:e.jsxs(H,{children:[e.jsx(Ye,{className:"logo",src:Qe,alt:"GainGuard",preview:!1}),e.jsx("p",{children:"ניווט"})]}),placement:"right",closable:!0,onClose:()=>n(!1),open:t,width:300,children:e.jsx(xt,{onClose:()=>n(!1)})})]})})]})}function xt({onClose:t}){const n=vs(),s=i=>n.pathname===i?"link-active":"link";return e.jsxs("div",{className:"nav-desktop-child",children:[e.jsx(W,{}),e.jsx(T,{type:"link",onClick:t,className:s("/"),children:e.jsxs(Z,{to:"/",children:[e.jsx(N,{icon:ts})," ",e.jsx("p",{children:"לוח מחוונים"})]})}),e.jsx(T,{type:"link",onClick:t,className:s("/menu"),children:e.jsxs(Z,{to:"/menu",children:[e.jsx(N,{icon:Pe})," ",e.jsx("p",{children:"תפריט"})]})}),e.jsx(T,{type:"link",onClick:t,className:s("/mixes"),children:e.jsxs(Z,{to:"/mixes",children:[e.jsx(N,{icon:vt})," ",e.jsx("p",{children:"מיקסים"})]})}),e.jsx(T,{type:"link",onClick:t,className:s("/ingredients"),children:e.jsxs(Z,{to:"/ingredients",children:[e.jsx(N,{icon:_e})," ",e.jsx("p",{children:"חומרי גלם"})]})}),e.jsx(T,{type:"link",onClick:t,className:s("/suppliers"),children:e.jsxs(Z,{to:"/suppliers",children:[e.jsx(N,{icon:Xe})," ",e.jsx("p",{children:"ספקים"})]})}),e.jsx(T,{type:"link",onClick:t,className:s("/employees"),children:e.jsxs(Z,{to:"/employees",children:[e.jsx(N,{icon:ss})," ",e.jsx("p",{children:"עובדים"})]})}),e.jsx(T,{type:"link",onClick:t,className:s("/work-hours"),children:e.jsxs(Z,{to:"/work-hours",children:[e.jsx(N,{icon:Fe})," ",e.jsx("p",{children:"ניהול שעות עבודה"})]})})]})}const Ue=Ze("dashboard/fetchDashboardData",async(t,{getState:n})=>(n(),{})),Qr=le({name:"dashboard",initialState:[],reducers:{},extraReducers:t=>{t.addCase(Ue.pending,n=>{}).addCase(Ue.fulfilled,(n,s)=>{}).addCase(Ue.rejected,n=>{})}}),zr=Qr.reducer,Jr=ys({reducer:{suppliers:ir,ingredients:cr,products:mr,dashboard:zr,mixes:fr,categories:br,employees:Fr,employeeHours:Kn,profitabilitySettingsSlice:Dr}});Vt.createRoot(document.getElementById("root")).render(e.jsx(ze.StrictMode,{children:e.jsx(Dt,{store:Jr,children:e.jsx(Yr,{})})}));"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(t=>{console.log("ServiceWorker registration successful with scope: ",t.scope)}).catch(t=>{console.error("ServiceWorker registration failed: ",t)})});
