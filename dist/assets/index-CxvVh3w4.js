import{r as u,j as e,a as mt}from"./react-BoqISt01.js";import{c as gs}from"./react-dom-Bk743r0W.js";import{u as te,a as De,P as js}from"./react-redux-D3oi59tp.js";import{a as z}from"./axios-CCb-kr4I.js";import{s as O,L as ge,C as de,R as Y,F as X,D as se,B as N,a as Bt,T as Je,P as ys,d as fs,M as ue,b as Z,c as _,S as oe,e as le,f as ne,g as ft,h as je,i as Me,I as ae,j as Lt,k as vt,l as wt,m as ot,A as Ge,n as bt,o as vs,p as dt,q as Ee,r as ht,t as Qe,u as ws,v as Ot,w as bs,x as ct,y as Cs,z as Ut}from"./antd-DjcCNDy_.js";import{u as ce}from"./react-responsive-B9DcSnuZ.js";import{L as Ss}from"./rc-virtual-list-D8xMsbcw.js";import{F as H,f as Re,a as Be,b as Ht,c as _e,d as Te,e as Is,g as Fs,h as ks,i as Ps,j as gt,k as qe,l as jt,m as Ns,n as Ye,o as Ve,p as Xe,q as rt,r as Es,s as _s,t as Ts,u as As}from"./@fortawesome-iG2bi8FM.js";import{a2 as Ct,A as $s,a3 as Wt,a4 as Ms,o as ut,a5 as qs,l as Ds,v as Le,a1 as Oe,a6 as Pe,R as yt,a0 as Rs,r as Bs,s as Ls,x as Os,a7 as Us}from"./@ant-design-DbJKpMgD.js";import{Z as Hs}from"./react-colorful-BRztN3dn.js";import{c as Ws}from"./classnames-CAxFPVRb.js";import{c as Qt,a as Ie,b as Qs}from"./@reduxjs-DkgbS889.js";import{m as Se,h as St}from"./moment-BAfwh5x7.js";import{D as Ys,B as It}from"./react-chartjs-2-0Z_sSmBf.js";import{C as Vs,A as Js,p as Gs,a as Xs,b as Zs,L as zs,c as Ks}from"./chart.js-BkMDj0WH.js";import{L as he,B as en}from"./react-router-dom-UU0TJEQ6.js";import{l as tn}from"./socket.io-client-CDVIIGn8.js";import{d as sn,e as Ne,b as nn}from"./react-router-CBguhhk8.js";import{T as rn}from"./@radix-ui-CBgnhGTJ.js";import"./@babel-D3CJPhrF.js";import"./scheduler-CzFDRTuY.js";import"./use-sync-external-store-BQxMxw6g.js";import"./rc-util-CNJZKBfo.js";import"./rc-resize-observer-DAFDewDD.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./rc-motion-DZL9tseL.js";import"./@rc-component-DPyZj6wr.js";import"./rc-overflow-BihHMfjR.js";import"./rc-picker-C6pnqAVS.js";import"./dayjs-DMN7meC7.js";import"./rc-tabs-BUPz9aOH.js";import"./rc-dropdown-DBn3Vn4f.js";import"./rc-menu-CXhGSgjF.js";import"./rc-select-Enbnx8e0.js";import"./rc-segmented-DWUgWqHo.js";import"./rc-input-number-Do8zGlOB.js";import"./rc-input-DGbryaDy.js";import"./@ctrl-DOFZgDuz.js";import"./rc-drawer-DjgcoIVX.js";import"./rc-field-form-DdGYHmQ7.js";import"./scroll-into-view-if-needed-BZeNfFF0.js";import"./compute-scroll-into-view-DWa9QgjM.js";import"./rc-image-CQiP7trl.js";import"./rc-dialog-B4yQaf15.js";import"./rc-notification-m3oA-fH0.js";import"./rc-tooltip-BAFIWTUD.js";import"./rc-steps-jTTkhuna.js";import"./rc-progress-BECVEO62.js";import"./rc-switch-B_QRjvBh.js";import"./rc-table-rj7zZJss.js";import"./rc-tree-BDK0sBoh.js";import"./rc-checkbox-XvbJzSrO.js";import"./rc-pagination-CZPuIcur.js";import"./throttle-debounce-CUWDS_la.js";import"./rc-textarea-BF1YsysJ.js";import"./copy-to-clipboard-DN2oU9Yq.js";import"./toggle-selection-BHUZwh74.js";import"./matchmediaquery-9DU1HNkU.js";import"./css-mediaquery-DcYbJrVh.js";import"./hyphenate-style-name-HOLnhz8K.js";import"./shallow-equal-BQUY1Bas.js";import"./prop-types-Bq5K3Feg.js";import"./@emotion-CW87jbl0.js";import"./stylis-OW4gUFyn.js";import"./redux-DITMfSWq.js";import"./immer-DqxjFn0G.js";import"./redux-thunk-ClJT1hhx.js";import"./@kurkle-BZxJdD1U.js";import"./@remix-run-Br25Cn4W.js";import"./engine.io-client-C44f3zIw.js";import"./engine.io-parser-BiEtp6m2.js";import"./@socket.io-Dkula2eQ.js";import"./socket.io-parser-BBkuslX-.js";import"./@floating-ui-CyZwn0-1.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const p of o.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&i(p)}).observe(document,{childList:!0,subtree:!0});function s(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=s(n);fetch(n.href,o)}})();const be="https://menu-server-c2b952e2c698.herokuapp.com/api",an=t=>z.post(`${be}/products`,t),ln=t=>{const r=encodeURIComponent(t._id);return z.put(`${be}/products/${r}`,t)},on=t=>z.delete(`${be}/products/${t}`),Yt=()=>z.get(`${be}/products`),dn=t=>z.get(`${be}/products/${t}`),cn=(t,r)=>z.post(`${be}/sizes/${t}`,r),un=(t,r)=>z.put(`${be}/sizes/${t}`,r),xn=(t,r)=>z.delete(`${be}/sizes/${t}/${r}`),pn=t=>z.post(`${be}/variations`,t),mn=(t,r)=>z.put(`${be}/variations/${t}`,r),hn=t=>z.delete(`${be}/variations/${t}`),Vt=u.createContext(),Jt=()=>u.useContext(Vt),gn=({children:t})=>{const[r,s]=u.useState(!1),[i,n]=u.useState(!1),[o,p]=u.useState("add"),[l,g]=u.useState(null),[h,I]=u.useState(null),C=F=>new Promise(async(x,a)=>{var d;try{const m=await dn(F);(d=m==null?void 0:m.data)!=null&&d.error?a(!1):x(m==null?void 0:m.data)}catch(m){console.error("Error get product:",m)}}),R=F=>new Promise(async(x,a)=>{var d,m;s(!0);try{const w=await an(F);s(!1),(d=w==null?void 0:w.data)!=null&&d.error?(O.error((m=w==null?void 0:w.data)==null?void 0:m.error),a(!1)):(O.success("המוצר נוסף בהצלחה"),x(!0))}catch(w){console.error("Error adding product:",w),O.error("שגיאה בהוספת המוצר"),s(!1)}}),S=F=>new Promise(async(x,a)=>{var d;s(!0);try{const m=await ln(F);s(!1),(d=m==null?void 0:m.data)!=null&&d.error||(O.success("המוצר עודכן בהצלחה"),x(!0)),a(!1)}catch(m){console.error("Error updating product:",m),O.error("שגיאה בעדכון המוצר"),s(!1)}}),T=async F=>{s(!0);try{await on(F),O.success("המוצר נמחק בהצלחה"),s(!1)}catch(x){console.error("Error deleting product:",x),O.error("שגיאה במחיקת המוצר"),s(!1)}},L=(F,x)=>(s(!0),new Promise(async(a,d)=>{try{const m=await cn(F,x);O.success("הגודל נוסף בהצלחה"),s(!1),a(m.data)}catch(m){console.error("Error adding size:",m),O.error("שגיאה בהוספת הגודל"),s(!1),d(m)}})),q=(F,x)=>(s(!0),new Promise(async(a,d)=>{try{const m=await un(F,x);O.success("הגודל עודכן בהצלחה"),s(!1),a(m.data)}catch(m){console.error("Error updating size:",m),O.error("שגיאה בעדכון הגודל"),s(!1),d(m)}})),j=(F,x)=>(s(!0),new Promise(async(a,d)=>{try{await xn(F,x),O.success("הגודל נמחק בהצלחה"),s(!1),a(!0)}catch(m){console.error("Error deleting size:",m),O.error("שגיאה במחיקת הגודל"),s(!1),d(m)}})),y=F=>(s(!0),new Promise(async(x,a)=>{try{const d=await pn(F);O.success("הווריאציה נוספה בהצלחה"),s(!1),x(d.data)}catch(d){console.error("Error adding variation:",d),O.error("שגיאה בהוספת הווריאציה"),s(!1),a(d)}})),c=(F,x)=>(s(!0),new Promise(async(a,d)=>{try{const m=await mn(F,x);O.success("הווריאציה עודכנה בהצלחה"),s(!1),a(m.data)}catch(m){console.error("Error updating variation:",m),O.error("שגיאה בעדכון הווריאציה"),s(!1),d(m)}})),v=F=>(s(!0),new Promise(async(x,a)=>{try{await hn(F),O.success("הווריאציה נמחקה בהצלחה"),s(!1),x(!0)}catch(d){console.error("Error deleting variation:",d),O.error("שגיאה במחיקת הווריאציה"),s(!1),a(d)}}));return e.jsx(Vt.Provider,{value:{getProductById:C,addProduct:R,updateProduct:S,deleteProduct:T,addSize:L,updateSize:q,deleteSize:j,addVariation:y,updateVariation:c,deleteVariation:v,loading:r,isModalVisible:i,setIsModalVisible:n,modalMode:o,setModalMode:p,selectedItem:l,setSelectedItem:g,selectedUpdateSize:h,setSelectedUpdateSize:I},children:t})};function jn({data:t,type:r,tableKeys:s,mobileKeys:i,openModal:n,Dtitle:o,Dcontent:p,onDelete:l}){const g=ce({query:"(max-width: 500px)"}),h=ce({query:"(max-width: 600px)"}),I=ce({query:"(min-width: 601px) and (max-width: 768px)"}),C=ce({query:"(min-width: 769px) and (max-width: 900px)"}),R=ce({query:"(min-width: 901px) and (max-width: 1024px)"}),S=ce({query:"(min-width: 1025px) and (max-width: 1280px)"}),T=ce({query:"(min-width: 1281px) and (max-width: 1440px)"}),L=ce({query:"(min-width: 1441px) and (max-width: 1600px)"}),q=ce({query:"(min-width: 1601px) and (max-width: 1760px)"}),j=ce({query:"(min-width: 1761px) and (max-width: 1920px)"}),y=ce({query:"(min-width: 1921px)"}),c=()=>h?"35vh":I?"40vh":C?"45vh":R?"50vh":S?"52vh":T?"53vh":L?"54vh":q?"55vh":j?"64vh":y?"70vh":"100vh",[v,F]=u.useState(0),[x,a]=u.useState(1),[d,m]=u.useState(6),[w,M]=u.useState([]),E=(A,D)=>{const ee=(A-1)*D,W=ee+D;return t.slice(ee,W)},k=(A,D)=>{a(A),m(D)};u.useEffect(()=>{F(t.length),M(E(x,d))},[x,d,t]);const $=A=>{ue.confirm({title:o,content:p,okText:"מחק",cancelText:"בטל",onOk:()=>l(A==null?void 0:A._id)})};return g?e.jsx(e.Fragment,{children:e.jsx(ge,{style:{maxHeight:"55vh",overflowY:"auto",minHeight:"80%",height:"80%"},children:e.jsx(Ss,{data:t,itemHeight:47,itemKey:"_id",children:A=>{var D,ee,W;return e.jsx(ge.Item,{className:"width-100",style:{padding:"0"},children:e.jsxs(de,{className:"width-100 padding-card",style:{margin:"8px",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)"},children:[e.jsxs(Y,{align:"middle",justify:"space-between",style:{margin:"1em 0em"},children:[e.jsx(X,{flex:1,children:e.jsx("strong",{style:{fontSize:"1.3em"},children:A==null?void 0:A.name})}),e.jsxs(X,{flex:1,style:{flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("strong",{children:(D=s==null?void 0:s.find(V=>V.key==="usedCount"))==null?void 0:D.title}),e.jsx("p",{children:A==null?void 0:A.usedCount})]}),(ee=s==null?void 0:s.find(V=>V.key==="type"||V.key==="category"))==null?void 0:ee.render("",A,"view")]}),s.filter(V=>V.key!=="name"&&V.key!=="type"&&(V==null?void 0:V.key)!=="category"&&(V==null?void 0:V.key)!=="actions"&&(i==null?void 0:i.includes(V==null?void 0:V.key))).map((V,b,f)=>e.jsxs(mt.Fragment,{children:[e.jsxs("div",{style:{fontSize:"0.9em",display:"flex",justifyContent:"space-between"},children:[V.title&&e.jsxs("strong",{children:[V.title,":"]}),e.jsx("span",{children:V.render?V.render(null,A,"view"):A[V.dataIndex]||"—"})]}),b<2&&e.jsx(se,{style:{margin:"0.2em"}})]},`${A==null?void 0:A._id}-${V.key}`)),e.jsxs(Y,{className:"card-actions",align:"middle",justify:"center",children:[(W=s==null?void 0:s.find(V=>V.key==="actions"))==null?void 0:W.render(null,A),r==="P"&&e.jsx(se,{type:"vertical"}),e.jsxs(X,{align:"center",justify:"center",children:[e.jsx(N,{type:"text",onClick:()=>$(A),children:e.jsx(H,{icon:Re})}),e.jsx(N,{type:"text",onClick:()=>n("edit",A),children:e.jsx(H,{icon:Be})}),e.jsx(N,{type:"text",onClick:()=>n("view",A),children:e.jsx(H,{icon:Ht})})]})]})]})},A==null?void 0:A._id)}})})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{flex:"1 1 auto",overflowY:"auto",maxHeight:c()},children:e.jsx(Bt,{style:{minWidth:"100%"},columns:s.map(A=>({...A,title:e.jsx(Je,{title:A.title,children:e.jsx("span",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",display:"inline-block",maxWidth:"150px"},children:A.title})})})),dataSource:w,pagination:!1,direction:"rtl"})}),e.jsx("div",{style:{flex:"0 0 auto",display:"flex",justifyContent:"center",alignItems:"center",padding:"1em"},children:e.jsx(ys,{current:x,total:v,pageSize:d,onChange:k,style:{direction:"ltr"},showSizeChanger:!0,pageSizeOptions:["6","10","20","50"],locale:fs})})]})}const{Text:Ft}=ne,yn=({value:t=[],onChange:r,ingredientsArr:s=[],fields:i,add:n,remove:o,form:p,editingIndex:l,setEditingIndex:g,isNew:h,setIsNew:I})=>{var d,m;u.useState(null),u.useState(null);const[C,R]=u.useState(""),S=u.useRef(null),T=u.useCallback(()=>{setTimeout(()=>{S.current&&S.current.scroll({top:S.current.scrollHeight,behavior:"smooth",duration:2e3})},1e3)},[(d=S.current)==null?void 0:d.scrollHeight]),L=(w,M)=>{const k=[...p.getFieldValue("ingredients")||[]];k[l]={...k[l],ingredientId:w,unit:M.unit,name:M.label},R(M.unit)},q=w=>{const E=[...p.getFieldValue("ingredients")||[]];E[l]={...E[l],quantity:w}},j=()=>{const M=a()[l];if(!M||!M.ingredientId||!M.quantity)return;const E=s.find(A=>A._id===M.ingredientId),k={...M,name:(E==null?void 0:E.name)||"---",unit:(E==null?void 0:E.unit)||M.unit,weightOrVolumePerUnit:M.weightOrVolumePerUnit||null},$=[...t,k];r($),g(null),I(!1)},y=w=>{const M=t.filter((E,k)=>k!==w);r(M),g(null)},c=()=>{h&&y(l),g(null),I(!1)},v=()=>g(null),F=(w,M,E)=>{const k=[...t];if(k[w][M]=E,M==="ingredientId"){const $=s.find(A=>A._id===E);$&&(k[w].unit=$.unit,k[w].name=$.name)}r(k)},x=w=>{switch(w){case"weight":return'ק"ג';case"volume":return"ליטר";case"units":return"יחידות";default:return""}},a=()=>{const w=p==null?void 0:p.getFieldValue("ingredients");return Array.isArray(w)?w:[]};return u.useEffect(()=>{a().length>0&&T()},[(m=p==null?void 0:p.getFieldValue("ingredients"))==null?void 0:m.length]),e.jsxs(e.Fragment,{children:[h?e.jsxs(Y,{gutter:16,style:{marginBottom:"1vw"},children:[e.jsxs("div",{className:"flex flex-1 flex-wrap",children:[e.jsx(Z,{span:10,children:e.jsx(_.Item,{name:[l,"ingredientId"],rules:[{required:!0,message:"בחר רכיב"}],children:e.jsx(oe,{placeholder:"בחר רכיב",filterOption:(w,M)=>{var E;return(E=M==null?void 0:M.label)==null?void 0:E.toLowerCase().includes(w.toLowerCase())},showSearch:!0,options:s==null?void 0:s.map(w=>({value:w._id,label:w.name,unit:w.unit})),onChange:L})})}),e.jsx(Z,{span:10,children:e.jsx(_.Item,{name:[l,"quantity"],rules:[{required:!0,message:"הזן כמות"}],children:e.jsx(le,{onChange:q,addonAfter:x(C),placeholder:"כמות"})})}),C==="units"&&e.jsx(Z,{span:14,children:e.jsx(_.Item,{name:[l,"weightOrVolumePerUnit"],rules:[{required:!0,message:"הזן נפח/משקל ליחידה"}],children:e.jsx(le,{placeholder:"נפח/משקל ליחידה",min:0,onChange:w=>F(l,"weightOrVolumePerUnit",w),addonAfter:"קילו/ליטר"})})})]}),e.jsxs(Z,{span:4,children:[e.jsx(N,{type:"text",icon:e.jsx(H,{icon:_e}),onClick:j}),e.jsx(N,{type:"text",icon:e.jsx(H,{icon:Te}),onClick:c})]})]}):e.jsx(N,{type:"dashed",onClick:()=>{g(t.length),I(!0)},disabled:l!==null,style:{marginBottom:"8px"},children:"הוסף מרכיב"}),e.jsx(de,{ref:S,style:{margin:"1vw 0",paddingTop:"1vw",maxHeight:"10vw",overflow:"auto"},children:e.jsx(ge,{dataSource:t,renderItem:(w,M)=>{var A;const E=l===M,k=s.find(D=>D._id===w.ingredientId),$=x(w.unit||(k==null?void 0:k.unit));return e.jsx(ge.Item,{children:E&&!h?e.jsxs(Y,{gutter:16,style:{marginBottom:"1vw"},children:[e.jsxs("div",{className:"flex flex-1 flex-wrap",children:[e.jsx(Z,{span:10,children:e.jsx(_.Item,{name:[M,"ingredientId"],children:e.jsx(oe,{placeholder:"בחר רכיב",value:w.ingredientId||null,onChange:D=>F(M,"ingredientId",D),options:s.map(D=>({value:D._id,label:D.name})),showSearch:!0})})}),e.jsx(Z,{span:10,children:e.jsx(_.Item,{name:[M,"quantity"],children:e.jsx(le,{placeholder:"כמות",onChange:D=>F(M,"quantity",D),min:0,addonAfter:$,style:{width:"100%"}})})}),w.unit==="units"&&e.jsx(Z,{span:14,children:e.jsx(_.Item,{name:[M,"weightOrVolumePerUnit"],rules:[{required:!0,message:"הזן נפח/משקל ליחידה"}],children:e.jsx(le,{placeholder:"נפח/משקל ליחידה (ליטר/גרם)",min:0,style:{width:"100%"},addonAfter:"קילו/ליטר",onChange:D=>F(M,"weightOrVolumePerUnit",D)})})})]}),e.jsxs(Z,{children:[e.jsx(N,{type:"text",icon:e.jsx(H,{icon:_e}),onClick:v}),e.jsx(N,{type:"text",icon:e.jsx(H,{icon:Te}),onClick:c})]})]}):e.jsxs(Y,{style:{width:"100%"},align:"middle",justify:"space-between",children:[e.jsx(X,{flex:1,children:e.jsx(Ft,{children:(w==null?void 0:w.name)||((A=w==null?void 0:w.ingredientData)==null?void 0:A.name)||"---"})}),e.jsx(X,{flex:1,children:e.jsxs(Ft,{children:[w.quantity," ",$,w.unit==="units"&&w.weightOrVolumePerUnit?` (${w.weightOrVolumePerUnit} ק"ג/ליטר)`:""]})}),e.jsxs(Y,{children:[e.jsx(N,{type:"text",icon:e.jsx(H,{icon:Be}),onClick:()=>g(M)}),e.jsx(N,{type:"text",icon:e.jsx(H,{icon:Re}),onClick:()=>y(M)})]})]})},M)}})})]})},Ce=[{value:"weight",label:"משקל",display:t=>t>=1?'ק"ג':"גרם"},{value:"volume",label:"נפח",display:t=>t>=1?"ליטר":'מ"ל'},{value:"units",label:"יחידות",display:t=>t>1?"יחידות":"יחידה"}],{Option:$e}=oe,{Text:ye}=ne,{TextArea:fn}=ae;function vn({mode:t="view",type:r,fields:s=[],onSubmit:i,initialValues:n={},onClose:o,groups:p,tableKeys:l,ingredientsArr:g}){var M,E,k,$,A,D,ee,W,V;const[h]=_.useForm(),[I]=_.useForm(),[C]=_.useForm(),R=te(b=>{var f,P;return(P=(f=b.settings.settings)==null?void 0:f.hourlyRate)==null?void 0:P.value}),[S,T]=u.useState(0),[L]=u.useState(["process","wait"]),[q,j]=u.useState(n),[y,c]=u.useState(null),[v,F]=u.useState(!1),x=b=>{console.log("onChange:",b),T(b)},a=()=>y===null&&!v,d=async b=>{let f=b.quantity;o&&o(),(b.subUnit==="g"||b.subUnit==="ml")&&(f=b.quantity/1e3);const P={...n,...b,quantity:f};i&&await i(P),await I.resetFields(),await C.resetFields()};u.useEffect(()=>{if(n){const b=n.quantity<1?n.quantity*1e3:n.quantity;h.setFieldsValue({...n,quantity:b})}},[n,h]);const m=(b,f)=>b.map(P=>{const{key:B,title:G,type:Q,options:xe,rules:pe,props:Fe,hiddenInForm:nt,coin:Ae,divider:U}=P;if(nt)return null;switch(Q){case"text":return e.jsxs(e.Fragment,{children:[e.jsx(_.Item,{name:B,label:G,rules:pe,validateTrigger:"onSubmit",children:e.jsx(ae,{...Fe})},B),U&&e.jsx(se,{style:{margin:"3vh 0vh"}})]});case"number":return e.jsxs(e.Fragment,{children:[e.jsx(_.Item,{name:B,label:G,rules:pe==null?void 0:pe.map(J=>J.validator?{...J,validator:(K,re)=>J.validator(K,re,n)}:J),validateTrigger:"onSubmit",children:e.jsx(le,{suffix:Ae&&"₪",min:0,style:{width:"100%"},...Fe})},B),U&&e.jsx(se,{style:{margin:"3vh 0vh"}})]});case"float":return e.jsxs(e.Fragment,{children:[e.jsx(_.Item,{name:B,label:G,rules:pe,validateTrigger:"onSubmit",children:e.jsx(le,{suffix:Ae&&"₪",min:0,step:.01,style:{width:"100%"},...Fe})},B),U&&e.jsx(se,{style:{margin:"3vh 0vh"}})]});case"select":return e.jsxs(e.Fragment,{children:[e.jsx(_.Item,{name:B,label:G,rules:pe,validateTrigger:"onSubmit",children:e.jsx(oe,{...Fe,showSearch:!0,onChange:J=>{B==="unit"&&(j(K=>({...K,unit:J,subUnit:void 0})),f.setFieldsValue({subUnit:void 0}))},children:xe.map(J=>e.jsx($e,{value:J.value,children:J.label},J.value))})},B),e.jsx(_.Item,{noStyle:!0,shouldUpdate:(J,K)=>J.unit!==K.unit,children:()=>{const J=q==null?void 0:q.unit,K=q==null?void 0:q.subUnit;return B==="unit"&&(J==="weight"||J==="volume")?e.jsx(_.Item,{name:"subUnit",initialValue:K||(J==="weight"?(q==null?void 0:q.quantity)>=1?"kg":"g":(q==null?void 0:q.quantity)>=1?"liter":"ml"),validateTrigger:"onSubmit",label:J==="weight"?'בחר יחידת משקל (ק"ג / גרם)':'בחר יחידת נפח (ליטר / מ"ל)',rules:[{required:!0,message:"אנא בחר יחידת משנה"}],children:e.jsx(oe,{onChange:re=>j(me=>({...me,subUnit:re})),children:J==="weight"?e.jsxs(e.Fragment,{children:[e.jsx($e,{value:"kg",children:'ק"ג'}),e.jsx($e,{value:"g",children:"גרם"})]}):e.jsxs(e.Fragment,{children:[e.jsx($e,{value:"liter",children:"ליטר"}),e.jsx($e,{value:"ml",children:'מ"ל'})]})})}):null}}),U&&e.jsx(se,{style:{margin:"3vh 0vh"}})]});case"ingredientsManager":return e.jsxs(e.Fragment,{children:[e.jsx(se,{style:{margin:"0.5em"}}),e.jsx(_.List,{name:B,label:G,rules:pe,validateTrigger:"onSubmit",children:(J,{add:K,remove:re})=>e.jsx(yn,{fields:J,add:K,form:f,remove:re,value:f.getFieldValue(B),onChange:me=>f.setFieldsValue({[B]:me}),ingredientsArr:g,editingIndex:y,setEditingIndex:c,isNew:v,setIsNew:F})},B)]});case"price":return e.jsxs(e.Fragment,{children:[e.jsx(_.Item,{name:"withVATFlag",initialValue:!0,valuePropName:"checked",validateTrigger:"onSubmit",children:e.jsx(Me,{onChange:()=>{j(J=>({...J,price:void 0,priceExcludingVAT:void 0}))},children:'עלות כולל מע"מ'})},"withVATFlag"),e.jsx(_.Item,{noStyle:!0,validateTrigger:"onSubmit",shouldUpdate:(J,K)=>J.withVATFlag!==K.withVATFlag,children:({getFieldValue:J})=>J("withVATFlag")?e.jsx(_.Item,{name:"price",label:'עלות (כולל מע"מ)',rules:[{required:!0,message:"חייב להזין עלות"}],validateTrigger:"onSubmit",children:e.jsx(le,{addonAfter:"₪",onChange:K=>{j(re=>({...re,priceExcludingVAT:void 0,price:K}))},style:{width:"100%"}})},"price"):e.jsx(_.Item,{name:"priceExcludingVAT",label:'עלות (ללא מע"מ)',rules:[{required:!0,message:"חייב להזין עלות"}],validateTrigger:"onSubmit",children:e.jsx(le,{style:{width:"100%"},addonAfter:"₪",onChange:K=>{j(re=>({...re,price:void 0,priceExcludingVAT:K}))}})},"priceExcludingVAT")})]});case"custom":return e.jsxs(e.Fragment,{children:[P.render&&P.render("",n,"edit",f),U&&e.jsx(se,{style:{margin:"3vh 0vh"}})]});case"textArea":return e.jsxs(e.Fragment,{children:[e.jsx(_.Item,{name:B,label:G,rules:pe,validateTrigger:"onSubmit",children:e.jsx(fn,{style:{resize:"none"},showCount:!0,maxLength:P==null?void 0:P.maxLength})},B),U&&e.jsx(se,{style:{margin:"3vh 0vh"}})]});default:return null}});if(t==="view")switch(r){case"mix":return e.jsxs("div",{children:[e.jsx(Y,{align:"middle",justify:"space-between",style:{margin:"1em 0em"},children:e.jsx(ye,{strong:!0,style:{fontSize:"1.8em"},children:n==null?void 0:n.name})}),e.jsx(Y,{align:"middle",justify:"space-between",style:{margin:"1em 0em"},children:(M=l==null?void 0:l.find(b=>b.key==="type"))==null?void 0:M.render("",n,"view")}),e.jsx(Y,{align:"middle",justify:"space-between",style:{margin:"1em 0em"},children:(E=l==null?void 0:l.find(b=>b.key==="is_active"))==null?void 0:E.render("",n,"view")}),e.jsxs(Y,{align:"middle",justify:"space-between",style:{width:"100%",gap:"8px"},children:[e.jsxs(Y,{align:"middle",style:{gap:"8px"},children:[e.jsx(Ct,{style:{fontSize:"1.5em",color:"#7f8c8d"}}),e.jsxs(ne.Text,{style:{fontSize:"1.4em",display:"flex",alignItems:"center",gap:"4px"},children:["₪",n==null?void 0:n.totalCost]})]}),e.jsxs(Y,{align:"middle",style:{gap:"8px"},children:[e.jsx($s,{style:{fontSize:"1.5em",color:"#7f8c8d"}}),e.jsxs(ne.Text,{style:{fontSize:"1.4em",display:"flex",alignItems:"center",gap:"4px"},children:[n==null?void 0:n.preparationTime," דקות"]})]})]}),e.jsxs(de,{type:"inner",title:"עלויות",styles:{header:{minHeight:"0",padding:"5px 20px"}},style:{margin:"15px 0"},children:[e.jsxs("div",{style:{margin:"12px 0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(X,{flex:1,children:e.jsxs(ye,{strong:!0,children:["עלות עבודה (₪)",":"]})}),e.jsx(X,{children:e.jsxs("p",{style:{},children:["₪",n==null?void 0:n.laborCost," (₪",R,")"]})})]}),e.jsx(se,{style:{margin:"8px 0"}}),e.jsxs("div",{style:{marginBottom:"12px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(X,{flex:1,children:e.jsxs(ye,{strong:!0,children:["עלות ל-100 גרם (₪)",":"]})}),e.jsx(X,{children:e.jsx("p",{style:{},children:(k=l==null?void 0:l.find(b=>b.key==="unitCost"))==null?void 0:k.render("",n,"view")})})]})]}),e.jsxs(de,{style:{width:"100%",backgroundColor:"#f9f9f9",border:"1px solid #d9d9d9",borderRadius:"8px",marginTop:"10px",paddingTop:"10px"},children:[e.jsx(ye,{strong:!0,style:{display:"block",marginBottom:"8px"},children:"מרכיבים:"}),e.jsx("ul",{style:{paddingLeft:"20px",margin:"0",maxHeight:"5vw",overflow:"auto"},children:($=n==null?void 0:n.ingredients)==null?void 0:$.map((b,f)=>{var B;const P=(()=>{switch(b==null?void 0:b.unit){case"weight":return'ק"ג';case"volume":return"ליטר";case"units":return"יחידות";default:return""}})();return e.jsx("li",{style:{marginBottom:"4px"},children:e.jsxs(ye,{children:[(B=g==null?void 0:g.find(G=>(G==null?void 0:G._id)===(b==null?void 0:b.ingredientId)))==null?void 0:B.name," -"," ",b.quantity," ",P," - ₪",b==null?void 0:b.costForQuantity]})},f)})})]})]});case"ingredient":return e.jsxs("div",{children:[e.jsx(Y,{align:"middle",justify:"space-between",style:{margin:"1em 0em"},children:e.jsx(ye,{strong:!0,style:{fontSize:"1.8em"},children:n==null?void 0:n.name})}),e.jsx(Y,{align:"middle",justify:"space-between",style:{margin:"1em 0em"},children:(A=l==null?void 0:l.find(b=>b.key==="type"))==null?void 0:A.render("",n,"view")}),e.jsx(Y,{align:"middle",justify:"space-between",style:{margin:"1em 0em"},children:e.jsx(ne.Text,{strong:!0,children:n==null?void 0:n.SKU})}),e.jsx(Y,{align:"middle",justify:"space-between",style:{margin:"1em 0em"},children:(D=l==null?void 0:l.find(b=>b.key==="is_active"))==null?void 0:D.render("",n,"view")}),e.jsx(Y,{align:"middle",justify:"space-between",style:{margin:"1em 0em"},children:(ee=l==null?void 0:l.find(b=>b.key==="supplierId"))==null?void 0:ee.render("",n,"view")}),e.jsxs(Y,{align:"middle",justify:"space-between",style:{width:"100%",gap:"8px"},children:[e.jsxs(Y,{align:"middle",style:{gap:"8px"},children:[e.jsx(Ct,{style:{fontSize:"1.5em",color:"#7f8c8d"}}),e.jsxs(Z,{children:[e.jsxs(ne.Text,{style:{fontSize:"1.4em",display:"flex",alignItems:"center"},children:["₪",n==null?void 0:n.priceExcludingVAT,' (ללא מע"מ)']}),e.jsxs(ne.Text,{style:{fontSize:"1em",display:"flex",alignItems:"center"},children:["₪",n==null?void 0:n.price,' (כולל מע"מ)']})]})]}),e.jsxs(Y,{align:"middle",style:{gap:"8px"},children:[e.jsx(H,{icon:Is}),e.jsxs(ne.Text,{style:{fontSize:"1.4em",display:"flex",alignItems:"center",gap:"4px"},children:[n==null?void 0:n.quantity," ",Ce.find(b=>b.value===(n==null?void 0:n.unit)).display(n==null?void 0:n.quantity)]})]})]}),e.jsx(se,{style:{margin:"8px 0"}}),e.jsxs("div",{style:{marginBottom:"12px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(X,{flex:1,children:e.jsxs(ye,{strong:!0,children:["כמות מינימלית",":"]})}),e.jsx(X,{children:e.jsxs("p",{style:{},children:[n==null?void 0:n.unitQuantity," ",Ce.find(b=>b.value===(n==null?void 0:n.unit)).display(n==null?void 0:n.quantity)," - ₪",n==null?void 0:n.unitPrice]})})]}),(n==null?void 0:n.juiceRatio)&&e.jsxs(e.Fragment,{children:[e.jsx(se,{style:{margin:"8px 0"}}),e.jsxs("div",{style:{marginBottom:"12px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(X,{flex:1,children:e.jsxs(ye,{strong:!0,children:["יחס עיבוד",":"]})}),e.jsx(X,{children:e.jsx("p",{style:{},children:(W=l==null?void 0:l.find(b=>b.key==="juiceRatio"))==null?void 0:W.render("",n,"view")})})]}),e.jsx(se,{style:{margin:"8px 0"}}),e.jsxs("div",{style:{marginBottom:"12px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(X,{flex:1,children:e.jsxs(ye,{strong:!0,children:["מחיר ליחידה מעובדת",":"]})}),e.jsx(X,{children:e.jsxs("p",{style:{},children:["₪",n==null?void 0:n.processedPrice]})})]})]}),(n==null?void 0:n.notes)&&e.jsx(de,{type:"inner",style:{backgroundColor:"#f9f9f9",border:"1px solid #d9d9d9",borderRadius:"8px",marginTop:"10px",paddingTop:"10px"},children:e.jsxs(Z,{children:[e.jsx(Y,{style:{marginBottom:"4px"},children:e.jsxs(ye,{strong:!0,style:{fontSize:"1.2em",color:"#333"},children:["הערות",":"]})}),e.jsx(ne.Text,{style:{fontSize:"1em",color:"#555"},children:n==null?void 0:n.notes})]})})]});default:return e.jsxs("div",{style:{},children:[e.jsxs(Y,{align:"middle",justify:"space-between",style:{margin:"1em 0em"},children:[e.jsx(ye,{strong:!0,style:{fontSize:"1.8em"},children:n==null?void 0:n.name}),(V=l==null?void 0:l.find(b=>b.key==="type"))==null?void 0:V.render("",n,"view")]}),l==null?void 0:l.filter(b=>b.key!=="type"&&(b==null?void 0:b.key)!=="name"&&!b.column).map((b,f,P)=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"12px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(X,{flex:1,children:e.jsxs(ye,{strong:!0,children:[b.title,":"]})}),e.jsx(X,{flex:1,children:e.jsx("p",{style:{},children:(b==null?void 0:b.render)&&(b==null?void 0:b.render("",n,t,"view"))||n[b.key]||"—"})})]},b.key),f<(P==null?void 0:P.length)-1&&e.jsx(se,{style:{margin:"8px 0"}})]})),l==null?void 0:l.filter(b=>b.column).map((b,f,P)=>e.jsxs(e.Fragment,{children:[f===0&&e.jsx(se,{style:{margin:"8px 0"}}),e.jsxs("div",{style:{marginBottom:"12px",display:"flex",justifyContent:"space-between",flexDirection:"column"},children:[e.jsxs(ye,{strong:!0,style:{fontSize:"1.4em"},children:[b.title,":"]}),e.jsx(X,{flex:1,children:e.jsx("p",{style:{},children:(b==null?void 0:b.render)&&(b==null?void 0:b.render("",n,t,"view"))||n[b.key]||"—"})})]},b.key),f<(P==null?void 0:P.length)-1&&e.jsx(se,{style:{margin:"8px 0"}})]}))]})}const w=[{title:"מידע",icon:e.jsx(Wt,{}),content:e.jsxs(_,{form:I,layout:"vertical",onValuesChange:(b,f)=>{j(P=>({...P,...b}))},onFinish:async b=>{await I.validateFields(),j({...q,...b}),T(S+1)},initialValues:n,children:[m(s==null?void 0:s.filter(b=>b.group===1),I),p&&!(n!=null&&n._id)&&e.jsx(N,{type:"primary",htmlType:"submit",children:"הבא"}),t!=="add"&&e.jsx(N,{type:"primary",onClick:()=>d(q),children:"עדכן"})]})},{title:"עלויות",icon:e.jsx(Ms,{}),content:e.jsxs(_,{layout:"vertical",form:C,onValuesChange:(b,f)=>{j(P=>({...P,...b}))},onFinish:b=>{let f=b.quantity;(b.subUnit==="g"||b.subUnit==="ml")&&(f=b.quantity/1e3);const P={...q,...b,quantity:f};j(P),i&&i(P)},initialValues:n,children:[m(s==null?void 0:s.filter(b=>b.group===2),C),p&&!(n!=null&&n._id)&&e.jsxs(e.Fragment,{children:[e.jsx(se,{style:{margin:"24px 0"}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[S>0&&e.jsx(N,{onClick:()=>T(S-1),children:"הקודם"}),e.jsx(N,{type:"primary",htmlType:"submit",children:t!=="add"?"עדכן":"סיום"})]})]}),t!=="add"&&e.jsx(N,{type:"primary",onClick:()=>{console.log(C==null?void 0:C.getFieldsValue()),d(q)},children:"עדכן"})]})}];return e.jsxs(e.Fragment,{children:[p&&!(n!=null&&n._id)&&e.jsx(X,{wrap:"wrap",justify:"space-between",align:"center",style:{gap:"8px"},children:e.jsx(ft,{current:S,onChange:x,status:L[S],style:{width:"100%"},children:w==null?void 0:w.map((b,f)=>e.jsx(ft.Step,{title:b.title,icon:b.icon},f))})}),p&&(n==null?void 0:n._id)&&e.jsx(X,{flex:1,wrap:"wrap",justify:"center",align:"center",style:{gap:"8px"},children:e.jsx(je,{current:S,onChange:x,status:L[S],style:{width:"100%"},children:w==null?void 0:w.map((b,f)=>e.jsx(je.TabPane,{tab:b.title,icon:b.icon},f))})}),p&&w[S].content,!p&&e.jsxs(_,{form:h,layout:"vertical",onFinish:d,onValuesChange:b=>{console.log(b)},initialValues:n,children:[!p&&m(s,h),t!=="view"&&(!p||p&&(n==null?void 0:n._id))&&e.jsx(_.Item,{children:e.jsx(N,{type:"primary",htmlType:"submit",disabled:!a(),style:{width:"100%",marginTop:"1vw"},children:t==="add"?"הוסף":"עדכן"})})]})]})}function wn({open:t,onClose:r,filters:s,setFilters:i,filtersArr:n}){var C,R,S,T,L,q,j;const[o,p]=u.useState({type:s.type||[],supplierId:s.supplierId||[],is_active:s.is_active}),l=y=>{p(c=>({...c,[y]:y==="is_active"?null:[]}))},g=()=>{const y=Object.entries(o).reduce((c,[v,F])=>((Array.isArray(F)&&F.length>0||typeof F=="boolean")&&(c[v]=F),c),{});i(y),r()},h=y=>{const c=y==="all"?null:y==="true";p(v=>({...v,is_active:c}))},I=({options:y,filterKey:c})=>{const v=F=>{p(x=>{const a=x[c]||[],d=a.includes(F)?a.filter(m=>m!==F):[...a,F];return{...x,[c]:d}})};return e.jsxs("div",{children:[e.jsx("div",{className:"sticky top-0 bg-white p-2 border-b",children:e.jsx(N,{type:"link",className:"w-full text-left",onClick:()=>l(c),children:"איפוס בחירה"})}),e.jsx("div",{style:{maxHeight:"250px",overflowY:"auto",padding:"8px"},onScroll:F=>F.stopPropagation(),children:y.map(F=>e.jsx("div",{style:{display:"flex",alignItems:"center",marginBottom:"8px"},children:e.jsx(Me,{checked:(o[c]||[]).includes(F.value),onChange:()=>v(F.value),children:F.label})},F.value))})]})};return e.jsxs(Lt,{title:"סינון רכיבים",placement:"right",onClose:r,open:t,width:360,children:[e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("label",{style:{fontSize:"14px",fontWeight:"500"},children:"קטגוריה"}),e.jsx(vt,{content:e.jsx(I,{options:((C=n.find(y=>y.value==="type"))==null?void 0:C.options)||[],filterKey:"type"}),trigger:"click",getPopupContainer:y=>y.parentElement,children:e.jsxs(N,{style:{width:"100%"},type:"dashed",children:[(((R=o.type)==null?void 0:R.length)||0)>0?`${(S=o.type)==null?void 0:S.length} נבחרו`:"בחר קטגוריות",e.jsx(ut,{style:{marginLeft:"8px"}})]})})]}),e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("label",{style:{fontSize:"14px",fontWeight:"500"},children:"ספק"}),e.jsx(vt,{content:e.jsx(I,{options:((T=n.find(y=>y.value==="supplierId"))==null?void 0:T.options)||[],filterKey:"supplierId"}),trigger:"click",getPopupContainer:y=>y.parentElement,children:e.jsxs(N,{style:{width:"100%"},type:"dashed",children:[(((L=o.supplierId)==null?void 0:L.length)||0)>0?`${(q=o.supplierId)==null?void 0:q.length} נבחרו`:"בחר ספקים",e.jsx(ut,{style:{marginLeft:"8px"}})]})})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"14px",fontWeight:"500"},children:"סטטוס"}),e.jsx(oe,{style:{width:"100%"},value:((j=o.is_active)==null?void 0:j.toString())||"all",onChange:h,options:[{label:"הכל",value:"all"},{label:"פעיל",value:"true"},{label:"לא פעיל",value:"false"}]})]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px"},children:[e.jsx(N,{onClick:()=>p({type:[],supplierId:[],is_active:null}),children:"איפוס הכל"}),e.jsx(N,{type:"primary",onClick:g,children:"החל סינון"})]})]})}const{Search:bn}=ae;function Ze({title:t,titleView:r,dataPrint:s,data:i,groups:n,tableKeys:o,newTitle:p,setDataPrint:l,searchKeys:g,sortKeys:h,mobileKeys:I,Dtitle:C,Dcontent:R,onAdd:S,onEdit:T,onDelete:L,width:q,ingredientsArr:j,iconADD:y,floatAction:c,type:v,openModalProduct:F,filters:x,saveFilters:a,filtersArr:d}){const[m,w]=u.useState([]),[M,E]=u.useState(!1),[k,$]=u.useState(!1),[A,D]=u.useState("add"),[ee,W]=u.useState(null),[V,b]=u.useState(!1),[f,P]=u.useState(x),B=ce({query:"(max-width: 500px)"}),G=h.map(U=>({key:U==null?void 0:U.key,label:e.jsx("span",{className:"width-100",onClick:()=>{const J=[...s].sort((K,re)=>{const me=K[U==null?void 0:U.key],ve=re[U==null?void 0:U.key];return typeof me=="number"&&typeof ve=="number"?ve-me:me==null?void 0:me.toString().localeCompare(ve==null?void 0:ve.toString())});l(J)},children:U==null?void 0:U.title})})),Q=U=>{if(U==="all")w(o);else{let J=m.findIndex(re=>re.key===U),K=[...m];J!==-1?K=K.filter(re=>re.key!==U):K=[...K,o.find(re=>re.key===U)],w(K)}},xe=[{key:"all",label:e.jsx(Me,{className:"width-100",rootClassName:"width-100",checked:m.length===o.length,disabled:m.length===o.length,onChange:()=>Q("all"),onClick:U=>U.stopPropagation(),children:"הכל"})},...o.filter(U=>!(U!=null&&U.required)).map(({title:U,dataIndex:J})=>({key:J,label:e.jsx(Me,{className:"width-100",rootClassName:"width-100",checked:m.some(K=>K.key===J),disabled:m.length<=3&&m.some(K=>K.key===J),onChange:()=>Q(J),onClick:K=>K.stopPropagation(),children:U})}))],pe=(U,J=null)=>{if(v==="P")return F(U,J);D(U),W(J),$(!0)},Fe=()=>{$(!1),W(null)},nt=U=>{ue.confirm({title:C,content:R,okText:"מחק",cancelText:"בטל",onOk:()=>L(U==null?void 0:U._id)})},Ae=()=>{let U=[...i];Object.entries(x).forEach(([J,K])=>{if(K!=null)switch(J){case"search":U=U.filter(re=>g.some(me=>{var ve;return(ve=re[me])==null?void 0:ve.toString().toLowerCase().includes(K.toLowerCase())}));break;case"is_active":U=U.filter(re=>re.is_active===K);break;case"type":case"supplierId":Array.isArray(K)&&(U=U.filter(re=>K.includes(re[J])));break}}),l(U)};return u.useEffect(()=>{x&&(Ae(),P(x))},[x]),u.useEffect(()=>{w(o)},[o]),e.jsxs(X,{flex:1,vertical:!0,style:{maxWidth:"100%",width:"100%",height:"100%"},gap:"1em",className:"container",children:[e.jsxs("div",{style:{flex:"0 0 auto"},children:[B&&e.jsx(Y,{justify:"center",children:e.jsxs(ne.Title,{level:3,style:{margin:"0"},children:[y," ",t]})}),e.jsxs(Y,{align:"middle",style:{flexFlow:""},justify:"space-between",children:[!B&&e.jsx(Y,{align:"",children:e.jsxs(ne.Title,{level:3,style:{margin:"0"},children:[y," ",t]})}),e.jsx(Y,{style:{},children:e.jsx(bn,{placeholder:"חיפוש ...",allowClear:!0,onChange:({target:U})=>{l(i==null?void 0:i.filter(J=>g.some(K=>{var re,me,ve;return(ve=(me=(re=J[K])==null?void 0:re.toString())==null?void 0:me.toLowerCase())==null?void 0:ve.includes(U.value.toLowerCase())})))},style:{width:200}})}),e.jsxs(Y,{style:{gap:"0.5em"},children:[d&&e.jsxs(N,{onClick:()=>b(!0),children:[e.jsx(qs,{}),!B&&"סינון","(",Object.keys(x).length,")"]}),!B&&e.jsx(e.Fragment,{children:e.jsx(wt,{menu:{items:xe},trigger:["click"],open:M,onOpenChange:U=>E(U),children:e.jsxs(N,{children:[e.jsx(H,{icon:Fs,style:{marginLeft:"8px"}}),B?e.jsx(e.Fragment,{children:`${m.length} / ${o.length}`}):e.jsx(e.Fragment,{children:`בחרת ${m.length} מתוך ${o.length}`})]})})}),e.jsx(wt,{menu:{items:G},trigger:["click"],children:e.jsxs(N,{type:B?"link":"default",children:[e.jsx(H,{icon:ks,style:{marginLeft:"8px"}}),"מיון"]})}),!B&&e.jsxs(e.Fragment,{children:[e.jsx(se,{type:"vertical",style:{height:"auto"}}),e.jsx(Y,{style:{},children:e.jsx(N,{onClick:()=>pe("add"),type:"primary",children:p})})]})]})]})]}),e.jsxs(ot.Group,{trigger:"click",type:"primary",icon:e.jsx(H,{icon:Ps}),children:[e.jsx(ot,{type:"primary",onClick:()=>pe("add"),icon:y}),c==null?void 0:c.map((U,J)=>e.jsx(mt.Fragment,{children:U},`float-action-${J}`))]}),e.jsx(jn,{data:s,tableKeys:[{title:"פעולות",key:"action",width:110,minWidth:110,render:(U,J)=>e.jsxs("div",{className:"w-fit",children:[e.jsx(N,{type:"text",className:"m-0 !px-1",onClick:()=>nt(J),children:e.jsx(H,{icon:Re})}),e.jsx(N,{type:"text",className:"m-0 !px-1",onClick:()=>pe("edit",J),children:e.jsx(H,{icon:Be})}),e.jsx(N,{type:"text",className:"m-0 !px-1",onClick:()=>pe("view",J),children:e.jsx(H,{icon:Ht})})]})},...m],openModal:pe,mobileKeys:I,type:v,Dtitle:C,Dcontent:R,onDelete:L}),V&&e.jsx(wn,{open:V,onClose:()=>b(!1),filtersArr:d,filters:f,setFilters:U=>{P(U),a(U),Ae()}}),e.jsx(ue,{style:{top:B?"3em":""},title:A==="add"?`הוסף ${r} חדש`:A==="edit"?`ערוך ${r}`:`צפייה ב${r}`,open:k,onCancel:Fe,footer:null,destroyOnClose:!0,width:B?"100%":q||600,children:v!=="P"&&e.jsx(vn,{mode:A,groups:n,type:v,tableKeys:m,ingredientsArr:j,fields:o.filter(U=>U.editable||A==="view"),onSubmit:U=>{A==="add"&&S(U),A==="edit"&&T({...ee,...U}),Fe()},initialValues:ee||{},onClose:Fe})})]})}const ze="https://menu-server-c2b952e2c698.herokuapp.com/api",Cn=t=>z.post(`${ze}/categories`,t),Sn=t=>{const r=encodeURIComponent(t._id);return z.put(`${ze}/categories/${r}`,t)},In=t=>z.delete(`${ze}/categories/${t}`),Fn=()=>z.get(`${ze}/categories`),Gt=u.createContext(),kn=()=>u.useContext(Gt),Pn=({children:t})=>{const[r,s]=u.useState(!1),i=async p=>{s(!0);try{await Cn(p),O.success("הקטגוריה נוספה בהצלחה"),s(!1)}catch(l){console.error("Error adding category:",l),O.error("שגיאה בהוספת הקטגוריה"),s(!1)}},n=async p=>{s(!0);try{await Sn(p),O.success("הקטגוריה עודכנה בהצלחה"),s(!1)}catch(l){console.error("Error updating category:",l),O.error("שגיאה בעדכון הקטגוריה"),s(!1)}},o=async p=>{s(!0);try{await In(p),O.success("הקטגוריה נמחקה בהצלחה"),s(!1)}catch(l){console.error("Error deleting category:",l),O.error("שגיאה במחיקת הקטגוריה"),s(!1)}};return e.jsx(Gt.Provider,{value:{addCategory:i,updateCategory:n,deleteCategory:o,loading:r},children:t})},{TabPane:kt}=je,Xt=({value:t,onChange:r})=>{const[s,i]=u.useState(!1),n={gray:["#F8F9FA","#F1F3F5","#E9ECEF","#DEE2E6","#CED4DA","#ADB5BD","#868E96","#495057","#343A40","#212529"],red:["#FFF5F5","#FFE3E3","#FFC9C9","#FFA8A8","#FF8787","#FF6B6B","#FA5252","#F03E3E","#E03131","#C92A2A"],pink:["#FFF0F6","#FFDEEB","#FCC2D7","#FAA2C1","#F783AC","#F06595","#E64980","#D6336C","#C2255C","#A61E4D"],purple:["#F8F0FC","#F3D9FA","#EEBEFA","#E599F7","#DA77F2","#CC5DE8","#BE4BDB","#AE3EC9","#9C36B5","#862E9C"],blue:["#E7F5FF","#D0EBFF","#A5D8FF","#74C0FC","#4DABF7","#339AF0","#228BE6","#1C7ED6","#1971C2","#1864AB"],cyan:["#E3FAFC","#C5F6FA","#99E9F2","#66D9E8","#3BC9DB","#22B8CF","#15AABF","#1098AD","#0C8599","#0B7285"],teal:["#E6FCF5","#C3FAE8","#96F2D7","#63E6BE","#38D9A9","#20C997","#12B886","#0CA678","#099268","#087F5B"],green:["#EBFBEE","#D3F9D8","#B2F2BB","#8CE99A","#69DB7C","#51CF66","#40C057","#37B24D","#2F9E44","#2B8A3E"],yellow:["#FFF9DB","#FFF3BF","#FFEC99","#FFE066","#FFD43B","#FCC419","#FAB005","#F59F00","#F08C00","#E67700"],orange:["#FFF4E6","#FFE8CC","#FFD8A8","#FFC078","#FFA94D","#FF922B","#FD7E14","#F76707","#E8590C","#D9480F"]};return e.jsxs("div",{className:"relative",children:[e.jsxs(N,{onClick:()=>i(!s),className:"flex items-center gap-2 w-[180px]",children:[e.jsx("div",{className:"w-6 h-6 rounded border border-gray-300",style:{backgroundColor:t||"#ffffff"}}),e.jsx("span",{className:"flex-1 text-right",children:t||"בחר צבע"}),e.jsx(ut,{})]}),s&&e.jsx("div",{className:"absolute z-10 mt-2 w-[320px] bg-white border border-gray-300 rounded shadow-lg p-4",children:e.jsxs(je,{defaultActiveKey:"presets",children:[e.jsx(kt,{tab:"צבעים מוכנים",children:e.jsx("div",{className:"max-h-[400px] overflow-y-auto",children:Object.entries(n).map(([o,p])=>e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-xs text-gray-500 capitalize",children:o}),e.jsx("div",{className:"grid grid-cols-10 gap-1",children:p.map(l=>e.jsx("button",{className:Ws("h-6 w-6 rounded-md transition-transform duration-150",{"ring-2 ring-black scale-110":t===l,"border border-gray-300":t!==l}),style:{backgroundColor:l},onClick:()=>{r(l),i(!1)},children:t===l&&e.jsx(Ds,{className:"text-white text-sm"})},l))})]},o))})},"presets"),e.jsxs(kt,{tab:"צבע מותאם אישי",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"mb-2",children:"קוד צבע (Hex)"}),e.jsx(ae,{value:t||"",onChange:o=>{const p=o.target.value;/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.test(p)&&r(p)},placeholder:"#000000",className:"font-mono"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-2",children:"בחר צבע"}),e.jsx(Hs,{color:t||"#000000",onChange:o=>{r(o)}})]})]},"custom")]})})]})},{Title:Nn}=ne,Pt=({isOpen:t,onClose:r,onSubmit:s,initialValues:i=null,isColorUsed:n})=>{const[o]=_.useForm(),[p,l]=u.useState(null);u.useEffect(()=>{t&&i?o.setFieldsValue(i):t&&o.resetFields()},[t,i,o]);const g=async h=>{var I;if(!((I=h.name)!=null&&I.trim())){l("שם הקטגוריה הוא שדה חובה");return}try{await s(h),o.resetFields(),r(),l(null)}catch{l("שגיאה בשמירת הקטגוריה")}};return e.jsxs(ue,{title:i?"עריכת קטגוריה":"הוספת קטגוריה",open:t,onCancel:r,footer:null,destroyOnClose:!0,children:[p&&e.jsx(Ge,{message:p,type:"error",className:"mb-4"}),e.jsxs(_,{form:o,layout:"vertical",onFinish:g,children:[e.jsx(_.Item,{label:"שם הקטגוריה",name:"name",rules:[{required:!0,message:"שם הקטגוריה הוא שדה חובה"}],children:e.jsx(ae,{})}),e.jsx(_.Item,{label:"תיאור",name:"description",children:e.jsx(ae,{})}),e.jsx(_.Item,{label:"צבע",name:"color",children:e.jsx(Xt,{value:o.getFieldValue("color"),onChange:h=>{!n(h)||h===(i==null?void 0:i.color)?o.setFieldsValue({color:h}):l("צבע זה כבר בשימוש")}})}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(N,{type:"primary",htmlType:"submit",children:"שמור"}),e.jsx(N,{onClick:r,children:"ביטול"})]})]})]})},En=({isCategoryModalVisible:t,setIsCategoryModalVisible:r})=>{const{addCategory:s,updateCategory:i,deleteCategory:n}=kn(),o=te(j=>j.categories),[p,l]=u.useState(!1),[g,h]=u.useState(null),[I,C]=u.useState(null),R=async j=>{try{await s(j),C(null)}catch{C("שגיאה בהוספת הקטגוריה")}},S=async j=>{try{await i({...g,...j}),C(null)}catch{C("שגיאה בעדכון הקטגוריה")}},T=async j=>{try{await n(j._id),C(null)}catch{C("שגיאה במחיקת הקטגוריה")}},L=j=>o.some(y=>y.color===j&&y._id!==(g==null?void 0:g._id)),q=j=>{ue.confirm({title:"מחיקת קטגוריה",content:`האם אתה בטוח שברצונך למחוק את הקטגוריה "${j.name}"?`,okText:"מחק",cancelText:"ביטול",onOk:()=>T(j)})};return e.jsxs(ue,{title:"ניהול קטגוריות",open:t,onCancel:()=>r(!1),footer:null,width:800,children:[I&&e.jsx(Ge,{message:I,type:"error",className:"mb-4"}),e.jsxs("div",{className:"mb-4 flex justify-between items-center",children:[e.jsx(Nn,{level:4,children:"קטגוריות"}),e.jsx(N,{type:"primary",icon:e.jsx(Le,{}),onClick:()=>l(!0),children:"הוסף קטגוריה"})]}),e.jsx("div",{className:"space-y-2 max-h-[50vh] overflow-y-auto px-2",children:o.map(j=>e.jsxs("div",{className:"flex justify-between items-center border p-2 rounded",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:j.color}}),e.jsxs("div",{children:[e.jsx("div",{children:j.name}),e.jsx("div",{className:"text-sm text-gray-500",children:j.description})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{icon:e.jsx(Oe,{}),onClick:()=>h(j)}),e.jsx(N,{icon:e.jsx(Pe,{}),danger:!0,onClick:()=>q(j)})]})]},j._id))}),e.jsx(Pt,{isOpen:p,onClose:()=>l(!1),onSubmit:R,isColorUsed:L}),e.jsx(Pt,{isOpen:!!g,onClose:()=>h(null),onSubmit:S,initialValues:g,isColorUsed:L})]})},{Text:Nt}=ne,_n=({ingredients:t,sizes:r,add:s,remove:i,indexSize:n,form:o,onChange:p,getUnitDisplay:l,setDisabledSave:g})=>{var W,V,b;const h=u.useRef(null),[I,C]=u.useState(null),[R,S]=u.useState(!1),[T,L]=u.useState(!1),[q,j]=u.useState(null),[y,c]=u.useState(null),[v,F]=u.useState(""),x=u.useCallback(()=>{setTimeout(()=>{h.current&&h.current.scroll({top:h.current.scrollHeight,behavior:"smooth",duration:2e3})},1e3)},[(W=h.current)==null?void 0:W.scrollHeight]),a=f=>{C(f),g(!0)},d=()=>{C(null),g(!1),L(!1),S(!1),F("")},m=()=>{o.validateFields().then(()=>{C(null),g(!1),L(!1),S(!1),F("")})},w=(f,P,B)=>{const Q=[...o.getFieldValue("ingredients")||[]];Q[f]={...Q[f],[P]:B},o.setFieldsValue({ingredients:Q}),M(Q)},M=f=>{const P=[...r];P[n]={...P[n],ingredients:f},p(P)},E=(f,P)=>{j({ingredientId:f,unit:P.unit,name:P.label})},k=f=>{c(f)},$=()=>{if(!q||!y)return;const f={...q,quantity:y},B=[...o.getFieldValue("ingredients")||[],f];o.setFieldsValue({ingredients:B}),M(B),j(null),c(null),L(!1),C(null),g(!1),S(!1)},A=f=>{const B=(o.getFieldValue("ingredients")||[]).filter((G,Q)=>Q!==f);o.setFieldsValue({...B}),M(B),i(f)},D=f=>{if(!f)return"";if(f.name)return f.name;if(f.ingredientId&&t){const P=t.find(B=>B._id===f.ingredientId);return(P==null?void 0:P.name)||""}return""},ee=()=>{const f=o.getFieldValue("ingredients");return Array.isArray(f)?f:[]};return u.useEffect(()=>{ee().length>0&&x()},[(V=o.getFieldValue("ingredients"))==null?void 0:V.length]),e.jsxs(e.Fragment,{children:[T?e.jsxs(Y,{gutter:16,className:"width-100",style:{marginBottom:"1vw"},justify:"space-between",children:[e.jsxs(Z,{span:10,children:[" ",e.jsx(oe,{placeholder:"בחר רכיב",style:{width:"100%"},filterOption:(f,P)=>{var B;return(B=P==null?void 0:P.label)==null?void 0:B.toLowerCase().includes(f.toLowerCase())},showSearch:!0,options:t==null?void 0:t.map(f=>({value:f._id,label:f.name,unit:f.unit})),onChange:E})]}),e.jsxs(Z,{span:10,children:[" ",e.jsx(le,{onChange:k,addonAfter:l((q==null?void 0:q.unit)||""),placeholder:"כמות",style:{width:"100%"}})]}),e.jsxs(Z,{children:[" ",e.jsx(N,{type:"text",icon:e.jsx(H,{icon:_e}),onClick:$}),e.jsx(N,{type:"text",icon:e.jsx(H,{icon:Te}),onClick:d})]})]}):e.jsx(N,{type:"dashed",onClick:()=>{L(!0),S(!0),C(ee().length),g(!0)},disabled:I!==null,children:"הוסף מרכיב"}),e.jsx("div",{ref:h,style:{margin:"1vw 0",height:"12vw",maxHeight:"12vw",overflowY:"auto",overflowX:"hidden"},children:e.jsx(ge,{dataSource:(b=r[n])==null?void 0:b.ingredients,renderItem:(f,P)=>{var B;return e.jsx("div",{className:"mx-3 my-0 p-0",children:I!==P?e.jsxs(Y,{style:{width:"100%"},align:"middle",justify:"space-between",children:[e.jsx(X,{flex:2,children:e.jsx(Nt,{children:D(f)})}),e.jsx(X,{flex:1,children:e.jsxs(Nt,{children:[f==null?void 0:f.quantity," ",l(f==null?void 0:f.unit)]})}),e.jsxs(Z,{children:[e.jsx(N,{type:"text",icon:e.jsx(H,{icon:Be}),onClick:()=>a(P)}),e.jsx(N,{type:"text",icon:e.jsx(H,{icon:Re}),onClick:()=>A(P)})]})]}):!R&&e.jsxs("div",{className:"flex flex-1 flex-row gap-2 justify-between",children:[e.jsx(Z,{span:10,children:e.jsx(_.Item,{name:[P,"ingredientId"],rules:[{required:!0,message:"בחר רכיב"}],initialValue:((B=f.ingredientId)==null?void 0:B._id)||f.ingredientId,children:e.jsx(oe,{placeholder:"בחר רכיב",showSearch:!0,filterOption:(G,Q)=>{var xe;return(xe=Q==null?void 0:Q.label)==null?void 0:xe.toLowerCase().includes(G.toLowerCase())},options:t==null?void 0:t.map(G=>({value:G._id,label:G.name,unit:G.unit})),onChange:(G,Q)=>w(P,"ingredientId",G)})})}),e.jsx(Z,{span:10,children:e.jsx(_.Item,{name:[P,"quantity"],rules:[{required:!0,message:"הזן כמות"}],initialValue:f.quantity,children:e.jsx(le,{addonAfter:l(f==null?void 0:f.unit),onChange:G=>w(P,"quantity",G)})})}),e.jsxs(Z,{span:4,children:[e.jsx(N,{type:"text",icon:e.jsx(H,{icon:_e}),onClick:m}),e.jsx(N,{type:"text",icon:e.jsx(H,{icon:Te}),onClick:d})]})]})},P)}})})]})},{Text:Et}=ne,Tn=({mixes:t,sizes:r,add:s,remove:i,indexSize:n,form:o,onChange:p,getUnitDisplay:l,setDisabledSave:g})=>{var W,V,b;const h=u.useRef(null),[I,C]=u.useState(null),[R,S]=u.useState(!1),[T,L]=u.useState(!1),[q,j]=u.useState(null),[y,c]=u.useState(null),[v,F]=u.useState(""),x=u.useCallback(()=>{setTimeout(()=>{h.current&&h.current.scroll({top:h.current.scrollHeight,behavior:"smooth",duration:2e3})},1e3)},[(W=h.current)==null?void 0:W.scrollHeight]),a=f=>{C(f),g(!0)},d=()=>{C(null),g(!1),L(!1),S(!1),F("")},m=()=>{o.validateFields().then(()=>{C(null),g(!1),L(!1),S(!1),F("")})},w=(f,P,B)=>{const Q=[...o.getFieldValue("mixes")||[]];Q[f]={...Q[f],[P]:B},o.setFieldsValue({mixes:Q}),M(Q)},M=f=>{const P=[...r];P[n]={...P[n],mixes:f},p(P)},E=(f,P)=>{j({mixId:f,unit:(P==null?void 0:P.unit)||"weight",name:P.label})},k=f=>{c(f)},$=()=>{if(!q||!y)return;const f={...q,quantity:y},B=[...o.getFieldValue("mixes")||[],f];o.setFieldsValue({mixes:B}),M(B),j(null),c(null),L(!1),F(""),C(null),g(!1),S(!1)},A=f=>{const B=(o.getFieldValue("mixes")||[]).filter((G,Q)=>Q!==f);o.setFieldsValue({...B}),M(B),i(f)},D=f=>{if(!f)return"";if(f.name)return f.name;if(f.mixId&&t){const P=t.find(B=>B._id===f.mixId);return(P==null?void 0:P.name)||""}return""},ee=()=>{const f=o.getFieldValue("mixes");return Array.isArray(f)?f:[]};return u.useEffect(()=>{ee().length>0&&x()},[(V=o.getFieldValue("mixes"))==null?void 0:V.length]),e.jsxs(e.Fragment,{children:[T?e.jsxs(Y,{gutter:16,className:"width-100",style:{marginBottom:"1vw"},justify:"space-between",children:[e.jsx(Z,{span:10,children:e.jsx(oe,{placeholder:"בחר רכיב",filterOption:(f,P)=>{var B;return(B=P==null?void 0:P.label)==null?void 0:B.toLowerCase().includes(f.toLowerCase())},showSearch:!0,style:{width:"100%"},options:t==null?void 0:t.map(f=>({value:f._id,label:f.name,unit:f.unit})),onChange:E})}),e.jsx(Z,{span:10,children:e.jsx(le,{onChange:k,addonAfter:l(v),placeholder:"כמות",style:{width:"100%"}})}),e.jsxs(Z,{children:[e.jsx(N,{type:"text",icon:e.jsx(H,{icon:_e}),onClick:$}),e.jsx(N,{type:"text",icon:e.jsx(H,{icon:Te}),onClick:d})]})]}):e.jsx(N,{type:"dashed",onClick:()=>{L(!0),S(!0),C(ee().length),g(!0)},disabled:I!==null,children:"הוסף מרכיב"}),e.jsx("div",{ref:h,style:{margin:"1vw 0",height:"12vw",maxHeight:"12vw",overflowY:"auto",overflowX:"hidden"},children:e.jsx(ge,{dataSource:(b=r[n])==null?void 0:b.mixes,renderItem:(f,P)=>{var B;return e.jsx("div",{className:"mx-3 my-0 p-0",children:I!==P?e.jsxs(Y,{style:{width:"100%"},align:"middle",justify:"space-between",children:[e.jsx(X,{flex:1,children:e.jsx(Et,{children:D(f)})}),e.jsx(X,{flex:1,children:e.jsxs(Et,{children:[f==null?void 0:f.quantity," ",l(f==null?void 0:f.unit)]})}),e.jsxs(Y,{children:[e.jsx(N,{type:"text",onClick:()=>a(P),children:e.jsx(H,{icon:Be})}),e.jsx(N,{type:"text",onClick:()=>A(P),children:e.jsx(H,{icon:Re})})]})]}):!R&&e.jsxs("div",{className:"flex flex-1 flex-row gap-2 justify-between",children:[e.jsx(Z,{span:10,children:e.jsx(_.Item,{name:[P,"mixId"],rules:[{required:!0,message:"בחר רכיב"}],initialValue:((B=f.mixId)==null?void 0:B._id)||f.mixId,children:e.jsx(oe,{placeholder:"בחר רכיב",showSearch:!0,filterOption:(G,Q)=>{var xe;return(xe=Q==null?void 0:Q.label)==null?void 0:xe.toLowerCase().includes(G.toLowerCase())},options:t==null?void 0:t.map(G=>({value:G._id,label:G.name,unit:G.unit})),onChange:(G,Q)=>w(P,"mixId",G)})})}),e.jsx(Z,{span:10,children:e.jsx(_.Item,{name:[P,"quantity"],rules:[{required:!0,message:"הזן כמות"}],initialValue:f.quantity,children:e.jsx(le,{addonAfter:l(f==null?void 0:f.unit),onChange:G=>w(P,"quantity",G)})})}),e.jsxs(Z,{span:4,children:[e.jsx(N,{type:"text",icon:e.jsx(H,{icon:_e}),onClick:m}),e.jsx(N,{type:"text",icon:e.jsx(H,{icon:Te}),onClick:d})]})]})},P)}})})]})};function An({size:t,sizes:r,indexSize:s,handleCancelEdit:i,handleRemoveSize:n,newSizeId:o,form:p,ingredients:l,mixes:g,onChange:h,getUnitDisplay:I,activeSubTab:C,setActiveSubTab:R,setNewSizeId:S,onSubmit:T}){var y,c;const[L,q]=u.useState(!1),j=async()=>{var v;try{const F=await p.validateFields();S(null),h(r==null?void 0:r.map((x,a)=>a===s?{...x,...F,edit:!1}:x)),T(F,s)}catch(F){const a=(v=F.errorFields[0])==null?void 0:v.name;a!=null&&a.includes("ingredients")?R("1"):a!=null&&a.includes("mixes")&&R("2")}};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-row justify-between items-start",style:{marginBottom:"12px"},children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx(_.Item,{name:["_id"],hidden:!0,children:e.jsx(ae,{})}),e.jsx(_.Item,{name:"label",label:"שם הגודל",rules:[{required:!0,message:"חייב למלא שם גודל"},{min:1,message:"שם גודל חייב להיות לפחות 1 תווים"},{max:25,message:"שם גודל לא יכול לחרוג מ-25 תווים"}],children:e.jsx(ae,{placeholder:"שם הגודל",size:"middle",showCount:!0,style:{width:"auto",minWidth:"200px"},maxLength:25})}),e.jsx(_.Item,{name:"price",label:"מחיר",rules:[{required:!0,message:"יש למלא מחיר"},{type:"number",min:0,message:"המחיר חייב להיות חיובי"}],children:e.jsx(le,{placeholder:"מחיר",style:{width:"100%"},addonAfter:"₪"})}),e.jsx(_.Item,{label:"זמן הכנה (דקות)",name:"preparationTime",rules:[{required:!0,message:"חייב לציין זמן הכנה"}],children:e.jsx(le,{placeholder:"זמן הכנה",style:{width:"100%"},addonAfter:e.jsx(H,{style:{fontSize:"0.9em"},icon:gt})})})]}),e.jsxs("div",{children:[!(t!=null&&t.idNew)&&e.jsx(N,{type:"text",icon:e.jsx(yt,{}),onClick:()=>i(s)}),e.jsx(N,{type:"text",danger:!0,icon:e.jsx(Pe,{}),title:"מחק גודל",onClick:()=>n(s)})]})]}),e.jsx(se,{className:"my-2"}),e.jsxs(je,{activeKey:C,onChange:v=>R(v),tabBarStyle:{direction:"rtl"},style:{margin:"1vw 0"},type:"card",tabPosition:"top",children:[e.jsxs(bt,{tab:`מרכיבים (${((y=t==null?void 0:t.ingredients)==null?void 0:y.length)||0})`,children:[e.jsx(ne.Text,{strong:!0,style:{display:"block",marginBottom:"8px"},children:"מרכיבים:"}),e.jsx(_.List,{name:["ingredients"],children:(v,{add:F,remove:x})=>e.jsx(_n,{add:F,remove:x,fields:v,form:p,indexSize:s,setDisabledSave:q,ingredients:l,onChange:h,getUnitDisplay:I,sizes:r})})]},1),e.jsxs(bt,{tab:`מתכונים (${((c=t==null?void 0:t.mixes)==null?void 0:c.length)||0})`,children:[e.jsx(ne.Text,{strong:!0,style:{display:"block",marginBottom:"8px"},children:"מתכונים:"}),e.jsx(_.List,{name:["mixes"],children:(v,{add:F,remove:x})=>e.jsx(Tn,{add:F,remove:x,fields:v,form:p,indexSize:s,setDisabledSave:q,mixes:g,onChange:h,getUnitDisplay:I,sizes:r})})]},2)]}),e.jsx(N,{type:"primary",htmlType:"submit",disabled:L,onClick:()=>j(),children:"שמור"})]},t.idNew||s)}const{Title:_t,Text:ie}=ne,fe=t=>!t||isNaN(t)?"0.00":Number(t).toFixed(2),ke=(t,r)=>!t||!r||isNaN(t)||isNaN(r)||r===0?"0.0":(Number(t)/Number(r)*100).toFixed(1),$n=({size:t})=>{if(!t)return null;const s=((C,R)=>C<R*.85?"text-red-500":C<R*.95?"text-orange-500":"text-green-500")(t==null?void 0:t.priceIncludingVAT,t==null?void 0:t.suggestedPriceIncludingVAT),i=Number(t.totalCostWithoutLabor||0),n=Number(t.priceIncludingVAT||0),o=Number(t.suggestedPriceIncludingVAT||0),p=i/.3,l=p*.3,g=p*.25,h=n-(i+l+g),I=o-(i+l+g);return e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex flex-row justify-evenly items-center mb-4",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("p",{className:"text-base font-semibold",children:"מחיר נוכחי"}),e.jsxs("p",{className:`text-xl font-semibold ${s}`,children:["₪",fe(t==null?void 0:t.priceIncludingVAT)]}),e.jsx("p",{className:"text-sm",children:'מחיר ללא מע"מ:'}),e.jsxs("p",{className:"text-base font-medium",children:["₪",fe(t==null?void 0:t.priceExcludingVAT),"(₪",fe((t==null?void 0:t.priceIncludingVAT)-(t==null?void 0:t.priceExcludingVAT)),")"]})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("p",{className:"text-base font-semibold",children:"מחיר מומלץ לצרכן"}),e.jsxs("p",{className:"text-xl font-semibold text-green-400",children:["₪",fe(t==null?void 0:t.suggestedPriceIncludingVAT)]}),e.jsx("p",{className:"text-sm",children:'מחיר ללא מע"מ:'}),e.jsxs("p",{className:"text-base font-medium",children:["₪",fe(t==null?void 0:t.suggestedPriceExcludingVAT),"(₪",fe((t==null?void 0:t.suggestedPriceIncludingVAT)-(t==null?void 0:t.suggestedPriceExcludingVAT)),")"]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[e.jsx(ie,{className:"text-lg block mb-2",children:"פודקוסט"}),e.jsxs(ie,{strong:!0,className:"text-xl",children:["₪",fe(i)]})]}),e.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[e.jsx(ie,{className:"text-lg block mb-2",children:"עובדים"}),e.jsxs(ie,{strong:!0,className:"text-xl",children:["₪",fe(l)]})]}),e.jsxs("div",{className:"text-center p-4 bg-purple-50 rounded-lg",children:[e.jsx(ie,{className:"text-lg block mb-2",children:"הוצאות קבועות"}),e.jsxs(ie,{strong:!0,className:"text-xl",children:["₪",fe(g)]})]})]})]}),e.jsx(se,{}),e.jsxs("div",{className:"grid grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsxs(_t,{level:4,className:"text-center mb-4",children:["מחיר נוכחי - ₪",fe(n)]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center p-2 bg-blue-50 rounded",children:[e.jsx(ie,{children:"פודקוסט"}),e.jsxs(ie,{strong:!0,children:[ke(i,n),"%"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 bg-green-50 rounded",children:[e.jsx(ie,{children:"עובדים"}),e.jsxs(ie,{strong:!0,children:[ke(l,n),"%"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 bg-purple-50 rounded",children:[e.jsx(ie,{children:"הוצאות קבועות"}),e.jsxs(ie,{strong:!0,children:[ke(g,n),"%"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 bg-yellow-50 rounded",children:[e.jsx(ie,{children:"רווח"}),e.jsxs(ie,{strong:!0,children:["₪",fe(h)," (",ke(h,n),"%)"]})]})]})]}),e.jsxs("div",{children:[e.jsxs(_t,{level:4,className:"text-center mb-4",children:["מחיר מומלץ - ₪",fe(o)]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center p-2 bg-blue-50 rounded",children:[e.jsx(ie,{children:"פודקוסט"}),e.jsxs(ie,{strong:!0,children:[ke(i,o),"%"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 bg-green-50 rounded",children:[e.jsx(ie,{children:"עובדים"}),e.jsxs(ie,{strong:!0,children:[ke(l,o),"%"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 bg-purple-50 rounded",children:[e.jsx(ie,{children:"הוצאות קבועות"}),e.jsxs(ie,{strong:!0,children:[ke(g,o),"%"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 bg-yellow-50 rounded",children:[e.jsx(ie,{children:"רווח"}),e.jsxs(ie,{strong:!0,children:["₪",fe(I)," (",ke(I,o),"%)"]})]})]})]})]})]})},{Text:Mn}=ne;function Zt({size:t,index:r,sizeInfo:s,type:i,handleEditSize:n,handleDuplicateSize:o,handleRemoveSize:p,ingredients:l,mixes:g}){const h=ce({query:"(max-width: 500px)"});te(R=>{var S,T;return(T=(S=R.settings.settings)==null?void 0:S.hourlyRate)==null?void 0:T.value});const I=R=>R?e.jsx(Y,{children:e.jsx(X,{flex:1,style:{flexDirection:"column"},children:e.jsx($n,{size:R})})}):null,C=({type:R,size:S,ingredients:T,mixes:L})=>{const[q,j]=u.useState("ingredients"),y=()=>{var F;const v=(F=S==null?void 0:S.ingredients)==null?void 0:F.map(x=>{var m;const a=(()=>{switch(x==null?void 0:x.unit){case"weight":return'ק"ג';case"volume":return"ליטר";case"units":return"יחידות";default:return""}})();return{name:((m=T==null?void 0:T.find(w=>(w==null?void 0:w._id)===(x==null?void 0:x.ingredientId)))==null?void 0:m.name)||"לא ידוע",quantity:x==null?void 0:x.quantity,unitDisplay:a,cost:x==null?void 0:x.costForQuantity}});return e.jsx(ge,{dataSource:v,style:{paddingLeft:"20px",margin:"0",height:h?"25vh":"22vh",maxHeight:h?"25vh":"22vh",overflow:"auto"},renderItem:(x,a)=>e.jsxs("div",{className:"flex flex-1 flex-row p-2 bg-gray-200 rounded-lg",style:{marginBottom:"4px"},children:[e.jsx("p",{className:"flex-[2] text-center",children:x.name}),e.jsxs("p",{className:"flex-[1] text-center",children:[x.quantity," ",x.unitDisplay]}),e.jsxs("p",{className:"flex-[1] text-center",children:["₪",x.cost]})]},a)})},c=()=>{var F;const v=(F=S==null?void 0:S.mixes)==null?void 0:F.map(x=>{var m;const a=(()=>{switch(x.unit){case"weight":return'ק"ג';case"volume":return"ליטר";case"units":return"יחידות";default:return""}})();return{name:((m=L==null?void 0:L.find(w=>(w==null?void 0:w._id)===(x==null?void 0:x.mixId)))==null?void 0:m.name)||"לא ידוע",quantity:x.quantity,unitDisplay:a,cost:x==null?void 0:x.costForQuantity}});return e.jsx(ge,{dataSource:v,style:{paddingLeft:"20px",margin:"0",height:h?"25vh":"22vh",maxHeight:h?"25vh":"22vh",overflow:"auto"},renderItem:(x,a)=>e.jsx(ge.Item,{style:{marginBottom:"4px"},children:e.jsxs(Mn,{children:[x.name," - ",x.quantity," ",x.unitDisplay," - ₪",x.cost]})},a)})};return e.jsx(e.Fragment,{children:R!=="P"&&e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"my-5"}),e.jsxs(Y,{style:{gap:"1.5vw"},children:[e.jsx(X,{align:"center",justify:"center",children:e.jsx(vs,{vertical:!0,options:[{label:e.jsxs("div",{style:{padding:4},children:[e.jsx(H,{icon:qe}),e.jsx("div",{children:"מרכיבים"})]}),value:"ingredients"},{label:e.jsxs("div",{style:{padding:4},children:[e.jsx(H,{icon:jt}),e.jsx("div",{children:"מתכונים"})]}),value:"mixes"}],onChange:v=>j(v),style:{marginBottom:"12px",direction:""}})}),e.jsx(X,{flex:1,children:e.jsx("div",{style:{width:"100%"},children:q==="ingredients"?y():c()})})]})]})})};return e.jsxs("div",{children:[e.jsx(X,{flex:1,style:{padding:"0em 1em"},justify:"space-between",align:"middle",children:e.jsxs(Z,{className:"width-100",style:{display:"flex",flexDirection:"column",gap:"0.3em"},children:[e.jsx(X,{flex:1,style:{marginBottom:"8px"},children:e.jsxs(Y,{className:"width-100",align:"middle",justify:"space-between",children:[e.jsx(ne.Text,{strong:!0,style:{fontSize:"1.6em"},children:t==null?void 0:t.label}),e.jsxs(X,{children:[n&&e.jsx(N,{type:"text",icon:e.jsx(Oe,{}),onClick:()=>n(r)}),o&&e.jsx(N,{type:"text",icon:e.jsx(Rs,{}),onClick:()=>o(r)}),p&&e.jsx(N,{type:"text",danger:!0,icon:e.jsx(Pe,{}),onClick:()=>p(r)}),i==="P"&&e.jsx(N,{type:"text",size:"large",icon:e.jsx(Wt,{}),onClick:()=>s(r)})]})]})}),I(t)]})}),e.jsx(C,{ingredients:l,mixes:g,size:t,type:i})]},t.idNew||r)}Se.locale("he");const qn=Qt("employeeHours/buildMonthData",async({selectedDate:t,employees:r,employeeHours:s},{dispatch:i})=>{const n=Se(t,"YYYY-MM").daysInMonth(),o=Array.from({length:n},(p,l)=>{const g=Se(t,"YYYY-MM").date(l+1),h=g.format("dddd"),I=h==="שישי"||h==="שבת",C=r.map(T=>{const L=s.find(j=>{var y;return((y=j==null?void 0:j.employeeId)==null?void 0:y._id)===(T==null?void 0:T._id)&&Se(j==null?void 0:j.date).isSame(g,"day")});if(!L)return null;const q=!L.startTime||!L.endTime;return{hoursId:L._id,employeeId:T._id,name:T.name,hourlyRate:T.hourlyRate,hoursWorked:L.hoursWorked,hours:{start:L.startTime,end:L.endTime},hasError:q}}).filter(Boolean),R=C.reduce((T,L)=>T+L.hoursWorked,0),S=C.length;return{date:g.format("YYYY-MM-DD"),dayOfWeek:h,status:I&&h==="שישי"?"חצי יום":"יום מלא",isPast:g.isBefore(Se(),"day"),isToday:g.isSame(Se(),"day"),employees:C,totalHours:R,employeesCount:S}});i(Dn(o))}),zt=Ie({name:"employeeHours",initialState:{data:[],selectedDate:Se().startOf("month").format("YYYY-MM")},reducers:{setEmployeeHoursState:(t,r)=>{t.data=r.payload},setSelectedDate:(t,r)=>{t.selectedDate=r.payload},addOrUpdateEmployeeHoursState:(t,r)=>{const s=r.payload,i=t.data.findIndex(n=>n._id===s._id);i!==-1?t.data[i]=s:t.data.unshift(s)},updateEmployeeHoursState:(t,r)=>{const s=r.payload;t.data=t.data.map(i=>i._id===s._id?s:i)},deleteEmployeeHoursState:(t,r)=>{const s=r.payload._id;t.data=t.data.filter(i=>i._id!==s)}}}),{setEmployeeHoursState:Dn,addOrUpdateEmployeeHoursState:Rn,updateEmployeeHoursState:Bn,deleteEmployeeHoursState:Ln,setSelectedDate:On}=zt.actions,Un=zt.reducer,Kt=Ie({name:"products",initialState:[],reducers:{setProductsState:(t,r)=>{const{products:s,ingredientsState:i,mixesState:n,averageHourlyRate:o}=r.payload;return s},addOrUpdateProductState:(t,r)=>{const{newProduct:s,ingredientsState:i,mixesState:n,averageHourlyRate:o}=r.payload,p=s,l=t.findIndex(g=>g._id===s._id);l!==-1?t[l]=p:t.unshift(p)},updateProductState:(t,r)=>{const{updatedProduct:s,ingredientsState:i,mixesState:n,averageHourlyRate:o}=r.payload,p=s;return t.map(l=>l._id===s._id?p:l)},deleteProductState:(t,r)=>{const s=r.payload._id;return t.filter(i=>i._id!==s)}}}),{setProductsState:es,addOrUpdateProductState:xt,updateProductState:al,deleteProductState:Hn}=Kt.actions,Wn=Kt.reducer,Qn=u.forwardRef(({size:t,indexSize:r,getProductById:s,sizes:i,onChange:n,onDelete:o,newSizeId:p,setSelectedUpdateSize:l,setNewSizeId:g,transformValueToForm:h,setActiveTabKey:I,ingredients:C,mixes:R,activeSubTab:S,setActiveSubTab:T,onSubmit:L},q)=>{const[j]=_.useForm(),y=De();u.useImperativeHandle(q,()=>({setFieldsValue:d=>j.setFieldsValue(d),getFieldsValue:()=>j.getFieldsValue(),resetFields:()=>j.resetFields()}));const c=d=>{const m=i[d],w={...m,idNew:Date.now(),_id:void 0,ingredients:m.ingredients.map(E=>({...E,_id:void 0})),mixes:m.mixes.map(E=>({...E,_id:void 0}))},M=[...i];M.splice(d+1,0,w),n(M),I((d+1).toString()),g(w.idNew)},v=()=>{const d=[...i];d[r]={...d[r],edit:!1,ingredients:t.ingredients.filter(m=>m==null?void 0:m._id),mixes:t.mixes.filter(m=>m==null?void 0:m._id)},n(d)},F=d=>{const m=[...i];m[d]={...m[d],edit:!0},n(m),l(d)},x=d=>{const m=i[d];if(m!=null&&m._id)ue.confirm({title:"האם אתה בטוח שברצונך למחוק את הגודל הזה?",content:`המחיקה תסיר לצמיתות את ${m.label}.`,okText:"מחק",okType:"danger",cancelText:"ביטול",onOk:()=>{o(m==null?void 0:m.productId,m._id).then(()=>{const w=[...i];w.splice(d,1),n(w),j.setFieldsValue({...w[d]}),I(Math.max(0,d-1).toString()||"0"),s(m==null?void 0:m.productId).then(M=>{y(xt({newProduct:M}))})}).catch(w=>{console.error("Error deleting size:",w)})}});else{const w=[...i];w.splice(d,1),n(w),j.setFieldsValue({...t}),I(Math.max(0,d-1).toString()||"0"),g(null)}},a=d=>{switch(d){case"weight":return'ק"ג';case"volume":return"ליטר";case"units":return"יחידות";default:return""}};return u.useEffect(()=>{console.log(j.getFieldsValue()),console.log(t)},[j,t]),!(t!=null&&t._id)||t!=null&&t.edit?e.jsx(_,{form:j,initialValues:{...t},children:e.jsx(An,{handleCancelEdit:v,handleRemoveSize:x,newSizeId:p,size:t,indexSize:r,onChange:n,form:j,ingredients:C,mixes:R,setNewSizeId:g,setActiveSubTab:T,activeSubTab:S,sizes:i,getUnitDisplay:a,onSubmit:L})}):e.jsx(Zt,{handleEditSize:F,handleRemoveSize:x,index:r,size:t,ingredients:C,handleDuplicateSize:c,mixes:R})}),{TabPane:Yn}=je,Tt=u.forwardRef(({value:t=[],onChange:r,getProductById:s,setSelectedUpdateSize:i,ingredients:n,activeTabKey:o,setActiveTabKey:p,mixes:l,onSubmit:g,onDelete:h},I)=>{const[C,R]=u.useState(null),[S,T]=u.useState("1"),[L,q]=u.useState(t),j=u.useRef([]),y=v=>({value:v}),c=()=>{var x;const v={idNew:Date.now(),label:`גודל ${t.length+1}`,price:null,preparationTime:null,ingredients:[],mixes:[],edit:!0};(t==null?void 0:t.length)>0&&(v.mixes=t[t.length-1].mixes,v.ingredients=t[t.length-1].ingredients);const F=[...t,v];r(F),(x=j.current[+o])==null||x.setFieldsValue({...v}),R(v.idNew),p(t.length.toString()||"0"),T("1")};return u.useEffect(()=>()=>{T("1")},[]),u.useEffect(()=>{L||q(t)},[t]),e.jsxs(X,{style:{flexDirection:"column"},children:[e.jsx(N,{type:"default",icon:e.jsx(Le,{}),onClick:c,children:"הוסף גודל"}),e.jsx(je,{activeKey:o,onChange:v=>p(v||"0"),tabBarStyle:{direction:"rtl"},style:{margin:"1vw 0"},type:"card",tabPosition:"top",children:t==null?void 0:t.map((v,F)=>e.jsx(Yn,{tab:(v==null?void 0:v.label)||`גודל ${F+1}`,children:e.jsx(Qn,{ref:x=>j.current[F]=x,size:v,indexSize:F,setSelectedUpdateSize:i,sizes:t,onChange:r,onDelete:h,getProductById:s,ingredients:n,transformValueToForm:y,setActiveTabKey:p,setActiveSubTab:T,activeSubTab:S,mixes:l,onSubmit:g,newSizeId:C,setNewSizeId:R})},F.toString()))})]})}),{TabPane:At}=je,$t=u.forwardRef(({value:t=[],sizes:r,onChange:s,ingredients:i,onSubmit:n,onDelete:o},p)=>{const[l,g]=u.useState(null),[h,I]=u.useState("0"),[C]=_.useForm(),R=()=>({value:t}),S=()=>{const j={idNew:Date.now(),label:`וריאציה - ${t.length+1}`,sizeAdjustments:[...r==null?void 0:r.map(c=>({sizeId:c==null?void 0:c._id,label:c==null?void 0:c.label,priceAdjustment:null,preparationTimeAdjustment:null,ingredients:c==null?void 0:c.ingredients,mixes:c==null?void 0:c.mixes,add:[],remove:[],update:[]}))]},y=[...t,j];s(y),C.setFieldsValue({variations:y}),g(j.idNew),I(t.length.toString())},T=j=>{const y=t[j];if(y!=null&&y._id)ue.confirm({title:"האם אתה בטוח שברצונך למחוק את הוריאציה הזו?",content:`המחיקה תסיר לצמיתות את ${y.label}.`,okText:"מחק",okType:"danger",cancelText:"ביטול",onOk:()=>{o(y==null?void 0:y.productId,y._id).then(()=>{const c=[...t];c.splice(j,1),s(c),C.setFieldsValue({sizes:c}),I(Math.max(0,j-1).toString())}).catch(c=>{console.error("Error deleting vatiation:",c)})}});else{const c=[...t];c.splice(j,1),s(c),C.setFieldsValue(R()),I(Math.max(0,j-1).toString()),g(null)}},L=j=>{const y=[...t];y[j]={...y[j],edit:!0},s(y)},q=j=>{switch(j){case"weight":return'ק"ג';case"volume":return"ליטר";case"units":return"יחידות";default:return""}};return e.jsxs(_,{form:C,initialValues:{variations:t},onFinish:(j,y)=>{var c;n({variations:(c=j==null?void 0:j.variations)==null?void 0:c.filter(v=>v)})},children:[!r.length&&e.jsx(Ge,{message:"לא ניתן להוסיף וריאציות",description:"יש להוסיף לפחות גודל אחד לפני שניתן להוסיף וריאציות.",type:"warning",showIcon:!0,style:{marginBottom:"16px"}}),e.jsx(N,{type:"default",icon:e.jsx(Le,{}),disabled:(r==null?void 0:r.length)===0||!r,onClick:S,children:"הוסף וריאציה"}),e.jsx(_.List,{name:["variations","sizeAdjustments"],children:(j,{add:y,remove:c})=>{je,j.map(({key:v,name:F,fieldKey:x})=>{var d;const a=C.getFieldValue(["variations","sizeAdjustments",v]);return e.jsx(At,{tab:(a==null?void 0:a.label)||`גודל ${v+1}`,children:!(a!=null&&a._id)||a!=null&&a.edit?e.jsxs("div",{className:a.idNew===l?"highlight-new":"",style:{border:`1px ${a!=null&&a.idNew?"dashed":"solid #e6e6e6"}`,borderRadius:"8px",padding:"16px",background:"#fafafa",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},children:[e.jsxs(Y,{justify:"space-between",align:"middle",style:{marginBottom:"12px"},children:[e.jsx(_.Item,{name:["variations","sizeAdjustments",v,"_id"],hidden:!0,children:e.jsx(ae,{})}),e.jsx(_.Item,{name:["variations","sizeAdjustments",v,"label"],label:"שם הוריאציה",rules:[{required:!0,message:"חייב למלא שם גודל"}],children:e.jsx(ae,{placeholder:"שם הוריאציה",size:"middle",style:{width:"auto",minWidth:"200px"}})}),e.jsx(N,{type:"text",style:{alignSelf:"flex-start"},danger:!0,icon:e.jsx(Pe,{}),title:"מחק וריאציה",onClick:()=>T(v),children:"מחק וריאציה"})]}),e.jsx(_.List,{name:["variations","sizeAdjustments",v],children:(m,{add:w,remove:M})=>e.jsx(je,{tabBarStyle:{direction:"rtl"},style:{margin:"1vw 0"},type:"card",tabPosition:"top",children:m.map(({key:E,name:k,fieldKey:$})=>{const A=C.getFieldValue(["variations",index,"sizeAdjustments",k]);return e.jsxs(At,{tab:(A==null?void 0:A.label)||`Size ${k}`,children:[e.jsxs(Y,{gutter:[16,16],children:[e.jsx(Z,{span:12,children:e.jsx(_.Item,{name:["variations",index,"price"],label:"תוספת מחיר",rules:[{required:!1,message:"יש למלא מחיר"},{type:"number",min:0,message:"המחיר חייב להיות חיובי"}],children:e.jsx(le,{placeholder:"מחיר",style:{width:"100%"}})})}),e.jsx(Z,{span:12,children:e.jsx(_.Item,{label:"תוספת זמן הכנה (דקות)",name:["sizes",index,"preparationTime"],rules:[{required:!1,message:"חייב לציין זמן הכנה"}],children:e.jsx(le,{placeholder:"זמן הכנה",style:{width:"100%"}})})})]}),e.jsx(ne.Text,{strong:!0,style:{display:"block",marginBottom:"8px"},children:"מרכיבים:"}),e.jsx(_.List,{name:["sizes",index,"ingredients"],children:(D,{add:ee,remove:W})=>e.jsxs(e.Fragment,{children:[e.jsx(N,{type:"dashed",style:{marginBottom:"0.5vw"},onClick:()=>ee({ingredientId:null,quantity:null,unit:null}),children:"הוסף מרכיב"}),e.jsx("div",{style:{maxHeight:"12vw",overflowY:"auto",overflowX:"hidden"},children:D.map(({key:V,name:b,fieldKey:f})=>e.jsxs(Y,{gutter:16,children:[e.jsx(Z,{span:10,children:e.jsx(_.Item,{name:[b,"ingredientId"],fieldKey:[f,"ingredientId"],rules:[{required:!0,message:"בחר רכיב"}],children:e.jsx(oe,{placeholder:"בחר מרכיב",showSearch:!0,filterOption:(P,B)=>{var G;return(G=B==null?void 0:B.label)==null?void 0:G.toLowerCase().includes(P.toLowerCase())},options:i.map(P=>({value:P._id,label:P.name,unit:P==null?void 0:P.unit}))})})}),e.jsx(Z,{span:10,children:e.jsx(_.Item,{name:[b,"quantity"],fieldKey:[f,"quantity"],rules:[{required:!0,message:"הזן כמות"}],children:e.jsx(le,{placeholder:"כמות",addonAfter:q(C.getFieldValue(["sizes",index,"ingredients",b,"unit"])||"")})})}),e.jsx(Z,{span:4,children:e.jsx(N,{type:"text",danger:!0,icon:e.jsx(yt,{}),onClick:()=>W(b)})})]},V))})]})})]},E)})})}),e.jsx(se,{style:{margin:"12px 0"}})]},a.idNew||v):e.jsxs("div",{style:{border:"1px solid #e6e6e6",borderRadius:"8px",padding:"16px",background:"#fafafa",boxShadow:"0 1px 2px rgba(0,0,0,0.05)",marginBottom:"16px"},children:[e.jsx(X,{flex:1,style:{padding:"0em 1em"},justify:"space-between",align:"middle",children:e.jsxs(Z,{className:"width-100",children:[e.jsx(X,{flex:1,style:{marginBottom:"8px"},children:e.jsxs(Y,{className:"width-100",align:"middle",justify:"space-between",children:[e.jsx(ne.Text,{strong:!0,style:{fontSize:"1.2em"},children:size==null?void 0:size.label}),e.jsxs(X,{children:[e.jsx(N,{type:"text",icon:e.jsx(Oe,{}),onClick:()=>L(index)}),e.jsx(N,{type:"text",danger:!0,icon:e.jsx(Pe,{}),onClick:()=>T(index)})]})]})}),e.jsxs(X,{flex:1,align:"middle",style:{gap:"12px",marginBottom:"8px"},children:[e.jsxs(Y,{align:"middle",style:{gap:"8px"},children:[e.jsxs(ne.Text,{style:{color:"#007acc",fontSize:"1.1em",fontWeight:"bold",display:"flex",alignItems:"center",gap:"4px"},children:["₪",size==null?void 0:size.price]}),e.jsx(H,{style:{fontSize:"0.9em",color:"#007acc"},icon:Ns})]}),e.jsxs(Y,{align:"middle",style:{gap:"8px"},children:[e.jsxs(ne.Text,{style:{fontSize:"1.1em",fontWeight:"bold",display:"flex",alignItems:"center",gap:"4px"},children:[size==null?void 0:size.preparationTime," דקות"]}),e.jsx(H,{style:{fontSize:"0.9em"},icon:gt})]})]})]})}),e.jsx(se,{style:{margin:"12px 0"}}),e.jsx(ne.Text,{strong:!0,style:{display:"block",marginBottom:"8px"},children:"מרכיבים:"}),e.jsx("ul",{style:{paddingLeft:"20px",margin:"0"},children:(d=size==null?void 0:size.ingredients)==null?void 0:d.map((m,w)=>{var E;const M=(()=>{switch(m.unit){case"weight":return'ק"ג';case"volume":return"ליטר";case"units":return"יחידות";default:return""}})();return e.jsx("li",{style:{marginBottom:"4px"},children:e.jsxs(ne.Text,{children:[(E=i==null?void 0:i.find(k=>(k==null?void 0:k._id)===(m==null?void 0:m.ingredientId)))==null?void 0:E.name," -"," ",m.quantity," ",M]})},w)})})]},size.idNew||index)},v)})}}),e.jsx(N,{type:"primary",htmlType:"submit",disabled:t.length===0,onClick:()=>g(null),children:"שמור"})]})}),{Title:il,Text:Mt}=ne,{TabPane:Vn}=je,Jn=({})=>{var A;const{isModalVisible:t,setIsModalVisible:r,modalMode:s,setModalMode:i,selectedItem:n,setSelectedItem:o,selectedUpdateSize:p,setSelectedUpdateSize:l,getProductById:g,addProduct:h,updateProduct:I,deleteProduct:C,addSize:R,updateSize:S,deleteSize:T}=Jt(),L=ce({query:"(max-width: 500px)"}),q=te(D=>D.categories),j=(A=te(D=>D.ingredients))==null?void 0:A.filter(D=>D==null?void 0:D.is_active),y=te(D=>D.mixes),c=te(D=>D.products),[v,F]=u.useState("0"),[x,a]=u.useState(!1),d=u.useCallback(()=>{if(!n||!c)return;const D=c.find(ee=>ee._id===n._id);D&&x&&o({...D})},[n,c]);u.useEffect(()=>{d()},[c]);const[m]=_.useForm(),w=(D,ee,W)=>{if(D==="product")switch(ee){case"add":return"הוספת מוצר";case"edit":return"עדכון מוצר";case"view":return"צפייה במוצר";default:return"הוספת מוצר"}else switch(D){case"size":return e.jsxs(e.Fragment,{children:[`ניהול גדלים - ${W==null?void 0:W.name}`,e.jsx(k,{categoriesState:q,categoryId:W==null?void 0:W.category})]});case"variation":return e.jsxs(e.Fragment,{children:[`ניהול וריאציות - ${W==null?void 0:W.name}`,e.jsx(k,{categoriesState:q,categoryId:W==null?void 0:W.category})]})}};u.useEffect(()=>{n?m.setFieldsValue(n):m.resetFields()},[n]);const M=(D,ee)=>{var W,V,b,f;switch(t){case"product":const P=m.getFieldsValue();s==="edit"?I({...P,_id:n==null?void 0:n._id}).then(()=>{r(!1),o(null),a(!0)}).catch(Q=>{console.error("שגיאה בעריכת מוצר:",Q)}):h(P).then(()=>{r(!1),o(null)}).catch(Q=>{console.error("שגיאה בהוספת מוצר:",Q)});break;case"size":const B={...n==null?void 0:n.sizes[ee],...D},G={productId:n==null?void 0:n._id,label:B.label,price:B.price,preparationTime:B.preparationTime,ingredients:((V=(W=B.ingredients)==null?void 0:W.filter(Q=>Q))==null?void 0:V.map(Q=>{var xe;return{ingredientId:((xe=Q.ingredientId)==null?void 0:xe._id)||Q.ingredientId,quantity:Q.quantity,unit:Q.unit}}))||[],mixes:((f=(b=B.mixes)==null?void 0:b.filter(Q=>Q))==null?void 0:f.map(Q=>({mixId:Q.mixId,quantity:Q.quantity,unit:Q.unit})))||[],_id:B._id};return new Promise((Q,xe)=>{G._id?S(G._id,G).then(Q).catch(xe):R(n==null?void 0:n._id,G).then(Q).catch(xe)}).then(()=>{a(!0)}).catch(Q=>{console.error("Error managing sizes:",Q)})}},E=()=>{switch(t){case"product":return e.jsxs(_,{form:m,layout:"vertical",onFinish:M,children:[e.jsx(_.Item,{name:"name",label:"שם מוצר",rules:[{required:!0,message:"אנא הזן שם מוצר"},{max:25,message:"שם המוצר לא יכול להיות יותר מ-25 תווים"}],children:e.jsx(ae,{maxLength:25,showCount:!0})}),e.jsx(_.Item,{name:"category",label:"קטגוריה",rules:[{required:!0,message:"אנא בחר קטגוריה"}],children:e.jsx(oe,{showSearch:!0,placeholder:"בחר קטגוריה",optionFilterProp:"children",filterOption:(D,ee)=>ee.children.toLowerCase().indexOf(D.toLowerCase())>=0,children:q.map(D=>e.jsx(oe.Option,{value:D._id,children:D==null?void 0:D.name},D._id))})}),e.jsx(_.Item,{name:"isFeatured",label:"פעיל",children:e.jsx(dt,{checkedChildren:"פעיל",unCheckedChildren:"לא פעיל"})}),e.jsx(_.Item,{name:"isOnSale",label:"מוצר מכירה",children:e.jsx(dt,{checkedChildren:"פעיל",unCheckedChildren:"לא פעיל"})}),e.jsx(_.Item,{name:"notes",label:"הערות",rules:[{required:!1,message:"אנא הזן הערות"},{max:250,message:"ההערות לא יכולות להיות יותר מ-250 תווים"}],children:e.jsx(ae.TextArea,{rows:4,maxLength:250,showCount:!0})}),e.jsx(_.Item,{children:e.jsx(N,{type:"primary",htmlType:"submit",children:"שמור מוצר"})})]});case"size":return e.jsx(Tt,{value:n==null?void 0:n.sizes,setValue:o,ingredients:j,setSelectedUpdateSize:l,getProductById:g,mixes:y,onDelete:T,activeTabKey:v,setActiveTabKey:F,onSubmit:M,onChange:D=>o({...n,sizes:D})});case"variation":return e.jsx($t,{value:n==null?void 0:n.variations,form:formVariation,setValue:o,sizes:n==null?void 0:n.sizes,ingredients:j,onChange:D=>o({...n,variations:D})});default:return null}},k=({categoryId:D,categoriesState:ee})=>{let W=ee.find(V=>V._id===D);return e.jsxs("div",{className:"flex items-center w-fit gap-1 bg-white py-1 px-2 rounded-lg border border-zinc-200",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-full shadow-sm border border-zinc-200",style:{backgroundColor:W==null?void 0:W.color}}),W==null?void 0:W.name]})},$=()=>{var D,ee;switch(t){case"product":return e.jsxs("div",{styles:{body:{display:"flex",flexDirection:"column"}},children:[e.jsxs(X,{style:{gap:"1em",flexDirection:"column",margin:"1em 0em"},children:[e.jsx(Mt,{strong:!0,style:{fontSize:"1.5em"},children:n==null?void 0:n.name}),e.jsx(k,{categoriesState:q,categoryId:n==null?void 0:n.category}),e.jsxs(X,{style:{gap:"0.5em",flexDirection:"column"},children:[e.jsx(Ee,{status:n!=null&&n.isFeatured?"success":"default",text:n!=null&&n.isFeatured?"פעיל":"לא פעיל"}),e.jsx(Ee,{status:n!=null&&n.isOnSale?"processing":"default",text:n!=null&&n.isOnSale?"במבצע":"לא במבצע"})]})]}),((D=n==null?void 0:n.notes)==null?void 0:D.length)>0&&e.jsxs("div",{style:{marginBottom:"12px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(X,{flex:1,children:e.jsxs(Mt,{strong:!0,children:["הערות",":"]})}),e.jsx(X,{flex:1,children:e.jsx("p",{style:{},children:n==null?void 0:n.notes})})]}),e.jsx(X,{flex:1,children:e.jsx(je,{style:{width:"100%"},type:"card",children:(ee=n==null?void 0:n.sizes)==null?void 0:ee.map((W,V)=>e.jsx(Vn,{tab:W.label,children:e.jsx(Zt,{handleEditSize:!1,handleRemoveSize:!1,index:V,size:W,type:"P",sizeInfo:b=>{r("size"),F((b==null?void 0:b.toString())||"0")},ingredients:j,mixes:y,priceExcludingVAT:(n==null?void 0:n.priceExcludingVAT)&&(n==null?void 0:n.priceExcludingVAT[V].priceExcludingVAT),sizeSummary:(n==null?void 0:n.sizeSummary)&&(n==null?void 0:n.sizeSummary[V])})},V))})})]});case"size":return e.jsx(Tt,{value:n==null?void 0:n.sizes,setValue:o,ingredients:j,setSelectedUpdateSize:l,getProductById:g,mixes:y,onDelete:T,activeTabKey:v,setActiveTabKey:F,onSubmit:M,onChange:W=>o({...n,sizes:W})});case"variation":return e.jsx($t,{value:n==null?void 0:n.variations,mode:"view",ingredients:j,onChange:W=>o({...n,variations:W})});default:return null}};return e.jsx(ue,{style:{top:"3em"},title:w(t,s,n),open:t,onCancel:()=>{r(!1),o()},footer:null,destroyOnClose:!0,height:L?"86vh":"80vh",width:L?"100%":700,styles:{body:{height:"100%"}},children:s==="view"?$():E()})},Gn=({categories:t,isMobile:r,selectedCategory:s,setSelectedCategory:i,setIsCategoryModalVisible:n})=>{const o=u.useRef(null),p=u.useRef({}),l=()=>{o.current.scrollBy({left:200,behavior:"smooth"})},g=()=>{o.current.scrollBy({left:-200,behavior:"smooth"})},h=I=>{i(I),p.current[I]&&p.current[I].scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})};return e.jsx("div",{style:{padding:"16px",backgroundColor:"#f0f2f5"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(N,{icon:e.jsx(Bs,{}),onClick:l}),e.jsxs("div",{ref:o,style:{display:"flex",overflowX:"auto",flexGrow:1,gap:"8px",padding:"8px 0",scrollbarWidth:"none",msOverflowStyle:"none"},children:[e.jsx(N,{type:s==="all"?"primary":"default",onClick:()=>h("all"),children:"הכל"}),t.map(I=>e.jsxs(N,{ref:C=>p.current[I._id]=C,type:s===I._id?"primary":"default",onClick:()=>h(I._id),children:[e.jsx("div",{className:"w-3 h-3 rounded-full shadow-sm border border-zinc-200",style:{backgroundColor:I==null?void 0:I.color}}),I.name]},I._id))]}),e.jsx(N,{icon:e.jsx(Ls,{}),onClick:g}),!r&&e.jsx(N,{type:"primary",icon:e.jsx(Le,{}),onClick:()=>n(!0)})]})})};function Xn(){var M;const{addProduct:t,updateProduct:r,deleteProduct:s,isModalVisible:i,setIsModalVisible:n,modalMode:o,setModalMode:p,selectedItem:l,setSelectedItem:g}=Jt(),h=ce({query:"(max-width: 500px)"});u.useRef(null);const[I,C]=u.useState([]),[R,S]=u.useState([]),[T,L]=u.useState("all"),[q,j]=u.useState(!1),[y,c]=u.useState({}),v=te(E=>E.products),F=te(E=>E.categories),x=(M=te(E=>E.ingredients))==null?void 0:M.filter(E=>E==null?void 0:E.is_active),a=["name","category"],d=["name","category","detailes","sizes","productSummary","actions"],m=[{key:"name",dataIndex:"name",title:"שם",required:!0},{key:"category",dataIndex:"category",title:"קטגוריה"},{key:"profitMargin",dataIndex:"profitMargin",title:"אחוז רווח"}],w=u.useMemo(()=>[{key:"detailes",dataIndex:"actions",width:110,render:(E,k)=>e.jsxs(X,{style:{flexDirection:"column"},children:[e.jsx(Ee,{className:"!text-xs",status:k!=null&&k.isFeatured?"success":"default",text:k!=null&&k.isFeatured?"פעיל":"לא פעיל"}),e.jsx(Ee,{className:"!text-xs",status:k!=null&&k.isOnSale?"processing":"default",text:k!=null&&k.isOnSale?"במבצע":"לא במבצע"})]})},{key:"name",dataIndex:"name",title:"שם המוצר",editable:!0,type:"text",rules:[{required:!0,message:"חייב להיות שם מוצר"},{min:2,message:"שם חייב להיות לפחות 2 תווים"}],render:(E,k)=>e.jsx("p",{className:"text-base font-semibold	",children:k==null?void 0:k.name})},{key:"category",dataIndex:"category",title:"קטגוריה",editable:!0,type:"custom",render:(E,k)=>{let $=F.find(A=>A._id===(k==null?void 0:k.category));return e.jsxs("div",{className:"flex items-center w-fit gap-1 bg-white py-1 px-2 rounded-lg border border-zinc-200",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-full shadow-sm border border-zinc-200",style:{backgroundColor:$==null?void 0:$.color}}),$==null?void 0:$.name]})},options:F.map(E=>({value:E._id,label:E.name})),rules:[{required:!0,message:"יש לבחור קטגוריה"}]},{key:"sizes",title:"גדלים",type:"custom",editable:!0,render:(E,k,$="view",A)=>{var D;return(D=k==null?void 0:k.sizes)==null?void 0:D.length}},{key:"variations",title:"ווריאציות",type:"custom",editable:!0,render:(E,k,$="view",A)=>{var D;return(D=k==null?void 0:k.variations)==null?void 0:D.length}},{key:"productSummary",dataIndex:"productSummary",title:"רווח (ממוצע לפי מחיר לצרכן)",width:150,render:(E,k)=>{var $,A;return`${(($=k==null?void 0:k.productSummary)==null?void 0:$.averageProfitMarginInput)||0}% ₪${((A=k==null?void 0:k.productSummary)==null?void 0:A.totalGrossProfitInput)||0}`}},{key:"productSummary",dataIndex:"productSummary",title:"רווח (ממוצע לפי מחיר מומלץ)",width:150,render:(E,k)=>{var $,A;return`${(($=k==null?void 0:k.productSummary)==null?void 0:$.averageProfitMarginSuggested)||0}% ₪${((A=k==null?void 0:k.productSummary)==null?void 0:A.totalGrossProfitSuggested)||0}`}},{key:"actions",dataIndex:"actions",width:200,render:(E,k)=>e.jsx("div",{className:"",style:{display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs(N,{type:"text",onClick:()=>{n("size"),g(k)},children:[e.jsx("p",{children:"גדלים"}),e.jsx(H,{icon:Ye})]})})}],[F]);return F==null||F.map(E=>({label:E.name,value:E._id})),u.useEffect(()=>{const E=JSON.parse(localStorage.getItem("filtersMenu")||"{}");c(E)},[]),u.useEffect(()=>{if(v){const E=T&&T!=="all"?v.filter(k=>k.category===T):v;C(E),S(E)}},[v,T]),e.jsxs("div",{style:{display:"flex",flexDirection:"column",maxWidth:"100%",height:"100%",width:"100%",overflow:"hidden","- webkit - overflow - scrolling":"touch"},children:[e.jsx(Gn,{categories:F,isMobile:h,selectedCategory:T,setIsCategoryModalVisible:j,setSelectedCategory:L}),e.jsx(X,{flex:1,children:e.jsx(Ze,{title:"תפריט",type:"P",data:I,mobileKeys:d,dataPrint:R,sortKeys:m,tableKeys:w,newTitle:"הוסף מוצר חדש",searchKeys:a,setDataPrint:S,onAdd:t,onEdit:r,onDelete:s,ingredientsArr:x,Dtitle:"אישור מחיקה",Dcontent:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"האם אתה בטוח שברצונך למחוק את המוצר?"}),e.jsx("p",{children:"שים לב! מחיקת מוצר עשויה להשפיע על מכירות ותערובות קשורות."})]}),iconADD:e.jsx(H,{icon:Ve}),floatAction:[e.jsx(ot,{type:"primary",onClick:()=>j(!0),icon:e.jsx(H,{icon:Ye})})],openModalProduct:(E,k)=>{n("product"),p(E),k&&g(k)}})}),e.jsx(En,{isCategoryModalVisible:q,setIsCategoryModalVisible:j}),e.jsx(Jn,{})]})}const Ke="https://menu-server-c2b952e2c698.herokuapp.com/api",Zn=t=>z.post(`${Ke}/suppliers`,t),zn=t=>{const r=encodeURIComponent(t._id);return z.put(`${Ke}/suppliers/${r}`,t)},Kn=t=>z.delete(`${Ke}/suppliers/${t}`),er=()=>z.get(`${Ke}/suppliers`),ts=u.createContext(),tr=()=>u.useContext(ts),sr=({children:t})=>{const[r,s]=u.useState(!1),i=async p=>{s(!0);try{await Zn(p),O.success("הספק נוסף בהצלחה"),s(!1)}catch(l){console.error("Error adding supplier:",l),O.error("שגיאה בהוספת הספק"),s(!1)}},n=async p=>{s(!0);try{await zn(p),O.success("הספק עודכן בהצלחה"),s(!1)}catch(l){console.error("Error updating supplier:",l),O.error("שגיאה בעדכון הספק"),s(!1)}},o=async p=>{s(!0);try{await Kn(p),O.success("הספק נמחק בהצלחה"),s(!1)}catch(l){console.error("Error deleting supplier:",l),O.error("שגיאה במחיקת הספק"),s(!1)}};return e.jsx(ts.Provider,{value:{addSupplier:i,updateSupplier:n,deleteSupplier:o,loading:r},children:t})};function nr(){const{addSupplier:t,updateSupplier:r,deleteSupplier:s}=tr(),i=te(j=>j.suppliers),n=te(j=>j.ingredients),[o,p]=u.useState([]),[l,g]=u.useState([]),[h,I]=u.useState({}),C=["name"],R=["name","phone","email","contact_name","address",,"second_phone","notes"],S=[{key:"name",dataIndex:"name",title:"שם",required:!0},{key:"usedCount",dataIndex:"usedCount",title:"כמות רכיבים"}],T=[{key:"name",dataIndex:"name",title:"שם הספק",editable:!0,type:"text",width:100,rules:[{required:!0,message:"חייב להיות שם ספק"},{min:3,message:"שם ספק חייב להיות לפחות 3 תווים"}]},{key:"usedCount",dataIndex:"usedCount",title:"כמות רכיבים",editable:!1},{key:"phone",dataIndex:"phone",title:"טלפון",editable:!0,type:"text",width:100,rules:[{required:!0,message:"חייב להיות מספר טלפון"},{pattern:/^[0-9]{9,10}$/,message:"טלפון חייב להיות מספר תקין באורך 9-10 ספרות"}]},{key:"email",dataIndex:"email",title:"אימייל",editable:!0,type:"text",width:100,rules:[{required:!0,message:"חייב להיות אימייל"},{type:"email",message:"אימייל לא תקין"}]},{key:"contact_name",dataIndex:"contact_name",title:"איש קשר",editable:!0,type:"text",width:100,rules:[{required:!0,message:"חייב להיות איש קשר"},{min:3,message:"איש קשר חייב להיות לפחות 3 תווים"}]},{key:"address",dataIndex:"address",title:"כתובת",editable:!0,type:"text",width:150,rules:[{required:!0,message:"חייבת להיות כתובת"},{min:5,message:"כתובת חייבת להיות לפחות 5 תווים"}]},{key:"second_phone",dataIndex:"second_phone",title:"טלפון נוסף",editable:!0,type:"text",width:100,rules:[{pattern:/^[0-9]{9,10}$/,message:"טלפון חייב להיות מספר תקין באורך 9-10 ספרות"}]},{key:"notes",dataIndex:"notes",title:"הערות",editable:!0,type:"textArea",maxLength:120,width:150,rules:[{required:!1},{max:120,message:"מקסימום 120 תווים"}],render:(j,y)=>{const c=(y==null?void 0:y.notes)||"—";return e.jsx(Je,{title:c,children:e.jsx("span",{style:{display:"inline-block",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",maxWidth:"150px"},children:c})})}}],L=[{name:"רשימת ספקים",value:"name",type:"select",options:i.map(j=>({label:j.name,value:j.name}))},{name:"סטטוס רכיבים",value:"usedCount",type:"slider",min:0,max:Math.max(...o.map(j=>j.usedCount||0))}];u.useEffect(()=>{if(i){const j=i.map(y=>{const c=n==null?void 0:n.filter(v=>v.supplierId===y._id).length;return{...y,usedCount:c}});p(j),g(j)}},[i,n]),u.useEffect(()=>{const j=JSON.parse(localStorage.getItem("filtersSuppliers")||"{}");I(j)},[]);const q=j=>{I(j),localStorage.setItem("filtersSuppliers",JSON.stringify(j))};return e.jsx(Ze,{title:"ספקים",titleView:"ספק",data:o,mobileKeys:R,dataPrint:l,sortKeys:S,tableKeys:T,newTitle:"הוסף ספק חדש",searchKeys:C,setDataPrint:g,onAdd:t,onEdit:r,onDelete:s,Dtitle:"אישור מחיקה",filters:h,saveFilters:q,filtersArr:L,iconADD:e.jsx(H,{icon:Xe}),Dcontent:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"האם אתה בטוח שברצונך למחוק את הספק?"}),e.jsx("p",{children:"שים לב! במחיקת ספק אתה תמחוק את כל הרכיבים שלו וכן הם כמובן ימחקו מכל התערובות והמוצרים."})]})})}const et="https://menu-server-c2b952e2c698.herokuapp.com/api",rr=t=>z.post(`${et}/ingredients`,t),ar=t=>{const r=encodeURIComponent(t._id);return z.put(`${et}/ingredients/${r}`,t)},ir=t=>z.delete(`${et}/ingredients/${t}`),lr=()=>z.get(`${et}/ingredients`),ss=u.createContext(),or=()=>u.useContext(ss),dr=({children:t})=>{const[r,s]=u.useState(!1),i=async p=>{s(!0);try{await rr(p),O.success("החומר גלם נוסף בהצלחה"),s(!1)}catch{O.error("שגיאה בהוספת חומר הגלם"),s(!1)}},n=async p=>{s(!0);const l=["unitQuantity","unitDescription","unitPrice","processedPrice"],g=Object.keys(p).filter(h=>!l.includes(h)).reduce((h,I)=>(h[I]=p[I],h),{});try{await ar(g),O.success("החומר גלם עודכן בהצלחה")}catch{O.error("שגיאה בעדכון חומר הגלם")}finally{s(!1)}},o=async p=>{s(!0);try{await ir(p),O.success("החומר גלם נמחק בהצלחה"),s(!1)}catch{O.error("שגיאה במחיקת חומר הגלם"),s(!1)}};return e.jsx(ss.Provider,{value:{addIngredient:i,updateIngredient:n,deleteIngredient:o,loading:r},children:t})},Ue="https://menu-server-c2b952e2c698.herokuapp.com/api",cr=()=>z.get(`${Ue}/settings`),ur=t=>z.put(`${Ue}/settings`,{settings:t}),xr=t=>z.post(`${Ue}/settings/categories`,t),pr=(t,r)=>z.put(`${Ue}/settings/categories/${t}`,r),mr=t=>z.delete(`${Ue}/settings/categories/${t}`),ns=Ie({name:"settings",initialState:{settings:null,loading:!1},reducers:{setSettings:(t,r)=>{t.settings=r.payload},updateSettingValue:(t,r)=>{const{key:s,value:i}=r.payload;t.settings&&t.settings[s]&&(t.settings[s].value=i,t.settings[s].lastUpdated=new Date().toISOString())},addCategory:(t,r)=>{const s=r.payload;t.settings&&t.settings.materialCategories&&(t.settings.materialCategories.value.push(s),t.settings.materialCategories.lastUpdated=new Date().toISOString())},updateCategory:(t,r)=>{const s=r.payload;if(t.settings&&t.settings.materialCategories){const i=t.settings.materialCategories.value.findIndex(n=>n._id===s._id);i!==-1&&(t.settings.materialCategories.value[i]=s,t.settings.materialCategories.lastUpdated=new Date().toISOString())}},deleteCategory:(t,r)=>{const s=r.payload;t.settings&&t.settings.materialCategories&&(t.settings.materialCategories.value=t.settings.materialCategories.value.filter(i=>i._id!==s),t.settings.materialCategories.lastUpdated=new Date().toISOString())},setLoading:(t,r)=>{t.loading=r.payload}}}),{setSettings:hr,updateSettingValue:ll,addCategory:gr,updateCategory:jr,deleteCategory:yr,setLoading:we}=ns.actions,fr=ns.reducer,rs=u.createContext(),as=()=>u.useContext(rs),vr=({children:t})=>{const r=De(),{settings:s,loading:i}=te(h=>h.settings),n=async()=>{r(we(!0));try{const{data:h}=await cr();r(hr(h))}catch(h){console.error("Error fetching settings:",h)}finally{r(we(!1))}},o=async h=>{var I;r(we(!0));try{await ur(h);const[C]=await Promise.all([Yt()]);r(es({products:(I=C.data)==null?void 0:I.reverse()})),O.success("הגדרות נשמרו בהצלחה"),r(we(!1))}catch{O.error("שגיאה בשמירת ההגדרות"),r(we(!1))}},p=async h=>{r(we(!0));try{const{data:I}=await xr(h);r(gr(I)),O.success("הקטגוריה נוספה בהצלחה")}catch(I){console.error("Error adding category:",I),O.error("שגיאה בהוספת הקטגוריה")}finally{r(we(!1))}},l=async(h,I)=>{r(we(!0));try{await pr(h,I),r(jr(I)),O.success("הקטגוריה עודכנה בהצלחה")}catch(C){console.error("Error updating category:",C),O.error("שגיאה בעדכון הקטגוריה")}finally{r(we(!1))}},g=async h=>{r(we(!0));try{await mr(h),r(yr(h)),O.success("הקטגוריה נמחקה בהצלחה")}catch(I){console.error("Error deleting category:",I),O.error("שגיאה במחיקת הקטגוריה")}finally{r(we(!1))}};return u.useEffect(()=>{n()},[]),e.jsx(rs.Provider,{value:{settings:s,loading:i,fetchSettings:n,updateSetting:o,addCategoryContext:p,updateCategoryContext:l,deleteCategoryContext:g},children:t})},{Text:wr}=ne;function br(){var F;const{settings:t}=as(),r=u.useMemo(()=>{var x,a;return((a=(x=t==null?void 0:t.materialCategories)==null?void 0:x.value)==null?void 0:a.map(d=>({value:d==null?void 0:d._id,label:d==null?void 0:d.name,color:(d==null?void 0:d.color)||"blue"})))||[]},[(F=t==null?void 0:t.materialCategories)==null?void 0:F.value]),s=te(x=>x.suppliers),i=te(x=>x.ingredients),n=te(x=>x.products),o=te(x=>x.mixes),{addIngredient:p,updateIngredient:l,deleteIngredient:g}=or(),[h,I]=u.useState([]),[C,R]=u.useState([]),[S,T]=u.useState({});u.useState(!1);const L=["name","type","supplierId"],q=["unit","unitPrice","supplierId","usedInMixes","usedInProducts"],j=[{key:"name",dataIndex:"name",title:"שם",required:!0},{key:"type",dataIndex:"type",title:"סוג"},{key:"usedCount",dataIndex:"usedCount",title:"בשימוש"},{key:"unit",dataIndex:"unit",title:"יחידת מידה"},{key:"supplierName",dataIndex:"supplierName",title:"שם ספק"}],y=[{key:"SKU",dataIndex:"SKU",title:'מק"ט',editable:!0,type:"number",width:100,group:1,rules:[{validator:async(x,a,d)=>a?typeof a!="number"?Promise.reject('מק"ט חייב להיות מספר תקין'):a.toString().length===0?Promise.reject('מק"ט חייב להיות מינימום תו אחד '):h.some(w=>w.SKU===a&&w._id!==(d==null?void 0:d._id))?Promise.reject('מק"ט זה כבר קיים במערכת'):Promise.resolve():Promise.resolve()}]},{key:"name",dataIndex:"name",title:"שם",required:!0,editable:!0,group:1,type:"text",width:200,minWidth:200,rules:[{required:!0,message:"השדה חובה"},{min:3,message:"השם חייב להיות לפחות 3 תווים"},{pattern:/^[א-תa-zA-Z\s0-9%-]+$/,message:"השם יכול להכיל אותיות בעברית או אנגלית, מספרים והתווים הבאים: ' % ', ' - '"}]},{key:"supplierId",dataIndex:"supplierId",title:"שם ספק",editable:!0,group:1,type:"select",required:!0,width:100,render:(x,a,d)=>{var m;return e.jsxs(Y,{align:"middle",style:{gap:5},children:[d==="view"&&e.jsx(H,{icon:Xe})," ",(m=s==null?void 0:s.find(w=>(w==null?void 0:w._id)===(a==null?void 0:a.supplierId)))==null?void 0:m.name]})},options:s==null?void 0:s.map(x=>({value:x._id,label:x==null?void 0:x.name})),rules:[{required:!0,message:"יש לבחור ספק"},{validator:(x,a)=>(s==null?void 0:s.some(m=>m._id===a))?Promise.resolve():Promise.reject("ספק לא חוקי נבחר")}]},{key:"usedCount",dataIndex:"usedCount",title:"בשימוש",editable:!1,width:100},{key:"is_active",dataIndex:"is_active",title:"פעיל",editable:!0,group:1,type:"custom",render:(x,a,d,m)=>d==="edit"?e.jsx(e.Fragment,{children:e.jsx(_.Item,{name:"is_active",label:"פעיל",children:e.jsx(dt,{checkedChildren:"פעיל",unCheckedChildren:"לא פעיל"})},"is_active")}):e.jsx(Ee,{status:a!=null&&a.is_active?"success":"error",text:a!=null&&a.is_active?"פעיל":"לא פעיל"}),minWidth:120,width:120},{key:"type",dataIndex:"type",title:"סוג",render:(x,a)=>{const d=r.find(m=>m.value===(a==null?void 0:a.type));return e.jsx(ht,{color:d==null?void 0:d.color,children:d==null?void 0:d.label})},type:"select",required:!0,editable:!0,group:2,options:r,divider:!0,width:100,rules:[{required:!0,message:"יש לבחור סוג"},{validator:(x,a)=>(r==null?void 0:r.some(m=>m.value===a))?Promise.resolve():Promise.reject("סוג לא חוקי נבחר")}]},{key:"unit",dataIndex:"unit",title:"יחידת מידה",editable:!0,group:2,type:"select",options:Ce,width:100,render:(x,a)=>{var d;return e.jsx("p",{children:((d=Ce.find(m=>m.value===(a==null?void 0:a.unit)))==null?void 0:d.label)||(a==null?void 0:a.unit)})},rules:[{required:!0,message:"יש לבחור יחידת מידה"},{validator:(x,a)=>(Ce==null?void 0:Ce.some(m=>m.value===a))?Promise.resolve():Promise.reject("יחידת מידה לא חוקית")}]},{key:"quantity",dataIndex:"quantity",title:"כמות",editable:!0,group:2,type:"custom",width:100,render:(x,a,d,m)=>{if(d=="edit")return e.jsx(_.Item,{shouldUpdate:(E,k)=>E.subUnit!==k.subUnit,children:({getFieldValue:E})=>e.jsx(_.Item,{name:"quantity",label:"כמות",rules:[{required:!0,message:"אנא הזן כמות"},{validator:(k,$)=>$==null?Promise.reject("כמות נדרשת"):$<0?Promise.reject("הכמות לא יכולה להיות שלילית"):(E("subUnit")==="g"||E("subUnit")==="ml")&&($<.001||$>999)?Promise.reject('עבור גרם או מ"ל הכמות חייבת להיות בין 0.001 ל-999'):(E("subUnit")==="kg"||E("subUnit")==="liter")&&($<1||$>1e6)?Promise.reject('עבור ק"ג או ליטר הכמות חייבת להיות מ-1 ומעלה, ובתוך הטווח המותר'):Promise.resolve()}],children:e.jsx(le,{style:{width:"100%"}})},"quantity")});let w=a.unit,M="";return w==="weight"?M=a.quantity>=1?'ק"ג':"גרם":w==="volume"?M=a.quantity>=1?"ליטר":'מ"ל':w==="units"&&(M="יחידות"),e.jsxs("p",{children:[a.quantity<1?a.quantity*1e3:a.quantity," ",M]})}},{key:"price",dataIndex:"price",title:"מחיר כולל מעמ",editable:!0,group:2,type:"price",width:100,show:!1,divider:!0,render:(x,a,d,m)=>{var w;if(d!=="edit")return e.jsxs("p",{children:["₪",(w=a==null?void 0:a.price)==null?void 0:w.toFixed(2)]})}},{key:"priceExcludingVAT",dataIndex:"priceExcludingVAT",width:100,title:"מחיר ללא מעמ",render:(x,a)=>e.jsxs("p",{children:["₪",a==null?void 0:a.priceExcludingVAT]}),editable:!1,hiddenInForm:!0},{key:"unitPrice",dataIndex:"unitPrice",title:"כמות מינימלית",width:100,render:(x,a)=>e.jsxs(Z,{children:[e.jsxs(Y,{children:[e.jsxs("p",{children:[a.unitQuantity<1?a.unitQuantity*1e3:a.unitQuantity," ",a==null?void 0:a.unitDescription]}),e.jsx("br",{})]}),e.jsxs("p",{children:["₪",a==null?void 0:a.unitPrice]})]})},{key:"juiceRatio",dataIndex:"juiceRatio",title:"יחס עיבוד (תפוקת חומר מעובד)",editable:!0,group:2,width:100,type:"custom",render:(x,a,d,m)=>d=="view"||d!=="edit"?e.jsx("p",{children:a!=null&&a.juiceRatio?`${((a==null?void 0:a.juiceRatio)*100).toFixed(0)}%`:""}):e.jsxs(e.Fragment,{children:[e.jsx(_.Item,{name:"isJuice",valuePropName:"checked",style:{marginBottom:0},children:e.jsx(Me,{onChange:w=>{m.setFieldsValue({isJuice:w.target.checked}),w.target.checked||m.setFieldsValue({juiceRatio:void 0})},children:"האם הרכיב דורש עיבוד?"})}),e.jsx(_.Item,{noStyle:!0,shouldUpdate:(w,M)=>w.isJuice!==M.isJuice,children:({getFieldValue:w})=>w("isJuice")&&e.jsx(_.Item,{name:"juiceRatio",label:"יחס המיץ (0.1 עד 0.99)",rules:[{required:!0,message:"אנא הזן יחס מיץ"},{type:"number",min:.1,max:.99,message:"היחס חייב להיות בין 0.1 ל-0.99"}],children:e.jsx(le,{style:{width:"100%"}})})})]})},{key:"processedPrice",dataIndex:"processedPrice",title:"מחיר לכמות מינימלית מעובדת",width:100,render:(x,a)=>e.jsx("p",{children:a!=null&&a.processedPrice?`₪${a==null?void 0:a.processedPrice}`:""}),editable:!1,hiddenInForm:!0},{key:"notes",dataIndex:"notes",title:"הערות",width:100,editable:!0,group:1,render:(x,a)=>{const d=(a==null?void 0:a.notes)||"—";return e.jsx(Je,{title:d,children:e.jsx(wr,{style:{display:"inline-block",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",maxWidth:"150px",direction:"rtl"},children:d})})},type:"textArea",maxLength:120,rules:[{required:!1},{max:120,message:"מקסימום 120 תווים"}]}],c=[{name:"סוג",value:"type",options:r},{name:"ספק",value:"supplierId",options:s.map(x=>({label:x.name,value:x._id}))},{name:"סטטוס",value:"is_active",options:[{label:"פעיל",value:!0},{label:"לא פעיל",value:!1}]}];u.useEffect(()=>{if(i)if(s){let x=[...i==null?void 0:i.map(a=>{let d=s==null?void 0:s.find(M=>(M==null?void 0:M._id)===(a==null?void 0:a.supplierId));const m=(n==null?void 0:n.reduce((M,E)=>{var k;return M+((k=E.ingredients)==null?void 0:k.filter($=>$.ingredientId===a._id).length)},0))||0,w=(o==null?void 0:o.reduce((M,E)=>{var k;return M+((k=E.ingredients)==null?void 0:k.filter($=>$.ingredientId===a._id).length)},0))||0;return{...a,supplierName:d==null?void 0:d.name,usedCount:m+w}})];I(x),R(x)}else I([...i]),R([...i])},[s,i]),u.useEffect(()=>{const x=JSON.parse(localStorage.getItem("filtersIngredients")||"{}");T(x)},[]);const v=x=>{T(x),localStorage.setItem("filtersIngredients",JSON.stringify(x))};return e.jsx(e.Fragment,{children:e.jsx(Ze,{title:"חומרי גלם",titleView:"חומר גלם",type:"ingredient",data:h,groups:!0,mobileKeys:q,dataPrint:C,sortKeys:j,tableKeys:y,newTitle:"הוסף חומר גלם חדש",searchKeys:L,setDataPrint:R,onAdd:p,onEdit:l,onDelete:g,Dtitle:"אישור מחיקה",filters:S,saveFilters:v,filtersArr:c,iconADD:e.jsx(H,{icon:qe}),Dcontent:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"האם אתה בטוח שברצונך למחוק את הרכיב?"}),e.jsx("p",{children:"שים לב! הרכיב יימחק מכל המוצרים והתערובות בהם הוא נמצא."})]})})})}Vs.register(Js,Gs,Xs,Zs,zs,Ks);const{Text:Cr}=ne,Sr=["#4E79A7","#F28E2B","#E15759","#76B7B2","#59A14F"];function Ir(){const t=te(S=>S.categories),r=te(S=>S.products),s=te(S=>S.suppliers),i=te(S=>S.ingredients),n=te(S=>S.mixes),o=te(S=>S.employees),p=ce({query:"(max-width: 500px)"}),l=u.useMemo(()=>{const S=r.reduce((T,L)=>{var j;const q=((j=t.find(y=>y._id===L.category))==null?void 0:j.name)||"לא מוגדר";return T[q]=(T[q]||0)+1,T},{});return{labels:Object.keys(S),datasets:[{data:Object.values(S),backgroundColor:Sr}]}},[r,t]),g=u.useMemo(()=>[...i].sort((S,T)=>(T.unitPrice||0)-(S.unitPrice||0)).slice(0,5).map(S=>({name:S.name,price:S.unitPrice})),[i]),h=u.useMemo(()=>[...n].map(S=>{const T=S.totalCost/S.totalWeight;return{name:S.name,costPerLiter:T}}).sort((S,T)=>(T.costPerLiter||0)-(S.costPerLiter||0)).slice(0,5),[n]),I={labels:g.map(S=>S.name),datasets:[{label:"מחיר ל-100 גרם",data:g.map(S=>S.price),backgroundColor:"#FF8042"}]},C={labels:h.map(S=>S.name),datasets:[{label:"עלות לליטר",data:h.map(S=>S.costPerLiter),backgroundColor:"#8884d8"}]},R=u.useMemo(()=>r.filter(S=>S.profitMargin<=90).slice(0,3).map(S=>({key:S._id,name:S.name,profitMargin:S.profitMargin})),[r]);return e.jsxs("div",{className:"dashboard-container",style:{padding:p?"10px":"20px"},children:[e.jsxs(Y,{gutter:[5,5],wrap:!0,children:[e.jsx(Z,{xs:12,sm:12,md:10,lg:8,xl:6,children:e.jsx(he,{to:"/menu",children:e.jsxs(de,{className:"dashboard-card",children:[e.jsx("div",{className:"icon-circle green",children:e.jsx(H,{icon:Ve})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-title",children:"מוצרים"}),e.jsx("div",{className:"stat-value",children:r.length})]})]})})}),e.jsx(Z,{xs:12,sm:12,md:10,lg:8,xl:6,children:e.jsx(he,{to:"/suppliers",children:e.jsxs(de,{className:"dashboard-card",children:[e.jsx("div",{className:"icon-circle red",children:e.jsx(H,{icon:Xe})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-title",children:"ספקים"}),e.jsx("div",{className:"stat-value",children:s.length})]})]})})}),e.jsx(Z,{xs:12,sm:12,md:10,lg:8,xl:6,children:e.jsx(he,{to:"/ingredients",children:e.jsxs(de,{className:"dashboard-card",children:[e.jsx("div",{className:"icon-circle blue",children:e.jsx(H,{icon:qe})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-title",children:"חומרי גלם"}),e.jsx("div",{className:"stat-value",children:i.length})]})]})})}),e.jsx(Z,{xs:12,sm:12,md:10,lg:8,xl:6,children:e.jsx(he,{to:"/menu",children:e.jsxs(de,{className:"dashboard-card",children:[e.jsx("div",{className:"icon-circle yellow",children:e.jsx(H,{icon:Ye})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-title",children:"קטגוריות"}),e.jsx("div",{className:"stat-value",children:t.length})]})]})})}),e.jsx(Z,{xs:12,sm:12,md:10,lg:8,xl:6,children:e.jsx(he,{to:"/mixes",children:e.jsxs(de,{className:"dashboard-card",children:[e.jsx("div",{className:"icon-circle purple",children:e.jsx(H,{icon:rt})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-title",children:"תערובות"}),e.jsx("div",{className:"stat-value",children:n.length})]})]})})}),e.jsx(Z,{xs:12,sm:12,md:10,lg:8,xl:6,children:e.jsx(he,{to:"/employees",children:e.jsxs(de,{className:"dashboard-card",children:[e.jsx("div",{className:"icon-circle aqua",children:e.jsx(H,{icon:rt})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-title",children:"עובדים"}),e.jsx("div",{className:"stat-value",children:o==null?void 0:o.length})]})]})})})]}),e.jsx(se,{className:"no-margin"}),e.jsxs(Y,{gutter:[16,16],children:[e.jsx(Z,{xs:24,md:12,children:e.jsx(de,{className:"dashboard-card",title:e.jsxs("span",{children:[e.jsx(H,{icon:Ye,style:{marginLeft:"8px"}}),"מוצרים לפי קטגוריה"]}),children:e.jsx(Ys,{data:l,options:{responsive:!0,maintainAspectRatio:!1}})})}),e.jsx(Z,{xs:24,md:12,children:e.jsx(de,{className:"dashboard-card",title:e.jsxs("span",{children:[e.jsx(H,{icon:qe,style:{marginLeft:"8px"}}),"חומרי הגלם היקרים ביותר"]}),children:e.jsx(It,{data:I,options:{responsive:!0,maintainAspectRatio:!1}})})})]}),e.jsx(se,{className:"no-margin"}),e.jsxs(Y,{gutter:[16,16],children:[e.jsx(Z,{xs:24,md:12,children:e.jsx(de,{className:"dashboard-card",title:e.jsxs("span",{children:[e.jsx(H,{icon:rt,style:{marginLeft:"8px"}}),"התערובות היקרות ביותר"]}),children:e.jsx(It,{data:C,options:{responsive:!0,maintainAspectRatio:!1}})})}),e.jsx(Z,{xs:24,md:12,children:e.jsx(de,{className:"dashboard-card",title:e.jsxs("span",{children:[e.jsx(H,{icon:Ve,style:{marginLeft:"8px"}}),"מוצרים עם רווחיות נמוכה"]}),children:e.jsx(Y,{gutter:[16,16],children:R.map(S=>e.jsx(Z,{xs:24,sm:8,children:e.jsxs(de,{children:[e.jsx(Qe,{title:S.name,value:S.profitMargin,suffix:"%",valueStyle:{color:"#cf1322"}}),e.jsx(Cr,{type:"secondary",children:"רווחיות"})]})},S.key))})})})]})]})}const tt="https://menu-server-c2b952e2c698.herokuapp.com/api",Fr=t=>z.post(`${tt}/mixes`,t),kr=t=>{const r=encodeURIComponent(t._id);return z.put(`${tt}/mixes/${r}`,t)},Pr=t=>z.delete(`${tt}/mixes/${t}`),Nr=()=>z.get(`${tt}/mixes`),is=u.createContext(),Er=()=>u.useContext(is),_r=({children:t})=>{const[r,s]=u.useState(!1),i=async p=>{s(!0);try{await Fr(p),O.success("התערובת נוספה בהצלחה"),s(!1)}catch(l){console.error("Error adding mix:",l),O.error("שגיאה בהוספת התערובת"),s(!1)}},n=async p=>{s(!0);try{await kr(p),O.success("התערובת עודכנה בהצלחה"),s(!1)}catch(l){console.error("Error updating mix:",l),O.error("שגיאה בעדכון התערובת"),s(!1)}},o=async p=>{s(!0);try{await Pr(p),O.success("התערובת נמחקה בהצלחה"),s(!1)}catch(l){console.error("Error deleting mix:",l),O.error("שגיאה במחיקת התערובת"),s(!1)}};return e.jsx(is.Provider,{value:{addMix:i,updateMix:n,deleteMix:o,loading:r},children:t})};function Tr(){var j;const{addMix:t,updateMix:r,deleteMix:s}=Er(),[i,n]=u.useState([]),[o,p]=u.useState([]),[l,g]=u.useState({}),h=te(y=>y.mixes),I=(j=te(y=>y.ingredients))==null?void 0:j.filter(y=>y.is_active);te(y=>y.products);const C=te(y=>{var c,v;return(v=(c=y.settings.settings)==null?void 0:c.hourlyRate)==null?void 0:v.value}),R=({ingredients:y})=>{const[v,F]=u.useState(!1),x=y.slice(0,2);return y.slice(2).map((d,m)=>e.jsx("div",{style:{marginBottom:"5px"},children:`${d==null?void 0:d.name} (${d.quantity} ${d.unit}) - ₪${d==null?void 0:d.costForQuantity}`},m)),e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"5px",alignItems:"center"},children:[e.jsx("span",{style:{color:"blue",cursor:"pointer",fontWeight:"bold",marginLeft:"5px"},onClick:()=>F(!0),children:e.jsx(Os,{style:{fontSize:"16px",color:"#000"}})}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"5px",maxWidth:"400px"},children:x.map((d,m)=>e.jsx("span",{style:{backgroundColor:"#f0f0f0",borderRadius:"8px",padding:"5px 10px",fontSize:"0.7vw"},children:`${d==null?void 0:d.name} (${d.quantity} ${d.unit}) - ₪${d==null?void 0:d.costForQuantity}`},m))}),e.jsx(ue,{title:"רשימת מרכיבים",open:v,onCancel:()=>F(!1),footer:[e.jsx(N,{onClick:()=>F(!1),children:"סגור"},"close")],children:y.map((d,m)=>e.jsx("div",{style:{backgroundColor:"#f0f0f0",borderRadius:"8px",padding:"5px 10px",width:"fit-content",fontSize:"0.7vw",marginBottom:".5vw"},children:`${d==null?void 0:d.name} (${d.quantity} ${d.unit}) - ₪${d==null?void 0:d.costForQuantity}`},m))})]})},S=["name","ingredients"],T=["name","preparationTime","totalCost","totalWeight","usedCount"],L=[{key:"name",dataIndex:"name",title:"שם",required:!0},{key:"preparationTime",dataIndex:"preparationTime",title:"זמן הכנה"},{key:"totalCost",dataIndex:"totalCost",title:"עלות כוללת"},{key:"totalWeight",dataIndex:"totalWeight",title:"משקל כולל"},{key:"usedCount",dataIndex:"usedCount",title:"בשימוש"}],q=[{key:"name",dataIndex:"name",title:"שם התערובת",editable:!0,type:"text",minWidth:100,rules:[{required:!0,message:"חייב להיות שם תערובת"},{min:3,message:"שם חייב להיות לפחות 3 תווים"}]},{key:"usedCount",dataIndex:"usedCount",title:"בשימוש",editable:!1,width:100},{key:"preparationTime",dataIndex:"preparationTime",title:"זמן הכנה (דקות)",editable:!0,minWidth:100,type:"number",rules:[{required:!0,message:"זמן הכנה נדרש"},{type:"number",min:0,message:"זמן הכנה חייב להיות מספר חיובי"}]},{key:"unitCost",dataIndex:"unitCost",title:"עלות ל-100 גרם (₪)",minWidth:100,render:(y,c)=>(c==null?void 0:c.totalWeight)!=null&&(c==null?void 0:c.totalCost)!=null?`₪${((Number(c.totalCost)+Number(c.laborCost||0))/(Number(c.totalWeight)*10)).toFixed(2)} / 100 גרם`:"—",editable:!1},{key:"laborCost",dataIndex:"laborCost",title:"עלות עבודה (₪)",minWidth:100,render:(y,c)=>{var v;return`₪${(v=c==null?void 0:c.laborCost)==null?void 0:v.toFixed(2)} (₪${C})`||"—"},editable:!1},{key:"totalCost",dataIndex:"totalCost",title:"עלות כוללת (₪)",minWidth:100,render:(y,c)=>(c==null?void 0:c.totalCost)!=null&&(c==null?void 0:c.laborCost)!=null?`₪${(Number(c.totalCost)+Number(c.laborCost)).toFixed(2)}`:"—",editable:!1},{key:"totalWeight",dataIndex:"totalWeight",title:'משקל כולל (ק"ג)',minWidth:100,render:(y,c)=>{var v;return((v=c.totalWeight)==null?void 0:v.toFixed(2))||"—"},editable:!1},{key:"ingredients",title:"רכיבים",type:"ingredientsManager",editable:!0,width:500,minWidth:500,column:!0,fields:[{key:"ingredientId",type:"select",title:"רכיב",placeholder:"בחר רכיב",options:I.map(y=>({value:y._id,label:y.name})),required:!0,rules:[{required:!0,message:"יש לבחור רכיב"}]},{key:"quantity",type:"number",title:"כמות",placeholder:"הזן כמות",required:!0,rules:[{required:!0,message:"יש להזין כמות"},{type:"number",min:0,message:"כמות חייבת להיות חיובית"}]},{key:"unit",type:"text",title:"יחידה",readonly:!0},{key:"weightOrVolumePerUnit",type:"number",title:"נפח/משקל ליחידה (אם רלוונטי)",placeholder:"הזן נפח ליחידה",required:!1,visible:y=>y.unit==="units",rules:[{type:"number",min:0,message:"ערך חייב להיות חיובי"}]}],render:(y,c,v,F)=>{let x=[...(c==null?void 0:c.ingredients)||[]].sort((a,d)=>d.quantity-a.quantity);return x=x==null?void 0:x.map(a=>{var d;return{name:a==null?void 0:a.ingredientData.name,quantity:((a==null?void 0:a.rawQuantityForJuice)||a.quantity)<1&&a.unit!=="units"?((a==null?void 0:a.rawQuantityForJuice)||a.quantity)*100:(a==null?void 0:a.rawQuantityForJuice)||a.quantity,unit:(d=Ce==null?void 0:Ce.find(m=>m.value===a.unit))==null?void 0:d.display((a==null?void 0:a.rawQuantityForJuice)||a.quantity),costForQuantity:a==null?void 0:a.costForQuantity}}),F?e.jsx("ul",{style:{display:"flex",flexDirection:"column",gap:"5px",padding:0,margin:0,listStyleType:"none"},children:x==null?void 0:x.map((a,d)=>e.jsxs("li",{style:{whiteSpace:"normal",display:"flex"},children:[e.jsx(Je,{title:a==null?void 0:a.name,children:e.jsx("span",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",display:"inline-block",maxWidth:"150px"},children:a==null?void 0:a.name})}),` (${a.quantity} ${a.unit}) - ₪${a==null?void 0:a.costForQuantity}`]},d))}):e.jsx(R,{ingredients:x})},rules:[{required:!0,message:"יש לבחור לפחות רכיב אחד"}]}];return I==null||I.map(y=>({label:y.name,value:y._id})),u.useEffect(()=>{h&&(n(h),p(h))},[h,I,C]),u.useEffect(()=>{const y=JSON.parse(localStorage.getItem("filtersMenu")||"{}");g(y)},[]),e.jsx(Ze,{title:"מתכונים",titleView:"מיקס",type:"mix",data:i,mobileKeys:T,dataPrint:o,sortKeys:L,tableKeys:q,newTitle:"הוסף תערובת חדשה",searchKeys:S,setDataPrint:p,onAdd:t,onEdit:r,onDelete:s,Dtitle:"אישור מחיקה",ingredientsArr:I,iconADD:e.jsx(H,{icon:jt}),Dcontent:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"האם אתה בטוח שברצונך למחוק את התערובת?"}),e.jsx("p",{children:"שים לב! מחיקת תערובת עשויה להשפיע על מוצרים המשתמשים בה."})]})})}const{Text:Ar}=ne,{Option:We}=oe,ls=({addEmployee:t,initialValues:r,onClose:s})=>{const[i]=_.useForm(),n=te(g=>g.employees),[o,p]=u.useState("");u.useEffect(()=>{r&&i.setFieldsValue(r)},[r,i]);const l=g=>{if(n.some(h=>h.name===g.name.trim()&&(!r||h._id!==r._id))){p("קיים כבר עובד בעל שם דומה");return}t({...r,...g}),i.resetFields(),s()};return e.jsx(de,{className:"employee-form-card",children:e.jsxs(_,{form:i,layout:"vertical",onFinish:l,initialValues:r,children:[e.jsx(_.Item,{label:"שם עובד",name:"name",rules:[{required:!0,message:"אנא הזן שם עובד"}],children:e.jsx(ae,{})}),e.jsx(_.Item,{label:"תפקיד",name:"position",children:e.jsx(ae,{placeholder:"הזן תפקיד"})}),e.jsx(_.Item,{label:"תעריף שעתי",name:"hourlyRate",rules:[{required:!0,message:"אנא הזן תעריף שעתי"}],children:e.jsx(le,{min:0,style:{width:"100%"}})}),e.jsx(_.Item,{label:"סטטוס",name:"status",initialValue:"active",rules:[{required:!0}],children:e.jsxs(oe,{children:[e.jsx(We,{value:"active",children:"פעיל"}),e.jsx(We,{value:"inactive",children:"לא פעיל"}),e.jsx(We,{value:"on_leave",children:"בחופשה"}),e.jsx(We,{value:"terminated",children:"סיים העסקה"})]})}),o&&e.jsx(ws,{style:{display:"block",marginBottom:"10px"},children:e.jsx(Ar,{type:"danger",className:"error-message",children:o})}),e.jsxs(_.Item,{children:[e.jsx(N,{type:"primary",htmlType:"submit",className:"employee-form-button",children:r?"עדכן עובד":"הוסף עובד"}),e.jsx(N,{className:"employee-form-button",onClick:s,style:{marginLeft:"8px"},children:"ביטול"})]})]})})},st="https://menu-server-c2b952e2c698.herokuapp.com/api",$r=t=>z.post(`${st}/employees`,t),Mr=t=>{const r=encodeURIComponent(t._id);return z.put(`${st}/employees/${r}`,t)},qr=t=>z.delete(`${st}/employees/${t}`),Dr=(t,r)=>z.get(`${st}/employees?`),os=u.createContext(),ds=()=>u.useContext(os),Rr=({children:t})=>{const[r,s]=u.useState(!1),i=async p=>{s(!0);try{await $r(p),O.success("העובד נוסף בהצלחה"),s(!1)}catch(l){console.error("Error adding employee:",l),O.error("שגיאה בהוספת עובד"),s(!1)}},n=async p=>{s(!0);try{await Mr(p),O.success("העובד עודכן בהצלחה"),s(!1)}catch(l){console.error("Error updating employee:",l),O.error("שגיאה בעדכון עובד"),s(!1)}},o=async p=>{s(!0);try{await qr(p),O.success("העובד נמחק בהצלחה"),s(!1)}catch(l){console.error("Error deleting employee:",l),O.error("שגיאה במחיקת עובד"),s(!1)}};return e.jsx(os.Provider,{value:{addEmployee:i,updateEmployee:n,deleteEmployee:o,loading:r},children:t})},{Text:at}=ne,Br=({sortKey:t})=>{const{updateEmployee:r,deleteEmployee:s}=ds(),i=te(C=>C.employees),[n,o]=u.useState(!1),[p,l]=u.useState(null),g=C=>{l(C),o(!0)},h=()=>{l(null),o(!1)},I=[...i].sort((C,R)=>t==="name"?C.name.localeCompare(R.name):0);return e.jsxs(de,{title:"רשימת עובדים",className:"employee-list-card",children:[e.jsx(ge,{itemLayout:"vertical",dataSource:I,renderItem:C=>e.jsx(ge.Item,{className:"employee-item",actions:[e.jsx(N,{type:"link",onClick:()=>g(C),children:"ערוך"}),e.jsx(Ot,{title:"האם אתה בטוח שברצונך למחוק את העובד הנוכחי?",onConfirm:()=>s(C._id),okText:"כן",cancelText:"לא",children:e.jsx(N,{icon:e.jsx(Pe,{}),danger:!0})})],children:e.jsx(ge.Item.Meta,{title:e.jsx(at,{strong:!0,children:C.name}),description:e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx(at,{strong:!0,children:"תפקיד:"})," ",C.position||"לא הוגדר"]}),e.jsxs("p",{children:[e.jsx(at,{strong:!0,children:"תעריף שעתי:"})," ",C.hourlyRate," ₪"]}),e.jsx("p",{children:e.jsx(Ee,{color:Or(C.status),text:Lr(C.status),style:{marginLeft:"8px"}})})]})})},C._id)}),e.jsx(ue,{title:p?"ערוך עובד":"הוסף עובד חדש",open:n,onCancel:h,footer:null,children:e.jsx(ls,{addEmployee:r,initialValues:p,onClose:h})})]})},Lr=t=>{switch(t){case"active":return"פעיל";case"inactive":return"לא פעיל";case"on_leave":return"בחופשה";case"terminated":return"סיים העסקה";default:return"לא ידוע"}},Or=t=>{switch(t){case"active":return"green";case"inactive":return"grey";case"on_leave":return"orange";case"terminated":return"red";default:return"blue"}};function Ur(){const{addEmployee:t}=ds(),[r,s]=u.useState(!1),[i,n]=u.useState(""),o=()=>{s(!0)},p=()=>{s(!1)};return e.jsxs("div",{style:{padding:"20px"},className:"scrollable-content employees-page-container",children:[e.jsxs("div",{className:"employees-controls",children:[e.jsx(N,{type:"primary",onClick:o,className:"add-employee-button",children:"הוסף עובד חדש"}),e.jsxs(oe,{value:i,onChange:l=>n(l),className:"sort-select",children:[e.jsx(oe.Option,{value:"",children:"מיין"}),e.jsx(oe.Option,{value:"name",children:"מיין לפי שם"})]})]}),e.jsx(Br,{sortKey:i}),e.jsx(ue,{title:"הוסף עובד חדש",open:r,onCancel:p,footer:null,destroyOnClose:!0,children:e.jsx(ls,{addEmployee:t,onClose:p})})]})}const He="https://menu-server-c2b952e2c698.herokuapp.com/api",Hr=(t,r)=>z.post(`${He}/employees/${t}/hours`,r),Wr=(t,r)=>z.put(`${He}/employees/hours/${t}`,r),Qr=t=>z.delete(`${He}/employees/hours/${t}`),Yr=t=>z.get(`${He}/employees/${t}/hours`),Vr=(t,r)=>z.get(`${He}/employees/hours/${r}/${t}`),cs=u.createContext(),Jr=()=>u.useContext(cs),Gr=({children:t})=>{const[r,s]=u.useState(!1),i=async(l,g)=>new Promise(async(h,I)=>{var C;s(!0);try{const R=await Hr(l,g);if((R==null?void 0:R.status)===200){O.error((C=R.data)==null?void 0:C.message),I(!1);return}O.success("שעות העבודה נוספו בהצלחה"),h(!0)}catch(R){console.error("Error adding employee hours:",R),O.error("שגיאה בהוספת שעות עבודה"),I(!1)}finally{s(!1)}}),n=async(l,g)=>new Promise(async(h,I)=>{s(!0);try{(await Wr(l,g)).status!==201?I(!1):(O.success("שעות העבודה עודכנו בהצלחה"),h(!0))}catch(C){console.error("Error updating employee hours:",C),O.error("שגיאה בעדכון שעות עבודה"),I(!1)}finally{s(!1)}}),o=async l=>{s(!0);try{const g=await Yr(l);return O.success("שעות העבודה נשלפו בהצלחה"),g.data}catch(g){console.error("Error fetching employee hours:",g),O.error("שגיאה בשליפת שעות עבודה")}finally{s(!1)}},p=async l=>{s(!0);try{await Qr(l),O.success("שעות העבודה נמחקו בהצלחה")}catch(g){console.error("Error deleting employee hours:",g),O.error("שגיאה במחיקת שעות עבודה")}finally{s(!1)}};return e.jsx(cs.Provider,{value:{loading:r,addEmployeeHours:i,updateEmployeeHours:n,deleteEmployeeHours:p,fetchEmployeeHours:o},children:t})},{Option:Xr}=oe,Zr=({visible:t,onClose:r,dayData:s})=>{const{addEmployeeHours:i,updateEmployeeHours:n,deleteEmployeeHours:o}=Jr(),p=te(c=>c.employees),[l,g]=u.useState(),[h,I]=u.useState(),[C,R]=u.useState(!1),[S]=_.useForm();if(!s)return null;const T=()=>{const c=C?n:i,v=C?h:l;c(C?v==null?void 0:v.hoursId:v.employeeId,v).then(()=>{g(),R(!1),S.resetFields()}).catch(()=>{})},L=c=>{I({...c,employeeId:c.employeeId,startTime:c.hours.start,endTime:c.hours.end,date:s.date}),R(!0)},q=()=>{g(null),R(!1)},j=c=>{o(c)},y=p==null?void 0:p.filter(c=>!s.employees.some(v=>v.employeeId===c._id));return e.jsxs(ue,{title:`ניהול שעות עבודה ליום ${s.date}`,open:t,onCancel:r,footer:null,width:800,style:{top:"1em"},destroyOnClose:!0,children:[e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("h3",{style:{fontWeight:"600",color:"#333"},children:"סיכום יום"}),e.jsxs("p",{children:["תאריך: ",s.date]}),e.jsxs("p",{children:["יום בשבוע: ",s.dayOfWeek]}),e.jsx(ht,{color:(s==null?void 0:s.status)==="חצי יום"?"orange":"green",children:s==null?void 0:s.status})]}),e.jsx(se,{}),e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("h3",{style:{fontWeight:"600",color:"#333"},children:C?"עריכת עובד":"הוספת עובד חדש"}),e.jsx(_,{form:S,layout:"vertical",onFinish:T,children:e.jsx(_.Item,{label:"בחר עובד",style:{maxWidth:"400px"},children:e.jsx(oe,{showSearch:!0,placeholder:"חיפוש והוספת עובד",optionFilterProp:"children",value:(l==null?void 0:l.employeeId)||null,onChange:c=>{const v=y.find(F=>F._id===c);g({name:v==null?void 0:v.name,startTime:"",endTime:"",date:s==null?void 0:s.date,employeeId:v._id})},filterOption:(c,v)=>v.children.toLowerCase().includes(c.toLowerCase()),children:y==null?void 0:y.map(c=>e.jsx(Xr,{value:c._id,children:c.name},c._id))})})})]}),e.jsx(se,{}),l&&e.jsxs(_,{layout:"inline",onFinish:T,initialValues:{startTime:l==null?void 0:l.startTime,endTime:l==null?void 0:l.endTime},children:[e.jsx(_.Item,{label:"שעת כניסה",children:e.jsx(ae,{placeholder:"HH:mm",value:l==null?void 0:l.startTime,onChange:c=>g(v=>({...v,startTime:c.target.value}))})}),e.jsx(_.Item,{label:"שעת יציאה",children:e.jsx(ae,{placeholder:"HH:mm",value:l==null?void 0:l.endTime,onChange:c=>g(v=>({...v,endTime:c.target.value}))})}),!(l!=null&&l._id)&&e.jsx(N,{type:"primary",onClick:T,children:"שמור שעות עבודה"})]}),e.jsx(se,{}),e.jsxs("div",{style:{marginTop:"20px"},children:[e.jsx("h3",{style:{fontWeight:"600",color:"#333"},children:"עובדים שנוספו"}),e.jsx(ge,{bordered:!0,className:"scroll-content",style:{maxHeight:"25em",overflow:"auto"},dataSource:s==null?void 0:s.employees,renderItem:c=>{var v,F,x;return e.jsx(ge.Item,{children:e.jsxs("div",{style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("h2",{style:{fontWeight:"500",width:"6em"},children:c.name}),C&&c.employeeId===(h==null?void 0:h.employeeId)?e.jsxs(e.Fragment,{children:[e.jsx(ae,{placeholder:"שעת כניסה",value:h==null?void 0:h.startTime,onChange:a=>I(d=>({...d,startTime:a.target.value})),style:{width:"100px",marginRight:"10px"}}),e.jsx(ae,{placeholder:"שעת יציאה",value:h==null?void 0:h.endTime,onChange:a=>I(d=>({...d,endTime:a.target.value})),style:{width:"100px",marginRight:"10px"}}),e.jsxs(Y,{style:{gap:"0.5em"},children:[e.jsx(N,{type:"primary",icon:e.jsx(Us,{}),onClick:T}),e.jsx(N,{icon:e.jsx(yt,{}),onClick:q,style:{marginLeft:"5px"}})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(Qe,{title:"כניסה",value:(v=c==null?void 0:c.hours)==null?void 0:v.start}),e.jsx(Qe,{title:"יציאה",value:(F=c==null?void 0:c.hours)==null?void 0:F.end}),e.jsx(Qe,{title:"סך שעות",value:(x=c==null?void 0:c.hoursWorked)==null?void 0:x.toFixed(2)}),e.jsxs(Y,{style:{gap:"0.5em"},children:[e.jsx(N,{icon:e.jsx(Oe,{}),onClick:()=>L(c)}),e.jsx(Ot,{title:"האם אתה בטוח שברצונך למחוק את העובד?",onConfirm:()=>j(c.hoursId),okText:"כן",cancelText:"לא",children:e.jsx(N,{icon:e.jsx(Pe,{}),danger:!0})})]})]})]})})}})]})]})},zr=({monthData:t})=>{const[r,s]=u.useState(!1),[i,n]=u.useState(null),o=g=>{n(g),s(!0)},p=[{title:"תאריך",dataIndex:"date",key:"date"},{title:"יום בשבוע",dataIndex:"dayOfWeek",key:"dayOfWeek"},{title:"סטטוס",dataIndex:"status",key:"status",render:g=>e.jsx(ht,{color:g==="חצי יום"?"orange":"green",children:g})},{title:"מספר עובדים",dataIndex:"employeesCount",key:"employeesCount",render:g=>g??"לא ידוע"},{title:"סך הכל שעות",dataIndex:"totalHours",key:"totalHours",render:g=>(g==null?void 0:g.toFixed(2))??"לא ידוע"}],l=g=>{let h="";return g!=null&&g.hasError&&(h+="workhours-error "),g.isToday?h+="today-row":g.isPast&&(h+="past-row"),h};return e.jsxs(e.Fragment,{children:[e.jsx(Bt,{columns:p,dataSource:t,rowKey:"date",pagination:!1,rowClassName:l,onRow:(g,h)=>({onClick:()=>(g.isToday||g.isPast)&&o(h)})}),e.jsx(Zr,{visible:r,onClose:()=>s(!1),dayData:t[i]})]})},{MonthPicker:Kr}=bs;Se.locale("he");const ea=()=>{const t=De(),r=te(n=>n.employeeHours.data),s=te(n=>n.employeeHours.selectedDate),i=n=>{t(On(n.format("YYYY-MM")))};return e.jsxs("div",{className:"workhours-container",children:[e.jsx("h1",{children:"ניהול שעות עבודה חודשיות"}),e.jsx(Kr,{onChange:i,placeholder:"בחר חודש ושנה",disabledDate:n=>n&&n>Se().endOf("month")},s),e.jsx(zr,{monthData:r})," "]})},us=Ie({name:"suppliers",initialState:[],reducers:{addSuppliersState:(t,r)=>r.payload,addOrUpdateSupplierState:(t,r)=>{const s=r.payload,i=t.findIndex(n=>n._id===s._id);i!==-1?t[i]=s:t.unshift(s)},updateSupplierState:(t,r)=>{const s=r.payload;return t.map(i=>i._id===s._id?s:i)},deleteSupplierState:(t,r)=>{const s=r.payload._id;return t.filter(i=>i._id!==s)}}}),{addSuppliersState:ta,addOrUpdateSupplierState:sa,updateSupplierState:na,deleteSupplierState:ra}=us.actions,aa=us.reducer;function it(t){let r,s,i,n;const o=t.price/1.17;return t.unit==='ק"ג'||t.unit==="weight"?(r=.1,s="גרם",i=o/t.quantity*r):t.unit==="ליטר"||t.unit==="volume"?(r=.1,s='מ"ל',i=o/t.quantity*r):(t.unit==="יחידות"||t.unit==="units")&&(r=1,s="יחידה",i=o/t.quantity),t.isJuice&&(n=i/(t.juiceRatio||1)),{...t,priceExcludingVAT:o.toFixed(2),unitQuantity:r,unitDescription:s,unitPrice:i.toFixed(2),processedPrice:n?n.toFixed(2):null}}const xs=Ie({name:"ingredients",initialState:[],reducers:{addIngerdientsState:(t,r)=>r.payload.map(it),addOrUpdateIngredientState:(t,r)=>{const s=it(r.payload),i=t.findIndex(n=>n._id===s._id);i!==-1?t[i]=s:t.unshift(s)},updateIngredientState:(t,r)=>{const s=it(r.payload);return t.map(i=>i._id===s._id?s:i)},deleteIngredientState:(t,r)=>{const s=r.payload._id;return t.filter(i=>i._id!==s)}}}),{addIngerdientsState:ia,addOrUpdateIngredientState:la,updateIngredientState:oa,deleteIngredientState:da}=xs.actions,ca=xs.reducer,ps=Ie({name:"mixes",initialState:[],reducers:{setMixesState:(t,r)=>{const{mixes:s,ingredientsState:i}=r.payload;return s},addOrUpdateMixState:(t,r)=>{const{newMix:s,ingredientsState:i}=r.payload,n=s,o=t.findIndex(p=>p._id===s._id);o!==-1?t[o]=n:t.unshift(n)},updateMixState:(t,r)=>{const{updatedMix:s,ingredientsState:i}=r.payload,n=s,o=t.findIndex(p=>p._id===s._id);o!==-1&&(t[o]=n)},deleteMixState:(t,r)=>t.filter(s=>s._id!==r.payload._id)}}),{setMixesState:ua,addOrUpdateMixState:xa,updateMixState:pa,deleteMixState:ma}=ps.actions,ha=ps.reducer,ms=Ie({name:"categories",initialState:[],reducers:{setCategories:(t,r)=>r.payload,addOrUpdateCategory:(t,r)=>{const s=r.payload,i=t.findIndex(n=>n._id===s._id);i!==-1?t[i]=s:t.unshift(s)},updateCategory:(t,r)=>{const s=r.payload,i=t.findIndex(n=>n._id===s._id);i!==-1&&(t[i]=s)},deleteCategory:(t,r)=>{const s=r.payload;return t.filter(i=>i._id!==s)}}}),{setCategories:ga,addOrUpdateCategory:ja,updateCategory:ya,deleteCategory:fa}=ms.actions,va=ms.reducer,hs=Ie({name:"employees",initialState:[],reducers:{setEmployees:(t,r)=>r.payload,addOrUpdateEmployee:(t,r)=>{const s=r.payload,i=t.findIndex(n=>n._id===s._id);i!==-1?t[i]=s:t.push(s)},updateEmployee:(t,r)=>{const s=r.payload,i=t.findIndex(n=>n._id===s._id);i!==-1&&(t[i]=s)},deleteEmployee:(t,r)=>t.filter(s=>s._id!==r.payload)}}),{setEmployees:wa,addOrUpdateEmployee:ba,updateEmployee:Ca,deleteEmployee:Sa}=hs.actions,Ia=hs.reducer,Fa=(t,r)=>{t.on("ingredientAdded",s=>{r(la(s))}),t.on("ingredientUpdated",s=>{r(oa(s))}),t.on("ingredientDeleted",s=>{r(da(s))}),t.on("supplierAdded",s=>{r(sa(s))}),t.on("supplierUpdated",s=>{r(na(s))}),t.on("supplierDeleted",s=>{r(ra(s))}),t.on("productAdded",s=>{r((i,n)=>{const o=n().ingredients,p=n().mixes;i(xt({newProduct:s,ingredientsState:o,mixesState:p}))})}),t.on("productUpdated",s=>{r((i,n)=>{const o=n().ingredients,p=n().mixes;i(xt({newProduct:s,ingredientsState:o,mixesState:p}))})}),t.on("productDeleted",s=>{r(Hn(s))}),t.on("categoryAdded",s=>{r(ja(s))}),t.on("categoryUpdated",s=>{r(ya(s))}),t.on("categoryDeleted",s=>{r(fa(s._id))}),t.on("mixAdded",s=>{r((i,n)=>{const o=n().ingredients;i(xa({newMix:s,ingredientsState:o}))})}),t.on("mixUpdated",s=>{r((i,n)=>{const o=n().ingredients;i(pa({updatedMix:s,ingredientsState:o}))})}),t.on("mixDeleted",s=>{r(ma(s))}),t.on("employeeAdded",s=>{r(ba(s))}),t.on("employeeUpdated",s=>{r(Ca(s))}),t.on("employeeDeleted",s=>{r(Sa(s._id))}),t.on("employeeHoursAdded",s=>{r(Rn(s))}),t.on("employeeHoursUpdated",s=>{r(Bn(s))}),t.on("employeeHoursDeleted",s=>{r(Ln({_id:s._id}))})},qt="https://menu-server-c2b952e2c698.herokuapp.com/",ka=u.createContext(),Pa=({children:t})=>{const r=De();return console.log(qt),u.useEffect(()=>{const s=tn(qt);return Fa(s,r),()=>s.disconnect()},[r]),e.jsx(ka.Provider,{value:{},children:t})};O.config({prefixCls:"my-message"});const Na=({children:t,setLoading:r})=>{const s=De(),i=te(o=>o.employeeHours.selectedDate),n=te(o=>{var p,l;return(l=(p=o.settings.settings)==null?void 0:p.hourlyRate)==null?void 0:l.value});return u.useEffect(()=>{(async()=>{var g,h;r(!0);const p=St(i).year(),l=St(i).month()+1;try{const[I,C,R,S,T,L,q]=await Promise.all([lr(),er(),Yt(),Fn(),Nr(),Dr(),Vr(l,p)]);s(ia((g=I==null?void 0:I.data)==null?void 0:g.reverse())),s((j,y)=>{var v;const c=y().ingredients;j(ua({mixes:(v=T==null?void 0:T.data)==null?void 0:v.reverse(),ingredientsState:c}))}),s((j,y)=>{var F;const c=y().ingredients,v=y().mixes;j(es({products:(F=R.data)==null?void 0:F.reverse(),ingredientsState:c,mixesState:v,averageHourlyRate:n}))}),s(ga(S.data)),s(ta((h=C==null?void 0:C.data)==null?void 0:h.reverse())),s(wa(L.data)),s(qn({selectedDate:i,employees:L.data,employeeHours:q==null?void 0:q.data})),r(!1)}catch(I){console.error("Error fetching data:",I),r(!1)}})()},[s,r,i]),e.jsx(Pa,{children:e.jsx(dr,{children:e.jsx(sr,{children:e.jsx(gn,{children:e.jsx(_r,{children:e.jsx(Pn,{children:e.jsx(Rr,{children:e.jsx(Gr,{children:e.jsx(vr,{children:t})})})})})})})})})},pt="/assets/logo-Ha-8mVYV.png",{TabPane:Dt}=je,Ea=({flag:t,setFlag:r})=>{var d,m,w,M,E,k;const{settings:s,loading:i,updateSetting:n,fetchSettings:o,addCategoryContext:p,updateCategoryContext:l,deleteCategoryContext:g}=as(),[h]=_.useForm(),[I,C]=u.useState(!1),[R,S]=u.useState("add"),[T,L]=u.useState(null),[q,j]=u.useState(null);u.useEffect(()=>{t&&(o(),j(null))},[t]),u.useEffect(()=>{var $,A,D,ee,W;s&&h.setFieldsValue({hourlyRate:parseFloat(($=s==null?void 0:s.hourlyRate)==null?void 0:$.value)||0,markupMultiplier:parseFloat((A=s==null?void 0:s.markupMultiplier)==null?void 0:A.value)||0,fixedExpensesRate:parseFloat((D=s==null?void 0:s.fixedExpensesRate)==null?void 0:D.value)||0,profitRate:parseFloat((ee=s==null?void 0:s.profitRate)==null?void 0:ee.value)||0,vatRate:parseFloat((W=s==null?void 0:s.vatRate)==null?void 0:W.value)||0})},[s,h]);const y=($,A=null)=>{S($),L(A),C(!0),$==="edit"&&A?h.setFieldsValue({name:A.name,description:A.description,color:A.color}):h.resetFields()},c=async $=>{try{const A={hourlyRate:{value:parseFloat($.hourlyRate)},markupMultiplier:{value:parseFloat($.markupMultiplier)},fixedExpensesRate:{value:parseFloat($.fixedExpensesRate)},profitRate:{value:parseFloat($.profitRate)},vatRate:{value:parseFloat($.vatRate)}};await n(A)}catch{j("שגיאה בשמירת ההגדרות")}},v=async $=>{try{R==="add"?await p($):R==="edit"&&await l(T._id,$),C(!1),o()}catch{j("שגיאה בתהליך")}},F=async $=>{try{await g($),o()}catch{j("שגיאה במחיקת הקטגוריה")}},x=$=>{var A;return(A=s==null?void 0:s.materialCategories)==null?void 0:A.value.some(D=>D.color===$)},a=$=>{ue.confirm({title:"מחיקת קטגוריה",content:`האם אתה בטוח שברצונך למחוק את הקטגוריה "${$.name}"?`,okText:"מחק",cancelText:"ביטול",onOk:()=>F($)})};return e.jsxs(ue,{title:"הגדרות מערכת",visible:t,footer:null,onCancel:()=>r(!1),width:800,children:[e.jsxs(je,{defaultActiveKey:"general",children:[e.jsx(Dt,{tab:"הגדרות כלליות",children:e.jsxs(_,{layout:"vertical",initialValues:{hourlyRate:((d=s==null?void 0:s.hourlyRate)==null?void 0:d.value)||0,markupMultiplier:((m=s==null?void 0:s.markupMultiplier)==null?void 0:m.value)||0,fixedExpensesRate:((w=s==null?void 0:s.fixedExpensesRate)==null?void 0:w.value)||0,profitRate:((M=s==null?void 0:s.profitRate)==null?void 0:M.value)||0,vatRate:((E=s==null?void 0:s.vatRate)==null?void 0:E.value)||0},onFinish:c,children:[e.jsx(_.Item,{label:"עלות שעת עבודה (₪)",name:"hourlyRate",rules:[{required:!0,message:"שדה חובה"}],children:e.jsx(ae,{type:"number",step:"0.1",min:"0",placeholder:"הכנס עלות שעת עבודה"})}),e.jsx(_.Item,{label:"אחוז המכפיל עבור מחיר מומלץ לצרכן (%)",name:"markupMultiplier",rules:[{required:!0,message:"שדה חובה"},{type:"number",min:0,max:100,message:"האחוז חייב להיות בין 0 ל-100"}],children:e.jsx(ae,{type:"number",step:"0.01",min:"0",max:"100",placeholder:"הכנס אחוז מכפיל"})}),e.jsx(_.Item,{label:"אחוז השתתפות בהוצאות קבועות (%)",name:"fixedExpensesRate",rules:[{required:!0,message:"שדה חובה"},{type:"number",min:0,max:100,message:"האחוז חייב להיות בין 0 ל-100"}],children:e.jsx(ae,{type:"number",step:"0.1",min:"0",max:"100",placeholder:"הכנס אחוז הוצאות"})}),e.jsx(_.Item,{label:"אחוז רווח רצוי (%)",name:"profitRate",rules:[{required:!0,message:"שדה חובה"},{type:"number",min:0,max:100,message:"האחוז חייב להיות בין 0 ל-100"}],children:e.jsx(ae,{type:"number",step:"0.1",min:"0",max:"100",placeholder:"הכנס אחוז רווח"})}),e.jsx(_.Item,{label:'מע"מ (%)',name:"vatRate",rules:[{required:!0,message:"שדה חובה"},{type:"number",min:0,max:100,message:"האחוז חייב להיות בין 0 ל-100"}],children:e.jsx(ae,{type:"number",step:"0.01",min:"0",max:"100",placeholder:'הכנס מע" מ'})}),e.jsx("div",{className:"flex justify-center mt-4",children:e.jsx(N,{type:"primary",htmlType:"submit",loading:i,children:"שמור הגדרות"})})]})},"general"),e.jsxs(Dt,{tab:"קטגוריות",children:[e.jsx(N,{type:"primary",icon:e.jsx(Le,{}),onClick:()=>y("add"),className:"mb-4",children:"הוסף קטגוריה"}),q&&e.jsx(Ge,{message:q,type:"error",className:"mb-4"}),e.jsx("div",{className:"space-y-2 overflow-y-auto px-2",style:{maxHeight:"400px",paddingRight:"8px"},children:(k=s==null?void 0:s.materialCategories)==null?void 0:k.value.map($=>e.jsxs("div",{className:"flex justify-between items-center border p-2 rounded",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:$.color}}),e.jsxs("div",{children:[e.jsx("div",{children:$.name}),e.jsx("div",{className:"text-sm text-gray-500",children:$.description})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{icon:e.jsx(Oe,{}),onClick:()=>y("edit",$)}),e.jsx(N,{icon:e.jsx(Pe,{}),danger:!0,onClick:()=>a($)})]})]},$._id))})]},"categories")]}),e.jsx(ue,{title:R==="add"?"הוסף קטגוריה":"ערוך קטגוריה",visible:I,onCancel:()=>C(!1),footer:null,children:e.jsxs(_,{form:h,layout:"vertical",onFinish:v,children:[e.jsx(_.Item,{label:"שם הקטגוריה",name:"name",rules:[{required:!0,message:"שדה חובה"}],children:e.jsx(ae,{placeholder:"הכנס שם קטגוריה"})}),e.jsx(_.Item,{label:"תיאור",name:"description",children:e.jsx(ae,{placeholder:"הכנס תיאור"})}),e.jsx(_.Item,{label:"צבע",name:"color",children:e.jsx(Xt,{value:h.getFieldValue("color"),onChange:$=>{!x($)||$===(T==null?void 0:T.color)?h.setFieldsValue({color:$}):j("צבע זה כבר בשימוש")}})}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(N,{onClick:()=>C(!1),children:"ביטול"}),e.jsx(N,{type:"primary",htmlType:"submit",loading:i,children:"שמור"})]})]})})]})};function _a({drawerVisible:t,setDrawerVisible:r,isMobile:s}){const[i,n]=u.useState(!1);return e.jsxs("div",{className:"top-bar",children:[e.jsx(he,{to:"/",children:e.jsx(ct,{className:"logo-mobile",src:pt,alt:"GainGuard",preview:!1})}),e.jsxs("div",{children:[e.jsx("button",{className:"settings-button",onClick:()=>n(!i),children:e.jsx(H,{icon:Es})}),s&&e.jsx("button",{className:"menu-button",onClick:()=>r(!t),children:e.jsx(H,{icon:_s})}),e.jsx(Ea,{flag:i,setFlag:()=>n(!1)})]})]})}const{Header:Ta,Content:Aa,Footer:$a}=Ut;function Ma(){const[t,r]=u.useState(!1),[s,i]=u.useState(!1),n=ce({query:"(max-width: 1200px)"});return e.jsxs(Na,{setLoading:i,children:[e.jsx(Cs,{fullscreen:!0,spinning:s,size:"large"}),e.jsx(en,{children:e.jsxs(Ut,{className:"app-container",style:{minHeight:n?"85vh":"100vh"},children:[e.jsxs("div",{className:"nav-container",children:[e.jsx("div",{className:"nav-top",children:e.jsx(ct,{className:"logo",src:pt,alt:"GainGuard",preview:!1})}),e.jsx(Rt,{})]}),e.jsxs("div",{className:"body-container",children:[e.jsxs(Ta,{className:"header",style:{padding:"0 20px"},children:[e.jsx(_a,{isMobile:n,drawerVisible:t,setDrawerVisible:r}),e.jsx(se,{className:"no-margin"})]}),e.jsx(Aa,{className:"content",children:e.jsxs(sn,{children:[e.jsx(Ne,{path:"/",element:e.jsx(Ir,{})}),e.jsx(Ne,{path:"/menu",element:e.jsx(Xn,{})}),e.jsx(Ne,{path:"/suppliers",element:e.jsx(nr,{})}),e.jsx(Ne,{path:"/mixes",element:e.jsx(Tr,{})}),e.jsx(Ne,{path:"/ingredients",element:e.jsx(br,{})}),e.jsx(Ne,{path:"/employees",element:e.jsx(Ur,{})}),e.jsx(Ne,{path:"/work-hours",element:e.jsx(ea,{})})]})}),e.jsx($a,{className:"footer",children:"© 2024 מערכת ניהול תפריט ועץ מוצר"})]}),e.jsx(Lt,{title:e.jsxs(Z,{children:[e.jsx(ct,{className:"logo",src:pt,alt:"GainGuard",preview:!1}),e.jsx("p",{children:"ניווט"})]}),placement:"right",closable:!0,onClose:()=>r(!1),open:t,width:300,children:e.jsx(Rt,{onClose:()=>r(!1)})})]})})]})}function Rt({onClose:t}){const r=nn(),s=i=>r.pathname===i?"link-active":"link";return e.jsxs("div",{className:"nav-desktop-child",children:[e.jsx(se,{}),e.jsx(N,{type:"link",onClick:t,className:s("/"),children:e.jsxs(he,{to:"/",children:[e.jsx(H,{icon:Ts})," ",e.jsx("p",{children:"לוח מחוונים"})]})}),e.jsx(N,{type:"link",onClick:t,className:s("/menu"),children:e.jsxs(he,{to:"/menu",children:[e.jsx(H,{icon:Ve})," ",e.jsx("p",{children:"תפריט"})]})}),e.jsx(N,{type:"link",onClick:t,className:s("/mixes"),children:e.jsxs(he,{to:"/mixes",children:[e.jsx(H,{icon:jt})," ",e.jsx("p",{children:"מתכונים"})]})}),e.jsx(N,{type:"link",onClick:t,className:s("/ingredients"),children:e.jsxs(he,{to:"/ingredients",children:[e.jsx(H,{icon:qe})," ",e.jsx("p",{children:"חומרי גלם"})]})}),e.jsx(N,{type:"link",onClick:t,className:s("/suppliers"),children:e.jsxs(he,{to:"/suppliers",children:[e.jsx(H,{icon:Xe})," ",e.jsx("p",{children:"ספקים"})]})}),e.jsx(N,{type:"link",onClick:t,className:s("/employees"),children:e.jsxs(he,{to:"/employees",children:[e.jsx(H,{icon:As})," ",e.jsx("p",{children:"עובדים"})]})}),e.jsx(N,{type:"link",onClick:t,className:s("/work-hours"),children:e.jsxs(he,{to:"/work-hours",children:[e.jsx(H,{icon:gt})," ",e.jsx("p",{children:"ניהול שעות עבודה"})]})})]})}const lt=Qt("dashboard/fetchDashboardData",async(t,{getState:r})=>(r(),{})),qa=Ie({name:"dashboard",initialState:[],reducers:{},extraReducers:t=>{t.addCase(lt.pending,r=>{}).addCase(lt.fulfilled,(r,s)=>{}).addCase(lt.rejected,r=>{})}}),Da=qa.reducer,Ra=Qs({reducer:{suppliers:aa,ingredients:ca,products:Wn,dashboard:Da,mixes:ha,categories:va,employees:Ia,employeeHours:Un,settings:fr}});gs.createRoot(document.getElementById("root")).render(e.jsx(mt.StrictMode,{children:e.jsx(js,{store:Ra,children:e.jsx(rn,{children:e.jsx(Ma,{})})})}));"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(t=>{console.log("ServiceWorker registration successful with scope: ",t.scope)}).catch(t=>{console.error("ServiceWorker registration failed: ",t)})});
