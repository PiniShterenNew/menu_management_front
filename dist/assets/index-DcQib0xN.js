import{r as b,j as e,a as Be}from"./react-BoqISt01.js";import{c as qt}from"./react-dom-Bk743r0W.js";import{u as H,a as Ye,P as Lt}from"./react-redux-D3oi59tp.js";import{a as R}from"./axios-CCb-kr4I.js";import{s as P,L as se,C as Y,R as M,F as D,D as O,B as E,a as ut,T as Ce,P as Ht,d as Vt,M as Z,b as L,c as k,S as z,e as X,f as q,I as Q,g as me,h as Xe,A as Dt,i as Ke,j as ne,k as De,l as Ze,m as Oe,n as Qe,o as we,p as Ot,q as Ut,r as Wt,t as Ue,u as Bt,v as xt,w as Yt}from"./antd-DmeG_UQO.js";import{u as ue}from"./react-responsive-B9DcSnuZ.js";import{L as Qt}from"./rc-virtual-list-D8xMsbcw.js";import{F as N,f as pt,a as mt,b as ht,c as Ie,d as gt,e as zt,g as Jt,h as Gt,i as ve,j as Se,k as ze,l as be,m as Re,n as yt,o as Xt,p as Kt,q as Zt,r as es}from"./@fortawesome-qDWh2dRT.js";import{v as Pe,a2 as le,R as ye,a1 as Je,r as ts,s as ss,a3 as ns}from"./@ant-design-D19tj2KF.js";import"./lodash-Cvu4m7Jc.js";import{D as rs,B as et}from"./react-chartjs-2-0Z_sSmBf.js";import{C as is,A as as,p as ls,a as os,b as ds,L as cs,c as us}from"./chart.js-BkMDj0WH.js";import{L as G,B as xs}from"./react-router-dom-UU0TJEQ6.js";import{m as te,h as tt}from"./moment-BAfwh5x7.js";import{c as Ge,a as re,b as ps}from"./@reduxjs-DkgbS889.js";import{l as ms}from"./socket.io-client-CDVIIGn8.js";import{d as hs,e as de,b as gs}from"./react-router-CBguhhk8.js";import"./@babel-D3CJPhrF.js";import"./scheduler-CzFDRTuY.js";import"./use-sync-external-store-BQxMxw6g.js";import"./rc-util-CNJZKBfo.js";import"./classnames-CAxFPVRb.js";import"./rc-resize-observer-DAFDewDD.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./rc-motion-DZL9tseL.js";import"./@rc-component-CJ3O0XX2.js";import"./rc-overflow-BihHMfjR.js";import"./rc-picker-C36UyFNu.js";import"./dayjs-DMN7meC7.js";import"./rc-tabs-yzw-cdZ6.js";import"./rc-dropdown-DWrTNHHf.js";import"./rc-menu-CaEGf7N_.js";import"./rc-select-Bo0uuwt8.js";import"./rc-input-number-CeDoipJ2.js";import"./rc-input-DGbryaDy.js";import"./@ctrl-DOFZgDuz.js";import"./rc-drawer-BuYifGjd.js";import"./rc-field-form-B3AIq04K.js";import"./scroll-into-view-if-needed-BZeNfFF0.js";import"./compute-scroll-into-view-DWa9QgjM.js";import"./rc-image-BZAcmxn_.js";import"./rc-dialog-IBK2RULo.js";import"./rc-notification-m3oA-fH0.js";import"./rc-tooltip-CEyrPNEN.js";import"./rc-switch-B_QRjvBh.js";import"./rc-table-BLi0AqDf.js";import"./rc-tree-BDK0sBoh.js";import"./rc-checkbox-XvbJzSrO.js";import"./rc-pagination-CZPuIcur.js";import"./throttle-debounce-CUWDS_la.js";import"./rc-textarea-BF1YsysJ.js";import"./copy-to-clipboard-DN2oU9Yq.js";import"./toggle-selection-BHUZwh74.js";import"./matchmediaquery-9DU1HNkU.js";import"./css-mediaquery-DcYbJrVh.js";import"./hyphenate-style-name-HOLnhz8K.js";import"./shallow-equal-BQUY1Bas.js";import"./prop-types-Bq5K3Feg.js";import"./@emotion-CW87jbl0.js";import"./stylis-OW4gUFyn.js";import"./@kurkle-BZxJdD1U.js";import"./@remix-run-Br25Cn4W.js";import"./redux-DITMfSWq.js";import"./immer-DqxjFn0G.js";import"./redux-thunk-ClJT1hhx.js";import"./engine.io-client-C44f3zIw.js";import"./engine.io-parser-BiEtp6m2.js";import"./@socket.io-Dkula2eQ.js";import"./socket.io-parser-BBkuslX-.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))l(r);new MutationObserver(r=>{for(const m of r)if(m.type==="childList")for(const h of m.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&l(h)}).observe(document,{childList:!0,subtree:!0});function s(r){const m={};return r.integrity&&(m.integrity=r.integrity),r.referrerPolicy&&(m.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?m.credentials="include":r.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function l(r){if(r.ep)return;r.ep=!0;const m=s(r);fetch(r.href,m)}})();const ee="https://menu-server-c2b952e2c698.herokuapp.com/api",ys=t=>R.post(`${ee}/products`,t),js=t=>{const n=encodeURIComponent(t._id);return R.put(`${ee}/products/${n}`,t)},fs=t=>R.delete(`${ee}/products/${t}`),ws=()=>R.get(`${ee}/products`),vs=(t,n)=>R.post(`${ee}/sizes/${t}`,n),Ss=(t,n)=>R.put(`${ee}/sizes/${t}`,n),bs=(t,n)=>R.delete(`${ee}/sizes/${t}/${n}`),Cs=t=>R.post(`${ee}/variations`,t),Is=(t,n)=>R.put(`${ee}/variations/${t}`,n),Ps=t=>R.delete(`${ee}/variations/${t}`),jt=b.createContext(),ft=()=>b.useContext(jt),_s=({children:t})=>{const[n,s]=b.useState(!1),[l,r]=b.useState(!1),[m,h]=b.useState("add"),[u,y]=b.useState(null),v=g=>new Promise(async(i,p)=>{var F,C;s(!0);try{const w=await ys(g);s(!1),(F=w==null?void 0:w.data)!=null&&F.error?(P.error((C=w==null?void 0:w.data)==null?void 0:C.error),p(!1)):(P.success("המוצר נוסף בהצלחה"),i(!0))}catch(w){console.error("Error adding product:",w),P.error("שגיאה בהוספת המוצר"),s(!1)}}),f=g=>new Promise(async(i,p)=>{var F;s(!0);try{const C=await js(g);s(!1),(F=C==null?void 0:C.data)!=null&&F.error||(P.success("המוצר עודכן בהצלחה"),i(!0)),p(!1)}catch(C){console.error("Error updating product:",C),P.error("שגיאה בעדכון המוצר"),s(!1)}}),S=async g=>{s(!0);try{await fs(g),P.success("המוצר נמחק בהצלחה"),s(!1)}catch(i){console.error("Error deleting product:",i),P.error("שגיאה במחיקת המוצר"),s(!1)}},j=(g,i)=>(s(!0),new Promise(async(p,F)=>{try{const C=await vs(g,i);P.success("הגודל נוסף בהצלחה"),s(!1),p(C.data)}catch(C){console.error("Error adding size:",C),P.error("שגיאה בהוספת הגודל"),s(!1),F(C)}})),x=(g,i)=>(s(!0),new Promise(async(p,F)=>{try{const C=await Ss(g,i);P.success("הגודל עודכן בהצלחה"),s(!1),p(C.data)}catch(C){console.error("Error updating size:",C),P.error("שגיאה בעדכון הגודל"),s(!1),F(C)}})),a=(g,i)=>(s(!0),new Promise(async(p,F)=>{try{await bs(g,i),P.success("הגודל נמחק בהצלחה"),s(!1),p(!0)}catch(C){console.error("Error deleting size:",C),P.error("שגיאה במחיקת הגודל"),s(!1),F(C)}})),d=g=>(s(!0),new Promise(async(i,p)=>{try{const F=await Cs(g);P.success("הווריאציה נוספה בהצלחה"),s(!1),i(F.data)}catch(F){console.error("Error adding variation:",F),P.error("שגיאה בהוספת הווריאציה"),s(!1),p(F)}})),o=(g,i)=>(s(!0),new Promise(async(p,F)=>{try{const C=await Is(g,i);P.success("הווריאציה עודכנה בהצלחה"),s(!1),p(C.data)}catch(C){console.error("Error updating variation:",C),P.error("שגיאה בעדכון הווריאציה"),s(!1),F(C)}})),c=g=>(s(!0),new Promise(async(i,p)=>{try{await Ps(g),P.success("הווריאציה נמחקה בהצלחה"),s(!1),i(!0)}catch(F){console.error("Error deleting variation:",F),P.error("שגיאה במחיקת הווריאציה"),s(!1),p(F)}}));return e.jsx(jt.Provider,{value:{addProduct:v,updateProduct:f,deleteProduct:S,addSize:j,updateSize:x,deleteSize:a,addVariation:d,updateVariation:o,deleteVariation:c,loading:n,isModalVisible:l,setIsModalVisible:r,modalMode:m,setModalMode:h,selectedItem:u,setSelectedItem:y},children:t})};function ks({data:t,type:n,tableKeys:s,mobileKeys:l,openModal:r,Dtitle:m,Dcontent:h,onDelete:u}){const y=ue({query:"(max-width: 500px)"}),[v,f]=b.useState(0),[S,j]=b.useState(1),[x,a]=b.useState(6),[d,o]=b.useState([]),c=(p,F)=>{const C=(p-1)*F,w=C+F;return t.slice(C,w)},g=(p,F)=>{j(p),a(F)};b.useEffect(()=>{f(t.length),o(c(S,x))},[S,x,t]);const i=p=>{Z.confirm({title:m,content:h,okText:"מחק",cancelText:"בטל",onOk:()=>u(p==null?void 0:p._id)})};return y?e.jsx(e.Fragment,{children:e.jsx(se,{style:{maxHeight:"55vh",overflowY:"auto",minHeight:"80%",height:"80%"},children:e.jsx(Qt,{data:t,itemHeight:47,itemKey:"_id",children:p=>{var F,C,w;return e.jsx(se.Item,{className:"width-100",style:{padding:"0"},children:e.jsxs(Y,{className:"width-100 padding-card",style:{margin:"8px",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)"},children:[e.jsxs(M,{align:"middle",justify:"space-between",style:{margin:"1em 0em"},children:[e.jsx(D,{flex:1,children:e.jsx("strong",{style:{fontSize:"1.3em"},children:p==null?void 0:p.name})}),e.jsxs(D,{flex:1,style:{flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("strong",{children:(F=s==null?void 0:s.find(I=>I.key==="usedCount"))==null?void 0:F.title}),e.jsx("p",{children:p==null?void 0:p.usedCount})]}),(C=s==null?void 0:s.find(I=>I.key==="type"||I.key==="category"))==null?void 0:C.render("",p,"view")]}),s.filter(I=>I.key!=="name"&&I.key!=="type"&&(I==null?void 0:I.key)!=="category"&&(I==null?void 0:I.key)!=="actions"&&(l==null?void 0:l.includes(I==null?void 0:I.key))).map((I,T,_)=>e.jsxs(Be.Fragment,{children:[e.jsxs("div",{style:{fontSize:"0.9em",display:"flex",justifyContent:"space-between"},children:[I.title&&e.jsxs("strong",{children:[I.title,":"]}),e.jsx("span",{children:I.render?I.render(null,p,"view"):p[I.dataIndex]||"—"})]}),T<2&&e.jsx(O,{style:{margin:"0.2em"}})]},`${p==null?void 0:p._id}-${I.key}`)),e.jsxs(M,{className:"card-actions",align:"middle",justify:"center",children:[(w=s==null?void 0:s.find(I=>I.key==="actions"))==null?void 0:w.render(null,p),n==="P"&&e.jsx(O,{type:"vertical"}),e.jsxs(D,{align:"center",justify:"center",children:[e.jsx(E,{type:"text",onClick:()=>i(p),children:e.jsx(N,{icon:pt})}),e.jsx(E,{type:"text",onClick:()=>r("edit",p),children:e.jsx(N,{icon:mt})}),e.jsx(E,{type:"text",onClick:()=>r("view",p),children:e.jsx(N,{icon:ht})})]})]})]})},p==null?void 0:p._id)}})})}):e.jsxs(D,{flex:1,style:{display:"flex",flexDirection:"column",overflow:"hidden",width:"100%"},children:[e.jsx(D,{flex:1,style:{maxWidth:"100%",maxHeight:"90%",overflowY:"auto",overflowX:"auto"},children:e.jsx(ut,{style:{minWidth:"100%"},columns:s.map(p=>({...p,title:e.jsx(Ce,{title:p.title,children:e.jsx("span",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",display:"inline-block",maxWidth:"150px"},children:p.title})})})),dataSource:d,pagination:!1,direction:"rtl"})}),e.jsx(D,{align:"center",justify:"center",style:{marginTop:"2vh"},children:e.jsx(Ht,{current:S,total:v,pageSize:x,onChange:g,style:{direction:"ltr"},showSizeChanger:!0,pageSizeOptions:["6","10","20","50"],locale:Vt})})]})}const Fs=({title:t,value:n=[],onChange:s,ingredientsArr:l=[],indexSize:r,nameArr:m,nameArrType:h})=>{const u=ue({query:"(max-width: 500px)"}),y=()=>{const x={ingredientId:null,quantity:null,unit:null};s([...n,x])},v=x=>{const a=[...n];a.splice(x,1),s(a)},f=(x,a,d)=>{const o=[...n];if(o[x][a]=d,a==="ingredientId"){const c=l.find(g=>g._id===d);c&&(o[x].unit=c.unit)}s(o)},S=x=>{switch(x){case"weight":return'ק"ג';case"volume":return"ליטר";case"units":return"יחידות";default:return""}},j=(x,a)=>{const d=l.find(c=>c._id===x.ingredientId),o=x.unit||d!=null&&d.unit?S(x.unit||(d==null?void 0:d.unit)):"";return e.jsxs(M,{gutter:[20,20],align:"middle",justify:"center",children:[e.jsx(L,{span:u?24:10,children:e.jsx(k.Item,{name:[m,r,h,a,"ingredientId"],rules:[{required:!0,message:"יש לבחור רכיב"}],children:e.jsx(z,{placeholder:"בחר רכיב",style:{width:"100%"},value:x.ingredientId||null,onChange:c=>f(a,"ingredientId",c),showSearch:!0,filterOption:(c,g)=>{var i;return(i=g==null?void 0:g.label)==null?void 0:i.toLowerCase().includes(c.toLowerCase())},options:l.map(c=>({value:c._id,label:c.name})),size:"small"})})}),e.jsx(L,{span:u?20:10,children:e.jsx(k.Item,{name:[m,r,h,a,"quantity"],rules:[{required:!0,message:"יש למלא כמות"},{type:"number",min:0,message:"כמות חייבת להיות חיובית"}],children:e.jsx(X,{placeholder:`כמות ${o?`(${o})`:""}`,style:{width:"100%"},value:x.quantity||null,onChange:c=>f(a,"quantity",c),min:0,step:x.unit==="units"?1:.001,precision:x.unit==="units"?0:3,size:"small",addonAfter:o})})}),e.jsx(L,{span:4,style:{alignSelf:"flex-start",textAlign:"right"},children:e.jsx(E,{type:"text",danger:!0,icon:e.jsx(le,{}),onClick:()=>v(a),size:"small"})})]})};return e.jsxs("div",{children:[e.jsx(E,{type:"dashed",onClick:y,style:{width:"100%",marginBottom:"8px"},icon:e.jsx(Pe,{}),size:"small",children:t}),e.jsx("div",{children:n.map((x,a)=>j(x,a))})]})},{Option:ge}=z,{Text:qe}=q,{TextArea:Ts}=Q;function Es({mode:t="view",fields:n=[],onSubmit:s,initialValues:l={},onClose:r,tableKeys:m,ingredientsArr:h}){var x;const[u]=k.useForm(),[y,v]=b.useState(l.unit||null),[f,S]=b.useState(l.subUnit||null);b.useEffect(()=>{if(l){const a=l.quantity<1?l.quantity*1e3:l.quantity;u.setFieldsValue({...l,quantity:a}),v(l.unit),S(l.subUnit||"kg")}},[l,u]);const j=a=>{let d=a.quantity;(a.subUnit==="g"||a.subUnit==="ml")&&(d=a.quantity/1e3);const o={...a,quantity:d};s&&s(o),u.resetFields(),r&&r()};return t==="view"?e.jsxs(Y,{style:{},children:[e.jsx(q.Title,{level:4,style:{marginBottom:"16px"},children:"פרטי הרכיב"}),e.jsxs(M,{align:"middle",justify:"space-between",style:{margin:"1em 0em"},children:[e.jsx(qe,{strong:!0,style:{fontSize:"1.8em"},children:l==null?void 0:l.name}),(x=m==null?void 0:m.find(a=>a.key==="type"))==null?void 0:x.render("",l,"view")]}),m==null?void 0:m.filter(a=>a.key!=="type"&&(a==null?void 0:a.key)!=="name"&&!a.column).map((a,d,o)=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"12px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(D,{flex:1,children:e.jsxs(qe,{strong:!0,children:[a.title,":"]})}),e.jsx(D,{flex:1,children:e.jsx("p",{style:{},children:(a==null?void 0:a.render)&&(a==null?void 0:a.render("",l,t,"view"))||l[a.key]||"—"})})]},a.key),d<(o==null?void 0:o.length)-1&&e.jsx(O,{style:{margin:"8px 0"}})]})),m==null?void 0:m.filter(a=>a.column).map((a,d,o)=>e.jsxs(e.Fragment,{children:[d===0&&e.jsx(O,{style:{margin:"8px 0"}}),e.jsxs("div",{style:{marginBottom:"12px",display:"flex",justifyContent:"space-between",flexDirection:"column"},children:[e.jsxs(qe,{strong:!0,style:{fontSize:"1.4em"},children:[a.title,":"]}),e.jsx(D,{flex:1,children:e.jsx("p",{style:{},children:(a==null?void 0:a.render)&&(a==null?void 0:a.render("",l,t,"view"))||l[a.key]||"—"})})]},a.key),d<(o==null?void 0:o.length)-1&&e.jsx(O,{style:{margin:"8px 0"}})]}))]}):e.jsx(Y,{children:e.jsxs(k,{form:u,layout:"vertical",onFinish:j,initialValues:l,children:[n.map(a=>{const{key:d,title:o,type:c,options:g,rules:i,props:p,hiddenInForm:F,coin:C,divider:w}=a;if(F)return null;switch(c){case"text":return e.jsxs(e.Fragment,{children:[e.jsx(k.Item,{name:d,label:o,rules:i,children:e.jsx(Q,{...p})},d),w&&e.jsx(O,{style:{margin:"0.2em"}})]});case"number":return e.jsxs(e.Fragment,{children:[e.jsx(k.Item,{name:d,label:o,rules:i==null?void 0:i.map(I=>I.validator?{...I,validator:(T,_)=>I.validator(T,_,l)}:I),children:e.jsx(X,{suffix:C&&"₪",min:0,style:{width:"100%"},...p})},d),w&&e.jsx(O,{style:{margin:"0.2em"}})]});case"float":return e.jsxs(e.Fragment,{children:[e.jsx(k.Item,{name:d,label:o,rules:i,children:e.jsx(X,{suffix:C&&"₪",min:0,step:.01,style:{width:"100%"},...p})},d),w&&e.jsx(O,{style:{margin:"0.2em"}})]});case"select":return e.jsxs(e.Fragment,{children:[e.jsx(k.Item,{name:d,label:o,rules:i,children:e.jsx(z,{...p,showSearch:!0,onChange:I=>{d==="unit"&&(v(I),u.setFieldsValue({subUnit:void 0}))},children:g.map(I=>e.jsx(ge,{value:I.value,children:I.label},I.value))})},d),d==="unit"&&(u.getFieldValue("unit")==="weight"||u.getFieldValue("unit")==="volume")&&e.jsx(k.Item,{name:"subUnit",initialValue:u.getFieldValue("subUnit")||(u.getFieldValue("unit")==="weight"?(l==null?void 0:l.quantity)>=1?"kg":"g":u.getFieldValue("unit")==="volume"?(l==null?void 0:l.quantity)>=1?"liter":"ml":void 0),label:u.getFieldValue("unit")==="weight"?'בחר יחידת משקל (ק"ג / גרם)':'בחר יחידת נפח (ליטר / מ"ל)',rules:[{required:!0,message:"אנא בחר יחידת משנה"}],children:e.jsx(z,{onChange:I=>u.setFieldsValue({subUnit:I}),children:u.getFieldValue("unit")==="weight"?e.jsxs(e.Fragment,{children:[e.jsx(ge,{value:"kg",children:'ק"ג'}),e.jsx(ge,{value:"g",children:"גרם"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ge,{value:"liter",children:"ליטר"}),e.jsx(ge,{value:"ml",children:'מ"ל'})]})})}),w&&e.jsx(O,{style:{margin:"0.2em"}})]});case"ingredientsManager":return e.jsxs(e.Fragment,{children:[e.jsx(O,{style:{margin:"0.5em"}}),e.jsx(k.Item,{name:d,label:o,rules:i,children:e.jsx(Fs,{value:u.getFieldValue(d),onChange:I=>u.setFieldsValue({[d]:I}),fields:a==null?void 0:a.fields,ingredientsArr:h})},d)]});case"custom":return e.jsxs(e.Fragment,{children:[a.render&&a.render("",l,"edit",u),w&&e.jsx(O,{style:{margin:"0.2em"}})]});case"textArea":return e.jsxs(e.Fragment,{children:[e.jsx(k.Item,{name:d,label:o,rules:i,children:e.jsx(Ts,{style:{resize:"none"},showCount:!0,maxLength:a==null?void 0:a.maxLength})},d),w&&e.jsx(O,{style:{margin:"0.2em"}})]});default:return null}}),t!=="view"&&e.jsx(k.Item,{children:e.jsx(E,{type:"primary",htmlType:"submit",style:{width:"100%"},children:t==="add"?"הוסף":"עדכן"})})]})})}const $s=({sizes:t,ingredients:n,add:s,remove:l,form:r,fields:m,index:h,onChange:u,getUnitDisplay:y})=>e.jsxs(e.Fragment,{children:[e.jsx(E,{type:"dashed",style:{marginBottom:"0.5vw"},onClick:()=>s(),children:"הוסף מרכיב"}),e.jsx("div",{style:{maxHeight:"12vw",overflowY:"auto",overflowX:"hidden"},children:m.map(({key:v,name:f,fieldKey:S})=>e.jsxs(M,{gutter:16,children:[e.jsx(L,{span:10,children:e.jsx(k.Item,{name:[f,"ingredientId"],fieldKey:[S,"ingredientId"],rules:[{required:!0,message:"בחר רכיב"}],children:e.jsx(z,{placeholder:"בחר רכיב",showSearch:!0,filterOption:(j,x)=>{var a;return(a=x==null?void 0:x.label)==null?void 0:a.toLowerCase().includes(j.toLowerCase())},options:n.map(j=>({value:j._id,label:j.name,unit:j==null?void 0:j.unit})),onChange:j=>{var o;const x=n.find(c=>c._id===j),a=[...t],d=r.getFieldValue(["sizes",h]);d.ingredients[f]={...d.ingredients[f],ingredientId:j,unit:(x==null?void 0:x.unit)||""},a[h]={...d,edit:((o=a[h])==null?void 0:o.edit)||!1},u(a),r.setFieldsValue({sizes:a})}})})}),e.jsx(L,{span:10,children:e.jsx(k.Item,{name:[f,"quantity"],fieldKey:[S,"quantity"],rules:[{required:!0,message:"הזן כמות"}],children:e.jsx(X,{onChange:j=>{var d;const x=[...t],a=r.getFieldValue(["sizes",h]);a.ingredients[f]={...a.ingredients[f],quantity:j},x[h]={...a,edit:((d=x[h])==null?void 0:d.edit)||!1},u(x),r.setFieldsValue({sizes:x})},addonAfter:y(r.getFieldValue(["sizes",h,"ingredients",f,"unit"])||"")})})}),e.jsx(L,{span:4,children:e.jsx(E,{type:"text",danger:!0,icon:e.jsx(ye,{}),onClick:()=>l(f)})})]},v))})]}),As=({sizes:t,mixes:n,add:s,remove:l,form:r,fields:m,index:h,onChange:u,getUnitDisplay:y})=>e.jsxs(e.Fragment,{children:[e.jsx(E,{type:"dashed",style:{marginBottom:"0.5vw"},onClick:()=>s(),children:"הוסף מיקס"}),e.jsx("div",{style:{maxHeight:"12vw",overflowY:"auto",overflowX:"hidden"},children:m.map(({key:v,name:f,fieldKey:S})=>e.jsxs(M,{gutter:16,children:[e.jsx(L,{span:10,children:e.jsx(k.Item,{name:[f,"mixId"],fieldKey:[S,"mixId"],rules:[{required:!0,message:"בחר מיקס"}],children:e.jsx(z,{placeholder:"בחר מיקס",showSearch:!0,filterOption:(j,x)=>{var a;return(a=x==null?void 0:x.label)==null?void 0:a.toLowerCase().includes(j.toLowerCase())},options:n.map(j=>({value:j._id,label:j.name,unit:j==null?void 0:j.unit})),onChange:j=>{var o;const x=n.find(c=>c._id===j),a=[...t],d=r.getFieldValue(["sizes",h,"mixes"]);d[f]={...d[f],unit:(x==null?void 0:x.unit)||"weight"},a[h]={...a[h],mixes:d,edit:((o=a[h])==null?void 0:o.edit)||!1},a[h].mixes=d,u(a),r.setFieldsValue({sizes:a})}})})}),e.jsx(L,{span:10,children:e.jsx(k.Item,{name:[f,"quantity"],fieldKey:[S,"quantity"],rules:[{required:!0,message:"הזן כמות"}],children:e.jsx(X,{onChange:j=>{var d;const x=[...t],a=r.getFieldValue(["sizes",h,"mixes"]);a[f]={...a[f],quantity:j},x[h]={...x[h],mixes:a,edit:((d=x[h])==null?void 0:d.edit)||!1},u(x),r.setFieldsValue({sizes:x})},addonAfter:y(r.getFieldValue(["sizes",h,"mixes",f,"unit"])||"")})})}),e.jsx(L,{span:4,children:e.jsx(E,{type:"text",danger:!0,icon:e.jsx(ye,{}),onClick:()=>l(f)})})]},v))})]});function Ms({size:t,sizes:n,index:s,handleCancelEdit:l,handleRemoveSize:r,newSizeId:m,form:h,ingredients:u,mixes:y,onChange:v,getUnitDisplay:f,activeSubTab:S,setActiveSubTab:j,setNewSizeId:x}){var d,o;const a=async()=>{var c;try{await h.validateFields(),x(null),v(n==null?void 0:n.map((g,i)=>i===s?{...g,edit:!1}:g))}catch(g){const p=(c=g.errorFields[0])==null?void 0:c.name;p!=null&&p.includes("ingredients")?j("1"):p!=null&&p.includes("mixes")&&j("2")}};return e.jsxs("div",{className:t.idNew===m?"highlight-new":"",style:{border:`1px ${t!=null&&t.idNew?"dashed":"solid #e6e6e6"}`,borderRadius:"8px",padding:"16px",background:"#fafafa",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},children:[e.jsxs(M,{justify:"space-between",align:"middle",style:{marginBottom:"12px"},children:[e.jsxs(D,{flex:2,children:[e.jsx(k.Item,{name:["_id"],hidden:!0,children:e.jsx(Q,{})}),e.jsx(k.Item,{name:["label"],label:"שם הגודל",rules:[{required:!0,message:"חייב למלא שם גודל"},{min:1,message:"שם גודל חייב להיות לפחות 1 תווים"},{max:25,message:"שם גודל לא יכול לחרוג מ-25 תווים"}],children:e.jsx(Q,{placeholder:"שם הגודל",size:"middle",showCount:!0,style:{width:"auto",minWidth:"200px"},maxLength:25})})]}),e.jsxs(D,{flex:1,style:{alignSelf:"flex-start"},justify:"end",children:[e.jsx(E,{type:"text",icon:e.jsx(ye,{}),onClick:()=>l(s)}),e.jsx(E,{type:"text",danger:!0,icon:e.jsx(le,{}),title:"מחק גודל",onClick:()=>r(s)})]})]}),e.jsxs(M,{gutter:[16,16],children:[e.jsx(L,{span:12,children:e.jsx(k.Item,{name:["price"],label:"מחיר",rules:[{required:!0,message:"יש למלא מחיר"},{type:"number",min:0,message:"המחיר חייב להיות חיובי"}],children:e.jsx(X,{placeholder:"מחיר",style:{width:"100%"},addonAfter:"₪"})})}),e.jsx(L,{span:12,children:e.jsx(k.Item,{label:"זמן הכנה (דקות)",name:["preparationTime"],rules:[{required:!0,message:"חייב לציין זמן הכנה"}],children:e.jsx(X,{placeholder:"זמן הכנה",style:{width:"100%"},addonAfter:e.jsx(N,{style:{fontSize:"0.9em"},icon:Ie})})})})]}),e.jsxs(me,{activeKey:S,onChange:c=>j(c),tabBarStyle:{direction:"rtl"},style:{margin:"1vw 0"},type:"card",tabPosition:"top",children:[e.jsxs(Xe,{tab:`מרכיבים (${((d=t==null?void 0:t.ingredients)==null?void 0:d.length)||0})`,children:[e.jsx(q.Text,{strong:!0,style:{display:"block",marginBottom:"8px"},children:"מרכיבים:"}),e.jsx(k.List,{name:["ingredients"],children:(c,{add:g,remove:i})=>e.jsx($s,{add:g,remove:i,fields:c,form:h,index:s,ingredients:u,onChange:v,getUnitDisplay:f,sizes:n})})]},1),e.jsxs(Xe,{tab:`מיקסים (${((o=t==null?void 0:t.mixes)==null?void 0:o.length)||0})`,children:[e.jsx(q.Text,{strong:!0,style:{display:"block",marginBottom:"8px"},children:"מיקסים:"}),e.jsx(k.List,{name:["mixes"],children:(c,{add:g,remove:i})=>e.jsx(As,{add:g,remove:i,fields:c,form:h,index:s,mixes:y,onChange:v,getUnitDisplay:f,sizes:n})})]},2)]}),e.jsx(E,{type:"primary",htmlType:"submit",onClick:()=>a(),children:"שמור"})]},t.idNew||s)}function wt({size:t,index:n,handleEditSize:s,handleRemoveSize:l,ingredients:r,mixes:m,sizeSummary:h,priceExcludingVAT:u}){var f,S;const y=H(j=>j.employeeHours.overallAverageHourlyRate),v=(j,x)=>{const a=j;if(!a)return null;const d=x;return e.jsx(M,{children:e.jsxs(L,{children:[e.jsxs(M,{children:[e.jsx(q.Text,{strong:!0,children:'מחיר ללא מע"מ:'}),e.jsxs(q.Text,{style:{marginRight:8},children:["₪",d," (₪",((t==null?void 0:t.price)-d).toFixed(2),")"]})]}),e.jsxs(M,{children:[e.jsx(q.Text,{strong:!0,children:"עלות עבודה:"}),e.jsxs(q.Text,{style:{marginRight:8},children:["₪",a==null?void 0:a.laborCost," (₪",y,")"]})]}),e.jsxs(M,{children:[e.jsx(q.Text,{strong:!0,children:"עלות מרכיבים:"}),e.jsxs(q.Text,{style:{marginRight:8},children:["₪",a==null?void 0:a.ingredientCost]})]}),e.jsxs(M,{children:[e.jsx(q.Text,{strong:!0,children:"עלות מיקסים:"}),e.jsxs(q.Text,{style:{marginRight:8},children:["₪",a==null?void 0:a.mixCost]})]}),e.jsxs(M,{children:[e.jsx(q.Text,{strong:!0,children:"עלות הוצאות קבועות:"}),e.jsx(q.Text,{style:{marginRight:8},children:"₪"})]}),e.jsxs(M,{children:[e.jsx(q.Text,{strong:!0,children:"אחוז רווח:"}),e.jsxs(q.Text,{style:{marginRight:8},children:[a==null?void 0:a.profitMargin,"%"]})]}),e.jsxs(M,{children:[e.jsx(q.Text,{strong:!0,children:"סך הכל עלות:"}),e.jsxs(q.Text,{style:{marginRight:8},children:["₪",a==null?void 0:a.totalCost]})]})]})})};return e.jsxs("div",{style:{border:"1px solid #e6e6e6",borderRadius:"8px",padding:"16px",background:"#fafafa",boxShadow:"0 1px 2px rgba(0,0,0,0.05)",marginBottom:"16px"},children:[e.jsx(D,{flex:1,style:{padding:"0em 1em"},justify:"space-between",align:"middle",children:e.jsxs(L,{className:"width-100",children:[e.jsx(D,{flex:1,style:{marginBottom:"8px"},children:e.jsxs(M,{className:"width-100",align:"middle",justify:"space-between",children:[e.jsx(q.Text,{strong:!0,style:{fontSize:"1.2em"},children:t==null?void 0:t.label}),e.jsxs(D,{children:[s&&e.jsx(E,{type:"text",icon:e.jsx(Je,{}),onClick:()=>s(n)}),l&&e.jsx(E,{type:"text",danger:!0,icon:e.jsx(le,{}),onClick:()=>l(n)})]})]})}),e.jsxs(D,{flex:1,align:"start",style:{gap:"12px",marginBottom:"8px",flexDirection:"column"},children:[e.jsxs(M,{align:"middle",style:{gap:"8px"},children:[e.jsx(N,{style:{fontSize:"0.9em"},icon:gt}),e.jsxs(q.Text,{style:{fontSize:"1.1em",fontWeight:"bold",display:"flex",alignItems:"center",gap:"4px"},children:["₪",t==null?void 0:t.price]})]}),e.jsxs(M,{align:"middle",style:{gap:"8px"},children:[e.jsx(N,{style:{fontSize:"0.9em"},icon:Ie}),e.jsxs(q.Text,{style:{fontSize:"1.1em",fontWeight:"bold",display:"flex",alignItems:"center",gap:"4px"},children:[t==null?void 0:t.preparationTime," דקות"]})]})]}),v(h,u)]})}),e.jsx(O,{style:{margin:"12px 0"}}),e.jsx(q.Text,{strong:!0,style:{display:"block",marginBottom:"8px"},children:"מרכיבים:"}),e.jsx("ul",{style:{paddingLeft:"20px",margin:"0"},children:(f=t==null?void 0:t.ingredients)==null?void 0:f.map((j,x)=>{var d;const a=(()=>{switch(j.unit){case"weight":return'ק"ג';case"volume":return"ליטר";case"units":return"יחידות";default:return""}})();return e.jsx("li",{style:{marginBottom:"4px"},children:e.jsxs(q.Text,{children:[(d=r==null?void 0:r.find(o=>(o==null?void 0:o._id)===(j==null?void 0:j.ingredientId)))==null?void 0:d.name," -"," ",j.quantity," ",a," - ₪",j==null?void 0:j.costForQuantity]})},x)})}),e.jsx(O,{style:{margin:"12px 0"}}),e.jsx(q.Text,{strong:!0,style:{display:"block",marginBottom:"8px"},children:"מיקסים:"}),e.jsx("ul",{style:{paddingLeft:"20px",margin:"0"},children:(S=t==null?void 0:t.mixes)==null?void 0:S.map((j,x)=>{var d;const a=(()=>{switch(j.unit){case"weight":return'ק"ג';case"volume":return"ליטר";case"units":return"יחידות";default:return""}})();return e.jsx("li",{style:{marginBottom:"4px"},children:e.jsxs(q.Text,{children:[(d=m==null?void 0:m.find(o=>(o==null?void 0:o._id)===(j==null?void 0:j.mixId)))==null?void 0:d.name," -"," ",j.quantity," ",a," - ₪",j==null?void 0:j.costForQuantity]})},x)})})]},t.idNew||n)}const Ns=b.forwardRef(({size:t,index:n,sizes:s,onChange:l,onDelete:r,newSizeId:m,setNewSizeId:h,transformValueToForm:u,setActiveTabKey:y,ingredients:v,mixes:f,sizeSummary:S,priceExcludingVAT:j,activeSubTab:x,setActiveSubTab:a,onSubmit:d},o)=>{const[c]=k.useForm();b.useImperativeHandle(o,()=>({setFieldsValue:C=>c.setFieldsValue(C),getFieldsValue:()=>c.getFieldsValue(),resetFields:()=>c.resetFields()}));const g=()=>{const C=[...s];C[n]={...C[n],edit:!1,ingredients:t.ingredients.filter(w=>w==null?void 0:w._id),mixes:t.mixes.filter(w=>w==null?void 0:w._id)},l(C)},i=C=>{const w=[...s];w[C]={...w[C],edit:!0},l(w)},p=C=>{const w=s[C];if(w!=null&&w._id)Z.confirm({title:"האם אתה בטוח שברצונך למחוק את הגודל הזה?",content:`המחיקה תסיר לצמיתות את ${w.label}.`,okText:"מחק",okType:"danger",cancelText:"ביטול",onOk:()=>{r(w==null?void 0:w.productId,w._id).then(()=>{const I=[...s];I.splice(C,1),l(I),c.setFieldsValue({...I[C]}),y(Math.max(0,C-1).toString())}).catch(I=>{console.error("Error deleting size:",I)})}});else{const I=[...s];I.splice(C,1),l(I),c.setFieldsValue(u()),y(Math.max(0,C-1).toString()),h(null)}},F=C=>{switch(C){case"weight":return'ק"ג';case"volume":return"ליטר";case"units":return"יחידות";default:return""}};return!(t!=null&&t._id)||t!=null&&t.edit?e.jsx(k,{form:c,initialValues:{...t},onFinish:async(C,w)=>{d(C)},children:e.jsx(Ms,{handleCancelEdit:g,handleRemoveSize:p,newSizeId:m,size:t,index:n,onChange:l,form:c,ingredients:v,mixes:f,setNewSizeId:h,setActiveSubTab:a,activeSubTab:x,sizes:s,getUnitDisplay:F})}):e.jsx(wt,{handleEditSize:i,handleRemoveSize:p,index:n,size:t,ingredients:v,mixes:f,priceExcludingVAT:j,sizeSummary:S})}),{TabPane:Rs}=me,st=b.forwardRef(({value:t=[],onChange:n,ingredients:s,mixes:l,onSubmit:r,onDelete:m,sizeSummary:h,priceExcludingVAT:u},y)=>{const[v,f]=b.useState(null),[S,j]=b.useState("0"),[x,a]=b.useState("1"),d=b.useRef([]),o=g=>({value:g}),c=()=>{var p;const g={idNew:Date.now(),label:`גודל ${t.length+1}`,price:null,preparationTime:null,ingredients:[],mixes:[],edit:!0},i=[...t,g];n(i),(p=d.current[+S])==null||p.setFieldsValue({...g}),f(g.idNew),j(t.length.toString()),a("1")};return e.jsxs(D,{style:{flexDirection:"column"},children:[e.jsx(E,{type:"default",icon:e.jsx(Pe,{}),onClick:c,children:"הוסף גודל"}),e.jsx(me,{activeKey:S,onChange:g=>j(g),tabBarStyle:{direction:"rtl"},style:{margin:"1vw 0"},type:"card",tabPosition:"top",children:t==null?void 0:t.map((g,i)=>{var p;return e.jsx(Rs,{tab:(g==null?void 0:g.label)||`גודל ${i+1}`,children:e.jsx(Ns,{ref:F=>d.current[i]=F,size:g,index:i,sizes:t,onChange:n,onDelete:m,ingredients:s,transformValueToForm:o,setActiveTabKey:j,setActiveSubTab:a,activeSubTab:x,mixes:l,onSubmit:r,newSizeId:v,setNewSizeId:f,sizeSummary:h&&h[i],priceExcludingVAT:u&&((p=u[i])==null?void 0:p.priceExcludingVAT)})},i.toString())})})]})}),{TabPane:nt}=me,rt=b.forwardRef(({value:t=[],sizes:n,onChange:s,ingredients:l,onSubmit:r,onDelete:m},h)=>{const[u,y]=b.useState(null),[v,f]=b.useState("0"),[S]=k.useForm(),j=()=>({value:t}),x=()=>{const c={idNew:Date.now(),label:`וריאציה - ${t.length+1}`,sizeAdjustments:[...n==null?void 0:n.map(i=>({sizeId:i==null?void 0:i._id,label:i==null?void 0:i.label,priceAdjustment:null,preparationTimeAdjustment:null,ingredients:i==null?void 0:i.ingredients,mixes:i==null?void 0:i.mixes,add:[],remove:[],update:[]}))]},g=[...t,c];s(g),S.setFieldsValue({variations:g}),y(c.idNew),f(t.length.toString())},a=c=>{const g=t[c];if(g!=null&&g._id)Z.confirm({title:"האם אתה בטוח שברצונך למחוק את הוריאציה הזו?",content:`המחיקה תסיר לצמיתות את ${g.label}.`,okText:"מחק",okType:"danger",cancelText:"ביטול",onOk:()=>{m(g==null?void 0:g.productId,g._id).then(()=>{const i=[...t];i.splice(c,1),s(i),S.setFieldsValue({sizes:i}),f(Math.max(0,c-1).toString())}).catch(i=>{console.error("Error deleting vatiation:",i)})}});else{const i=[...t];i.splice(c,1),s(i),S.setFieldsValue(j()),f(Math.max(0,c-1).toString()),y(null)}},d=c=>{const g=[...t];g[c]={...g[c],edit:!0},s(g)},o=c=>{switch(c){case"weight":return'ק"ג';case"volume":return"ליטר";case"units":return"יחידות";default:return""}};return e.jsxs(k,{form:S,initialValues:{variations:t},onFinish:(c,g)=>{var i;r({variations:(i=c==null?void 0:c.variations)==null?void 0:i.filter(p=>p)})},children:[!n.length&&e.jsx(Dt,{message:"לא ניתן להוסיף וריאציות",description:"יש להוסיף לפחות גודל אחד לפני שניתן להוסיף וריאציות.",type:"warning",showIcon:!0,style:{marginBottom:"16px"}}),e.jsx(E,{type:"default",icon:e.jsx(Pe,{}),disabled:(n==null?void 0:n.length)===0||!n,onClick:x,children:"הוסף וריאציה"}),e.jsx(k.List,{name:["variations","sizeAdjustments"],children:(c,{add:g,remove:i})=>{me,c.map(({key:p,name:F,fieldKey:C})=>{var I;const w=S.getFieldValue(["variations","sizeAdjustments",p]);return e.jsx(nt,{tab:(w==null?void 0:w.label)||`גודל ${p+1}`,children:!(w!=null&&w._id)||w!=null&&w.edit?e.jsxs("div",{className:w.idNew===u?"highlight-new":"",style:{border:`1px ${w!=null&&w.idNew?"dashed":"solid #e6e6e6"}`,borderRadius:"8px",padding:"16px",background:"#fafafa",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},children:[e.jsxs(M,{justify:"space-between",align:"middle",style:{marginBottom:"12px"},children:[e.jsx(k.Item,{name:["variations","sizeAdjustments",p,"_id"],hidden:!0,children:e.jsx(Q,{})}),e.jsx(k.Item,{name:["variations","sizeAdjustments",p,"label"],label:"שם הוריאציה",rules:[{required:!0,message:"חייב למלא שם גודל"}],children:e.jsx(Q,{placeholder:"שם הוריאציה",size:"middle",style:{width:"auto",minWidth:"200px"}})}),e.jsx(E,{type:"text",style:{alignSelf:"flex-start"},danger:!0,icon:e.jsx(le,{}),title:"מחק וריאציה",onClick:()=>a(p),children:"מחק וריאציה"})]}),e.jsx(k.List,{name:["variations","sizeAdjustments",p],children:(T,{add:_,remove:V})=>e.jsx(me,{tabBarStyle:{direction:"rtl"},style:{margin:"1vw 0"},type:"card",tabPosition:"top",children:T.map(({key:W,name:A,fieldKey:xe})=>{const pe=S.getFieldValue(["variations",index,"sizeAdjustments",A]);return e.jsxs(nt,{tab:(pe==null?void 0:pe.label)||`Size ${A}`,children:[e.jsxs(M,{gutter:[16,16],children:[e.jsx(L,{span:12,children:e.jsx(k.Item,{name:["variations",index,"price"],label:"תוספת מחיר",rules:[{required:!1,message:"יש למלא מחיר"},{type:"number",min:0,message:"המחיר חייב להיות חיובי"}],children:e.jsx(X,{placeholder:"מחיר",style:{width:"100%"}})})}),e.jsx(L,{span:12,children:e.jsx(k.Item,{label:"תוספת זמן הכנה (דקות)",name:["sizes",index,"preparationTime"],rules:[{required:!1,message:"חייב לציין זמן הכנה"}],children:e.jsx(X,{placeholder:"זמן הכנה",style:{width:"100%"}})})})]}),e.jsx(q.Text,{strong:!0,style:{display:"block",marginBottom:"8px"},children:"מרכיבים:"}),e.jsx(k.List,{name:["sizes",index,"ingredients"],children:(Me,{add:oe,remove:he})=>e.jsxs(e.Fragment,{children:[e.jsx(E,{type:"dashed",style:{marginBottom:"0.5vw"},onClick:()=>oe({ingredientId:null,quantity:null,unit:null}),children:"הוסף מרכיב"}),e.jsx("div",{style:{maxHeight:"12vw",overflowY:"auto",overflowX:"hidden"},children:Me.map(({key:Ne,name:$,fieldKey:B})=>e.jsxs(M,{gutter:16,children:[e.jsx(L,{span:10,children:e.jsx(k.Item,{name:[$,"ingredientId"],fieldKey:[B,"ingredientId"],rules:[{required:!0,message:"בחר רכיב"}],children:e.jsx(z,{placeholder:"בחר מרכיב",showSearch:!0,filterOption:(U,J)=>{var K;return(K=J==null?void 0:J.label)==null?void 0:K.toLowerCase().includes(U.toLowerCase())},options:l.map(U=>({value:U._id,label:U.name,unit:U==null?void 0:U.unit}))})})}),e.jsx(L,{span:10,children:e.jsx(k.Item,{name:[$,"quantity"],fieldKey:[B,"quantity"],rules:[{required:!0,message:"הזן כמות"}],children:e.jsx(X,{placeholder:"כמות",addonAfter:o(S.getFieldValue(["sizes",index,"ingredients",$,"unit"])||"")})})}),e.jsx(L,{span:4,children:e.jsx(E,{type:"text",danger:!0,icon:e.jsx(ye,{}),onClick:()=>he($)})})]},Ne))})]})})]},W)})})}),e.jsx(O,{style:{margin:"12px 0"}})]},w.idNew||p):e.jsxs("div",{style:{border:"1px solid #e6e6e6",borderRadius:"8px",padding:"16px",background:"#fafafa",boxShadow:"0 1px 2px rgba(0,0,0,0.05)",marginBottom:"16px"},children:[e.jsx(D,{flex:1,style:{padding:"0em 1em"},justify:"space-between",align:"middle",children:e.jsxs(L,{className:"width-100",children:[e.jsx(D,{flex:1,style:{marginBottom:"8px"},children:e.jsxs(M,{className:"width-100",align:"middle",justify:"space-between",children:[e.jsx(q.Text,{strong:!0,style:{fontSize:"1.2em"},children:size==null?void 0:size.label}),e.jsxs(D,{children:[e.jsx(E,{type:"text",icon:e.jsx(Je,{}),onClick:()=>d(index)}),e.jsx(E,{type:"text",danger:!0,icon:e.jsx(le,{}),onClick:()=>a(index)})]})]})}),e.jsxs(D,{flex:1,align:"middle",style:{gap:"12px",marginBottom:"8px"},children:[e.jsxs(M,{align:"middle",style:{gap:"8px"},children:[e.jsxs(q.Text,{style:{color:"#007acc",fontSize:"1.1em",fontWeight:"bold",display:"flex",alignItems:"center",gap:"4px"},children:["₪",size==null?void 0:size.price]}),e.jsx(N,{style:{fontSize:"0.9em",color:"#007acc"},icon:gt})]}),e.jsxs(M,{align:"middle",style:{gap:"8px"},children:[e.jsxs(q.Text,{style:{fontSize:"1.1em",fontWeight:"bold",display:"flex",alignItems:"center",gap:"4px"},children:[size==null?void 0:size.preparationTime," דקות"]}),e.jsx(N,{style:{fontSize:"0.9em"},icon:Ie})]})]})]})}),e.jsx(O,{style:{margin:"12px 0"}}),e.jsx(q.Text,{strong:!0,style:{display:"block",marginBottom:"8px"},children:"מרכיבים:"}),e.jsx("ul",{style:{paddingLeft:"20px",margin:"0"},children:(I=size==null?void 0:size.ingredients)==null?void 0:I.map((T,_)=>{var W;const V=(()=>{switch(T.unit){case"weight":return'ק"ג';case"volume":return"ליטר";case"units":return"יחידות";default:return""}})();return e.jsx("li",{style:{marginBottom:"4px"},children:e.jsxs(q.Text,{children:[(W=l==null?void 0:l.find(A=>(A==null?void 0:A._id)===(T==null?void 0:T.ingredientId)))==null?void 0:W.name," -"," ",T.quantity," ",V]})},_)})})]},size.idNew||index)},p)})}}),e.jsx(E,{type:"primary",htmlType:"submit",disabled:t.length===0,onClick:()=>y(null),children:"שמור"})]})}),{Title:la,Text:it}=q,qs=({})=>{const{isModalVisible:t,setIsModalVisible:n,modalMode:s,setModalMode:l,selectedItem:r,setSelectedItem:m,addProduct:h,updateProduct:u,deleteProduct:y,addSize:v,updateSize:f,deleteSize:S}=ft(),j=ue({query:"(max-width: 500px)"}),x=H(w=>w.categories),a=H(w=>w.ingredients),d=H(w=>w.mixes),o=H(w=>w.products),c=b.useCallback(()=>{if(!r||!o)return;const w=o.find(I=>I._id===r._id);if(w){const I=((r==null?void 0:r.sizes)||[]).filter(_=>{var V;return _.edit||_._id&&((V=w.sizes)==null?void 0:V.some(W=>W._id===_._id))}).map(_=>{var W;const V=(W=w.sizes)==null?void 0:W.find(A=>A._id===_._id);return V||_}),T=(w.sizes||[]).filter(_=>!((r==null?void 0:r.sizes)||[]).some(V=>V._id===_._id));m({...w,sizes:[...I,...T]})}},[r,o]);b.useEffect(()=>{c()},[o]);const[g]=k.useForm(),i=(w,I,T)=>{if(w==="product")switch(I){case"add":return"הוספת מוצר";case"edit":return"עדכון מוצר";case"view":return"צפייה במוצר";default:return"הוספת מוצר"}else switch(w){case"size":return`ניהול גדלים - ${T==null?void 0:T.name}`;case"variation":return`ניהול וריאציות - ${T==null?void 0:T.name}`}};b.useEffect(()=>{r?g.setFieldsValue(r):g.resetFields()},[r]);const p=w=>{var I,T;switch(t){case"product":const _=g.getFieldsValue();s==="edit"?u({..._,_id:r==null?void 0:r._id}).then(()=>{n(!1),m(null)}).catch(A=>{console.error("שגיאה בעריכת מוצר:",A)}):h(_).then(()=>{n(!1),m(null)}).catch(A=>{console.error("שגיאה בהוספת מוצר:",A)});break;case"size":const V=w,W={productId:r==null?void 0:r._id,label:V.label,price:V.price,preparationTime:V.preparationTime,ingredients:((I=V.ingredients)==null?void 0:I.map(A=>{var xe;return{ingredientId:((xe=A.ingredientId)==null?void 0:xe._id)||A.ingredientId,quantity:A.quantity,unit:A.unit}}))||[],mixes:((T=V.mixes)==null?void 0:T.map(A=>({mixId:A.mixId,quantity:A.quantity,unit:A.unit})))||[],_id:V._id};new Promise((A,xe)=>W._id?f(W._id,W):v(r==null?void 0:r._id,W)).then(()=>{}).catch(A=>{console.error("Error managing sizes:",A)});break}},F=()=>{switch(t){case"product":return e.jsxs(k,{form:g,layout:"vertical",onFinish:p,children:[e.jsx(k.Item,{name:"name",label:"שם מוצר",rules:[{required:!0,message:"אנא הזן שם מוצר"},{max:25,message:"שם המוצר לא יכול להיות יותר מ-25 תווים"}],children:e.jsx(Q,{maxLength:25,showCount:!0})}),e.jsx(k.Item,{name:"category",label:"קטגוריה",rules:[{required:!0,message:"אנא בחר קטגוריה"}],children:e.jsx(z,{showSearch:!0,placeholder:"בחר קטגוריה",optionFilterProp:"children",filterOption:(w,I)=>I.children.toLowerCase().indexOf(w.toLowerCase())>=0,children:x.map(w=>e.jsx(z.Option,{value:w._id,children:w==null?void 0:w.name},w._id))})}),e.jsx(k.Item,{name:"isFeatured",label:"פעיל",children:e.jsx(Ke,{checkedChildren:"פעיל",unCheckedChildren:"לא פעיל"})}),e.jsx(k.Item,{name:"isOnSale",label:"מוצר מכירה",children:e.jsx(Ke,{checkedChildren:"פעיל",unCheckedChildren:"לא פעיל"})}),e.jsx(k.Item,{name:"notes",label:"הערות",rules:[{required:!1,message:"אנא הזן הערות"},{max:250,message:"ההערות לא יכולות להיות יותר מ-250 תווים"}],children:e.jsx(Q.TextArea,{rows:4,maxLength:250,showCount:!0})}),e.jsx(k.Item,{children:e.jsx(E,{type:"primary",htmlType:"submit",children:"שמור מוצר"})})]});case"size":return e.jsx(st,{value:r==null?void 0:r.sizes,setValue:m,ingredients:a,sizeSummary:r==null?void 0:r.sizeSummary,priceExcludingVAT:r==null?void 0:r.priceExcludingVAT,mixes:d,onDelete:S,onSubmit:p,onChange:w=>m({...r,sizes:w})});case"variation":return e.jsx(rt,{value:r==null?void 0:r.variations,form:formVariation,setValue:m,sizes:r==null?void 0:r.sizes,ingredients:a,onChange:w=>m({...r,variations:w})});default:return null}},C=()=>{var w,I;switch(t){case"product":return e.jsxs(Y,{styles:{body:{display:"flex",flexDirection:"column"}},children:[e.jsxs(M,{align:"middle",justify:"space-between",style:{margin:"1em 0em"},children:[e.jsx(it,{strong:!0,style:{fontSize:"1.5em"},children:r==null?void 0:r.name}),e.jsxs(M,{style:{gap:"0.5em"},children:[e.jsx(ne,{className:r!=null&&r.isFeatured?"green":"red",children:r!=null&&r.isFeatured?"פעיל":"לא פעיל"}),e.jsx(ne,{className:r!=null&&r.isOnSale?"blue":"yellow",children:r!=null&&r.isOnSale?"במבצע":"לא במבצע"})]}),e.jsx(ne,{children:(w=x==null?void 0:x.find(T=>T._id===(r==null?void 0:r.category)))==null?void 0:w.name})]}),e.jsxs("div",{style:{marginBottom:"12px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(D,{flex:1,children:e.jsxs(it,{strong:!0,children:["הערות",":"]})}),e.jsx(D,{flex:1,children:e.jsx("p",{style:{},children:r==null?void 0:r.notes})})]}),e.jsx(O,{style:{margin:"8px 0"}}),e.jsx(D,{flex:1,style:{flexDirection:"column",maxHeight:"50vh",overflowY:"auto"},children:(I=r==null?void 0:r.sizes)==null?void 0:I.map((T,_)=>e.jsx(wt,{handleEditSize:!1,handleRemoveSize:!1,index:_,size:T,ingredients:a,mixes:d,priceExcludingVAT:(r==null?void 0:r.priceExcludingVAT)&&(r==null?void 0:r.priceExcludingVAT[_].priceExcludingVAT),sizeSummary:(r==null?void 0:r.sizeSummary)&&(r==null?void 0:r.sizeSummary[_])}))})]});case"size":return e.jsx(st,{value:r==null?void 0:r.sizes,setValue:m,ingredients:a,sizeSummary:r==null?void 0:r.sizeSummary,priceExcludingVAT:r==null?void 0:r.priceExcludingVAT,mixes:d,onDelete:S,onSubmit:p,onChange:T=>m({...r,sizes:T})});case"variation":return e.jsx(rt,{value:r==null?void 0:r.variations,mode:"view",ingredients:a,onChange:T=>m({...r,variations:T})});default:return null}};return e.jsx(Z,{style:{top:j?"3em":""},title:i(t,s,r),open:t,onCancel:()=>{n(!1),m()},footer:null,destroyOnClose:!0,width:j?"100%":600,styles:{gap:"0.5em"},children:s==="view"?C():F()})},{Search:Ls}=Q;function _e({dataPrint:t,data:n,tableKeys:s,newTitle:l,setDataPrint:r,searchKeys:m,sortKeys:h,mobileKeys:u,Dtitle:y,Dcontent:v,onAdd:f,onEdit:S,onDelete:j,width:x,ingredientsArr:a,iconADD:d,floatAction:o,type:c,openModalProduct:g}){const[i,p]=b.useState([]),[F,C]=b.useState(!1),[w,I]=b.useState(!1),[T,_]=b.useState("add"),[V,W]=b.useState(null),A=ue({query:"(max-width: 500px)"}),xe=h.map($=>({key:$==null?void 0:$.key,label:e.jsx("span",{className:"width-100",onClick:()=>{const B=[...t].sort((U,J)=>{const K=U[$==null?void 0:$.key],ie=J[$==null?void 0:$.key];return typeof K=="number"&&typeof ie=="number"?ie-K:K==null?void 0:K.toString().localeCompare(ie==null?void 0:ie.toString())});r(B)},children:$==null?void 0:$.title})})),pe=$=>{if($==="all")p(s);else{let B=i.findIndex(J=>J.key===$),U=[...i];B!==-1?U=U.filter(J=>J.key!==$):U=[...U,s.find(J=>J.key===$)],p(U)}},Me=[{key:"all",label:e.jsx(De,{className:"width-100",rootClassName:"width-100",checked:i.length===s.length,disabled:i.length===s.length,onChange:()=>pe("all"),onClick:$=>$.stopPropagation(),children:"הכל"})},...s.filter($=>!($!=null&&$.required)).map(({title:$,dataIndex:B})=>({key:B,label:e.jsx(De,{className:"width-100",rootClassName:"width-100",checked:i.some(U=>U.key===B),disabled:i.length<=3&&i.some(U=>U.key===B),onChange:()=>pe(B),onClick:U=>U.stopPropagation(),children:$})}))],oe=($,B=null)=>{if(c==="P")return g($,B);_($),W(B),I(!0)},he=()=>{I(!1),W(null)},Ne=$=>{Z.confirm({title:y,content:v,okText:"מחק",cancelText:"בטל",onOk:()=>j($==null?void 0:$._id)})};return b.useEffect(()=>{p(s)},[s]),e.jsxs(D,{flex:1,vertical:!0,style:{maxWidth:"100%"},gap:"1em",className:"container",children:[e.jsxs(M,{align:"middle",style:{flexFlow:""},justify:"space-between",children:[!A&&e.jsx(M,{style:{},children:e.jsx(E,{onClick:()=>oe("add"),type:"primary",children:l})}),e.jsx(M,{style:{},children:e.jsx(Ls,{placeholder:"חיפוש ...",allowClear:!0,onChange:({target:$})=>{r(n==null?void 0:n.filter(B=>m.some(U=>{var J,K,ie;return(ie=(K=(J=B[U])==null?void 0:J.toString())==null?void 0:K.toLowerCase())==null?void 0:ie.includes($.value.toLowerCase())})))},style:{width:200}})}),e.jsxs(M,{style:{gap:"0.5em"},children:[!A&&e.jsx(Ze,{menu:{items:Me},trigger:["click"],open:F,onOpenChange:$=>C($),children:e.jsxs(E,{children:[e.jsx(N,{icon:zt,style:{marginLeft:"8px"}}),A?e.jsx(e.Fragment,{children:`${i.length} / ${s.length}`}):e.jsx(e.Fragment,{children:`בחרת ${i.length} מתוך ${s.length}`})]})}),e.jsx(Ze,{menu:{items:xe},trigger:["click"],children:e.jsxs(E,{type:A?"link":"default",children:[e.jsx(N,{icon:Jt,style:{marginLeft:"8px"}}),"מיון"]})})]})]}),e.jsxs(Oe.Group,{trigger:"click",type:"primary",icon:e.jsx(N,{icon:Gt}),children:[e.jsx(Oe,{type:"primary",onClick:()=>oe("add"),icon:d}),o==null?void 0:o.map(($,B)=>e.jsx(Be.Fragment,{children:$},`float-action-${B}`))]}),e.jsx(ks,{data:t,tableKeys:[{title:"פעולות",key:"action",minWidth:130,render:($,B)=>e.jsxs(M,{className:"card-actions",align:"middle",justify:"center",children:[e.jsx(E,{type:"text",onClick:()=>Ne(B),children:e.jsx(N,{icon:pt})}),e.jsx(E,{type:"text",onClick:()=>oe("edit",B),children:e.jsx(N,{icon:mt})}),e.jsx(E,{type:"text",onClick:()=>oe("view",B),children:e.jsx(N,{icon:ht})})]})},...i],openModal:oe,mobileKeys:u,type:c,Dtitle:y,Dcontent:v,onDelete:j}),e.jsx(Z,{style:{top:A?"3em":""},title:T==="add"?"הוסף פריט חדש":T==="edit"?"ערוך פריט":"צפייה בפרטי פריט",open:w,onCancel:he,footer:null,destroyOnClose:!0,width:A?"100%":x||600,children:c!=="P"&&e.jsx(Es,{mode:T,tableKeys:i,ingredientsArr:a,fields:s.filter($=>$.editable||T==="view"),onSubmit:$=>{T==="add"&&f($),T==="edit"&&S({...V,...$}),he()},initialValues:V||{},onClose:he})})]})}const ke="https://menu-server-c2b952e2c698.herokuapp.com/api",Hs=t=>R.post(`${ke}/categories`,t),Vs=t=>{const n=encodeURIComponent(t._id);return R.put(`${ke}/categories/${n}`,t)},Ds=t=>R.delete(`${ke}/categories/${t}`),Os=()=>R.get(`${ke}/categories`),vt=b.createContext(),Us=()=>b.useContext(vt),Ws=({children:t})=>{const[n,s]=b.useState(!1),l=async h=>{s(!0);try{await Hs(h),P.success("הקטגוריה נוספה בהצלחה"),s(!1)}catch(u){console.error("Error adding category:",u),P.error("שגיאה בהוספת הקטגוריה"),s(!1)}},r=async h=>{s(!0);try{await Vs(h),P.success("הקטגוריה עודכנה בהצלחה"),s(!1)}catch(u){console.error("Error updating category:",u),P.error("שגיאה בעדכון הקטגוריה"),s(!1)}},m=async h=>{s(!0);try{await Ds(h),P.success("הקטגוריה נמחקה בהצלחה"),s(!1)}catch(u){console.error("Error deleting category:",u),P.error("שגיאה במחיקת הקטגוריה"),s(!1)}};return e.jsx(vt.Provider,{value:{addCategory:l,updateCategory:r,deleteCategory:m,loading:n},children:t})},{Title:at,Text:Bs}=q,Ys=({isCategoryModalVisible:t,setIsCategoryModalVisible:n})=>{const{addCategory:s,updateCategory:l,deleteCategory:r}=Us(),m=H(c=>c.categories),[h,u]=b.useState(""),[y,v]=b.useState(null),[f,S]=b.useState(""),j=()=>{if(h.trim()===""){S("אנא הזן שם קטגוריה תקין");return}if(m.some(c=>c.name===h.trim()&&c!==y)){S("קטגוריה זו כבר קיימת");return}y?l({...y,name:h.trim()}):s({name:h.trim()}),u(""),v(null),S("")},x=c=>{v(c),u(c.name)},a=()=>{if(h.trim()===""){S("אנא הזן שם קטגוריה תקין");return}l({...y,name:h.trim()}),u(""),v(null),S("")},d=c=>{r(c)},o=()=>{u(""),v(null),S(""),n(!1)};return e.jsxs(Z,{title:y?"ערוך קטגוריה":"הוסף קטגוריה חדשה",open:t,onCancel:o,footer:null,className:"category-modal popup-modal",children:[e.jsxs("div",{className:"category-form-section",children:[e.jsx(at,{level:4,children:y?"ערוך קטגוריה":"הוסף קטגוריה חדשה"}),e.jsx(Q,{placeholder:"הזן שם קטגוריה",value:h,onChange:c=>u(c.target.value),onPressEnter:j}),f&&e.jsx(Bs,{type:"danger",className:"error-message",children:f}),e.jsx(E,{type:"primary",onClick:j,style:{marginTop:"10px"},children:y?"עדכן קטגוריה":"הוסף קטגוריה"})]}),e.jsxs("div",{className:"category-list-section",children:[e.jsx(at,{level:4,style:{marginTop:"20px"},children:"קטגוריות קיימות:"}),e.jsx(se,{dataSource:m,renderItem:c=>e.jsx(se.Item,{className:y&&y._id===c._id?"editing-item":"",actions:[y&&y._id===c._id?e.jsx(E,{type:"link",onClick:a,children:"שמור"}):e.jsx(E,{type:"link",onClick:()=>x(c),children:"ערוך"}),e.jsx(Qe,{title:"האם אתה בטוח שברצונך למחוק את הקטגוריה?",onConfirm:()=>d(c._id),okText:"כן",cancelText:"לא",children:e.jsx(E,{icon:e.jsx(le,{}),type:"text",danger:!0})})],children:y&&y._id===c._id?e.jsx(Q,{value:h,onChange:g=>u(g.target.value),onPressEnter:a,autoFocus:!0}):c.name})})]})]})},Qs=({categories:t,isMobile:n,selectedCategory:s,setSelectedCategory:l,setIsCategoryModalVisible:r})=>{const m=b.useRef(null),h=b.useRef({}),u=()=>{m.current.scrollBy({left:200,behavior:"smooth"})},y=()=>{m.current.scrollBy({left:-200,behavior:"smooth"})},v=f=>{l(f),h.current[f]&&h.current[f].scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})};return e.jsx("div",{style:{padding:"16px",backgroundColor:"#f0f2f5"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(E,{icon:e.jsx(ts,{}),onClick:u}),e.jsxs("div",{ref:m,style:{display:"flex",overflowX:"auto",flexGrow:1,gap:"8px",padding:"8px 0",scrollbarWidth:"none",msOverflowStyle:"none"},children:[e.jsx(E,{type:s==="all"?"primary":"default",onClick:()=>v("all"),children:"הכל"}),t.map(f=>e.jsx(E,{ref:S=>h.current[f._id]=S,type:s===f._id?"primary":"default",onClick:()=>v(f._id),children:f.name},f._id))]}),e.jsx(E,{icon:e.jsx(ss,{}),onClick:y}),!n&&e.jsx(E,{type:"primary",icon:e.jsx(Pe,{}),onClick:()=>r(!0)})]})})};function zs(){const{addProduct:t,updateProduct:n,deleteProduct:s,isModalVisible:l,setIsModalVisible:r,modalMode:m,setModalMode:h,selectedItem:u,setSelectedItem:y}=ft(),v=ue({query:"(max-width: 500px)"});b.useRef(null);const[f,S]=b.useState([]),[j,x]=b.useState([]),[a,d]=b.useState("all"),[o,c]=b.useState(!1),g=H(T=>T.products),i=H(T=>T.categories),p=H(T=>T.ingredients),F=["name","category"],C=["name","category","detailes","sizes","productSummary","actions"],w=[{key:"name",dataIndex:"name",title:"שם",required:!0},{key:"category",dataIndex:"category",title:"קטגוריה"},{key:"profitMargin",dataIndex:"profitMargin",title:"אחוז רווח"}],I=b.useMemo(()=>[{key:"name",dataIndex:"name",title:"שם המוצר",editable:!0,type:"text",rules:[{required:!0,message:"חייב להיות שם מוצר"},{min:2,message:"שם חייב להיות לפחות 2 תווים"}]},{key:"category",dataIndex:"category",title:"קטגוריה",editable:!0,type:"select",render:(T,_)=>{var V,W;return console.log(_==null?void 0:_.category),console.log(i),console.log((V=i==null?void 0:i.find(A=>A._id===(_==null?void 0:_.category)))==null?void 0:V.name),e.jsx(ne,{children:(W=i==null?void 0:i.find(A=>A._id===(_==null?void 0:_.category)))==null?void 0:W.name})},options:i.map(T=>({value:T._id,label:T.name})),rules:[{required:!0,message:"יש לבחור קטגוריה"}]},{key:"detailes",width:100,render:(T,_)=>e.jsxs(M,{style:{gap:"0.5em"},align:"middle",justify:"center",children:[e.jsx(ne,{className:_!=null&&_.isFeatured?"green":"red",children:_!=null&&_.isFeatured?"פעיל":"לא פעיל"}),e.jsx(ne,{className:_!=null&&_.isOnSale?"blue":"yellow",children:_!=null&&_.isOnSale?"במבצע":"לא במבצע"})]})},{key:"sizes",title:"גדלים",type:"custom",editable:!0,render:(T,_,V="view",W)=>{var A;return(A=_==null?void 0:_.sizes)==null?void 0:A.length}},{key:"variations",title:"ווריאציות",type:"custom",editable:!0,render:(T,_,V="view",W)=>{var A;return(A=_==null?void 0:_.variations)==null?void 0:A.length}},{key:"productSummary",dataIndex:"productSummary",title:"אחוז רווח (ממוצע)",width:150,render:(T,_)=>{var V;return`${((V=_==null?void 0:_.productSummary)==null?void 0:V.averageProfitMargin)||0}%`}},{key:"actions",dataIndex:"actions",width:200,render:(T,_)=>e.jsx("div",{className:"",style:{display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs(E,{type:"text",onClick:()=>{r("size"),y(_)},children:[e.jsx("p",{children:"גדלים"}),e.jsx(N,{icon:ve})]})})}],[i]);return b.useEffect(()=>{if(g){const T=a&&a!=="all"?g.filter(_=>_.category===a):g;S(T),x(T)}},[g,a]),e.jsxs("div",{style:{display:"flex",flexDirection:"column",maxWidth:"100%",height:"100%",width:"100%",overflow:"hidden","- webkit - overflow - scrolling":"touch"},children:[e.jsx(Qs,{categories:i,isMobile:v,selectedCategory:a,setIsCategoryModalVisible:c,setSelectedCategory:d}),e.jsx(D,{flex:1,children:e.jsx(_e,{type:"P",data:f,mobileKeys:C,dataPrint:j,sortKeys:w,tableKeys:I,newTitle:"הוסף מוצר חדש",searchKeys:F,setDataPrint:x,onAdd:t,onEdit:n,onDelete:s,ingredientsArr:p,Dtitle:"אישור מחיקה",Dcontent:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"האם אתה בטוח שברצונך למחוק את המוצר?"}),e.jsx("p",{children:"שים לב! מחיקת מוצר עשויה להשפיע על מכירות ותערובות קשורות."})]}),iconADD:e.jsx(N,{icon:Se}),floatAction:[e.jsx(Oe,{type:"primary",onClick:()=>c(!0),icon:e.jsx(N,{icon:ve})})],openModalProduct:(T,_)=>{r("product"),h(T),_&&y(_)}})}),e.jsx(Ys,{isCategoryModalVisible:o,setIsCategoryModalVisible:c}),e.jsx(qs,{})]})}const Fe="https://menu-server-c2b952e2c698.herokuapp.com/api",Js=t=>R.post(`${Fe}/suppliers`,t),Gs=t=>{const n=encodeURIComponent(t._id);return R.put(`${Fe}/suppliers/${n}`,t)},Xs=t=>R.delete(`${Fe}/suppliers/${t}`),Ks=()=>R.get(`${Fe}/suppliers`),St=b.createContext(),Zs=()=>b.useContext(St),en=({children:t})=>{const[n,s]=b.useState(!1),l=async h=>{s(!0);try{await Js(h),P.success("הספק נוסף בהצלחה"),s(!1)}catch(u){console.error("Error adding supplier:",u),P.error("שגיאה בהוספת הספק"),s(!1)}},r=async h=>{s(!0);try{await Gs(h),P.success("הספק עודכן בהצלחה"),s(!1)}catch(u){console.error("Error updating supplier:",u),P.error("שגיאה בעדכון הספק"),s(!1)}},m=async h=>{s(!0);try{await Xs(h),P.success("הספק נמחק בהצלחה"),s(!1)}catch(u){console.error("Error deleting supplier:",u),P.error("שגיאה במחיקת הספק"),s(!1)}};return e.jsx(St.Provider,{value:{addSupplier:l,updateSupplier:r,deleteSupplier:m,loading:n},children:t})};function tn(){const{addSupplier:t,updateSupplier:n,deleteSupplier:s}=Zs(),l=H(x=>x.suppliers),r=H(x=>x.ingredients),[m,h]=b.useState([]),[u,y]=b.useState([]),v=["name"],f=["name","phone","email","contect_name","address",,"second_phone","notes"],S=[{key:"name",dataIndex:"name",title:"שם",required:!0},{key:"usedCount",dataIndex:"usedCount",title:"כמות רכיבים"}],j=[{key:"name",dataIndex:"name",title:"שם הספק",editable:!0,type:"text",width:100,rules:[{required:!0,message:"חייב להיות שם ספק"},{min:3,message:"שם ספק חייב להיות לפחות 3 תווים"}]},{key:"usedCount",dataIndex:"usedCount",title:"כמות רכיבים",editable:!1},{key:"phone",dataIndex:"phone",title:"טלפון",editable:!0,type:"text",width:100,rules:[{required:!0,message:"חייב להיות מספר טלפון"},{pattern:/^[0-9]{9,10}$/,message:"טלפון חייב להיות מספר תקין באורך 9-10 ספרות"}]},{key:"email",dataIndex:"email",title:"אימייל",editable:!0,type:"text",width:100,rules:[{required:!0,message:"חייב להיות אימייל"},{type:"email",message:"אימייל לא תקין"}]},{key:"contect_name",dataIndex:"contect_name",title:"איש קשר",editable:!0,type:"text",width:100,rules:[{required:!0,message:"חייב להיות איש קשר"},{min:3,message:"איש קשר חייב להיות לפחות 3 תווים"}]},{key:"address",dataIndex:"address",title:"כתובת",editable:!0,type:"text",width:150,rules:[{required:!0,message:"חייבת להיות כתובת"},{min:5,message:"כתובת חייבת להיות לפחות 5 תווים"}]},{key:"second_phone",dataIndex:"second_phone",title:"טלפון נוסף",editable:!0,type:"text",width:100,rules:[{pattern:/^[0-9]{9,10}$/,message:"טלפון חייב להיות מספר תקין באורך 9-10 ספרות"}]},{key:"notes",dataIndex:"notes",title:"הערות",editable:!0,type:"textArea",maxLength:120,width:150,rules:[{required:!1},{max:120,message:"מקסימום 120 תווים"}],render:(x,a)=>{const d=(a==null?void 0:a.notes)||"—";return e.jsx(Ce,{title:d,children:e.jsx("span",{style:{display:"inline-block",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",maxWidth:"150px"},children:d})})}}];return b.useEffect(()=>{if(l){const x=l.map(a=>{const d=r==null?void 0:r.filter(o=>o.supplierId===a._id).length;return{...a,usedCount:d}});h(x),y(x)}},[l,r]),e.jsx(_e,{data:m,mobileKeys:f,dataPrint:u,sortKeys:S,tableKeys:j,newTitle:"הוסף חומר גלם חדש",searchKeys:v,setDataPrint:y,onAdd:t,onEdit:n,onDelete:s,Dtitle:"אישור מחיקה",iconADD:e.jsx(N,{icon:ze}),Dcontent:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"האם אתה בטוח שברצונך למחוק את הספק?"}),e.jsx("p",{children:"שים לב! במחיקת ספק אתה תמחוק את כל הרכיבים שלו וכן הם כמובן ימחקו מכל התערובות והמוצרים."})]})})}const Te="https://menu-server-c2b952e2c698.herokuapp.com/api",sn=t=>R.post(`${Te}/ingredients`,t),nn=t=>{const n=encodeURIComponent(t._id);return R.put(`${Te}/ingredients/${n}`,t)},rn=t=>R.delete(`${Te}/ingredients/${t}`),an=()=>R.get(`${Te}/ingredients`),bt=b.createContext(),ln=()=>b.useContext(bt),on=({children:t})=>{const[n,s]=b.useState(!1),l=async h=>{s(!0);try{await sn(h),P.success("החומר גלם נוסף בהצלחה"),s(!1)}catch{P.error("שגיאה בהוספת חומר הגלם"),s(!1)}},r=async h=>{s(!0);try{await nn(h),P.success("החומר גלם עודכן בהצלחה"),s(!1)}catch{P.error("שגיאה בעדכון חומר הגלם"),s(!1)}},m=async h=>{s(!0);try{await rn(h),P.success("החומר גלם נמחק בהצלחה"),s(!1)}catch{P.error("שגיאה במחיקת חומר הגלם"),s(!1)}};return e.jsx(bt.Provider,{value:{addIngredient:l,updateIngredient:r,deleteIngredient:m,loading:n},children:t})},ce=[{color:"magenta",value:"פירות טריים"},{color:"volcano",value:"פירות קפואים"},{color:"orange",value:"תמציות, ממרחים ותוספות"},{color:"gold",value:"אבקות"},{color:"lime",value:"גלידות וסורבה"},{color:"green",value:"מאפים ועוגיות"},{color:"cyan",value:"אריזות וחד פעמי"},{color:"blue",value:"מוצרי חלב"}],ae=[{value:"weight",label:"משקל",display:t=>t>=1?'ק"ג':"גרם"},{value:"volume",label:"נפח",display:t=>t>=1?"ליטר":'מ"ל'},{value:"units",label:"יחידות",display:()=>"יחידות"}],{Text:dn}=q;function cn(){const t=H(d=>d.suppliers),n=H(d=>d.ingredients),s=H(d=>d.products),l=H(d=>d.mixes),{addIngredient:r,updateIngredient:m,deleteIngredient:h}=ln(),[u,y]=b.useState([]),[v,f]=b.useState([]),S=["name","type","supplierId"],j=["unit","unitPrice","supplierId","usedInMixes","usedInProducts"],x=[{key:"name",dataIndex:"name",title:"שם",required:!0},{key:"type",dataIndex:"type",title:"סוג"},{key:"usedCount",dataIndex:"usedCount",title:"בשימוש"},{key:"unit",dataIndex:"unit",title:"יחידת מידה"},{key:"supplierName",dataIndex:"supplierName",title:"שם ספק"}],a=[{key:"SKU",dataIndex:"SKU",title:'מק"ט',editable:!0,type:"number",width:100,rules:[{validator:async(d,o,c)=>o?typeof o!="number"?Promise.reject('מק"ט חייב להיות מספר תקין'):o.toString().length<6?Promise.reject('מק"ט חייב להיות מינימום 6 ספרות'):u.some(i=>i.SKU===o&&i._id!==(c==null?void 0:c._id))?Promise.reject('מק"ט זה כבר קיים במערכת'):Promise.resolve():Promise.resolve()}]},{key:"name",dataIndex:"name",title:"שם",required:!0,editable:!0,type:"text",width:100,rules:[{required:!0,message:"השדה חובה"},{min:3,message:"השם חייב להיות לפחות 3 תווים"},{pattern:/^[א-תa-zA-Z\s0-9%-]+$/,message:"השם יכול להכיל אותיות בעברית או אנגלית, מספרים והתווים הבאים: ' % ', ' - '"}]},{key:"supplierId",dataIndex:"supplierId",title:"שם ספק",editable:!0,type:"select",width:100,render:(d,o)=>{var c;return e.jsx("p",{children:(c=t==null?void 0:t.find(g=>(g==null?void 0:g._id)===(o==null?void 0:o.supplierId)))==null?void 0:c.name})},options:t==null?void 0:t.map(d=>({value:d._id,label:d==null?void 0:d.name})),rules:[{required:!0,message:"יש לבחור ספק"},{validator:(d,o)=>(t==null?void 0:t.some(g=>g._id===o))?Promise.resolve():Promise.reject("ספק לא חוקי נבחר")}]},{key:"usedCount",dataIndex:"usedCount",title:"בשימוש",editable:!1,width:100},{key:"type",dataIndex:"type",title:"סוג",render:(d,o)=>{var c;return e.jsx(ne,{color:(c=ce==null?void 0:ce.find(g=>g.value===(o==null?void 0:o.type)))==null?void 0:c.color,children:o==null?void 0:o.type})},type:"select",required:!0,editable:!0,options:ce.map(d=>({value:d.value,label:d.value})),divider:!0,width:100,rules:[{required:!0,message:"יש לבחור סוג"},{validator:(d,o)=>(ce==null?void 0:ce.some(g=>g.value===o))?Promise.resolve():Promise.reject("סוג לא חוקי נבחר")}]},{key:"unit",dataIndex:"unit",title:"יחידת מידה",editable:!0,type:"select",options:ae,width:100,render:(d,o)=>{var c;return e.jsx("p",{children:((c=ae.find(g=>g.value===(o==null?void 0:o.unit)))==null?void 0:c.label)||(o==null?void 0:o.unit)})},rules:[{required:!0,message:"יש לבחור יחידת מידה"},{validator:(d,o)=>(ae==null?void 0:ae.some(g=>g.value===o))?Promise.resolve():Promise.reject("יחידת מידה לא חוקית")}]},{key:"quantity",dataIndex:"quantity",title:"כמות",editable:!0,type:"custom",width:100,render:(d,o,c,g)=>{if(c=="edit")return e.jsx(k.Item,{name:"quantity",label:"כמות",rules:[{required:!0,message:"אנא הזן כמות"},{validator:(F,C)=>(g.getFieldValue("subUnit"),C==null?Promise.reject("כמות נדרשת"):C<0?Promise.reject("הכמות לא יכולה להיות שלילית"):(g.getFieldValue("subUnit")==="g"||g.getFieldValue("subUnit")==="ml")&&(C<.1||C>999)?Promise.reject('עבור גרם או מ"ל הכמות חייבת להיות בין 0.1 ל-999'):(g.getFieldValue("subUnit")==="kg"||g.getFieldValue("subUnit")==="liter")&&(C<1||C>1e6)?Promise.reject('עבור ק"ג או ליטר הכמות חייבת להיות מ-1 ומעלה, ובתוך הטווח המותר'):Promise.resolve())}],children:e.jsx(X,{style:{width:"100%"}})},"quantity");let i=o.unit,p="";return i==="weight"?p=o.quantity>=1?'ק"ג':"גרם":i==="volume"?p=o.quantity>=1?"ליטר":'מ"ל':i==="units"&&(p="יחידות"),e.jsxs("p",{children:[o.quantity<1?o.quantity*1e3:o.quantity," ",p]})}},{key:"price",dataIndex:"price",title:"מחיר כולל מעמ",render:(d,o)=>e.jsxs("p",{children:["₪",o==null?void 0:o.price]}),editable:!0,type:"number",coin:!0,width:100,rules:[{required:!0,message:"מחיר חסר"}],show:!1},{key:"priceExcludingVAT",dataIndex:"priceExcludingVAT",width:100,title:"מחיר ללא מעמ",render:(d,o)=>e.jsxs("p",{children:["₪",o==null?void 0:o.priceExcludingVAT]}),editable:!1,hiddenInForm:!0},{key:"unitPrice",dataIndex:"unitPrice",title:"כמות מינימלית",width:100,render:(d,o)=>e.jsxs(L,{children:[e.jsxs(M,{children:[e.jsxs("p",{children:[o.unitQuantity<1?o.unitQuantity*1e3:o.unitQuantity," ",o==null?void 0:o.unitDescription]}),e.jsx("br",{})]}),e.jsxs("p",{children:["₪",o==null?void 0:o.unitPrice]})]})},{key:"juiceRatio",dataIndex:"juiceRatio",title:"יחס עיבוד (תפוקת חומר מעובד)",editable:!0,width:100,type:"custom",render:(d,o,c,g)=>c=="view"||c!=="edit"?e.jsx("p",{children:o!=null&&o.juiceRatio?`${((o==null?void 0:o.juiceRatio)*100).toFixed(0)}%`:""}):e.jsxs(e.Fragment,{children:[e.jsx(k.Item,{name:"isJuice",valuePropName:"checked",style:{marginBottom:0},children:e.jsx(De,{onChange:i=>{g.setFieldsValue({isJuice:i.target.checked}),i.target.checked||g.setFieldsValue({juiceRatio:void 0})},children:"האם הרכיב דורש עיבוד?"})}),e.jsx(k.Item,{noStyle:!0,shouldUpdate:(i,p)=>i.isJuice!==p.isJuice,children:({getFieldValue:i})=>i("isJuice")&&e.jsx(k.Item,{name:"juiceRatio",label:"יחס המיץ (0.1 עד 0.99)",rules:[{required:!0,message:"אנא הזן יחס מיץ"},{type:"number",min:.1,max:.99,message:"היחס חייב להיות בין 0.1 ל-0.99"}],children:e.jsx(X,{style:{width:"100%"}})})})]})},{key:"processedPrice",dataIndex:"processedPrice",title:"מחיר לכמות מינימלית מעובדת",width:100,render:(d,o)=>e.jsx("p",{children:o!=null&&o.processedPrice?`₪${o==null?void 0:o.processedPrice}`:""}),editable:!1,hiddenInForm:!0},{key:"notes",dataIndex:"notes",title:"הערות",width:100,editable:!0,render:(d,o)=>{const c=(o==null?void 0:o.notes)||"—";return e.jsx(Ce,{title:c,children:e.jsx(dn,{style:{display:"inline-block",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",maxWidth:"150px",direction:"rtl"},children:c})})},type:"textArea",maxLength:120,rules:[{required:!1},{max:120,message:"מקסימום 120 תווים"}]}];return b.useEffect(()=>{if(n)if(t){let d=[...n==null?void 0:n.map(o=>{let c=t==null?void 0:t.find(p=>(p==null?void 0:p._id)===(o==null?void 0:o.supplierId));const g=(s==null?void 0:s.reduce((p,F)=>{var C;return p+((C=F.ingredients)==null?void 0:C.filter(w=>w.ingredientId===o._id).length)},0))||0,i=(l==null?void 0:l.reduce((p,F)=>{var C;return p+((C=F.ingredients)==null?void 0:C.filter(w=>w.ingredientId===o._id).length)},0))||0;return{...o,supplierName:c==null?void 0:c.name,usedCount:g+i}})];y(d),f(d)}else y([...n]),f([...n])},[t,n]),e.jsx(e.Fragment,{children:e.jsx(_e,{data:u,mobileKeys:j,dataPrint:v,sortKeys:x,tableKeys:a,newTitle:"הוסף חומר גלם חדש",searchKeys:S,setDataPrint:f,onAdd:r,onEdit:m,onDelete:h,Dtitle:"אישור מחיקה",iconADD:e.jsx(N,{icon:be}),Dcontent:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"האם אתה בטוח שברצונך למחוק את הרכיב?"}),e.jsx("p",{children:"שים לב! הרכיב יימחק מכל המוצרים והתערובות בהם הוא נמצא."})]})})})}is.register(as,ls,os,ds,cs,us);const{Text:un}=q,xn=["#4E79A7","#F28E2B","#E15759","#76B7B2","#59A14F"];function pn(){const t=H(x=>x.categories),n=H(x=>x.products),s=H(x=>x.suppliers),l=H(x=>x.ingredients),r=H(x=>x.mixes),m=H(x=>x.employees),h=ue({query:"(max-width: 500px)"}),u=b.useMemo(()=>{const x=n.reduce((a,d)=>{var c;const o=((c=t.find(g=>g._id===d.category))==null?void 0:c.name)||"לא מוגדר";return a[o]=(a[o]||0)+1,a},{});return{labels:Object.keys(x),datasets:[{data:Object.values(x),backgroundColor:xn}]}},[n,t]),y=b.useMemo(()=>[...l].sort((x,a)=>(a.unitPrice||0)-(x.unitPrice||0)).slice(0,5).map(x=>({name:x.name,price:x.unitPrice})),[l]),v=b.useMemo(()=>[...r].map(x=>{const a=x.totalCost/x.totalWeight;return{name:x.name,costPerLiter:a}}).sort((x,a)=>(a.costPerLiter||0)-(x.costPerLiter||0)).slice(0,5),[r]),f={labels:y.map(x=>x.name),datasets:[{label:"מחיר ל-100 גרם",data:y.map(x=>x.price),backgroundColor:"#FF8042"}]},S={labels:v.map(x=>x.name),datasets:[{label:"עלות לליטר",data:v.map(x=>x.costPerLiter),backgroundColor:"#8884d8"}]},j=b.useMemo(()=>n.filter(x=>x.profitMargin<=90).slice(0,3).map(x=>({key:x._id,name:x.name,profitMargin:x.profitMargin})),[n]);return e.jsxs("div",{className:"dashboard-container",style:{padding:h?"10px":"20px"},children:[e.jsxs(M,{gutter:[5,5],wrap:!0,children:[e.jsx(L,{xs:12,sm:12,md:10,lg:8,xl:6,children:e.jsx(G,{to:"/menu",children:e.jsxs(Y,{className:"dashboard-card",children:[e.jsx("div",{className:"icon-circle green",children:e.jsx(N,{icon:Se})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-title",children:"מוצרים"}),e.jsx("div",{className:"stat-value",children:n.length})]})]})})}),e.jsx(L,{xs:12,sm:12,md:10,lg:8,xl:6,children:e.jsx(G,{to:"/suppliers",children:e.jsxs(Y,{className:"dashboard-card",children:[e.jsx("div",{className:"icon-circle red",children:e.jsx(N,{icon:ze})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-title",children:"ספקים"}),e.jsx("div",{className:"stat-value",children:s.length})]})]})})}),e.jsx(L,{xs:12,sm:12,md:10,lg:8,xl:6,children:e.jsx(G,{to:"/ingredients",children:e.jsxs(Y,{className:"dashboard-card",children:[e.jsx("div",{className:"icon-circle blue",children:e.jsx(N,{icon:be})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-title",children:"חומרי גלם"}),e.jsx("div",{className:"stat-value",children:l.length})]})]})})}),e.jsx(L,{xs:12,sm:12,md:10,lg:8,xl:6,children:e.jsx(G,{to:"/menu",children:e.jsxs(Y,{className:"dashboard-card",children:[e.jsx("div",{className:"icon-circle yellow",children:e.jsx(N,{icon:ve})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-title",children:"קטגוריות"}),e.jsx("div",{className:"stat-value",children:t.length})]})]})})}),e.jsx(L,{xs:12,sm:12,md:10,lg:8,xl:6,children:e.jsx(G,{to:"/mixes",children:e.jsxs(Y,{className:"dashboard-card",children:[e.jsx("div",{className:"icon-circle purple",children:e.jsx(N,{icon:Re})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-title",children:"תערובות"}),e.jsx("div",{className:"stat-value",children:r.length})]})]})})}),e.jsx(L,{xs:12,sm:12,md:10,lg:8,xl:6,children:e.jsx(G,{to:"/employees",children:e.jsxs(Y,{className:"dashboard-card",children:[e.jsx("div",{className:"icon-circle aqua",children:e.jsx(N,{icon:Re})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-title",children:"עובדים"}),e.jsx("div",{className:"stat-value",children:m==null?void 0:m.length})]})]})})})]}),e.jsx(O,{className:"no-margin"}),e.jsxs(M,{gutter:[16,16],children:[e.jsx(L,{xs:24,md:12,children:e.jsx(Y,{className:"dashboard-card",title:e.jsxs("span",{children:[e.jsx(N,{icon:ve,style:{marginLeft:"8px"}}),"מוצרים לפי קטגוריה"]}),children:e.jsx(rs,{data:u,options:{responsive:!0,maintainAspectRatio:!1}})})}),e.jsx(L,{xs:24,md:12,children:e.jsx(Y,{className:"dashboard-card",title:e.jsxs("span",{children:[e.jsx(N,{icon:be,style:{marginLeft:"8px"}}),"חומרי הגלם היקרים ביותר"]}),children:e.jsx(et,{data:f,options:{responsive:!0,maintainAspectRatio:!1}})})})]}),e.jsx(O,{className:"no-margin"}),e.jsxs(M,{gutter:[16,16],children:[e.jsx(L,{xs:24,md:12,children:e.jsx(Y,{className:"dashboard-card",title:e.jsxs("span",{children:[e.jsx(N,{icon:Re,style:{marginLeft:"8px"}}),"התערובות היקרות ביותר"]}),children:e.jsx(et,{data:S,options:{responsive:!0,maintainAspectRatio:!1}})})}),e.jsx(L,{xs:24,md:12,children:e.jsx(Y,{className:"dashboard-card",title:e.jsxs("span",{children:[e.jsx(N,{icon:Se,style:{marginLeft:"8px"}}),"מוצרים עם רווחיות נמוכה"]}),children:e.jsx(M,{gutter:[16,16],children:j.map(x=>e.jsx(L,{xs:24,sm:8,children:e.jsxs(Y,{children:[e.jsx(we,{title:x.name,value:x.profitMargin,suffix:"%",valueStyle:{color:"#cf1322"}}),e.jsx(un,{type:"secondary",children:"רווחיות"})]})},x.key))})})})]})]})}const Ee="https://menu-server-c2b952e2c698.herokuapp.com/api",mn=t=>R.post(`${Ee}/mixes`,t),hn=t=>{const n=encodeURIComponent(t._id);return R.put(`${Ee}/mixes/${n}`,t)},gn=t=>R.delete(`${Ee}/mixes/${t}`),yn=()=>R.get(`${Ee}/mixes`),Ct=b.createContext(),jn=()=>b.useContext(Ct),fn=({children:t})=>{const[n,s]=b.useState(!1),l=async h=>{s(!0);try{await mn(h),P.success("התערובת נוספה בהצלחה"),s(!1)}catch(u){console.error("Error adding mix:",u),P.error("שגיאה בהוספת התערובת"),s(!1)}},r=async h=>{s(!0);try{await hn(h),P.success("התערובת עודכנה בהצלחה"),s(!1)}catch(u){console.error("Error updating mix:",u),P.error("שגיאה בעדכון התערובת"),s(!1)}},m=async h=>{s(!0);try{await gn(h),P.success("התערובת נמחקה בהצלחה"),s(!1)}catch(u){console.error("Error deleting mix:",u),P.error("שגיאה במחיקת התערובת"),s(!1)}};return e.jsx(Ct.Provider,{value:{addMix:l,updateMix:r,deleteMix:m,loading:n},children:t})};function wn(){const{addMix:t,updateMix:n,deleteMix:s}=jn(),[l,r]=b.useState([]),[m,h]=b.useState([]),u=H(a=>a.mixes),y=H(a=>a.ingredients);H(a=>a.products);const v=H(a=>a.employeeHours.overallAverageHourlyRate),f=["name","ingredients"],S=["name","preparationTime","totalCost","totalWeight","usedCount"],j=[{key:"name",dataIndex:"name",title:"שם",required:!0},{key:"preparationTime",dataIndex:"preparationTime",title:"זמן הכנה"},{key:"totalCost",dataIndex:"totalCost",title:"עלות כוללת"},{key:"totalWeight",dataIndex:"totalWeight",title:"משקל כולל"},{key:"usedCount",dataIndex:"usedCount",title:"בשימוש"}],x=[{key:"name",dataIndex:"name",title:"שם התערובת",editable:!0,type:"text",minWidth:100,rules:[{required:!0,message:"חייב להיות שם תערובת"},{min:3,message:"שם חייב להיות לפחות 3 תווים"}]},{key:"usedCount",dataIndex:"usedCount",title:"בשימוש",editable:!1,width:100},{key:"preparationTime",dataIndex:"preparationTime",title:"זמן הכנה (דקות)",editable:!0,minWidth:100,type:"number",rules:[{required:!0,message:"זמן הכנה נדרש"},{type:"number",min:0,message:"זמן הכנה חייב להיות מספר חיובי"}]},{key:"totalCost",dataIndex:"totalCost",title:"עלות כוללת (₪)",minWidth:100,render:(a,d)=>(d==null?void 0:d.totalCost)!=null&&(d==null?void 0:d.laborCost)!=null?`₪${(Number(d.totalCost)+Number(d.laborCost)).toFixed(2)}`:"—",editable:!1},{key:"unitCost",dataIndex:"unitCost",title:"עלות ל-100 גרם (₪)",minWidth:100,render:(a,d)=>(d==null?void 0:d.totalWeight)!=null&&(d==null?void 0:d.totalCost)!=null?`₪${((Number(d.totalCost)+Number(d.laborCost||0))/(Number(d.totalWeight)*10)).toFixed(2)} / 100 גרם`:"—",editable:!1},{key:"laborCost",dataIndex:"laborCost",title:"עלות עבודה (₪)",minWidth:100,render:(a,d)=>{var o;return`₪${(o=d==null?void 0:d.laborCost)==null?void 0:o.toFixed(2)} (₪${v})`||"—"},editable:!1},{key:"totalWeight",dataIndex:"totalWeight",title:'משקל כולל (ק"ג)',minWidth:100,render:(a,d)=>{var o;return((o=d.totalWeight)==null?void 0:o.toFixed(2))||"—"},editable:!1},{key:"ingredients",title:"רכיבים",type:"ingredientsManager",editable:!0,width:500,minWidth:500,column:!0,fields:[{key:"ingredientId",type:"select",title:"רכיב",placeholder:"בחר רכיב",options:y.map(a=>({value:a._id,label:a.name})),required:!0,rules:[{required:!0,message:"יש לבחור רכיב"}]},{key:"quantity",type:"number",title:"כמות",placeholder:"הזן כמות",required:!0,rules:[{required:!0,message:"יש להזין כמות"},{type:"number",min:0,message:"כמות חייבת להיות חיובית"}]},{key:"unit",type:"text",title:"יחידה",readonly:!0}],render:(a,d,o,c)=>{let g=[...(d==null?void 0:d.ingredients)||[]].sort((i,p)=>p.quantity-i.quantity);return g=g==null?void 0:g.map(i=>{var p;return{name:i==null?void 0:i.ingredientId.name,quantity:((i==null?void 0:i.rawQuantityForJuice)||i.quantity)<1&&i.unit!=="units"?((i==null?void 0:i.rawQuantityForJuice)||i.quantity)*100:(i==null?void 0:i.rawQuantityForJuice)||i.quantity,unit:(p=ae==null?void 0:ae.find(F=>F.value===i.unit))==null?void 0:p.display((i==null?void 0:i.rawQuantityForJuice)||i.quantity),costForQuantity:i==null?void 0:i.costForQuantity}}),c?e.jsx("ul",{style:{display:"flex",flexDirection:"column",gap:"5px",padding:0,margin:0,listStyleType:"none"},children:g==null?void 0:g.map((i,p)=>e.jsxs("li",{style:{whiteSpace:"normal",display:"flex"},children:[e.jsx(Ce,{title:i==null?void 0:i.name,children:e.jsx("span",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",display:"inline-block",maxWidth:"150px"},children:i==null?void 0:i.name})}),` (${i.quantity} ${i.unit}) - ₪${i==null?void 0:i.costForQuantity}`]},p))}):e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"5px"},children:g==null?void 0:g.map((i,p)=>e.jsx("div",{children:`${i==null?void 0:i.name} (${i.quantity} ${i.unit}) - ₪${i==null?void 0:i.costForQuantity}, `},p))})},rules:[{required:!0,message:"יש לבחור לפחות רכיב אחד"}]}];return b.useEffect(()=>{u&&(r(u),h(u))},[u,y,v]),e.jsx(_e,{data:l,mobileKeys:S,dataPrint:m,sortKeys:j,tableKeys:x,newTitle:"הוסף תערובת חדשה",searchKeys:f,setDataPrint:h,onAdd:t,onEdit:n,onDelete:s,Dtitle:"אישור מחיקה",ingredientsArr:y,iconADD:e.jsx(N,{icon:yt}),Dcontent:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"האם אתה בטוח שברצונך למחוק את התערובת?"}),e.jsx("p",{children:"שים לב! מחיקת תערובת עשויה להשפיע על מוצרים המשתמשים בה."})]})})}const{Text:vn}=q,{Option:fe}=z,It=({addEmployee:t,initialValues:n,onClose:s})=>{const[l]=k.useForm(),r=H(y=>y.employees),[m,h]=b.useState("");b.useEffect(()=>{n&&l.setFieldsValue(n)},[n,l]);const u=y=>{if(r.some(v=>v.name===y.name.trim()&&(!n||v._id!==n._id))){h("קיים כבר עובד בעל שם דומה");return}t({...n,...y}),l.resetFields(),s()};return e.jsx(Y,{className:"employee-form-card",children:e.jsxs(k,{form:l,layout:"vertical",onFinish:u,initialValues:n,children:[e.jsx(k.Item,{label:"שם עובד",name:"name",rules:[{required:!0,message:"אנא הזן שם עובד"}],children:e.jsx(Q,{})}),e.jsx(k.Item,{label:"תפקיד",name:"position",children:e.jsx(Q,{placeholder:"הזן תפקיד"})}),e.jsx(k.Item,{label:"תעריף שעתי",name:"hourlyRate",rules:[{required:!0,message:"אנא הזן תעריף שעתי"}],children:e.jsx(X,{min:0,style:{width:"100%"}})}),e.jsx(k.Item,{label:"סטטוס",name:"status",initialValue:"active",rules:[{required:!0}],children:e.jsxs(z,{children:[e.jsx(fe,{value:"active",children:"פעיל"}),e.jsx(fe,{value:"inactive",children:"לא פעיל"}),e.jsx(fe,{value:"on_leave",children:"בחופשה"}),e.jsx(fe,{value:"terminated",children:"סיים העסקה"})]})}),m&&e.jsx(Ot,{style:{display:"block",marginBottom:"10px"},children:e.jsx(vn,{type:"danger",className:"error-message",children:m})}),e.jsxs(k.Item,{children:[e.jsx(E,{type:"primary",htmlType:"submit",className:"employee-form-button",children:n?"עדכן עובד":"הוסף עובד"}),e.jsx(E,{className:"employee-form-button",onClick:s,style:{marginLeft:"8px"},children:"ביטול"})]})]})})},$e="https://menu-server-c2b952e2c698.herokuapp.com/api",Sn=t=>R.post(`${$e}/employees`,t),bn=t=>{const n=encodeURIComponent(t._id);return R.put(`${$e}/employees/${n}`,t)},Cn=t=>R.delete(`${$e}/employees/${t}`),In=(t,n)=>R.get(`${$e}/employees?`),Pt=b.createContext(),_t=()=>b.useContext(Pt),Pn=({children:t})=>{const[n,s]=b.useState(!1),l=async h=>{s(!0);try{await Sn(h),P.success("העובד נוסף בהצלחה"),s(!1)}catch(u){console.error("Error adding employee:",u),P.error("שגיאה בהוספת עובד"),s(!1)}},r=async h=>{s(!0);try{await bn(h),P.success("העובד עודכן בהצלחה"),s(!1)}catch(u){console.error("Error updating employee:",u),P.error("שגיאה בעדכון עובד"),s(!1)}},m=async h=>{s(!0);try{await Cn(h),P.success("העובד נמחק בהצלחה"),s(!1)}catch(u){console.error("Error deleting employee:",u),P.error("שגיאה במחיקת עובד"),s(!1)}};return e.jsx(Pt.Provider,{value:{addEmployee:l,updateEmployee:r,deleteEmployee:m,loading:n},children:t})},{Text:Le}=q,_n=({sortKey:t})=>{const{updateEmployee:n,deleteEmployee:s}=_t(),l=H(S=>S.employees),[r,m]=b.useState(!1),[h,u]=b.useState(null),y=S=>{u(S),m(!0)},v=()=>{u(null),m(!1)},f=[...l].sort((S,j)=>t==="name"?S.name.localeCompare(j.name):0);return e.jsxs(Y,{title:"רשימת עובדים",className:"employee-list-card",children:[e.jsx(se,{itemLayout:"vertical",dataSource:f,renderItem:S=>e.jsx(se.Item,{className:"employee-item",actions:[e.jsx(E,{type:"link",onClick:()=>y(S),children:"ערוך"}),e.jsx(Qe,{title:"האם אתה בטוח שברצונך למחוק את העובד הנוכחי?",onConfirm:()=>s(S._id),okText:"כן",cancelText:"לא",children:e.jsx(E,{icon:e.jsx(le,{}),danger:!0})})],children:e.jsx(se.Item.Meta,{title:e.jsx(Le,{strong:!0,children:S.name}),description:e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx(Le,{strong:!0,children:"תפקיד:"})," ",S.position||"לא הוגדר"]}),e.jsxs("p",{children:[e.jsx(Le,{strong:!0,children:"תעריף שעתי:"})," ",S.hourlyRate," ₪"]}),e.jsx("p",{children:e.jsx(Ut,{color:Fn(S.status),text:kn(S.status),style:{marginLeft:"8px"}})})]})})},S._id)}),e.jsx(Z,{title:h?"ערוך עובד":"הוסף עובד חדש",open:r,onCancel:v,footer:null,children:e.jsx(It,{addEmployee:n,initialValues:h,onClose:v})})]})},kn=t=>{switch(t){case"active":return"פעיל";case"inactive":return"לא פעיל";case"on_leave":return"בחופשה";case"terminated":return"סיים העסקה";default:return"לא ידוע"}},Fn=t=>{switch(t){case"active":return"green";case"inactive":return"grey";case"on_leave":return"orange";case"terminated":return"red";default:return"blue"}};function Tn(){const{addEmployee:t}=_t(),[n,s]=b.useState(!1),[l,r]=b.useState(""),m=()=>{s(!0)},h=()=>{s(!1)};return e.jsxs("div",{style:{padding:"20px"},className:"scrollable-content employees-page-container",children:[e.jsxs("div",{className:"employees-controls",children:[e.jsx(E,{type:"primary",onClick:m,className:"add-employee-button",children:"הוסף עובד חדש"}),e.jsxs(z,{value:l,onChange:u=>r(u),className:"sort-select",children:[e.jsx(z.Option,{value:"",children:"מיין"}),e.jsx(z.Option,{value:"name",children:"מיין לפי שם"})]})]}),e.jsx(_n,{sortKey:l}),e.jsx(Z,{title:"הוסף עובד חדש",open:n,onCancel:h,footer:null,destroyOnClose:!0,children:e.jsx(It,{addEmployee:t,onClose:h})})]})}const je="https://menu-server-c2b952e2c698.herokuapp.com/api",En=(t,n)=>R.post(`${je}/employees/${t}/hours`,n),$n=(t,n)=>R.put(`${je}/employees/hours/${t}`,n),An=t=>R.delete(`${je}/employees/hours/${t}`),Mn=t=>R.get(`${je}/employees/${t}/hours`),Nn=(t,n)=>R.get(`${je}/employees/hours/${n}/${t}`),kt=b.createContext(),Rn=()=>b.useContext(kt),qn=({children:t})=>{const[n,s]=b.useState(!1),l=async(u,y)=>new Promise(async(v,f)=>{var S;s(!0);try{const j=await En(u,y);if((j==null?void 0:j.status)===200){P.error((S=j.data)==null?void 0:S.message),f(!1);return}P.success("שעות העבודה נוספו בהצלחה"),v(!0)}catch(j){console.error("Error adding employee hours:",j),P.error("שגיאה בהוספת שעות עבודה"),f(!1)}finally{s(!1)}}),r=async(u,y)=>new Promise(async(v,f)=>{s(!0);try{(await $n(u,y)).status!==201?f(!1):(P.success("שעות העבודה עודכנו בהצלחה"),v(!0))}catch(S){console.error("Error updating employee hours:",S),P.error("שגיאה בעדכון שעות עבודה"),f(!1)}finally{s(!1)}}),m=async u=>{s(!0);try{const y=await Mn(u);return P.success("שעות העבודה נשלפו בהצלחה"),y.data}catch(y){console.error("Error fetching employee hours:",y),P.error("שגיאה בשליפת שעות עבודה")}finally{s(!1)}},h=async u=>{s(!0);try{await An(u),P.success("שעות העבודה נמחקו בהצלחה")}catch(y){console.error("Error deleting employee hours:",y),P.error("שגיאה במחיקת שעות עבודה")}finally{s(!1)}};return e.jsx(kt.Provider,{value:{loading:n,addEmployeeHours:l,updateEmployeeHours:r,deleteEmployeeHours:h,fetchEmployeeHours:m},children:t})},{Option:Ln}=z,Hn=({visible:t,onClose:n,dayData:s})=>{const{addEmployeeHours:l,updateEmployeeHours:r,deleteEmployeeHours:m}=Rn(),h=H(i=>i.employees),[u,y]=b.useState(),[v,f]=b.useState(),[S,j]=b.useState(!1),[x]=k.useForm();if(!s)return null;const a=()=>{const i=S?r:l,p=S?v:u;i(S?p==null?void 0:p.hoursId:p.employeeId,p).then(()=>{y(),j(!1),x.resetFields()}).catch(()=>{})},d=i=>{f({...i,employeeId:i.employeeId,startTime:i.hours.start,endTime:i.hours.end,date:s.date}),j(!0)},o=()=>{y(null),j(!1)},c=i=>{m(i)},g=h==null?void 0:h.filter(i=>!s.employees.some(p=>p.employeeId===i._id));return e.jsxs(Z,{title:`ניהול שעות עבודה ליום ${s.date}`,open:t,onCancel:n,footer:null,width:800,style:{top:"1em"},destroyOnClose:!0,children:[e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("h3",{style:{fontWeight:"600",color:"#333"},children:"סיכום יום"}),e.jsxs("p",{children:["תאריך: ",s.date]}),e.jsxs("p",{children:["יום בשבוע: ",s.dayOfWeek]}),e.jsx(ne,{color:(s==null?void 0:s.status)==="חצי יום"?"orange":"green",children:s==null?void 0:s.status})]}),e.jsx(O,{}),e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("h3",{style:{fontWeight:"600",color:"#333"},children:S?"עריכת עובד":"הוספת עובד חדש"}),e.jsx(k,{form:x,layout:"vertical",onFinish:a,children:e.jsx(k.Item,{label:"בחר עובד",style:{maxWidth:"400px"},children:e.jsx(z,{showSearch:!0,placeholder:"חיפוש והוספת עובד",optionFilterProp:"children",value:(u==null?void 0:u.employeeId)||null,onChange:i=>{const p=g.find(F=>F._id===i);y({name:p==null?void 0:p.name,startTime:"",endTime:"",date:s==null?void 0:s.date,employeeId:p._id})},filterOption:(i,p)=>p.children.toLowerCase().includes(i.toLowerCase()),children:g==null?void 0:g.map(i=>e.jsx(Ln,{value:i._id,children:i.name},i._id))})})})]}),e.jsx(O,{}),u&&e.jsxs(k,{layout:"inline",onFinish:a,initialValues:{startTime:u==null?void 0:u.startTime,endTime:u==null?void 0:u.endTime},children:[e.jsx(k.Item,{label:"שעת כניסה",children:e.jsx(Q,{placeholder:"HH:mm",value:u==null?void 0:u.startTime,onChange:i=>y(p=>({...p,startTime:i.target.value}))})}),e.jsx(k.Item,{label:"שעת יציאה",children:e.jsx(Q,{placeholder:"HH:mm",value:u==null?void 0:u.endTime,onChange:i=>y(p=>({...p,endTime:i.target.value}))})}),!(u!=null&&u._id)&&e.jsx(E,{type:"primary",onClick:a,children:"שמור שעות עבודה"})]}),e.jsx(O,{}),e.jsxs("div",{style:{marginTop:"20px"},children:[e.jsx("h3",{style:{fontWeight:"600",color:"#333"},children:"עובדים שנוספו"}),e.jsx(se,{bordered:!0,className:"scroll-content",style:{maxHeight:"25em",overflow:"auto"},dataSource:s==null?void 0:s.employees,renderItem:i=>{var p,F,C;return e.jsx(se.Item,{children:e.jsxs("div",{style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("h2",{style:{fontWeight:"500",width:"6em"},children:i.name}),S&&i.employeeId===(v==null?void 0:v.employeeId)?e.jsxs(e.Fragment,{children:[e.jsx(Q,{placeholder:"שעת כניסה",value:v==null?void 0:v.startTime,onChange:w=>f(I=>({...I,startTime:w.target.value})),style:{width:"100px",marginRight:"10px"}}),e.jsx(Q,{placeholder:"שעת יציאה",value:v==null?void 0:v.endTime,onChange:w=>f(I=>({...I,endTime:w.target.value})),style:{width:"100px",marginRight:"10px"}}),e.jsxs(M,{style:{gap:"0.5em"},children:[e.jsx(E,{type:"primary",icon:e.jsx(ns,{}),onClick:a}),e.jsx(E,{icon:e.jsx(ye,{}),onClick:o,style:{marginLeft:"5px"}})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(we,{title:"כניסה",value:(p=i==null?void 0:i.hours)==null?void 0:p.start}),e.jsx(we,{title:"יציאה",value:(F=i==null?void 0:i.hours)==null?void 0:F.end}),e.jsx(we,{title:"סך שעות",value:(C=i==null?void 0:i.hoursWorked)==null?void 0:C.toFixed(2)}),e.jsxs(M,{style:{gap:"0.5em"},children:[e.jsx(E,{icon:e.jsx(Je,{}),onClick:()=>d(i)}),e.jsx(Qe,{title:"האם אתה בטוח שברצונך למחוק את העובד?",onConfirm:()=>c(i.hoursId),okText:"כן",cancelText:"לא",children:e.jsx(E,{icon:e.jsx(le,{}),danger:!0})})]})]})]})})}})]})]})},Vn=({monthData:t})=>{const[n,s]=b.useState(!1),[l,r]=b.useState(null),m=y=>{r(y),s(!0)},h=[{title:"תאריך",dataIndex:"date",key:"date"},{title:"יום בשבוע",dataIndex:"dayOfWeek",key:"dayOfWeek"},{title:"סטטוס",dataIndex:"status",key:"status",render:y=>e.jsx(ne,{color:y==="חצי יום"?"orange":"green",children:y})},{title:"מספר עובדים",dataIndex:"employeesCount",key:"employeesCount",render:y=>y??"לא ידוע"},{title:"סך הכל שעות",dataIndex:"totalHours",key:"totalHours",render:y=>(y==null?void 0:y.toFixed(2))??"לא ידוע"}],u=y=>{let v="";return y!=null&&y.hasError&&(v+="workhours-error "),y.isToday?v+="today-row":y.isPast&&(v+="past-row"),v};return e.jsxs(e.Fragment,{children:[e.jsx(ut,{columns:h,dataSource:t,rowKey:"date",pagination:!1,rowClassName:u,onRow:(y,v)=>({onClick:()=>(y.isToday||y.isPast)&&m(v)})}),e.jsx(Hn,{visible:n,onClose:()=>s(!1),dayData:t[l]})]})};te.locale("he");const Dn=Ge("employeeHours/buildMonthData",async({selectedDate:t,employees:n,employeeHours:s},{dispatch:l})=>{const r=te(t,"YYYY-MM").daysInMonth(),m=Array.from({length:r},(h,u)=>{const y=te(t,"YYYY-MM").date(u+1),v=y.format("dddd"),f=v==="שישי"||v==="שבת",S=n.map(a=>{const d=s.find(c=>{var g;return((g=c==null?void 0:c.employeeId)==null?void 0:g._id)===(a==null?void 0:a._id)&&te(c==null?void 0:c.date).isSame(y,"day")});if(!d)return null;const o=!d.startTime||!d.endTime;return{hoursId:d._id,employeeId:a._id,name:a.name,hourlyRate:a.hourlyRate,hoursWorked:d.hoursWorked,hours:{start:d.startTime,end:d.endTime},hasError:o}}).filter(Boolean),j=S.reduce((a,d)=>a+d.hoursWorked,0),x=S.length;return{date:y.format("YYYY-MM-DD"),dayOfWeek:v,status:f&&v==="שישי"?"חצי יום":"יום מלא",isPast:y.isBefore(te(),"day"),isToday:y.isSame(te(),"day"),employees:S,totalHours:j,employeesCount:x}});l(On(m))}),Ft=re({name:"employeeHours",initialState:{data:[],selectedDate:te().startOf("month").format("YYYY-MM"),overallAverageHourlyRate:34.39},reducers:{setEmployeeHoursState:(t,n)=>{t.data=n.payload},setSelectedDate:(t,n)=>{t.selectedDate=n.payload},setOverallAverageHourlyRate:(t,n)=>{t.overallAverageHourlyRate=n.payload},addOrUpdateEmployeeHoursState:(t,n)=>{const s=n.payload,l=t.data.findIndex(r=>r._id===s._id);l!==-1?t.data[l]=s:t.data.unshift(s)},updateEmployeeHoursState:(t,n)=>{const s=n.payload;t.data=t.data.map(l=>l._id===s._id?s:l)},deleteEmployeeHoursState:(t,n)=>{const s=n.payload._id;t.data=t.data.filter(l=>l._id!==s)}}}),{setEmployeeHoursState:On,addOrUpdateEmployeeHoursState:Un,updateEmployeeHoursState:Wn,deleteEmployeeHoursState:Bn,setSelectedDate:Yn,setOverallAverageHourlyRate:oa}=Ft.actions,Qn=t=>t.employeeHours.overallAverageHourlyRate,zn=Ft.reducer,{MonthPicker:Jn}=Wt;te.locale("he");const Gn=()=>{const t=Ye(),n=H(r=>r.employeeHours.data),s=H(r=>r.employeeHours.selectedDate),l=r=>{t(Yn(r.format("YYYY-MM")))};return e.jsxs("div",{className:"workhours-container",children:[e.jsx("h1",{children:"ניהול שעות עבודה חודשיות"}),e.jsx(Jn,{onChange:l,placeholder:"בחר חודש ושנה",disabledDate:r=>r&&r>te().endOf("month")},s),e.jsx(Vn,{monthData:n})," "]})},Tt=re({name:"suppliers",initialState:[],reducers:{addSuppliersState:(t,n)=>n.payload,addOrUpdateSupplierState:(t,n)=>{const s=n.payload,l=t.findIndex(r=>r._id===s._id);l!==-1?t[l]=s:t.unshift(s)},updateSupplierState:(t,n)=>{const s=n.payload;return t.map(l=>l._id===s._id?s:l)},deleteSupplierState:(t,n)=>{const s=n.payload._id;return t.filter(l=>l._id!==s)}}}),{addSuppliersState:Xn,addOrUpdateSupplierState:Kn,updateSupplierState:Zn,deleteSupplierState:er}=Tt.actions,tr=Tt.reducer;function He(t){let n,s,l,r;const m=t.price/1.17;return t.unit==='ק"ג'||t.unit==="weight"?(n=.1,s="גרם",l=m/t.quantity*n):t.unit==="ליטר"||t.unit==="volume"?(n=.1,s='מ"ל',l=m/t.quantity*n):(t.unit==="יחידות"||t.unit==="units")&&(n=1,s="יחידה",l=m/t.quantity),t.isJuice&&(r=l/(t.juiceRatio||1)),{...t,priceExcludingVAT:m.toFixed(2),unitQuantity:n,unitDescription:s,unitPrice:l.toFixed(2),processedPrice:r?r.toFixed(2):null}}const Et=re({name:"ingredients",initialState:[],reducers:{addIngerdientsState:(t,n)=>n.payload.map(He),addOrUpdateIngredientState:(t,n)=>{const s=He(n.payload),l=t.findIndex(r=>r._id===s._id);l!==-1?t[l]=s:t.unshift(s)},updateIngredientState:(t,n)=>{const s=He(n.payload);return t.map(l=>l._id===s._id?s:l)},deleteIngredientState:(t,n)=>{const s=n.payload._id;return t.filter(l=>l._id!==s)}}}),{addIngerdientsState:sr,addOrUpdateIngredientState:nr,updateIngredientState:rr,deleteIngredientState:ir}=Et.actions,ar=Et.reducer,$t=1.17,lr=Ge("products/updateWithRate",async(t,{getState:n})=>{const s=n(),l=Qn(s);return s.products.map(h=>({...h,sizes:h.sizes.map(u=>{const y=u.ingredients.reduce((o,c)=>o+parseFloat(c.processedCost||c.actualCost||0),0),v=u.mixes.reduce((o,c)=>o+parseFloat(c.actualCost||0),0),f=y+v,S=l/60*u.preparationTime,j=u.price/$t,x=f+S,a=j-x,d=j>0?(a/j*100).toFixed(2):"0.00";return{...u,totalRawCost:f.toFixed(2),laborCost:S.toFixed(2),profitMargin:d}})}))});function lt(t,n,s,l){return t.map(r=>({...r,sizes:r.sizes.map(m=>{const h=m.ingredients.map(o=>{const c=n.find(F=>F._id===o.ingredientId);if(!c)return o;const i=o.quantity/c.unitQuantity*c.unitPrice,p=c.isJuice?o.quantity/c.unitQuantity*c.processedPrice:null;return{...o,actualCost:i.toFixed(2),processedCost:p?p.toFixed(2):null}}),u=m.mixes.map(o=>{const c=s.find(p=>p._id===o.mixId);if(!c)return o;const g=o.quantity/c.totalWeight,i=g*c.totalCost;return{...o,actualCost:i.toFixed(2),realQuantity:g.toFixed(2)}}),y=h.reduce((o,c)=>o+parseFloat(c.processedCost||c.actualCost||0),0),v=u.reduce((o,c)=>o+parseFloat(c.actualCost||0),0),f=y+v,S=m.price/$t,j=l/60*m.preparationTime,x=f+j,a=S-x,d=S>0?(a/S*100).toFixed(2):"0.00";return{...m,ingredients:h,mixes:u,totalRawCost:f.toFixed(2),laborCost:j.toFixed(2),profitMargin:d}})}))}const At=re({name:"products",initialState:[],reducers:{setProductsState:(t,n)=>{const{products:s,ingredientsState:l,mixesState:r,averageHourlyRate:m}=n.payload;return s},addOrUpdateProductState:(t,n)=>{const{newProduct:s,ingredientsState:l,mixesState:r,averageHourlyRate:m}=n.payload,h=lt([s],l,r,m)[0],u=t.findIndex(y=>y._id===s._id);u!==-1?t[u]=h:t.unshift(h)},updateProductState:(t,n)=>{const{updatedProduct:s,ingredientsState:l,mixesState:r,averageHourlyRate:m}=n.payload,h=lt([s],l,r,m)[0];return t.map(u=>u._id===s._id?h:u)},deleteProductState:(t,n)=>{const s=n.payload._id;return t.filter(l=>l._id!==s)}},extraReducers:t=>{t.addCase(lr.fulfilled,(n,s)=>s.payload)}}),{setProductsState:or,addOrUpdateProductState:ot,updateProductState:da,deleteProductState:dr}=At.actions,cr=At.reducer,Mt=re({name:"mixes",initialState:[],reducers:{setMixesState:(t,n)=>{const{mixes:s,ingredientsState:l}=n.payload;return s},addOrUpdateMixState:(t,n)=>{const{newMix:s,ingredientsState:l}=n.payload,r=s,m=t.findIndex(h=>h._id===s._id);m!==-1?t[m]=r:t.push(r)},updateMixState:(t,n)=>{const{updatedMix:s,ingredientsState:l}=n.payload,r=s,m=t.findIndex(h=>h._id===s._id);m!==-1&&(t[m]=r)},deleteMixState:(t,n)=>t.filter(s=>s._id!==n.payload._id)}}),{setMixesState:ur,addOrUpdateMixState:xr,updateMixState:pr,deleteMixState:mr}=Mt.actions,hr=Mt.reducer,Nt=re({name:"categories",initialState:[],reducers:{setCategories:(t,n)=>n.payload,addOrUpdateCategory:(t,n)=>{const s=n.payload,l=t.findIndex(r=>r._id===s._id);l!==-1?t[l]=s:t.unshift(s)},updateCategory:(t,n)=>{const s=n.payload,l=t.findIndex(r=>r._id===s._id);l!==-1&&(t[l]=s)},deleteCategory:(t,n)=>{const s=n.payload;return t.filter(l=>l._id!==s)}}}),{setCategories:gr,addOrUpdateCategory:yr,updateCategory:jr,deleteCategory:fr}=Nt.actions,wr=Nt.reducer,Rt=re({name:"employees",initialState:[],reducers:{setEmployees:(t,n)=>n.payload,addOrUpdateEmployee:(t,n)=>{const s=n.payload,l=t.findIndex(r=>r._id===s._id);l!==-1?t[l]=s:t.push(s)},updateEmployee:(t,n)=>{const s=n.payload,l=t.findIndex(r=>r._id===s._id);l!==-1&&(t[l]=s)},deleteEmployee:(t,n)=>t.filter(s=>s._id!==n.payload)}}),{setEmployees:vr,addOrUpdateEmployee:Sr,updateEmployee:br,deleteEmployee:Cr}=Rt.actions,Ir=Rt.reducer,Pr=(t,n)=>{t.on("ingredientAdded",s=>{n(nr(s))}),t.on("ingredientUpdated",s=>{n(rr(s))}),t.on("ingredientDeleted",s=>{n(ir(s))}),t.on("supplierAdded",s=>{n(Kn(s))}),t.on("supplierUpdated",s=>{n(Zn(s))}),t.on("supplierDeleted",s=>{n(er(s))}),t.on("productAdded",s=>{n((l,r)=>{const m=r().ingredients,h=r().mixes;l(ot({newProduct:s,ingredientsState:m,mixesState:h}))})}),t.on("productUpdated",s=>{n((l,r)=>{const m=r().ingredients,h=r().mixes;l(ot({newProduct:s,ingredientsState:m,mixesState:h}))})}),t.on("productDeleted",s=>{n(dr(s))}),t.on("categoryAdded",s=>{n(yr(s))}),t.on("categoryUpdated",s=>{n(jr(s))}),t.on("categoryDeleted",s=>{n(fr(s._id))}),t.on("mixAdded",s=>{n((l,r)=>{const m=r().ingredients;l(xr({newMix:s,ingredientsState:m}))})}),t.on("mixUpdated",s=>{n((l,r)=>{const m=r().ingredients;l(pr({updatedMix:s,ingredientsState:m}))})}),t.on("mixDeleted",s=>{n(mr(s))}),t.on("employeeAdded",s=>{n(Sr(s))}),t.on("employeeUpdated",s=>{n(br(s))}),t.on("employeeDeleted",s=>{n(Cr(s._id))}),t.on("employeeHoursAdded",s=>{n(Un(s))}),t.on("employeeHoursUpdated",s=>{n(Wn(s))}),t.on("employeeHoursDeleted",s=>{n(Bn({_id:s._id}))})},dt="https://menu-server-c2b952e2c698.herokuapp.com/",_r=b.createContext(),kr=({children:t})=>{const n=Ye();return console.log(dt),b.useEffect(()=>{const s=ms(dt);return Pr(s,n),()=>s.disconnect()},[n]),e.jsx(_r.Provider,{value:{},children:t})},Ae="https://menu-server-c2b952e2c698.herokuapp.com/api",Fr=()=>R.get(`${Ae}/settings`),Tr=t=>R.post(`${Ae}/settings`,t),Er=t=>{const n=encodeURIComponent(t.key);return R.put(`${Ae}/settings/${n}`,t)},$r=t=>{const n=encodeURIComponent(t);return R.delete(`${Ae}/settings/${n}`)},Ar=b.createContext(),Mr=({children:t})=>{const[n,s]=b.useState(!1),[l,r]=b.useState([]),m=async()=>{s(!0);try{const{data:v}=await Fr();r(v),P.success("ההגדרות נטענו בהצלחה")}catch(v){console.error("Error fetching settings:",v),P.error("שגיאה בטעינת ההגדרות")}finally{s(!1)}},h=async v=>{s(!0);try{await Tr(v),P.success("ההגדרה נוספה בהצלחה"),await m()}catch(f){console.error("Error adding setting:",f),P.error("שגיאה בהוספת ההגדרה")}finally{s(!1)}},u=async v=>{s(!0);try{await Er(v),P.success("ההגדרה עודכנה בהצלחה"),await m()}catch(f){console.error("Error updating setting:",f),P.error("שגיאה בעדכון ההגדרה")}finally{s(!1)}},y=async v=>{s(!0);try{await $r(v),P.success("ההגדרה נמחקה בהצלחה"),await m()}catch(f){console.error("Error deleting setting:",f),P.error("שגיאה במחיקת ההגדרה")}finally{s(!1)}};return e.jsx(Ar.Provider,{value:{settings:l,loading:n,fetchSettings:m,addSetting:h,updateSetting:u,deleteSetting:y},children:t})};P.config({prefixCls:"my-message"});const Nr=({children:t,setLoading:n})=>{const s=Ye(),l=H(m=>m.employeeHours.selectedDate),r=H(m=>m.employeeHours.overallAverageHourlyRate);return b.useEffect(()=>{(async()=>{var y,v;n(!0);const h=tt(l).year(),u=tt(l).month()+1;try{const[f,S,j,x,a,d,o]=await Promise.all([an(),Ks(),ws(),Os(),yn(),In(),Nn(u,h)]);s(sr((y=f==null?void 0:f.data)==null?void 0:y.reverse())),s((c,g)=>{var p;const i=g().ingredients;c(ur({mixes:(p=a==null?void 0:a.data)==null?void 0:p.reverse(),ingredientsState:i}))}),s((c,g)=>{var F;const i=g().ingredients,p=g().mixes;c(or({products:(F=j.data)==null?void 0:F.reverse(),ingredientsState:i,mixesState:p,averageHourlyRate:r}))}),s(gr(x.data)),s(Xn((v=S==null?void 0:S.data)==null?void 0:v.reverse())),s(vr(d.data)),s(Dn({selectedDate:l,employees:d.data,employeeHours:o==null?void 0:o.data})),n(!1)}catch(f){console.error("Error fetching data:",f),n(!1)}})()},[s,n,l]),e.jsx(kr,{children:e.jsx(on,{children:e.jsx(en,{children:e.jsx(_s,{children:e.jsx(fn,{children:e.jsx(Ws,{children:e.jsx(Pn,{children:e.jsx(qn,{children:e.jsx(Mr,{children:t})})})})})})})})})},We="/assets/logo-Ha-8mVYV.png",Rr=re({name:"profitabilitySettings",initialState:{materialCostRate:25,laborCostRate:12,fixedExpensesRate:30,profitRate:33,materialCostRange:{min:20,max:30},laborCostRange:{min:10,max:15},fixedExpensesRange:{min:25,max:35},profitRange:{min:25,max:35}},reducers:{setMaterialCostRate:(t,n)=>{t.materialCostRate=n.payload},setLaborCostRate:(t,n)=>{t.laborCostRate=n.payload},setFixedExpensesRate:(t,n)=>{t.fixedExpensesRate=n.payload},setProfitRate:(t,n)=>{t.profitRate=n.payload},setMaterialCostRange:(t,n)=>{t.materialCostRange=n.payload},setLaborCostRange:(t,n)=>{t.laborCostRange=n.payload},setFixedExpensesRange:(t,n)=>{t.fixedExpensesRange=n.payload},setProfitRange:(t,n)=>{t.profitRange=n.payload}}}),qr=Rr.reducer;function Lr({drawerVisible:t,setDrawerVisible:n,isMobile:s}){return b.useState(!1),e.jsxs("div",{className:"top-bar",children:[e.jsx(G,{to:"/",children:e.jsx(Ue,{className:"logo-mobile",src:We,alt:"GainGuard",preview:!1})}),e.jsxs("div",{children:[e.jsx("button",{className:"profile-button",children:e.jsx(N,{icon:Xt})}),s&&e.jsx("button",{className:"menu-button",onClick:()=>n(!t),children:e.jsx(N,{icon:Kt})})]})]})}const{Header:Hr,Content:Vr,Footer:Dr}=xt;function Or(){const[t,n]=b.useState(!1),[s,l]=b.useState(!1),r=ue({query:"(max-width: 1200px)"});return e.jsxs(Nr,{setLoading:l,children:[e.jsx(Bt,{fullscreen:!0,spinning:s,size:"large"}),e.jsx(xs,{children:e.jsxs(xt,{className:"app-container",style:{minHeight:r?"85vh":"100vh"},children:[e.jsxs("div",{className:"nav-container",children:[e.jsx("div",{className:"nav-top",children:e.jsx(Ue,{className:"logo",src:We,alt:"GainGuard",preview:!1})}),e.jsx(ct,{})]}),e.jsxs("div",{className:"body-container",children:[e.jsxs(Hr,{className:"header",style:{padding:"0 20px"},children:[e.jsx(Lr,{isMobile:r,drawerVisible:t,setDrawerVisible:n}),e.jsx(O,{className:"no-margin"})]}),e.jsx(Vr,{className:"content",children:e.jsxs(hs,{children:[e.jsx(de,{path:"/",element:e.jsx(pn,{})}),e.jsx(de,{path:"/menu",element:e.jsx(zs,{})}),e.jsx(de,{path:"/suppliers",element:e.jsx(tn,{})}),e.jsx(de,{path:"/mixes",element:e.jsx(wn,{})}),e.jsx(de,{path:"/ingredients",element:e.jsx(cn,{})}),e.jsx(de,{path:"/employees",element:e.jsx(Tn,{})}),e.jsx(de,{path:"/work-hours",element:e.jsx(Gn,{})})]})}),e.jsx(Dr,{className:"footer",children:"© 2024 מערכת ניהול תפריט ועץ מוצר"})]}),e.jsx(Yt,{title:e.jsxs(L,{children:[e.jsx(Ue,{className:"logo",src:We,alt:"GainGuard",preview:!1}),e.jsx("p",{children:"ניווט"})]}),placement:"right",closable:!0,onClose:()=>n(!1),open:t,width:300,children:e.jsx(ct,{onClose:()=>n(!1)})})]})})]})}function ct({onClose:t}){const n=gs(),s=l=>n.pathname===l?"link-active":"link";return e.jsxs("div",{className:"nav-desktop-child",children:[e.jsx(O,{}),e.jsx(E,{type:"link",onClick:t,className:s("/"),children:e.jsxs(G,{to:"/",children:[e.jsx(N,{icon:Zt})," ",e.jsx("p",{children:"לוח מחוונים"})]})}),e.jsx(E,{type:"link",onClick:t,className:s("/menu"),children:e.jsxs(G,{to:"/menu",children:[e.jsx(N,{icon:Se})," ",e.jsx("p",{children:"תפריט"})]})}),e.jsx(E,{type:"link",onClick:t,className:s("/mixes"),children:e.jsxs(G,{to:"/mixes",children:[e.jsx(N,{icon:yt})," ",e.jsx("p",{children:"מיקסים"})]})}),e.jsx(E,{type:"link",onClick:t,className:s("/ingredients"),children:e.jsxs(G,{to:"/ingredients",children:[e.jsx(N,{icon:be})," ",e.jsx("p",{children:"חומרי גלם"})]})}),e.jsx(E,{type:"link",onClick:t,className:s("/suppliers"),children:e.jsxs(G,{to:"/suppliers",children:[e.jsx(N,{icon:ze})," ",e.jsx("p",{children:"ספקים"})]})}),e.jsx(E,{type:"link",onClick:t,className:s("/employees"),children:e.jsxs(G,{to:"/employees",children:[e.jsx(N,{icon:es})," ",e.jsx("p",{children:"עובדים"})]})}),e.jsx(E,{type:"link",onClick:t,className:s("/work-hours"),children:e.jsxs(G,{to:"/work-hours",children:[e.jsx(N,{icon:Ie})," ",e.jsx("p",{children:"ניהול שעות עבודה"})]})})]})}const Ve=Ge("dashboard/fetchDashboardData",async(t,{getState:n})=>(n(),{})),Ur=re({name:"dashboard",initialState:[],reducers:{},extraReducers:t=>{t.addCase(Ve.pending,n=>{}).addCase(Ve.fulfilled,(n,s)=>{}).addCase(Ve.rejected,n=>{})}}),Wr=Ur.reducer,Br=ps({reducer:{suppliers:tr,ingredients:ar,products:cr,dashboard:Wr,mixes:hr,categories:wr,employees:Ir,employeeHours:zn,profitabilitySettingsSlice:qr}});qt.createRoot(document.getElementById("root")).render(e.jsx(Be.StrictMode,{children:e.jsx(Lt,{store:Br,children:e.jsx(Or,{})})}));"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(t=>{console.log("ServiceWorker registration successful with scope: ",t.scope)}).catch(t=>{console.error("ServiceWorker registration failed: ",t)})});
