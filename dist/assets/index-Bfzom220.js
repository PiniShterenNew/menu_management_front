import{r as d,j as e,a as Pt}from"./react-BoqISt01.js";import{c as en}from"./react-dom-Bk743r0W.js";import{u as X,a as Ye,P as tn}from"./react-redux-D3oi59tp.js";import{a as G}from"./axios-CCb-kr4I.js";import{s as D,L as xe,C as ue,R as U,F as Q,D as Z,B as T,a as is,T as st,P as sn,d as nn,M as fe,b as J,c as M,S as de,e as oe,f as z,g as Ot,h as Se,i as We,I as me,j as ls,k as Ut,l as Ht,m as jt,n as _t,o as Bt,p as Wt,q as rn,A as an,r as ft,t as Pe,u as Ke,v as ze,w as ln,x as on,y as yt,z as dn,E as os}from"./antd-DUgvu7h7.js";import{u as Te}from"./react-responsive-B9DcSnuZ.js";import{L as cn}from"./rc-virtual-list-D8xMsbcw.js";import{F as L,f as Je,a as Ve,b as ds,c as De,d as Le,e as un,g as xn,h as mn,i as pn,j as Tt,k as Qe,l as Et,m as hn,n as et,o as tt,p as nt,q as xt,r as gn,s as jn,t as fn,u as yn}from"./@fortawesome-iG2bi8FM.js";import{a2 as vt,A as cs,a3 as us,a4 as vn,o as Qt,a5 as wn,a6 as _e,R as $t,a1 as Mt,v as At,r as bn,s as Cn,x as Sn,a7 as In}from"./@ant-design-DbJKpMgD.js";import{c as xs,a as Ne,b as Nn}from"./@reduxjs-DkgbS889.js";import{m as Ie,h as Yt}from"./moment-BAfwh5x7.js";import{D as kn,B as Jt}from"./react-chartjs-2-0Z_sSmBf.js";import{C as Fn,A as Pn,p as _n,a as Tn,b as En,L as $n,c as Mn}from"./chart.js-BkMDj0WH.js";import{L as pe,B as An}from"./react-router-dom-UU0TJEQ6.js";import{l as Rn}from"./socket.io-client-CDVIIGn8.js";import{O as ms,C as ps,a as qn,T as hs,D as gs,P as Dn,R as Ln,b as js,S as fs,L as ys,c as vs,d as ws,e as On,f as Un,g as bs,h as Hn,i as Bn,j as Wn}from"./@radix-ui-B3e9CqpC.js";import{c as Qn}from"./clsx-B-dksMZM.js";import{t as Yn}from"./tailwind-merge-D696Ktp4.js";import{X as wt,C as Jn,a as Vn,S as Gn,T as Xn,b as mt,P as Zn,c as zn,d as Kn}from"./lucide-react-C-DaTvPU.js";import{u as er,F as tr,C as sr,b as nr}from"./react-hook-form-E7byIJnj.js";import{c as Rt}from"./class-variance-authority-Dp3B9jqt.js";import{z as Ee}from"./zod-DHHRaryC.js";import{t as rr}from"./@hookform-CaGMwPfa.js";import{d as ar,e as Fe,b as ir}from"./react-router-CBguhhk8.js";import"./@babel-D3CJPhrF.js";import"./scheduler-CzFDRTuY.js";import"./use-sync-external-store-BQxMxw6g.js";import"./rc-util-CNJZKBfo.js";import"./classnames-CAxFPVRb.js";import"./rc-resize-observer-DAFDewDD.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./rc-motion-DZL9tseL.js";import"./@rc-component-DPyZj6wr.js";import"./rc-overflow-BihHMfjR.js";import"./rc-picker-C6pnqAVS.js";import"./dayjs-DMN7meC7.js";import"./rc-tabs-BUPz9aOH.js";import"./rc-dropdown-DBn3Vn4f.js";import"./rc-menu-CXhGSgjF.js";import"./rc-select-Enbnx8e0.js";import"./rc-segmented-DWUgWqHo.js";import"./rc-input-number-Do8zGlOB.js";import"./rc-input-DGbryaDy.js";import"./@ctrl-DOFZgDuz.js";import"./rc-drawer-DjgcoIVX.js";import"./rc-field-form-DdGYHmQ7.js";import"./scroll-into-view-if-needed-BZeNfFF0.js";import"./compute-scroll-into-view-DWa9QgjM.js";import"./rc-image-CQiP7trl.js";import"./rc-dialog-B4yQaf15.js";import"./rc-notification-m3oA-fH0.js";import"./rc-tooltip-BAFIWTUD.js";import"./rc-steps-jTTkhuna.js";import"./rc-progress-BECVEO62.js";import"./rc-switch-B_QRjvBh.js";import"./rc-table-rj7zZJss.js";import"./rc-tree-BDK0sBoh.js";import"./rc-checkbox-XvbJzSrO.js";import"./rc-pagination-CZPuIcur.js";import"./throttle-debounce-CUWDS_la.js";import"./rc-textarea-BF1YsysJ.js";import"./copy-to-clipboard-DN2oU9Yq.js";import"./toggle-selection-BHUZwh74.js";import"./matchmediaquery-9DU1HNkU.js";import"./css-mediaquery-DcYbJrVh.js";import"./hyphenate-style-name-HOLnhz8K.js";import"./shallow-equal-BQUY1Bas.js";import"./prop-types-Bq5K3Feg.js";import"./@emotion-CW87jbl0.js";import"./stylis-OW4gUFyn.js";import"./redux-DITMfSWq.js";import"./immer-DqxjFn0G.js";import"./redux-thunk-ClJT1hhx.js";import"./@kurkle-BZxJdD1U.js";import"./@remix-run-Br25Cn4W.js";import"./engine.io-client-C44f3zIw.js";import"./engine.io-parser-BiEtp6m2.js";import"./@socket.io-Dkula2eQ.js";import"./socket.io-parser-BBkuslX-.js";import"./react-remove-scroll-uEV8_dwQ.js";import"./tslib-CDuPK5Eb.js";import"./react-remove-scroll-bar-Chida324.js";import"./react-style-singleton-D-ncAbk2.js";import"./get-nonce-C-Z93AgS.js";import"./use-sidecar-BUbtaZ7t.js";import"./use-callback-ref-CGYexTLy.js";import"./aria-hidden-DQ5UC2Eg.js";import"./@floating-ui-CyZwn0-1.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const x of n)if(x.type==="childList")for(const h of x.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&i(h)}).observe(document,{childList:!0,subtree:!0});function s(n){const x={};return n.integrity&&(x.integrity=n.integrity),n.referrerPolicy&&(x.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?x.credentials="include":n.crossOrigin==="anonymous"?x.credentials="omit":x.credentials="same-origin",x}function i(n){if(n.ep)return;n.ep=!0;const x=s(n);fetch(n.href,x)}})();const ye="https://menu-server-c2b952e2c698.herokuapp.com/api",lr=t=>G.post(`${ye}/products`,t),or=t=>{const r=encodeURIComponent(t._id);return G.put(`${ye}/products/${r}`,t)},dr=t=>G.delete(`${ye}/products/${t}`),Cs=()=>G.get(`${ye}/products`),cr=t=>G.get(`${ye}/products/${t}`),ur=(t,r)=>G.post(`${ye}/sizes/${t}`,r),xr=(t,r)=>G.put(`${ye}/sizes/${t}`,r),mr=(t,r)=>G.delete(`${ye}/sizes/${t}/${r}`),pr=t=>G.post(`${ye}/variations`,t),hr=(t,r)=>G.put(`${ye}/variations/${t}`,r),gr=t=>G.delete(`${ye}/variations/${t}`),Ss=d.createContext(),Is=()=>d.useContext(Ss),jr=({children:t})=>{const[r,s]=d.useState(!1),[i,n]=d.useState(!1),[x,h]=d.useState("add"),[u,g]=d.useState(null),[w,N]=d.useState(null),m=y=>new Promise(async(C,a)=>{var l;try{const b=await cr(y);(l=b==null?void 0:b.data)!=null&&l.error?a(!1):C(b==null?void 0:b.data)}catch(b){console.error("Error get product:",b)}}),$=y=>new Promise(async(C,a)=>{var l,b;s(!0);try{const F=await lr(y);s(!1),(l=F==null?void 0:F.data)!=null&&l.error?(D.error((b=F==null?void 0:F.data)==null?void 0:b.error),a(!1)):(D.success("המוצר נוסף בהצלחה"),C(!0))}catch(F){console.error("Error adding product:",F),D.error("שגיאה בהוספת המוצר"),s(!1)}}),I=y=>new Promise(async(C,a)=>{var l;s(!0);try{const b=await or(y);s(!1),(l=b==null?void 0:b.data)!=null&&l.error||(D.success("המוצר עודכן בהצלחה"),C(!0)),a(!1)}catch(b){console.error("Error updating product:",b),D.error("שגיאה בעדכון המוצר"),s(!1)}}),P=async y=>{s(!0);try{await dr(y),D.success("המוצר נמחק בהצלחה"),s(!1)}catch(C){console.error("Error deleting product:",C),D.error("שגיאה במחיקת המוצר"),s(!1)}},q=(y,C)=>(s(!0),new Promise(async(a,l)=>{try{const b=await ur(y,C);D.success("הגודל נוסף בהצלחה"),s(!1),a(b.data)}catch(b){console.error("Error adding size:",b),D.error("שגיאה בהוספת הגודל"),s(!1),l(b)}})),A=(y,C)=>(s(!0),new Promise(async(a,l)=>{try{const b=await xr(y,C);D.success("הגודל עודכן בהצלחה"),s(!1),a(b.data)}catch(b){console.error("Error updating size:",b),D.error("שגיאה בעדכון הגודל"),s(!1),l(b)}})),S=(y,C)=>(s(!0),new Promise(async(a,l)=>{try{await mr(y,C),D.success("הגודל נמחק בהצלחה"),s(!1),a(!0)}catch(b){console.error("Error deleting size:",b),D.error("שגיאה במחיקת הגודל"),s(!1),l(b)}})),f=y=>(s(!0),new Promise(async(C,a)=>{try{const l=await pr(y);D.success("הווריאציה נוספה בהצלחה"),s(!1),C(l.data)}catch(l){console.error("Error adding variation:",l),D.error("שגיאה בהוספת הווריאציה"),s(!1),a(l)}})),c=(y,C)=>(s(!0),new Promise(async(a,l)=>{try{const b=await hr(y,C);D.success("הווריאציה עודכנה בהצלחה"),s(!1),a(b.data)}catch(b){console.error("Error updating variation:",b),D.error("שגיאה בעדכון הווריאציה"),s(!1),l(b)}})),p=y=>(s(!0),new Promise(async(C,a)=>{try{await gr(y),D.success("הווריאציה נמחקה בהצלחה"),s(!1),C(!0)}catch(l){console.error("Error deleting variation:",l),D.error("שגיאה במחיקת הווריאציה"),s(!1),a(l)}}));return e.jsx(Ss.Provider,{value:{getProductById:m,addProduct:$,updateProduct:I,deleteProduct:P,addSize:q,updateSize:A,deleteSize:S,addVariation:f,updateVariation:c,deleteVariation:p,loading:r,isModalVisible:i,setIsModalVisible:n,modalMode:x,setModalMode:h,selectedItem:u,setSelectedItem:g,selectedUpdateSize:w,setSelectedUpdateSize:N},children:t})};function fr({data:t,type:r,tableKeys:s,mobileKeys:i,openModal:n,Dtitle:x,Dcontent:h,onDelete:u}){const g=Te({query:"(max-width: 500px)"}),[w,N]=d.useState(0),[m,$]=d.useState(1),[I,P]=d.useState(6),[q,A]=d.useState([]),S=(p,y)=>{const C=(p-1)*y,a=C+y;return t.slice(C,a)},f=(p,y)=>{$(p),P(y)};d.useEffect(()=>{N(t.length),A(S(m,I))},[m,I,t]);const c=p=>{fe.confirm({title:x,content:h,okText:"מחק",cancelText:"בטל",onOk:()=>u(p==null?void 0:p._id)})};return g?e.jsx(e.Fragment,{children:e.jsx(xe,{style:{maxHeight:"55vh",overflowY:"auto",minHeight:"80%",height:"80%"},children:e.jsx(cn,{data:t,itemHeight:47,itemKey:"_id",children:p=>{var y,C,a;return e.jsx(xe.Item,{className:"width-100",style:{padding:"0"},children:e.jsxs(ue,{className:"width-100 padding-card",style:{margin:"8px",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)"},children:[e.jsxs(U,{align:"middle",justify:"space-between",style:{margin:"1em 0em"},children:[e.jsx(Q,{flex:1,children:e.jsx("strong",{style:{fontSize:"1.3em"},children:p==null?void 0:p.name})}),e.jsxs(Q,{flex:1,style:{flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("strong",{children:(y=s==null?void 0:s.find(l=>l.key==="usedCount"))==null?void 0:y.title}),e.jsx("p",{children:p==null?void 0:p.usedCount})]}),(C=s==null?void 0:s.find(l=>l.key==="type"||l.key==="category"))==null?void 0:C.render("",p,"view")]}),s.filter(l=>l.key!=="name"&&l.key!=="type"&&(l==null?void 0:l.key)!=="category"&&(l==null?void 0:l.key)!=="actions"&&(i==null?void 0:i.includes(l==null?void 0:l.key))).map((l,b,F)=>e.jsxs(Pt.Fragment,{children:[e.jsxs("div",{style:{fontSize:"0.9em",display:"flex",justifyContent:"space-between"},children:[l.title&&e.jsxs("strong",{children:[l.title,":"]}),e.jsx("span",{children:l.render?l.render(null,p,"view"):p[l.dataIndex]||"—"})]}),b<2&&e.jsx(Z,{style:{margin:"0.2em"}})]},`${p==null?void 0:p._id}-${l.key}`)),e.jsxs(U,{className:"card-actions",align:"middle",justify:"center",children:[(a=s==null?void 0:s.find(l=>l.key==="actions"))==null?void 0:a.render(null,p),r==="P"&&e.jsx(Z,{type:"vertical"}),e.jsxs(Q,{align:"center",justify:"center",children:[e.jsx(T,{type:"text",onClick:()=>c(p),children:e.jsx(L,{icon:Je})}),e.jsx(T,{type:"text",onClick:()=>n("edit",p),children:e.jsx(L,{icon:Ve})}),e.jsx(T,{type:"text",onClick:()=>n("view",p),children:e.jsx(L,{icon:ds})})]})]})]})},p==null?void 0:p._id)}})})}):e.jsxs(Q,{flex:1,style:{display:"flex",flexDirection:"column",overflow:"hidden",width:"100%"},children:[e.jsx(Q,{flex:1,style:{maxWidth:"100%",maxHeight:r==="P"?"63%":"90%",overflowY:"auto",overflowX:"auto"},children:e.jsx(is,{style:{minWidth:"100%"},columns:s.map(p=>({...p,title:e.jsx(st,{title:p.title,children:e.jsx("span",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",display:"inline-block",maxWidth:"150px"},children:p.title})})})),dataSource:q,pagination:!1,direction:"rtl"})}),e.jsx(Q,{align:"center",justify:"center",style:{marginTop:"2vh"},children:e.jsx(sn,{current:m,total:w,pageSize:I,onChange:f,style:{direction:"ltr"},showSizeChanger:!0,pageSizeOptions:["6","10","20","50"],locale:nn})})]})}const{Text:Vt}=z,yr=({value:t=[],onChange:r,ingredientsArr:s=[],fields:i,add:n,remove:x,form:h})=>{var l,b;const[u,g]=d.useState(null),[w,N]=d.useState(!1);d.useState(null),d.useState(null);const[m,$]=d.useState(""),I=d.useRef(null),P=d.useCallback(()=>{setTimeout(()=>{I.current&&I.current.scroll({top:I.current.scrollHeight,behavior:"smooth",duration:2e3})},1e3)},[(l=I.current)==null?void 0:l.scrollHeight]),q=(F,R)=>{const v=[...h.getFieldValue("ingredients")||[]];v[u]={...v[u],ingredientId:F,unit:R.unit,name:R.label},$(R.unit)},A=F=>{const _=[...h.getFieldValue("ingredients")||[]];_[u]={..._[u],quantity:F}},S=()=>{const R=a()[u];if(!R||!R.ingredientId||!R.quantity)return;const _=s.find(B=>B._id===R.ingredientId),v={...R,name:(_==null?void 0:_.name)||"---",unit:(_==null?void 0:_.unit)||R.unit,weightOrVolumePerUnit:R.weightOrVolumePerUnit||null},W=[...t,v];r(W),g(null),N(!1)},f=F=>{const R=t.filter((_,v)=>v!==F);r(R),g(null)},c=()=>{w&&f(u),g(null),N(!1)},p=()=>g(null),y=(F,R,_)=>{const v=[...t];if(v[F][R]=_,R==="ingredientId"){const W=s.find(B=>B._id===_);W&&(v[F].unit=W.unit,v[F].name=W.name)}r(v)},C=F=>{switch(F){case"weight":return'ק"ג';case"volume":return"ליטר";case"units":return"יחידות";default:return""}},a=()=>{const F=h==null?void 0:h.getFieldValue("ingredients");return Array.isArray(F)?F:[]};return d.useEffect(()=>{a().length>0&&P()},[(b=h==null?void 0:h.getFieldValue("ingredients"))==null?void 0:b.length]),e.jsxs(e.Fragment,{children:[w?e.jsxs(U,{gutter:16,style:{marginBottom:"1vw"},children:[e.jsxs("div",{className:"flex flex-1 flex-wrap",children:[e.jsx(J,{span:10,children:e.jsx(M.Item,{name:[u,"ingredientId"],rules:[{required:!0,message:"בחר רכיב"}],children:e.jsx(de,{placeholder:"בחר רכיב",filterOption:(F,R)=>{var _;return(_=R==null?void 0:R.label)==null?void 0:_.toLowerCase().includes(F.toLowerCase())},showSearch:!0,options:s==null?void 0:s.map(F=>({value:F._id,label:F.name,unit:F.unit})),onChange:q})})}),e.jsx(J,{span:10,children:e.jsx(M.Item,{name:[u,"quantity"],rules:[{required:!0,message:"הזן כמות"}],children:e.jsx(oe,{onChange:A,addonAfter:C(m),placeholder:"כמות"})})}),m==="units"&&e.jsx(J,{span:14,children:e.jsx(M.Item,{name:[u,"weightOrVolumePerUnit"],rules:[{required:!0,message:"הזן נפח/משקל ליחידה"}],children:e.jsx(oe,{placeholder:"נפח/משקל ליחידה",min:0,onChange:F=>y(u,"weightOrVolumePerUnit",F),addonAfter:"קילו/ליטר"})})})]}),e.jsxs(J,{span:4,children:[e.jsx(T,{type:"text",icon:e.jsx(L,{icon:De}),onClick:S}),e.jsx(T,{type:"text",icon:e.jsx(L,{icon:Le}),onClick:c})]})]}):e.jsx(T,{type:"dashed",onClick:()=>{g(t.length),N(!0)},disabled:u!==null,style:{marginBottom:"8px"},children:"הוסף מרכיב"}),e.jsx(ue,{ref:I,style:{margin:"1vw 0",paddingTop:"1vw",maxHeight:"10vw",overflow:"auto"},children:e.jsx(xe,{dataSource:t,renderItem:(F,R)=>{var B;const _=u===R,v=s.find(V=>V._id===F.ingredientId),W=C(F.unit||(v==null?void 0:v.unit));return e.jsx(xe.Item,{children:_&&!w?e.jsxs(U,{gutter:16,style:{marginBottom:"1vw"},children:[e.jsxs("div",{className:"flex flex-1 flex-wrap",children:[e.jsx(J,{span:10,children:e.jsx(M.Item,{name:[R,"ingredientId"],children:e.jsx(de,{placeholder:"בחר רכיב",value:F.ingredientId||null,onChange:V=>y(R,"ingredientId",V),options:s.map(V=>({value:V._id,label:V.name})),showSearch:!0})})}),e.jsx(J,{span:10,children:e.jsx(M.Item,{name:[R,"quantity"],children:e.jsx(oe,{placeholder:"כמות",onChange:V=>y(R,"quantity",V),min:0,addonAfter:W,style:{width:"100%"}})})}),F.unit==="units"&&e.jsx(J,{span:14,children:e.jsx(M.Item,{name:[R,"weightOrVolumePerUnit"],rules:[{required:!0,message:"הזן נפח/משקל ליחידה"}],children:e.jsx(oe,{placeholder:"נפח/משקל ליחידה (ליטר/גרם)",min:0,style:{width:"100%"},addonAfter:"קילו/ליטר",onChange:V=>y(R,"weightOrVolumePerUnit",V)})})})]}),e.jsxs(J,{children:[e.jsx(T,{type:"text",icon:e.jsx(L,{icon:De}),onClick:p}),e.jsx(T,{type:"text",icon:e.jsx(L,{icon:Le}),onClick:c})]})]}):e.jsxs(U,{style:{width:"100%"},align:"middle",justify:"space-between",children:[e.jsx(Q,{flex:1,children:e.jsx(Vt,{children:(F==null?void 0:F.name)||((B=F==null?void 0:F.ingredientData)==null?void 0:B.name)||"---"})}),e.jsx(Q,{flex:1,children:e.jsxs(Vt,{children:[F.quantity," ",W,F.unit==="units"&&F.weightOrVolumePerUnit?` (${F.weightOrVolumePerUnit} ק"ג/ליטר)`:""]})}),e.jsxs(U,{children:[e.jsx(T,{type:"text",icon:e.jsx(L,{icon:Ve}),onClick:()=>g(R)}),e.jsx(T,{type:"text",icon:e.jsx(L,{icon:Je}),onClick:()=>f(R)})]})]})},R)}})})]})},Ce=[{value:"weight",label:"משקל",display:t=>t>=1?'ק"ג':"גרם"},{value:"volume",label:"נפח",display:t=>t>=1?"ליטר":'מ"ל'},{value:"units",label:"יחידות",display:t=>t>1?"יחידות":"יחידה"}],{Option:Ue}=de,{Text:he}=z,{TextArea:vr}=me;function wr({mode:t="view",type:r,fields:s=[],onSubmit:i,initialValues:n={},onClose:x,groups:h,tableKeys:u,ingredientsArr:g}){var v,W,B,V,re,ae,ce,te,k;const[w]=M.useForm(),[N]=M.useForm(),[m]=M.useForm(),$=X(o=>{var j,E;return(E=(j=o.settings.settings)==null?void 0:j.hourlyRate)==null?void 0:E.value}),[I,P]=d.useState(0),[q,A]=d.useState(["process","wait"]),[S,f]=d.useState({}),[c,p]=d.useState(n),[y,C]=d.useState(n.unit||null),[a,l]=d.useState(n.subUnit||null),b=o=>{console.log("onChange:",o),P(o)},F=async o=>{let j=o.quantity;x&&x(),(o.subUnit==="g"||o.subUnit==="ml")&&(j=o.quantity/1e3);const E={...n,...S,...o,quantity:j};i&&await i(E),await N.resetFields(),await m.resetFields()};d.useEffect(()=>{if(n){const o=n.quantity<1?n.quantity*1e3:n.quantity;w.setFieldsValue({...n,quantity:o}),C(n.unit),l(n.subUnit||"kg")}},[n,w]);const R=(o,j)=>o.map(E=>{const{key:H,title:ie,type:ve,options:Oe,rules:we,props:ke,hiddenInForm:O,coin:ne,divider:K}=E;if(O)return null;switch(ve){case"text":return e.jsxs(e.Fragment,{children:[e.jsx(M.Item,{name:H,label:ie,rules:we,validateTrigger:"onSubmit",children:e.jsx(me,{...ke})},H),K&&e.jsx(Z,{style:{margin:"3vh 0vh"}})]});case"number":return e.jsxs(e.Fragment,{children:[e.jsx(M.Item,{name:H,label:ie,rules:we==null?void 0:we.map(Y=>Y.validator?{...Y,validator:(se,le)=>Y.validator(se,le,n)}:Y),validateTrigger:"onSubmit",children:e.jsx(oe,{suffix:ne&&"₪",min:0,style:{width:"100%"},...ke})},H),K&&e.jsx(Z,{style:{margin:"3vh 0vh"}})]});case"float":return e.jsxs(e.Fragment,{children:[e.jsx(M.Item,{name:H,label:ie,rules:we,validateTrigger:"onSubmit",children:e.jsx(oe,{suffix:ne&&"₪",min:0,step:.01,style:{width:"100%"},...ke})},H),K&&e.jsx(Z,{style:{margin:"3vh 0vh"}})]});case"select":return e.jsxs(e.Fragment,{children:[e.jsx(M.Item,{name:H,label:ie,rules:we,validateTrigger:"onSubmit",children:e.jsx(de,{...ke,showSearch:!0,onChange:Y=>{H==="unit"&&(C(Y),p(se=>({...se,unit:Y,subUnit:void 0})),j.setFieldsValue({subUnit:void 0}))},children:Oe.map(Y=>e.jsx(Ue,{value:Y.value,children:Y.label},Y.value))})},H),e.jsx(M.Item,{noStyle:!0,shouldUpdate:(Y,se)=>Y.unit!==se.unit,children:()=>{const Y=c==null?void 0:c.unit,se=c==null?void 0:c.subUnit;return H==="unit"&&(Y==="weight"||Y==="volume")?e.jsx(M.Item,{name:"subUnit",initialValue:se||(Y==="weight"?(c==null?void 0:c.quantity)>=1?"kg":"g":(c==null?void 0:c.quantity)>=1?"liter":"ml"),validateTrigger:"onSubmit",label:Y==="weight"?'בחר יחידת משקל (ק"ג / גרם)':'בחר יחידת נפח (ליטר / מ"ל)',rules:[{required:!0,message:"אנא בחר יחידת משנה"}],children:e.jsx(de,{onChange:le=>p(ut=>({...ut,subUnit:le})),children:Y==="weight"?e.jsxs(e.Fragment,{children:[e.jsx(Ue,{value:"kg",children:'ק"ג'}),e.jsx(Ue,{value:"g",children:"גרם"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ue,{value:"liter",children:"ליטר"}),e.jsx(Ue,{value:"ml",children:'מ"ל'})]})})}):null}}),K&&e.jsx(Z,{style:{margin:"3vh 0vh"}})]});case"ingredientsManager":return e.jsxs(e.Fragment,{children:[e.jsx(Z,{style:{margin:"0.5em"}}),e.jsx(M.List,{name:H,label:ie,rules:we,validateTrigger:"onSubmit",children:(Y,{add:se,remove:le})=>e.jsx(yr,{fields:Y,add:se,form:j,remove:le,value:j.getFieldValue(H),onChange:ut=>j.setFieldsValue({[H]:ut}),ingredientsArr:g})},H)]});case"price":return e.jsxs(e.Fragment,{children:[e.jsx(M.Item,{name:"withVATFlag",initialValue:!0,valuePropName:"checked",validateTrigger:"onSubmit",children:e.jsx(We,{onChange:()=>{p(Y=>({...Y,price:void 0,priceExcludingVAT:void 0}))},children:'עלות כולל מע"מ'})},"withVATFlag"),e.jsx(M.Item,{noStyle:!0,validateTrigger:"onSubmit",shouldUpdate:(Y,se)=>Y.withVATFlag!==se.withVATFlag,children:({getFieldValue:Y})=>Y("withVATFlag")?e.jsx(M.Item,{name:"price",label:'עלות (כולל מע"מ)',rules:[{required:!0,message:"חייב להזין עלות"}],validateTrigger:"onSubmit",children:e.jsx(oe,{addonAfter:"₪",onChange:se=>{p(le=>({...le,priceExcludingVAT:void 0,price:se}))},style:{width:"100%"}})},"price"):e.jsx(M.Item,{name:"priceExcludingVAT",label:'עלות (ללא מע"מ)',rules:[{required:!0,message:"חייב להזין עלות"}],validateTrigger:"onSubmit",children:e.jsx(oe,{style:{width:"100%"},addonAfter:"₪",onChange:se=>{p(le=>({...le,price:void 0,priceExcludingVAT:se}))}})},"priceExcludingVAT")})]});case"custom":return e.jsxs(e.Fragment,{children:[E.render&&E.render("",n,"edit",j),K&&e.jsx(Z,{style:{margin:"3vh 0vh"}})]});case"textArea":return e.jsxs(e.Fragment,{children:[e.jsx(M.Item,{name:H,label:ie,rules:we,validateTrigger:"onSubmit",children:e.jsx(vr,{style:{resize:"none"},showCount:!0,maxLength:E==null?void 0:E.maxLength})},H),K&&e.jsx(Z,{style:{margin:"3vh 0vh"}})]});default:return null}});if(t==="view")switch(r){case"mix":return e.jsxs("div",{children:[e.jsx(U,{align:"middle",justify:"space-between",style:{margin:"1em 0em"},children:e.jsx(he,{strong:!0,style:{fontSize:"1.8em"},children:n==null?void 0:n.name})}),e.jsx(U,{align:"middle",justify:"space-between",style:{margin:"1em 0em"},children:(v=u==null?void 0:u.find(o=>o.key==="type"))==null?void 0:v.render("",n,"view")}),e.jsx(U,{align:"middle",justify:"space-between",style:{margin:"1em 0em"},children:(W=u==null?void 0:u.find(o=>o.key==="is_active"))==null?void 0:W.render("",n,"view")}),e.jsxs(U,{align:"middle",justify:"space-between",style:{width:"100%",gap:"8px"},children:[e.jsxs(U,{align:"middle",style:{gap:"8px"},children:[e.jsx(vt,{style:{fontSize:"1.5em",color:"#7f8c8d"}}),e.jsxs(z.Text,{style:{fontSize:"1.4em",display:"flex",alignItems:"center",gap:"4px"},children:["₪",n==null?void 0:n.totalCost]})]}),e.jsxs(U,{align:"middle",style:{gap:"8px"},children:[e.jsx(cs,{style:{fontSize:"1.5em",color:"#7f8c8d"}}),e.jsxs(z.Text,{style:{fontSize:"1.4em",display:"flex",alignItems:"center",gap:"4px"},children:[n==null?void 0:n.preparationTime," דקות"]})]})]}),e.jsxs(ue,{type:"inner",title:"עלויות",styles:{header:{minHeight:"0",padding:"5px 20px"}},style:{margin:"15px 0"},children:[e.jsxs("div",{style:{margin:"12px 0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(Q,{flex:1,children:e.jsxs(he,{strong:!0,children:["עלות עבודה (₪)",":"]})}),e.jsx(Q,{children:e.jsxs("p",{style:{},children:["₪",n==null?void 0:n.laborCost," (₪",$,")"]})})]}),e.jsx(Z,{style:{margin:"8px 0"}}),e.jsxs("div",{style:{marginBottom:"12px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(Q,{flex:1,children:e.jsxs(he,{strong:!0,children:["עלות ל-100 גרם (₪)",":"]})}),e.jsx(Q,{children:e.jsx("p",{style:{},children:(B=u==null?void 0:u.find(o=>o.key==="unitCost"))==null?void 0:B.render("",n,"view")})})]})]}),e.jsxs(ue,{style:{width:"100%",backgroundColor:"#f9f9f9",border:"1px solid #d9d9d9",borderRadius:"8px",marginTop:"10px",paddingTop:"10px"},children:[e.jsx(he,{strong:!0,style:{display:"block",marginBottom:"8px"},children:"מרכיבים:"}),e.jsx("ul",{style:{paddingLeft:"20px",margin:"0",maxHeight:"5vw",overflow:"auto"},children:(V=n==null?void 0:n.ingredients)==null?void 0:V.map((o,j)=>{var H;const E=(()=>{switch(o==null?void 0:o.unit){case"weight":return'ק"ג';case"volume":return"ליטר";case"units":return"יחידות";default:return""}})();return e.jsx("li",{style:{marginBottom:"4px"},children:e.jsxs(he,{children:[(H=g==null?void 0:g.find(ie=>(ie==null?void 0:ie._id)===(o==null?void 0:o.ingredientId)))==null?void 0:H.name," -"," ",o.quantity," ",E," - ₪",o==null?void 0:o.costForQuantity]})},j)})})]})]});case"ingredient":return e.jsxs("div",{children:[e.jsx(U,{align:"middle",justify:"space-between",style:{margin:"1em 0em"},children:e.jsx(he,{strong:!0,style:{fontSize:"1.8em"},children:n==null?void 0:n.name})}),e.jsx(U,{align:"middle",justify:"space-between",style:{margin:"1em 0em"},children:(re=u==null?void 0:u.find(o=>o.key==="type"))==null?void 0:re.render("",n,"view")}),e.jsx(U,{align:"middle",justify:"space-between",style:{margin:"1em 0em"},children:e.jsx(z.Text,{strong:!0,children:n==null?void 0:n.SKU})}),e.jsx(U,{align:"middle",justify:"space-between",style:{margin:"1em 0em"},children:(ae=u==null?void 0:u.find(o=>o.key==="is_active"))==null?void 0:ae.render("",n,"view")}),e.jsx(U,{align:"middle",justify:"space-between",style:{margin:"1em 0em"},children:(ce=u==null?void 0:u.find(o=>o.key==="supplierId"))==null?void 0:ce.render("",n,"view")}),e.jsxs(U,{align:"middle",justify:"space-between",style:{width:"100%",gap:"8px"},children:[e.jsxs(U,{align:"middle",style:{gap:"8px"},children:[e.jsx(vt,{style:{fontSize:"1.5em",color:"#7f8c8d"}}),e.jsxs(J,{children:[e.jsxs(z.Text,{style:{fontSize:"1.4em",display:"flex",alignItems:"center"},children:["₪",n==null?void 0:n.priceExcludingVAT,' (ללא מע"מ)']}),e.jsxs(z.Text,{style:{fontSize:"1em",display:"flex",alignItems:"center"},children:["₪",n==null?void 0:n.price,' (כולל מע"מ)']})]})]}),e.jsxs(U,{align:"middle",style:{gap:"8px"},children:[e.jsx(L,{icon:un}),e.jsxs(z.Text,{style:{fontSize:"1.4em",display:"flex",alignItems:"center",gap:"4px"},children:[n==null?void 0:n.quantity," ",Ce.find(o=>o.value===(n==null?void 0:n.unit)).display(n==null?void 0:n.quantity)]})]})]}),e.jsx(Z,{style:{margin:"8px 0"}}),e.jsxs("div",{style:{marginBottom:"12px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(Q,{flex:1,children:e.jsxs(he,{strong:!0,children:["כמות מינימלית",":"]})}),e.jsx(Q,{children:e.jsxs("p",{style:{},children:[n==null?void 0:n.unitQuantity," ",Ce.find(o=>o.value===(n==null?void 0:n.unit)).display(n==null?void 0:n.quantity)," - ₪",n==null?void 0:n.unitPrice]})})]}),(n==null?void 0:n.juiceRatio)&&e.jsxs(e.Fragment,{children:[e.jsx(Z,{style:{margin:"8px 0"}}),e.jsxs("div",{style:{marginBottom:"12px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(Q,{flex:1,children:e.jsxs(he,{strong:!0,children:["יחס עיבוד",":"]})}),e.jsx(Q,{children:e.jsx("p",{style:{},children:(te=u==null?void 0:u.find(o=>o.key==="juiceRatio"))==null?void 0:te.render("",n,"view")})})]}),e.jsx(Z,{style:{margin:"8px 0"}}),e.jsxs("div",{style:{marginBottom:"12px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(Q,{flex:1,children:e.jsxs(he,{strong:!0,children:["מחיר ליחידה מעובדת",":"]})}),e.jsx(Q,{children:e.jsxs("p",{style:{},children:["₪",n==null?void 0:n.processedPrice]})})]})]}),(n==null?void 0:n.notes)&&e.jsx(ue,{type:"inner",style:{backgroundColor:"#f9f9f9",border:"1px solid #d9d9d9",borderRadius:"8px",marginTop:"10px",paddingTop:"10px"},children:e.jsxs(J,{children:[e.jsx(U,{style:{marginBottom:"4px"},children:e.jsxs(he,{strong:!0,style:{fontSize:"1.2em",color:"#333"},children:["הערות",":"]})}),e.jsx(z.Text,{style:{fontSize:"1em",color:"#555"},children:n==null?void 0:n.notes})]})})]});default:return e.jsxs("div",{style:{},children:[e.jsxs(U,{align:"middle",justify:"space-between",style:{margin:"1em 0em"},children:[e.jsx(he,{strong:!0,style:{fontSize:"1.8em"},children:n==null?void 0:n.name}),(k=u==null?void 0:u.find(o=>o.key==="type"))==null?void 0:k.render("",n,"view")]}),u==null?void 0:u.filter(o=>o.key!=="type"&&(o==null?void 0:o.key)!=="name"&&!o.column).map((o,j,E)=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"12px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(Q,{flex:1,children:e.jsxs(he,{strong:!0,children:[o.title,":"]})}),e.jsx(Q,{flex:1,children:e.jsx("p",{style:{},children:(o==null?void 0:o.render)&&(o==null?void 0:o.render("",n,t,"view"))||n[o.key]||"—"})})]},o.key),j<(E==null?void 0:E.length)-1&&e.jsx(Z,{style:{margin:"8px 0"}})]})),u==null?void 0:u.filter(o=>o.column).map((o,j,E)=>e.jsxs(e.Fragment,{children:[j===0&&e.jsx(Z,{style:{margin:"8px 0"}}),e.jsxs("div",{style:{marginBottom:"12px",display:"flex",justifyContent:"space-between",flexDirection:"column"},children:[e.jsxs(he,{strong:!0,style:{fontSize:"1.4em"},children:[o.title,":"]}),e.jsx(Q,{flex:1,children:e.jsx("p",{style:{},children:(o==null?void 0:o.render)&&(o==null?void 0:o.render("",n,t,"view"))||n[o.key]||"—"})})]},o.key),j<(E==null?void 0:E.length)-1&&e.jsx(Z,{style:{margin:"8px 0"}})]}))]})}const _=[{title:"מידע",icon:e.jsx(us,{}),content:e.jsxs(M,{form:N,layout:"vertical",onValuesChange:(o,j)=>{p(E=>({...E,...o}))},onFinish:async o=>{await N.validateFields(),p({...c,...o}),P(I+1)},initialValues:n,children:[R(s==null?void 0:s.filter(o=>o.group===1),N),h&&!(n!=null&&n._id)&&e.jsx(T,{type:"primary",htmlType:"submit",children:"הבא"}),t!=="add"&&e.jsx(T,{type:"primary",onClick:()=>F(c),children:"עדכן"})]})},{title:"עלויות",icon:e.jsx(vn,{}),content:e.jsxs(M,{layout:"vertical",form:m,onValuesChange:(o,j)=>{p(E=>({...E,...o}))},onFinish:o=>{const j={...c,...o};p(j),i&&i(j)},initialValues:n,children:[R(s==null?void 0:s.filter(o=>o.group===2),m),h&&!(n!=null&&n._id)&&e.jsxs(e.Fragment,{children:[e.jsx(Z,{style:{margin:"24px 0"}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[I>0&&e.jsx(T,{onClick:()=>P(I-1),children:"הקודם"}),e.jsx(T,{type:"primary",htmlType:"submit",children:t!=="add"?"עדכן":"סיום"})]})]}),t!=="add"&&e.jsx(T,{type:"primary",onClick:()=>{console.log(m==null?void 0:m.getFieldsValue()),F(c)},children:"עדכן"})]})}];return e.jsxs(e.Fragment,{children:[h&&!(n!=null&&n._id)&&e.jsx(Q,{wrap:"wrap",justify:"space-between",align:"center",style:{gap:"8px"},children:e.jsx(Ot,{current:I,onChange:b,status:q[I],style:{width:"100%"},children:_==null?void 0:_.map((o,j)=>e.jsx(Ot.Step,{title:o.title,icon:o.icon},j))})}),h&&(n==null?void 0:n._id)&&e.jsx(Q,{flex:1,wrap:"wrap",justify:"center",align:"center",style:{gap:"8px"},children:e.jsx(Se,{current:I,onChange:b,status:q[I],style:{width:"100%"},children:_==null?void 0:_.map((o,j)=>e.jsx(Se.TabPane,{tab:o.title,icon:o.icon},j))})}),h&&_[I].content,!h&&e.jsxs(M,{form:w,layout:"vertical",onFinish:F,onValuesChange:o=>{console.log(o)},initialValues:n,children:[!h&&R(s,w),t!=="view"&&(!h||h&&(n==null?void 0:n._id))&&e.jsx(M.Item,{children:e.jsx(T,{type:"primary",htmlType:"submit",style:{width:"100%",marginTop:"1vw"},children:t==="add"?"הוסף":"עדכן"})})]})]})}function br({open:t,onClose:r,filters:s,setFilters:i,filtersArr:n}){var m,$,I,P,q,A,S;const[x,h]=d.useState({type:s.type||[],supplierId:s.supplierId||[],is_active:s.is_active}),u=f=>{h(c=>({...c,[f]:f==="is_active"?null:[]}))},g=()=>{const f=Object.entries(x).reduce((c,[p,y])=>((Array.isArray(y)&&y.length>0||typeof y=="boolean")&&(c[p]=y),c),{});i(f),r()},w=f=>{const c=f==="all"?null:f==="true";h(p=>({...p,is_active:c}))},N=({options:f,filterKey:c})=>{const p=y=>{h(C=>{const a=C[c]||[],l=a.includes(y)?a.filter(b=>b!==y):[...a,y];return{...C,[c]:l}})};return e.jsxs("div",{children:[e.jsx("div",{className:"sticky top-0 bg-white p-2 border-b",children:e.jsx(T,{type:"link",className:"w-full text-left",onClick:()=>u(c),children:"איפוס בחירה"})}),e.jsx("div",{style:{maxHeight:"250px",overflowY:"auto",padding:"8px"},onScroll:y=>y.stopPropagation(),children:f.map(y=>e.jsx("div",{style:{display:"flex",alignItems:"center",marginBottom:"8px"},children:e.jsx(We,{checked:(x[c]||[]).includes(y.value),onChange:()=>p(y.value),children:y.label})},y.value))})]})};return e.jsxs(ls,{title:"סינון רכיבים",placement:"right",onClose:r,open:t,width:360,children:[e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("label",{style:{fontSize:"14px",fontWeight:"500"},children:"קטגוריה"}),e.jsx(Ut,{content:e.jsx(N,{options:((m=n.find(f=>f.value==="type"))==null?void 0:m.options)||[],filterKey:"type"}),trigger:"click",getPopupContainer:f=>f.parentElement,children:e.jsxs(T,{style:{width:"100%"},type:"dashed",children:[((($=x.type)==null?void 0:$.length)||0)>0?`${(I=x.type)==null?void 0:I.length} נבחרו`:"בחר קטגוריות",e.jsx(Qt,{style:{marginLeft:"8px"}})]})})]}),e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("label",{style:{fontSize:"14px",fontWeight:"500"},children:"ספק"}),e.jsx(Ut,{content:e.jsx(N,{options:((P=n.find(f=>f.value==="supplierId"))==null?void 0:P.options)||[],filterKey:"supplierId"}),trigger:"click",getPopupContainer:f=>f.parentElement,children:e.jsxs(T,{style:{width:"100%"},type:"dashed",children:[(((q=x.supplierId)==null?void 0:q.length)||0)>0?`${(A=x.supplierId)==null?void 0:A.length} נבחרו`:"בחר ספקים",e.jsx(Qt,{style:{marginLeft:"8px"}})]})})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"14px",fontWeight:"500"},children:"סטטוס"}),e.jsx(de,{style:{width:"100%"},value:((S=x.is_active)==null?void 0:S.toString())||"all",onChange:w,options:[{label:"הכל",value:"all"},{label:"פעיל",value:"true"},{label:"לא פעיל",value:"false"}]})]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px"},children:[e.jsx(T,{onClick:()=>h({type:[],supplierId:[],is_active:null}),children:"איפוס הכל"}),e.jsx(T,{type:"primary",onClick:g,children:"החל סינון"})]})]})}const{Search:Cr}=me;function rt({title:t,titleView:r,dataPrint:s,data:i,groups:n,tableKeys:x,newTitle:h,setDataPrint:u,searchKeys:g,sortKeys:w,mobileKeys:N,Dtitle:m,Dcontent:$,onAdd:I,onEdit:P,onDelete:q,width:A,ingredientsArr:S,iconADD:f,floatAction:c,type:p,openModalProduct:y,filters:C,saveFilters:a,filtersArr:l}){const[b,F]=d.useState([]),[R,_]=d.useState(!1),[v,W]=d.useState(!1),[B,V]=d.useState("add"),[re,ae]=d.useState(null),[ce,te]=d.useState(!1),[k,o]=d.useState(C),j=Te({query:"(max-width: 500px)"}),E=w.map(O=>({key:O==null?void 0:O.key,label:e.jsx("span",{className:"width-100",onClick:()=>{const ne=[...s].sort((K,Y)=>{const se=K[O==null?void 0:O.key],le=Y[O==null?void 0:O.key];return typeof se=="number"&&typeof le=="number"?le-se:se==null?void 0:se.toString().localeCompare(le==null?void 0:le.toString())});u(ne)},children:O==null?void 0:O.title})})),H=O=>{if(O==="all")F(x);else{let ne=b.findIndex(Y=>Y.key===O),K=[...b];ne!==-1?K=K.filter(Y=>Y.key!==O):K=[...K,x.find(Y=>Y.key===O)],F(K)}},ie=[{key:"all",label:e.jsx(We,{className:"width-100",rootClassName:"width-100",checked:b.length===x.length,disabled:b.length===x.length,onChange:()=>H("all"),onClick:O=>O.stopPropagation(),children:"הכל"})},...x.filter(O=>!(O!=null&&O.required)).map(({title:O,dataIndex:ne})=>({key:ne,label:e.jsx(We,{className:"width-100",rootClassName:"width-100",checked:b.some(K=>K.key===ne),disabled:b.length<=3&&b.some(K=>K.key===ne),onChange:()=>H(ne),onClick:K=>K.stopPropagation(),children:O})}))],ve=(O,ne=null)=>{if(p==="P")return y(O,ne);V(O),ae(ne),W(!0)},Oe=()=>{W(!1),ae(null)},we=O=>{fe.confirm({title:m,content:$,okText:"מחק",cancelText:"בטל",onOk:()=>q(O==null?void 0:O._id)})},ke=()=>{let O=[...i];Object.entries(C).forEach(([ne,K])=>{if(K!=null)switch(ne){case"search":O=O.filter(Y=>g.some(se=>{var le;return(le=Y[se])==null?void 0:le.toString().toLowerCase().includes(K.toLowerCase())}));break;case"is_active":O=O.filter(Y=>Y.is_active===K);break;case"type":case"supplierId":Array.isArray(K)&&(O=O.filter(Y=>K.includes(Y[ne])));break}}),u(O)};return d.useEffect(()=>{C&&(ke(),o(C))},[C]),d.useEffect(()=>{F(x)},[x]),e.jsxs(Q,{flex:1,vertical:!0,style:{maxWidth:"100%"},gap:"1em",className:"container",children:[j&&e.jsx(U,{justify:"center",children:e.jsxs(z.Title,{level:3,style:{margin:"0"},children:[f," ",t]})}),e.jsxs(U,{align:"middle",style:{flexFlow:""},justify:"space-between",children:[!j&&e.jsx(U,{align:"",children:e.jsxs(z.Title,{level:3,style:{margin:"0"},children:[f," ",t]})}),e.jsx(U,{style:{},children:e.jsx(Cr,{placeholder:"חיפוש ...",allowClear:!0,onChange:({target:O})=>{u(i==null?void 0:i.filter(ne=>g.some(K=>{var Y,se,le;return(le=(se=(Y=ne[K])==null?void 0:Y.toString())==null?void 0:se.toLowerCase())==null?void 0:le.includes(O.value.toLowerCase())})))},style:{width:200}})}),e.jsxs(U,{style:{gap:"0.5em"},children:[l&&e.jsxs(T,{onClick:()=>te(!0),children:[e.jsx(wn,{}),!j&&"סינון","(",Object.keys(C).length,")"]}),!j&&e.jsx(e.Fragment,{children:e.jsx(Ht,{menu:{items:ie},trigger:["click"],open:R,onOpenChange:O=>_(O),children:e.jsxs(T,{children:[e.jsx(L,{icon:xn,style:{marginLeft:"8px"}}),j?e.jsx(e.Fragment,{children:`${b.length} / ${x.length}`}):e.jsx(e.Fragment,{children:`בחרת ${b.length} מתוך ${x.length}`})]})})}),e.jsx(Ht,{menu:{items:E},trigger:["click"],children:e.jsxs(T,{type:j?"link":"default",children:[e.jsx(L,{icon:mn,style:{marginLeft:"8px"}}),"מיון"]})}),!j&&e.jsxs(e.Fragment,{children:[e.jsx(Z,{type:"vertical",style:{height:"auto"}}),e.jsx(U,{style:{},children:e.jsx(T,{onClick:()=>ve("add"),type:"primary",children:h})})]})]})]}),e.jsxs(jt.Group,{trigger:"click",type:"primary",icon:e.jsx(L,{icon:pn}),children:[e.jsx(jt,{type:"primary",onClick:()=>ve("add"),icon:f}),c==null?void 0:c.map((O,ne)=>e.jsx(Pt.Fragment,{children:O},`float-action-${ne}`))]}),e.jsx(fr,{data:s,tableKeys:[{title:"פעולות",key:"action",minWidth:130,maxWidth:130,render:(O,ne)=>e.jsxs(U,{className:"card-actions",align:"middle",justify:"center",style:{maxWidth:130},children:[e.jsx(T,{type:"text",onClick:()=>we(ne),children:e.jsx(L,{icon:Je})}),e.jsx(T,{type:"text",onClick:()=>ve("edit",ne),children:e.jsx(L,{icon:Ve})}),e.jsx(T,{type:"text",onClick:()=>ve("view",ne),children:e.jsx(L,{icon:ds})})]})},...b],openModal:ve,mobileKeys:N,type:p,Dtitle:m,Dcontent:$,onDelete:q}),ce&&e.jsx(br,{open:ce,onClose:()=>te(!1),filtersArr:l,filters:k,setFilters:O=>{o(O),a(O),ke()}}),e.jsx(fe,{style:{top:j?"3em":""},title:B==="add"?`הוסף ${r} חדש`:B==="edit"?`ערוך ${r}`:`צפייה ב${r}`,open:v,onCancel:Oe,footer:null,destroyOnClose:!0,width:j?"100%":A||600,children:p!=="P"&&e.jsx(wr,{mode:B,groups:n,type:p,tableKeys:b,ingredientsArr:S,fields:x.filter(O=>O.editable||B==="view"),onSubmit:O=>{B==="add"&&I(O),B==="edit"&&P({...re,...O}),Oe()},initialValues:re||{},onClose:Oe})})]})}const at="https://menu-server-c2b952e2c698.herokuapp.com/api",Sr=t=>G.post(`${at}/categories`,t),Ir=t=>{const r=encodeURIComponent(t._id);return G.put(`${at}/categories/${r}`,t)},Nr=t=>G.delete(`${at}/categories/${t}`),kr=()=>G.get(`${at}/categories`),Ns=d.createContext(),Fr=()=>d.useContext(Ns),Pr=({children:t})=>{const[r,s]=d.useState(!1),i=async h=>{s(!0);try{await Sr(h),D.success("הקטגוריה נוספה בהצלחה"),s(!1)}catch(u){console.error("Error adding category:",u),D.error("שגיאה בהוספת הקטגוריה"),s(!1)}},n=async h=>{s(!0);try{await Ir(h),D.success("הקטגוריה עודכנה בהצלחה"),s(!1)}catch(u){console.error("Error updating category:",u),D.error("שגיאה בעדכון הקטגוריה"),s(!1)}},x=async h=>{s(!0);try{await Nr(h),D.success("הקטגוריה נמחקה בהצלחה"),s(!1)}catch(u){console.error("Error deleting category:",u),D.error("שגיאה במחיקת הקטגוריה"),s(!1)}};return e.jsx(Ns.Provider,{value:{addCategory:i,updateCategory:n,deleteCategory:x,loading:r},children:t})},{Title:Gt,Text:_r}=z,Tr=({isCategoryModalVisible:t,setIsCategoryModalVisible:r})=>{const{addCategory:s,updateCategory:i,deleteCategory:n}=Fr(),x=X(S=>S.categories),[h,u]=d.useState(""),[g,w]=d.useState(null),[N,m]=d.useState(""),$=()=>{if(h.trim()===""){m("אנא הזן שם קטגוריה תקין");return}if(x.some(S=>S.name===h.trim()&&S!==g)){m("קטגוריה זו כבר קיימת");return}g?i({...g,name:h.trim()}):s({name:h.trim()}),u(""),w(null),m("")},I=S=>{w(S),u(S.name)},P=()=>{if(h.trim()===""){m("אנא הזן שם קטגוריה תקין");return}i({...g,name:h.trim()}),u(""),w(null),m("")},q=S=>{n(S)},A=()=>{u(""),w(null),m(""),r(!1)};return e.jsxs(fe,{title:g?"ערוך קטגוריה":"הוסף קטגוריה חדשה",open:t,onCancel:A,footer:null,className:"category-modal popup-modal",children:[e.jsxs("div",{className:"category-form-section",children:[e.jsx(Gt,{level:4,children:g?"ערוך קטגוריה":"הוסף קטגוריה חדשה"}),e.jsx(me,{placeholder:"הזן שם קטגוריה",value:h,onChange:S=>u(S.target.value),onPressEnter:$}),N&&e.jsx(_r,{type:"danger",className:"error-message",children:N}),e.jsx(T,{type:"primary",onClick:$,style:{marginTop:"10px"},children:g?"עדכן קטגוריה":"הוסף קטגוריה"})]}),e.jsxs("div",{className:"category-list-section",children:[e.jsx(Gt,{level:4,style:{marginTop:"20px"},children:"קטגוריות קיימות:"}),e.jsx(xe,{dataSource:x,renderItem:S=>e.jsx(xe.Item,{className:g&&g._id===S._id?"editing-item":"",actions:[g&&g._id===S._id?e.jsx(T,{type:"link",onClick:P,children:"שמור"}):e.jsx(T,{type:"link",onClick:()=>I(S),children:"ערוך"}),e.jsx(_t,{title:"האם אתה בטוח שברצונך למחוק את הקטגוריה?",onConfirm:()=>q(S._id),okText:"כן",cancelText:"לא",children:e.jsx(T,{icon:e.jsx(_e,{}),type:"text",danger:!0})})],children:g&&g._id===S._id?e.jsx(me,{value:h,onChange:f=>u(f.target.value),onPressEnter:P,autoFocus:!0}):S.name})})]})]})},{Text:Xt}=z,Er=({ingredients:t,sizes:r,add:s,remove:i,indexSize:n,form:x,onChange:h,getUnitDisplay:u,setDisabledSave:g})=>{var ae,ce,te;const w=d.useRef(null),[N,m]=d.useState(null),[$,I]=d.useState(!1),[P,q]=d.useState(!1),[A,S]=d.useState(null),[f,c]=d.useState(null),[p,y]=d.useState(""),C=d.useCallback(()=>{setTimeout(()=>{w.current&&w.current.scroll({top:w.current.scrollHeight,behavior:"smooth",duration:2e3})},1e3)},[(ae=w.current)==null?void 0:ae.scrollHeight]),a=k=>{m(k),g(!0)},l=()=>{m(null),g(!1),q(!1),I(!1),y("")},b=()=>{x.validateFields().then(()=>{m(null),g(!1),q(!1),I(!1),y("")})},F=(k,o,j)=>{const H=[...x.getFieldValue("ingredients")||[]];H[k]={...H[k],[o]:j},x.setFieldsValue({ingredients:H}),R(H)},R=k=>{const o=[...r];o[n]={...o[n],ingredients:k},h(o)},_=(k,o)=>{S({ingredientId:k,unit:o.unit,name:o.label})},v=k=>{c(k)},W=()=>{if(!A||!f)return;const k={...A,quantity:f},j=[...x.getFieldValue("ingredients")||[],k];x.setFieldsValue({ingredients:j}),R(j),S(null),c(null),q(!1),m(null),g(!1),I(!1)},B=k=>{const j=(x.getFieldValue("ingredients")||[]).filter((E,H)=>H!==k);x.setFieldsValue({...j}),R(j),i(k)},V=k=>{if(!k)return"";if(k.name)return k.name;if(k.ingredientId&&t){const o=t.find(j=>j._id===k.ingredientId);return(o==null?void 0:o.name)||""}return""},re=()=>{const k=x.getFieldValue("ingredients");return Array.isArray(k)?k:[]};return d.useEffect(()=>{re().length>0&&C()},[(ce=x.getFieldValue("ingredients"))==null?void 0:ce.length]),e.jsxs(e.Fragment,{children:[P?e.jsxs(U,{gutter:16,className:"width-100",style:{marginBottom:"1vw"},justify:"space-between",children:[e.jsxs(J,{span:10,children:[" ",e.jsx(de,{placeholder:"בחר רכיב",style:{width:"100%"},filterOption:(k,o)=>{var j;return(j=o==null?void 0:o.label)==null?void 0:j.toLowerCase().includes(k.toLowerCase())},showSearch:!0,options:t==null?void 0:t.map(k=>({value:k._id,label:k.name,unit:k.unit})),onChange:_})]}),e.jsxs(J,{span:10,children:[" ",e.jsx(oe,{onChange:v,addonAfter:u((A==null?void 0:A.unit)||""),placeholder:"כמות",style:{width:"100%"}})]}),e.jsxs(J,{children:[" ",e.jsx(T,{type:"text",icon:e.jsx(L,{icon:De}),onClick:W}),e.jsx(T,{type:"text",icon:e.jsx(L,{icon:Le}),onClick:l})]})]}):e.jsx(T,{type:"dashed",onClick:()=>{q(!0),I(!0),m(re().length),g(!0)},disabled:N!==null,children:"הוסף מרכיב"}),e.jsx("div",{ref:w,style:{margin:"1vw 0",height:"12vw",maxHeight:"12vw",overflowY:"auto",overflowX:"hidden"},children:e.jsx(xe,{dataSource:(te=r[n])==null?void 0:te.ingredients,renderItem:(k,o)=>{var j;return e.jsx("div",{className:"mx-3 my-0 p-0",children:N!==o?e.jsxs(U,{style:{width:"100%"},align:"middle",justify:"space-between",children:[e.jsx(Q,{flex:2,children:e.jsx(Xt,{children:V(k)})}),e.jsx(Q,{flex:1,children:e.jsxs(Xt,{children:[k==null?void 0:k.quantity," ",u(k==null?void 0:k.unit)]})}),e.jsxs(J,{children:[e.jsx(T,{type:"text",icon:e.jsx(L,{icon:Ve}),onClick:()=>a(o)}),e.jsx(T,{type:"text",icon:e.jsx(L,{icon:Je}),onClick:()=>B(o)})]})]}):!$&&e.jsxs("div",{className:"flex flex-1 flex-row gap-2 justify-between",children:[e.jsx(J,{span:10,children:e.jsx(M.Item,{name:[o,"ingredientId"],rules:[{required:!0,message:"בחר רכיב"}],initialValue:((j=k.ingredientId)==null?void 0:j._id)||k.ingredientId,children:e.jsx(de,{placeholder:"בחר רכיב",showSearch:!0,filterOption:(E,H)=>{var ie;return(ie=H==null?void 0:H.label)==null?void 0:ie.toLowerCase().includes(E.toLowerCase())},options:t==null?void 0:t.map(E=>({value:E._id,label:E.name,unit:E.unit})),onChange:(E,H)=>F(o,"ingredientId",E)})})}),e.jsx(J,{span:10,children:e.jsx(M.Item,{name:[o,"quantity"],rules:[{required:!0,message:"הזן כמות"}],initialValue:k.quantity,children:e.jsx(oe,{addonAfter:u(k==null?void 0:k.unit),onChange:E=>F(o,"quantity",E)})})}),e.jsxs(J,{span:4,children:[e.jsx(T,{type:"text",icon:e.jsx(L,{icon:De}),onClick:b}),e.jsx(T,{type:"text",icon:e.jsx(L,{icon:Le}),onClick:l})]})]})},o)}})})]})},{Text:Zt}=z,$r=({mixes:t,sizes:r,add:s,remove:i,indexSize:n,form:x,onChange:h,getUnitDisplay:u,setDisabledSave:g})=>{var ae,ce,te;const w=d.useRef(null),[N,m]=d.useState(null),[$,I]=d.useState(!1),[P,q]=d.useState(!1),[A,S]=d.useState(null),[f,c]=d.useState(null),[p,y]=d.useState(""),C=d.useCallback(()=>{setTimeout(()=>{w.current&&w.current.scroll({top:w.current.scrollHeight,behavior:"smooth",duration:2e3})},1e3)},[(ae=w.current)==null?void 0:ae.scrollHeight]),a=k=>{m(k),g(!0)},l=()=>{m(null),g(!1),q(!1),I(!1),y("")},b=()=>{x.validateFields().then(()=>{m(null),g(!1),q(!1),I(!1),y("")})},F=(k,o,j)=>{const H=[...x.getFieldValue("mixes")||[]];H[k]={...H[k],[o]:j},x.setFieldsValue({mixes:H}),R(H)},R=k=>{const o=[...r];o[n]={...o[n],mixes:k},h(o)},_=(k,o)=>{S({mixId:k,unit:(o==null?void 0:o.unit)||"weight",name:o.label})},v=k=>{c(k)},W=()=>{if(!A||!f)return;const k={...A,quantity:f},j=[...x.getFieldValue("mixes")||[],k];x.setFieldsValue({mixes:j}),R(j),S(null),c(null),q(!1),y(""),m(null),g(!1),I(!1)},B=k=>{const j=(x.getFieldValue("mixes")||[]).filter((E,H)=>H!==k);x.setFieldsValue({...j}),R(j),i(k)},V=k=>{if(!k)return"";if(k.name)return k.name;if(k.mixId&&t){const o=t.find(j=>j._id===k.mixId);return(o==null?void 0:o.name)||""}return""},re=()=>{const k=x.getFieldValue("mixes");return Array.isArray(k)?k:[]};return d.useEffect(()=>{re().length>0&&C()},[(ce=x.getFieldValue("mixes"))==null?void 0:ce.length]),e.jsxs(e.Fragment,{children:[P?e.jsxs(U,{gutter:16,className:"width-100",style:{marginBottom:"1vw"},justify:"space-between",children:[e.jsx(J,{span:10,children:e.jsx(de,{placeholder:"בחר רכיב",filterOption:(k,o)=>{var j;return(j=o==null?void 0:o.label)==null?void 0:j.toLowerCase().includes(k.toLowerCase())},showSearch:!0,style:{width:"100%"},options:t==null?void 0:t.map(k=>({value:k._id,label:k.name,unit:k.unit})),onChange:_})}),e.jsx(J,{span:10,children:e.jsx(oe,{onChange:v,addonAfter:u(p),placeholder:"כמות",style:{width:"100%"}})}),e.jsxs(J,{children:[e.jsx(T,{type:"text",icon:e.jsx(L,{icon:De}),onClick:W}),e.jsx(T,{type:"text",icon:e.jsx(L,{icon:Le}),onClick:l})]})]}):e.jsx(T,{type:"dashed",onClick:()=>{q(!0),I(!0),m(re().length),g(!0)},disabled:N!==null,children:"הוסף מרכיב"}),e.jsx("div",{ref:w,style:{margin:"1vw 0",height:"12vw",maxHeight:"12vw",overflowY:"auto",overflowX:"hidden"},children:e.jsx(xe,{dataSource:(te=r[n])==null?void 0:te.mixes,renderItem:(k,o)=>{var j;return e.jsx("div",{className:"mx-3 my-0 p-0",children:N!==o?e.jsxs(U,{style:{width:"100%"},align:"middle",justify:"space-between",children:[e.jsx(Q,{flex:1,children:e.jsx(Zt,{children:V(k)})}),e.jsx(Q,{flex:1,children:e.jsxs(Zt,{children:[k==null?void 0:k.quantity," ",u(k==null?void 0:k.unit)]})}),e.jsxs(U,{children:[e.jsx(T,{type:"text",onClick:()=>a(o),children:e.jsx(L,{icon:Ve})}),e.jsx(T,{type:"text",onClick:()=>B(o),children:e.jsx(L,{icon:Je})})]})]}):!$&&e.jsxs("div",{className:"flex flex-1 flex-row gap-2 justify-between",children:[e.jsx(J,{span:10,children:e.jsx(M.Item,{name:[o,"mixId"],rules:[{required:!0,message:"בחר רכיב"}],initialValue:((j=k.mixId)==null?void 0:j._id)||k.mixId,children:e.jsx(de,{placeholder:"בחר רכיב",showSearch:!0,filterOption:(E,H)=>{var ie;return(ie=H==null?void 0:H.label)==null?void 0:ie.toLowerCase().includes(E.toLowerCase())},options:t==null?void 0:t.map(E=>({value:E._id,label:E.name,unit:E.unit})),onChange:(E,H)=>F(o,"mixId",E)})})}),e.jsx(J,{span:10,children:e.jsx(M.Item,{name:[o,"quantity"],rules:[{required:!0,message:"הזן כמות"}],initialValue:k.quantity,children:e.jsx(oe,{addonAfter:u(k==null?void 0:k.unit),onChange:E=>F(o,"quantity",E)})})}),e.jsxs(J,{span:4,children:[e.jsx(T,{type:"text",icon:e.jsx(L,{icon:De}),onClick:b}),e.jsx(T,{type:"text",icon:e.jsx(L,{icon:Le}),onClick:l})]})]})},o)}})})]})};function Mr({size:t,sizes:r,indexSize:s,handleCancelEdit:i,handleRemoveSize:n,newSizeId:x,form:h,ingredients:u,mixes:g,onChange:w,getUnitDisplay:N,activeSubTab:m,setActiveSubTab:$,setNewSizeId:I,onSubmit:P}){var f,c;const[q,A]=d.useState(!1),S=async()=>{var p;try{const y=await h.validateFields();I(null),w(r==null?void 0:r.map((C,a)=>a===s?{...C,...y,edit:!1}:C)),P(y,s)}catch(y){const a=(p=y.errorFields[0])==null?void 0:p.name;a!=null&&a.includes("ingredients")?$("1"):a!=null&&a.includes("mixes")&&$("2")}};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-row justify-between items-start",style:{marginBottom:"12px"},children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx(M.Item,{name:["_id"],hidden:!0,children:e.jsx(me,{})}),e.jsx(M.Item,{name:["label"],label:"שם הגודל",rules:[{required:!0,message:"חייב למלא שם גודל"},{min:1,message:"שם גודל חייב להיות לפחות 1 תווים"},{max:25,message:"שם גודל לא יכול לחרוג מ-25 תווים"}],children:e.jsx(me,{placeholder:"שם הגודל",size:"middle",showCount:!0,style:{width:"auto",minWidth:"200px"},maxLength:25})}),e.jsx(M.Item,{name:["price"],label:"מחיר",rules:[{required:!0,message:"יש למלא מחיר"},{type:"number",min:0,message:"המחיר חייב להיות חיובי"}],children:e.jsx(oe,{placeholder:"מחיר",style:{width:"100%"},addonAfter:"₪"})}),e.jsx(M.Item,{label:"זמן הכנה (דקות)",name:["preparationTime"],rules:[{required:!0,message:"חייב לציין זמן הכנה"}],children:e.jsx(oe,{placeholder:"זמן הכנה",style:{width:"100%"},addonAfter:e.jsx(L,{style:{fontSize:"0.9em"},icon:Tt})})})]}),e.jsxs("div",{children:[!(t!=null&&t.idNew)&&e.jsx(T,{type:"text",icon:e.jsx($t,{}),onClick:()=>i(s)}),e.jsx(T,{type:"text",danger:!0,icon:e.jsx(_e,{}),title:"מחק גודל",onClick:()=>n(s)})]})]}),e.jsx(Z,{className:"my-2"}),e.jsxs(Se,{activeKey:m,onChange:p=>$(p),tabBarStyle:{direction:"rtl"},style:{margin:"1vw 0"},type:"card",tabPosition:"top",children:[e.jsxs(Bt,{tab:`מרכיבים (${((f=t==null?void 0:t.ingredients)==null?void 0:f.length)||0})`,children:[e.jsx(z.Text,{strong:!0,style:{display:"block",marginBottom:"8px"},children:"מרכיבים:"}),e.jsx(M.List,{name:["ingredients"],children:(p,{add:y,remove:C})=>e.jsx(Er,{add:y,remove:C,fields:p,form:h,indexSize:s,setDisabledSave:A,ingredients:u,onChange:w,getUnitDisplay:N,sizes:r})})]},1),e.jsxs(Bt,{tab:`מתכונים (${((c=t==null?void 0:t.mixes)==null?void 0:c.length)||0})`,children:[e.jsx(z.Text,{strong:!0,style:{display:"block",marginBottom:"8px"},children:"מתכונים:"}),e.jsx(M.List,{name:["mixes"],children:(p,{add:y,remove:C})=>e.jsx($r,{add:y,remove:C,fields:p,form:h,indexSize:s,setDisabledSave:A,mixes:g,onChange:w,getUnitDisplay:N,sizes:r})})]},2)]}),e.jsx(T,{type:"primary",htmlType:"submit",disabled:q,onClick:()=>S(),children:"שמור"})]},t.idNew||s)}const{Text:zt}=z;function ks({size:t,index:r,sizeInfo:s,type:i,handleEditSize:n,handleRemoveSize:x,ingredients:h,mixes:u}){const g=Te({query:"(max-width: 500px)"});X(m=>{var $,I;return(I=($=m.settings.settings)==null?void 0:$.hourlyRate)==null?void 0:I.value});const w=m=>e.jsx(U,{children:e.jsxs(Q,{flex:1,style:{flexDirection:"column"},children:[e.jsxs("div",{className:"flex flex-row justify-evenly items-center",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("p",{className:"text-xl font-semibold",children:["₪",m==null?void 0:m.priceIncludingVAT]}),e.jsx("p",{className:"text-sm",children:'מחיר ללא מע"מ:'}),e.jsxs("p",{className:"text-base font-medium",children:[" ₪",m==null?void 0:m.priceExcludingVAT," (₪",((m==null?void 0:m.priceIncludingVAT)-(m==null?void 0:m.priceExcludingVAT)).toFixed(2),")"]})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("p",{className:"text-base font-semibold text-green-400",children:"מחיר מומלץ לצרכן!!"}),e.jsxs("p",{className:"text-xl font-semibold text-green-400",children:["₪",m==null?void 0:m.suggestedPriceIncludingVAT]}),e.jsx("p",{className:"text-sm",children:'מחיר ללא מע"מ:'}),e.jsxs("p",{className:"text-base font-medium",children:[" ₪",m==null?void 0:m.suggestedPriceExcludingVAT," (₪",((m==null?void 0:m.suggestedPriceIncludingVAT)-(m==null?void 0:m.suggestedPriceExcludingVAT)).toFixed(2),")"]})]})]}),e.jsx(Z,{className:"my-5"}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("p",{className:"text-xl font-semibold",children:"סך הכל פודקוסט:"}),e.jsxs("p",{className:"text-base font-medium",children:[" ₪",m==null?void 0:m.totalCostWithoutLabor]})]}),e.jsx(Z,{className:"my-5"}),e.jsxs("div",{className:"flex flex-row items-center justify-evenly",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("p",{className:"text-xl font-semibold",children:["רווח גולמי"," - ₪",m==null?void 0:m.grossProfitInput]}),e.jsx("p",{className:"text-sm",children:"(ממחיר לצרכן)"}),e.jsx(Wt,{percent:m==null?void 0:m.profitMarginInput,className:"mt-3",type:"circle"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("p",{className:"text-xl font-semibold",children:["רווח גולמי"," - ₪",m==null?void 0:m.grossProfitSuggested]}),e.jsx("p",{className:"text-sm",children:"(ממחיר מומלץ לצרכן)"}),e.jsx(Wt,{percent:m==null?void 0:m.profitMarginSuggested,className:"mt-3",type:"circle"})]})]})]})}),N=({type:m,size:$,ingredients:I,mixes:P})=>{const[q,A]=d.useState("ingredients"),S=()=>{var p;const c=(p=$==null?void 0:$.ingredients)==null?void 0:p.map(y=>{var l;const C=(()=>{switch(y==null?void 0:y.unit){case"weight":return'ק"ג';case"volume":return"ליטר";case"units":return"יחידות";default:return""}})();return{name:((l=I==null?void 0:I.find(b=>(b==null?void 0:b._id)===(y==null?void 0:y.ingredientId)))==null?void 0:l.name)||"לא ידוע",quantity:y==null?void 0:y.quantity,unitDisplay:C,cost:y==null?void 0:y.costForQuantity}});return e.jsx(xe,{dataSource:c,style:{paddingLeft:"20px",margin:"0",maxHeight:g?"25vh":"22vh",overflow:"auto"},renderItem:(y,C)=>e.jsx(xe.Item,{style:{marginBottom:"4px"},children:e.jsxs(zt,{children:[y.name," - ",y.quantity," ",y.unitDisplay," - ₪",y.cost]})},C)})},f=()=>{var p;const c=(p=$==null?void 0:$.mixes)==null?void 0:p.map(y=>{var l;const C=(()=>{switch(y.unit){case"weight":return'ק"ג';case"volume":return"ליטר";case"units":return"יחידות";default:return""}})();return{name:((l=P==null?void 0:P.find(b=>(b==null?void 0:b._id)===(y==null?void 0:y.mixId)))==null?void 0:l.name)||"לא ידוע",quantity:y.quantity,unitDisplay:C,cost:y==null?void 0:y.costForQuantity}});return e.jsx(xe,{dataSource:c,style:{paddingLeft:"20px",margin:"0",maxHeight:g?"25vh":"22vh",overflow:"auto"},renderItem:(y,C)=>e.jsx(xe.Item,{style:{marginBottom:"4px"},children:e.jsxs(zt,{children:[y.name," - ",y.quantity," ",y.unitDisplay," - ₪",y.cost]})},C)})};return e.jsx(e.Fragment,{children:m!=="P"&&e.jsxs(e.Fragment,{children:[e.jsx(Z,{style:{margin:"5px 0"}}),e.jsxs(U,{style:{gap:"1.5vw",height:g?"30vh":"12vw"},children:[e.jsx(Q,{align:"center",justify:"center",children:e.jsx(rn,{vertical:!0,options:[{label:e.jsxs("div",{style:{padding:4},children:[e.jsx(L,{icon:Qe}),e.jsx("div",{children:"מרכיבים"})]}),value:"ingredients"},{label:e.jsxs("div",{style:{padding:4},children:[e.jsx(L,{icon:Et}),e.jsx("div",{children:"מתכונים"})]}),value:"mixes"}],onChange:c=>A(c),style:{marginBottom:"12px",direction:""}})}),e.jsx(Q,{flex:1,children:e.jsx(ue,{style:{width:"100%",backgroundColor:"#f9f9f9",border:"1px solid #d9d9d9",borderRadius:"8px",marginTop:"10px",paddingTop:"10px"},children:q==="ingredients"?S():f()})})]})]})})};return e.jsxs("div",{children:[e.jsx(Q,{flex:1,style:{padding:"0em 1em"},justify:"space-between",align:"middle",children:e.jsxs(J,{className:"width-100",style:{display:"flex",flexDirection:"column",gap:"0.3em"},children:[e.jsx(Q,{flex:1,style:{marginBottom:"8px"},children:e.jsxs(U,{className:"width-100",align:"middle",justify:"space-between",children:[e.jsx(z.Text,{strong:!0,style:{fontSize:"1.6em"},children:t==null?void 0:t.label}),e.jsxs(Q,{children:[n&&e.jsx(T,{type:"text",icon:e.jsx(Mt,{}),onClick:()=>n(r)}),x&&e.jsx(T,{type:"text",danger:!0,icon:e.jsx(_e,{}),onClick:()=>x(r)}),i==="P"&&e.jsx(T,{type:"text",size:"large",icon:e.jsx(us,{}),onClick:()=>s(r)})]})]})}),e.jsx(Q,{flex:1,align:"start",style:{gap:"12px",marginBottom:"8px",flexDirection:"column"},children:e.jsxs(U,{align:"middle",justify:"space-between",style:{width:"100%",gap:"8px"},children:[e.jsxs(U,{align:"middle",style:{gap:"8px"},children:[e.jsx(vt,{style:{fontSize:"1.5em",color:"#7f8c8d"}}),e.jsxs(z.Text,{style:{fontSize:"1.4em",display:"flex",alignItems:"center",gap:"4px"},children:["₪",t==null?void 0:t.price]})]}),e.jsxs(U,{align:"middle",style:{gap:"8px"},children:[e.jsx(cs,{style:{fontSize:"1.5em",color:"#7f8c8d"}}),e.jsxs(z.Text,{style:{fontSize:"1.4em",display:"flex",alignItems:"center",gap:"4px"},children:[t==null?void 0:t.preparationTime," דקות"]})]})]})}),w(t)]})}),e.jsx(N,{ingredients:h,mixes:u,size:t,type:i})]},t.idNew||r)}Ie.locale("he");const Ar=xs("employeeHours/buildMonthData",async({selectedDate:t,employees:r,employeeHours:s},{dispatch:i})=>{const n=Ie(t,"YYYY-MM").daysInMonth(),x=Array.from({length:n},(h,u)=>{const g=Ie(t,"YYYY-MM").date(u+1),w=g.format("dddd"),N=w==="שישי"||w==="שבת",m=r.map(P=>{const q=s.find(S=>{var f;return((f=S==null?void 0:S.employeeId)==null?void 0:f._id)===(P==null?void 0:P._id)&&Ie(S==null?void 0:S.date).isSame(g,"day")});if(!q)return null;const A=!q.startTime||!q.endTime;return{hoursId:q._id,employeeId:P._id,name:P.name,hourlyRate:P.hourlyRate,hoursWorked:q.hoursWorked,hours:{start:q.startTime,end:q.endTime},hasError:A}}).filter(Boolean),$=m.reduce((P,q)=>P+q.hoursWorked,0),I=m.length;return{date:g.format("YYYY-MM-DD"),dayOfWeek:w,status:N&&w==="שישי"?"חצי יום":"יום מלא",isPast:g.isBefore(Ie(),"day"),isToday:g.isSame(Ie(),"day"),employees:m,totalHours:$,employeesCount:I}});i(Rr(x))}),Fs=Ne({name:"employeeHours",initialState:{data:[],selectedDate:Ie().startOf("month").format("YYYY-MM")},reducers:{setEmployeeHoursState:(t,r)=>{t.data=r.payload},setSelectedDate:(t,r)=>{t.selectedDate=r.payload},addOrUpdateEmployeeHoursState:(t,r)=>{const s=r.payload,i=t.data.findIndex(n=>n._id===s._id);i!==-1?t.data[i]=s:t.data.unshift(s)},updateEmployeeHoursState:(t,r)=>{const s=r.payload;t.data=t.data.map(i=>i._id===s._id?s:i)},deleteEmployeeHoursState:(t,r)=>{const s=r.payload._id;t.data=t.data.filter(i=>i._id!==s)}}}),{setEmployeeHoursState:Rr,addOrUpdateEmployeeHoursState:qr,updateEmployeeHoursState:Dr,deleteEmployeeHoursState:Lr,setSelectedDate:Or}=Fs.actions,Ur=Fs.reducer,Ps=Ne({name:"products",initialState:[],reducers:{setProductsState:(t,r)=>{const{products:s,ingredientsState:i,mixesState:n,averageHourlyRate:x}=r.payload;return s},addOrUpdateProductState:(t,r)=>{const{newProduct:s,ingredientsState:i,mixesState:n,averageHourlyRate:x}=r.payload,h=s,u=t.findIndex(g=>g._id===s._id);u!==-1?t[u]=h:t.unshift(h)},updateProductState:(t,r)=>{const{updatedProduct:s,ingredientsState:i,mixesState:n,averageHourlyRate:x}=r.payload,h=s;return t.map(u=>u._id===s._id?h:u)},deleteProductState:(t,r)=>{const s=r.payload._id;return t.filter(i=>i._id!==s)}}}),{setProductsState:_s,addOrUpdateProductState:bt,updateProductState:Mo,deleteProductState:Hr}=Ps.actions,Br=Ps.reducer,Wr=d.forwardRef(({size:t,indexSize:r,getProductById:s,sizes:i,onChange:n,onDelete:x,newSizeId:h,setSelectedUpdateSize:u,setNewSizeId:g,transformValueToForm:w,setActiveTabKey:N,ingredients:m,mixes:$,activeSubTab:I,setActiveSubTab:P,onSubmit:q},A)=>{const[S]=M.useForm(),f=Ye();d.useImperativeHandle(A,()=>({setFieldsValue:a=>S.setFieldsValue(a),getFieldsValue:()=>S.getFieldsValue(),resetFields:()=>S.resetFields()}));const c=()=>{const a=[...i];a[r]={...a[r],edit:!1,ingredients:t.ingredients.filter(l=>l==null?void 0:l._id),mixes:t.mixes.filter(l=>l==null?void 0:l._id)},n(a)},p=a=>{const l=[...i];l[a]={...l[a],edit:!0},n(l),u(a)},y=a=>{const l=i[a];if(l!=null&&l._id)fe.confirm({title:"האם אתה בטוח שברצונך למחוק את הגודל הזה?",content:`המחיקה תסיר לצמיתות את ${l.label}.`,okText:"מחק",okType:"danger",cancelText:"ביטול",onOk:()=>{x(l==null?void 0:l.productId,l._id).then(()=>{const b=[...i];b.splice(a,1),n(b),S.setFieldsValue({...b[a]}),N(Math.max(0,a-1).toString()||"0"),s(l==null?void 0:l.productId).then(F=>{f(bt({newProduct:F}))})}).catch(b=>{console.error("Error deleting size:",b)})}});else{const b=[...i];b.splice(a,1),n(b),S.setFieldsValue({...t}),N(Math.max(0,a-1).toString()||"0"),g(null)}},C=a=>{switch(a){case"weight":return'ק"ג';case"volume":return"ליטר";case"units":return"יחידות";default:return""}};return d.useEffect(()=>{console.log(S.getFieldsValue()),console.log(t)},[S,t]),!(t!=null&&t._id)||t!=null&&t.edit?e.jsx(M,{form:S,initialValues:{...t},children:e.jsx(Mr,{handleCancelEdit:c,handleRemoveSize:y,newSizeId:h,size:t,indexSize:r,onChange:n,form:S,ingredients:m,mixes:$,setNewSizeId:g,setActiveSubTab:P,activeSubTab:I,sizes:i,getUnitDisplay:C,onSubmit:q})}):e.jsx(ks,{handleEditSize:p,handleRemoveSize:y,index:r,size:t,ingredients:m,mixes:$})}),{TabPane:Qr}=Se,Kt=d.forwardRef(({value:t=[],onChange:r,getProductById:s,setSelectedUpdateSize:i,ingredients:n,activeTabKey:x,setActiveTabKey:h,mixes:u,onSubmit:g,onDelete:w},N)=>{const[m,$]=d.useState(null),[I,P]=d.useState("1"),q=d.useRef([]),A=f=>({value:f}),S=()=>{var p;const f={idNew:Date.now(),label:`גודל ${t.length+1}`,price:null,preparationTime:null,ingredients:[],mixes:[],edit:!0};(t==null?void 0:t.length)>0&&(f.mixes=t[t.length-1].mixes,f.ingredients=t[t.length-1].ingredients);const c=[...t,f];r(c),(p=q.current[+x])==null||p.setFieldsValue({...f}),$(f.idNew),h(t.length.toString()||"0"),P("1")};return d.useEffect(()=>()=>{P("1")},[]),e.jsxs(Q,{style:{flexDirection:"column"},children:[e.jsx(T,{type:"default",icon:e.jsx(At,{}),onClick:S,children:"הוסף גודל"}),e.jsx(Se,{activeKey:x,onChange:f=>h(f||"0"),tabBarStyle:{direction:"rtl"},style:{margin:"1vw 0"},type:"card",tabPosition:"top",children:t==null?void 0:t.map((f,c)=>e.jsx(Qr,{tab:(f==null?void 0:f.label)||`גודל ${c+1}`,children:e.jsx(Wr,{ref:p=>q.current[c]=p,size:f,indexSize:c,setSelectedUpdateSize:i,sizes:t,onChange:r,onDelete:w,getProductById:s,ingredients:n,transformValueToForm:A,setActiveTabKey:h,setActiveSubTab:P,activeSubTab:I,mixes:u,onSubmit:g,newSizeId:m,setNewSizeId:$})},c.toString()))})]})}),{TabPane:es}=Se,ts=d.forwardRef(({value:t=[],sizes:r,onChange:s,ingredients:i,onSubmit:n,onDelete:x},h)=>{const[u,g]=d.useState(null),[w,N]=d.useState("0"),[m]=M.useForm(),$=()=>({value:t}),I=()=>{const S={idNew:Date.now(),label:`וריאציה - ${t.length+1}`,sizeAdjustments:[...r==null?void 0:r.map(c=>({sizeId:c==null?void 0:c._id,label:c==null?void 0:c.label,priceAdjustment:null,preparationTimeAdjustment:null,ingredients:c==null?void 0:c.ingredients,mixes:c==null?void 0:c.mixes,add:[],remove:[],update:[]}))]},f=[...t,S];s(f),m.setFieldsValue({variations:f}),g(S.idNew),N(t.length.toString())},P=S=>{const f=t[S];if(f!=null&&f._id)fe.confirm({title:"האם אתה בטוח שברצונך למחוק את הוריאציה הזו?",content:`המחיקה תסיר לצמיתות את ${f.label}.`,okText:"מחק",okType:"danger",cancelText:"ביטול",onOk:()=>{x(f==null?void 0:f.productId,f._id).then(()=>{const c=[...t];c.splice(S,1),s(c),m.setFieldsValue({sizes:c}),N(Math.max(0,S-1).toString())}).catch(c=>{console.error("Error deleting vatiation:",c)})}});else{const c=[...t];c.splice(S,1),s(c),m.setFieldsValue($()),N(Math.max(0,S-1).toString()),g(null)}},q=S=>{const f=[...t];f[S]={...f[S],edit:!0},s(f)},A=S=>{switch(S){case"weight":return'ק"ג';case"volume":return"ליטר";case"units":return"יחידות";default:return""}};return e.jsxs(M,{form:m,initialValues:{variations:t},onFinish:(S,f)=>{var c;n({variations:(c=S==null?void 0:S.variations)==null?void 0:c.filter(p=>p)})},children:[!r.length&&e.jsx(an,{message:"לא ניתן להוסיף וריאציות",description:"יש להוסיף לפחות גודל אחד לפני שניתן להוסיף וריאציות.",type:"warning",showIcon:!0,style:{marginBottom:"16px"}}),e.jsx(T,{type:"default",icon:e.jsx(At,{}),disabled:(r==null?void 0:r.length)===0||!r,onClick:I,children:"הוסף וריאציה"}),e.jsx(M.List,{name:["variations","sizeAdjustments"],children:(S,{add:f,remove:c})=>{Se,S.map(({key:p,name:y,fieldKey:C})=>{var l;const a=m.getFieldValue(["variations","sizeAdjustments",p]);return e.jsx(es,{tab:(a==null?void 0:a.label)||`גודל ${p+1}`,children:!(a!=null&&a._id)||a!=null&&a.edit?e.jsxs("div",{className:a.idNew===u?"highlight-new":"",style:{border:`1px ${a!=null&&a.idNew?"dashed":"solid #e6e6e6"}`,borderRadius:"8px",padding:"16px",background:"#fafafa",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},children:[e.jsxs(U,{justify:"space-between",align:"middle",style:{marginBottom:"12px"},children:[e.jsx(M.Item,{name:["variations","sizeAdjustments",p,"_id"],hidden:!0,children:e.jsx(me,{})}),e.jsx(M.Item,{name:["variations","sizeAdjustments",p,"label"],label:"שם הוריאציה",rules:[{required:!0,message:"חייב למלא שם גודל"}],children:e.jsx(me,{placeholder:"שם הוריאציה",size:"middle",style:{width:"auto",minWidth:"200px"}})}),e.jsx(T,{type:"text",style:{alignSelf:"flex-start"},danger:!0,icon:e.jsx(_e,{}),title:"מחק וריאציה",onClick:()=>P(p),children:"מחק וריאציה"})]}),e.jsx(M.List,{name:["variations","sizeAdjustments",p],children:(b,{add:F,remove:R})=>e.jsx(Se,{tabBarStyle:{direction:"rtl"},style:{margin:"1vw 0"},type:"card",tabPosition:"top",children:b.map(({key:_,name:v,fieldKey:W})=>{const B=m.getFieldValue(["variations",index,"sizeAdjustments",v]);return e.jsxs(es,{tab:(B==null?void 0:B.label)||`Size ${v}`,children:[e.jsxs(U,{gutter:[16,16],children:[e.jsx(J,{span:12,children:e.jsx(M.Item,{name:["variations",index,"price"],label:"תוספת מחיר",rules:[{required:!1,message:"יש למלא מחיר"},{type:"number",min:0,message:"המחיר חייב להיות חיובי"}],children:e.jsx(oe,{placeholder:"מחיר",style:{width:"100%"}})})}),e.jsx(J,{span:12,children:e.jsx(M.Item,{label:"תוספת זמן הכנה (דקות)",name:["sizes",index,"preparationTime"],rules:[{required:!1,message:"חייב לציין זמן הכנה"}],children:e.jsx(oe,{placeholder:"זמן הכנה",style:{width:"100%"}})})})]}),e.jsx(z.Text,{strong:!0,style:{display:"block",marginBottom:"8px"},children:"מרכיבים:"}),e.jsx(M.List,{name:["sizes",index,"ingredients"],children:(V,{add:re,remove:ae})=>e.jsxs(e.Fragment,{children:[e.jsx(T,{type:"dashed",style:{marginBottom:"0.5vw"},onClick:()=>re({ingredientId:null,quantity:null,unit:null}),children:"הוסף מרכיב"}),e.jsx("div",{style:{maxHeight:"12vw",overflowY:"auto",overflowX:"hidden"},children:V.map(({key:ce,name:te,fieldKey:k})=>e.jsxs(U,{gutter:16,children:[e.jsx(J,{span:10,children:e.jsx(M.Item,{name:[te,"ingredientId"],fieldKey:[k,"ingredientId"],rules:[{required:!0,message:"בחר רכיב"}],children:e.jsx(de,{placeholder:"בחר מרכיב",showSearch:!0,filterOption:(o,j)=>{var E;return(E=j==null?void 0:j.label)==null?void 0:E.toLowerCase().includes(o.toLowerCase())},options:i.map(o=>({value:o._id,label:o.name,unit:o==null?void 0:o.unit}))})})}),e.jsx(J,{span:10,children:e.jsx(M.Item,{name:[te,"quantity"],fieldKey:[k,"quantity"],rules:[{required:!0,message:"הזן כמות"}],children:e.jsx(oe,{placeholder:"כמות",addonAfter:A(m.getFieldValue(["sizes",index,"ingredients",te,"unit"])||"")})})}),e.jsx(J,{span:4,children:e.jsx(T,{type:"text",danger:!0,icon:e.jsx($t,{}),onClick:()=>ae(te)})})]},ce))})]})})]},_)})})}),e.jsx(Z,{style:{margin:"12px 0"}})]},a.idNew||p):e.jsxs("div",{style:{border:"1px solid #e6e6e6",borderRadius:"8px",padding:"16px",background:"#fafafa",boxShadow:"0 1px 2px rgba(0,0,0,0.05)",marginBottom:"16px"},children:[e.jsx(Q,{flex:1,style:{padding:"0em 1em"},justify:"space-between",align:"middle",children:e.jsxs(J,{className:"width-100",children:[e.jsx(Q,{flex:1,style:{marginBottom:"8px"},children:e.jsxs(U,{className:"width-100",align:"middle",justify:"space-between",children:[e.jsx(z.Text,{strong:!0,style:{fontSize:"1.2em"},children:size==null?void 0:size.label}),e.jsxs(Q,{children:[e.jsx(T,{type:"text",icon:e.jsx(Mt,{}),onClick:()=>q(index)}),e.jsx(T,{type:"text",danger:!0,icon:e.jsx(_e,{}),onClick:()=>P(index)})]})]})}),e.jsxs(Q,{flex:1,align:"middle",style:{gap:"12px",marginBottom:"8px"},children:[e.jsxs(U,{align:"middle",style:{gap:"8px"},children:[e.jsxs(z.Text,{style:{color:"#007acc",fontSize:"1.1em",fontWeight:"bold",display:"flex",alignItems:"center",gap:"4px"},children:["₪",size==null?void 0:size.price]}),e.jsx(L,{style:{fontSize:"0.9em",color:"#007acc"},icon:hn})]}),e.jsxs(U,{align:"middle",style:{gap:"8px"},children:[e.jsxs(z.Text,{style:{fontSize:"1.1em",fontWeight:"bold",display:"flex",alignItems:"center",gap:"4px"},children:[size==null?void 0:size.preparationTime," דקות"]}),e.jsx(L,{style:{fontSize:"0.9em"},icon:Tt})]})]})]})}),e.jsx(Z,{style:{margin:"12px 0"}}),e.jsx(z.Text,{strong:!0,style:{display:"block",marginBottom:"8px"},children:"מרכיבים:"}),e.jsx("ul",{style:{paddingLeft:"20px",margin:"0"},children:(l=size==null?void 0:size.ingredients)==null?void 0:l.map((b,F)=>{var _;const R=(()=>{switch(b.unit){case"weight":return'ק"ג';case"volume":return"ליטר";case"units":return"יחידות";default:return""}})();return e.jsx("li",{style:{marginBottom:"4px"},children:e.jsxs(z.Text,{children:[(_=i==null?void 0:i.find(v=>(v==null?void 0:v._id)===(b==null?void 0:b.ingredientId)))==null?void 0:_.name," -"," ",b.quantity," ",R]})},F)})})]},size.idNew||index)},p)})}}),e.jsx(T,{type:"primary",htmlType:"submit",disabled:t.length===0,onClick:()=>g(null),children:"שמור"})]})}),{Title:Ao,Text:ss}=z,{TabPane:Yr}=Se,Jr=({})=>{var _;const{isModalVisible:t,setIsModalVisible:r,modalMode:s,setModalMode:i,selectedItem:n,setSelectedItem:x,selectedUpdateSize:h,setSelectedUpdateSize:u,getProductById:g,addProduct:w,updateProduct:N,deleteProduct:m,addSize:$,updateSize:I,deleteSize:P}=Is(),q=Te({query:"(max-width: 500px)"}),A=X(v=>v.categories),S=(_=X(v=>v.ingredients))==null?void 0:_.filter(v=>v==null?void 0:v.is_active),f=X(v=>v.mixes),c=X(v=>v.products),[p,y]=d.useState("0"),C=d.useCallback(()=>{if(!n||!c)return;const v=c.find(W=>W._id===n._id);v&&x({...v})},[n,c]);d.useEffect(()=>{C()},[c]);const[a]=M.useForm(),l=(v,W,B)=>{if(v==="product")switch(W){case"add":return"הוספת מוצר";case"edit":return"עדכון מוצר";case"view":return"צפייה במוצר";default:return"הוספת מוצר"}else switch(v){case"size":return`ניהול גדלים - ${B==null?void 0:B.name}`;case"variation":return`ניהול וריאציות - ${B==null?void 0:B.name}`}};d.useEffect(()=>{n?a.setFieldsValue(n):a.resetFields()},[n]);const b=(v,W)=>{var B,V,re,ae;switch(t){case"product":const ce=a.getFieldsValue();s==="edit"?N({...ce,_id:n==null?void 0:n._id}).then(()=>{r(!1),x(null)}).catch(o=>{console.error("שגיאה בעריכת מוצר:",o)}):w(ce).then(()=>{r(!1),x(null)}).catch(o=>{console.error("שגיאה בהוספת מוצר:",o)});break;case"size":const te={...n==null?void 0:n.sizes[W],...v},k={productId:n==null?void 0:n._id,label:te.label,price:te.price,preparationTime:te.preparationTime,ingredients:((V=(B=te.ingredients)==null?void 0:B.filter(o=>o))==null?void 0:V.map(o=>{var j;return{ingredientId:((j=o.ingredientId)==null?void 0:j._id)||o.ingredientId,quantity:o.quantity,unit:o.unit}}))||[],mixes:((ae=(re=te.mixes)==null?void 0:re.filter(o=>o))==null?void 0:ae.map(o=>({mixId:o.mixId,quantity:o.quantity,unit:o.unit})))||[],_id:te._id};new Promise((o,j)=>k._id?I(k._id,k):$(n==null?void 0:n._id,k)).then(()=>{}).catch(o=>{console.error("Error managing sizes:",o)});break}},F=()=>{switch(t){case"product":return e.jsxs(M,{form:a,layout:"vertical",onFinish:b,children:[e.jsx(M.Item,{name:"name",label:"שם מוצר",rules:[{required:!0,message:"אנא הזן שם מוצר"},{max:25,message:"שם המוצר לא יכול להיות יותר מ-25 תווים"}],children:e.jsx(me,{maxLength:25,showCount:!0})}),e.jsx(M.Item,{name:"category",label:"קטגוריה",rules:[{required:!0,message:"אנא בחר קטגוריה"}],children:e.jsx(de,{showSearch:!0,placeholder:"בחר קטגוריה",optionFilterProp:"children",filterOption:(v,W)=>W.children.toLowerCase().indexOf(v.toLowerCase())>=0,children:A.map(v=>e.jsx(de.Option,{value:v._id,children:v==null?void 0:v.name},v._id))})}),e.jsx(M.Item,{name:"isFeatured",label:"פעיל",children:e.jsx(ft,{checkedChildren:"פעיל",unCheckedChildren:"לא פעיל"})}),e.jsx(M.Item,{name:"isOnSale",label:"מוצר מכירה",children:e.jsx(ft,{checkedChildren:"פעיל",unCheckedChildren:"לא פעיל"})}),e.jsx(M.Item,{name:"notes",label:"הערות",rules:[{required:!1,message:"אנא הזן הערות"},{max:250,message:"ההערות לא יכולות להיות יותר מ-250 תווים"}],children:e.jsx(me.TextArea,{rows:4,maxLength:250,showCount:!0})}),e.jsx(M.Item,{children:e.jsx(T,{type:"primary",htmlType:"submit",children:"שמור מוצר"})})]});case"size":return e.jsx(Kt,{value:n==null?void 0:n.sizes,setValue:x,ingredients:S,setSelectedUpdateSize:u,getProductById:g,mixes:f,onDelete:P,activeTabKey:p,setActiveTabKey:y,onSubmit:b,onChange:v=>x({...n,sizes:v})});case"variation":return e.jsx(ts,{value:n==null?void 0:n.variations,form:formVariation,setValue:x,sizes:n==null?void 0:n.sizes,ingredients:S,onChange:v=>x({...n,variations:v})});default:return null}},R=()=>{var v,W,B;switch(t){case"product":return e.jsxs("div",{styles:{body:{display:"flex",flexDirection:"column"}},children:[e.jsxs(Q,{style:{gap:"1em",flexDirection:"column",margin:"1em 0em"},children:[e.jsx(ss,{strong:!0,style:{fontSize:"1.5em"},children:n==null?void 0:n.name}),e.jsx(Pe,{style:{width:"fit-content"},children:(v=A==null?void 0:A.find(V=>V._id===(n==null?void 0:n.category)))==null?void 0:v.name}),e.jsxs(Q,{style:{gap:"0.5em",flexDirection:"column"},children:[e.jsx(Ke,{status:n!=null&&n.isFeatured?"success":"default",text:n!=null&&n.isFeatured?"פעיל":"לא פעיל"}),e.jsx(Ke,{status:n!=null&&n.isOnSale?"processing":"default",text:n!=null&&n.isOnSale?"במבצע":"לא במבצע"})]})]}),((W=n==null?void 0:n.notes)==null?void 0:W.length)>0&&e.jsxs("div",{style:{marginBottom:"12px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(Q,{flex:1,children:e.jsxs(ss,{strong:!0,children:["הערות",":"]})}),e.jsx(Q,{flex:1,children:e.jsx("p",{style:{},children:n==null?void 0:n.notes})})]}),e.jsx(Q,{flex:1,children:e.jsx(Se,{style:{width:"100%"},type:"card",children:(B=n==null?void 0:n.sizes)==null?void 0:B.map((V,re)=>e.jsx(Yr,{tab:V.label,children:e.jsx(ks,{handleEditSize:!1,handleRemoveSize:!1,index:re,size:V,type:"P",sizeInfo:ae=>{r("size"),y((ae==null?void 0:ae.toString())||"0")},ingredients:S,mixes:f,priceExcludingVAT:(n==null?void 0:n.priceExcludingVAT)&&(n==null?void 0:n.priceExcludingVAT[re].priceExcludingVAT),sizeSummary:(n==null?void 0:n.sizeSummary)&&(n==null?void 0:n.sizeSummary[re])})},re))})})]});case"size":return e.jsx(Kt,{value:n==null?void 0:n.sizes,setValue:x,ingredients:S,setSelectedUpdateSize:u,getProductById:g,mixes:f,onDelete:P,activeTabKey:p,setActiveTabKey:y,onSubmit:b,onChange:V=>x({...n,sizes:V})});case"variation":return e.jsx(ts,{value:n==null?void 0:n.variations,mode:"view",ingredients:S,onChange:V=>x({...n,variations:V})});default:return null}};return e.jsx(fe,{style:{top:"3em"},title:l(t,s,n),open:t,onCancel:()=>{r(!1),x()},footer:null,destroyOnClose:!0,height:q?"86vh":"80vh",width:q?"100%":700,styles:{body:{height:"100%"}},children:s==="view"?R():F()})},Vr=({categories:t,isMobile:r,selectedCategory:s,setSelectedCategory:i,setIsCategoryModalVisible:n})=>{const x=d.useRef(null),h=d.useRef({}),u=()=>{x.current.scrollBy({left:200,behavior:"smooth"})},g=()=>{x.current.scrollBy({left:-200,behavior:"smooth"})},w=N=>{i(N),h.current[N]&&h.current[N].scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})};return e.jsx("div",{style:{padding:"16px",backgroundColor:"#f0f2f5"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(T,{icon:e.jsx(bn,{}),onClick:u}),e.jsxs("div",{ref:x,style:{display:"flex",overflowX:"auto",flexGrow:1,gap:"8px",padding:"8px 0",scrollbarWidth:"none",msOverflowStyle:"none"},children:[e.jsx(T,{type:s==="all"?"primary":"default",onClick:()=>w("all"),children:"הכל"}),t.map(N=>e.jsx(T,{ref:m=>h.current[N._id]=m,type:s===N._id?"primary":"default",onClick:()=>w(N._id),children:N.name},N._id))]}),e.jsx(T,{icon:e.jsx(Cn,{}),onClick:g}),!r&&e.jsx(T,{type:"primary",icon:e.jsx(At,{}),onClick:()=>n(!0)})]})})};function Gr(){var R;const{addProduct:t,updateProduct:r,deleteProduct:s,isModalVisible:i,setIsModalVisible:n,modalMode:x,setModalMode:h,selectedItem:u,setSelectedItem:g}=Is(),w=Te({query:"(max-width: 500px)"});d.useRef(null);const[N,m]=d.useState([]),[$,I]=d.useState([]),[P,q]=d.useState("all"),[A,S]=d.useState(!1),[f,c]=d.useState({}),p=X(_=>_.products),y=X(_=>_.categories),C=(R=X(_=>_.ingredients))==null?void 0:R.filter(_=>_==null?void 0:_.is_active),a=["name","category"],l=["name","category","detailes","sizes","productSummary","actions"],b=[{key:"name",dataIndex:"name",title:"שם",required:!0},{key:"category",dataIndex:"category",title:"קטגוריה"},{key:"profitMargin",dataIndex:"profitMargin",title:"אחוז רווח"}],F=d.useMemo(()=>[{key:"name",dataIndex:"name",title:"שם המוצר",editable:!0,type:"text",rules:[{required:!0,message:"חייב להיות שם מוצר"},{min:2,message:"שם חייב להיות לפחות 2 תווים"}]},{key:"category",dataIndex:"category",title:"קטגוריה",editable:!0,type:"select",render:(_,v)=>{var W;return e.jsx(Pe,{children:(W=y==null?void 0:y.find(B=>B._id===(v==null?void 0:v.category)))==null?void 0:W.name})},options:y.map(_=>({value:_._id,label:_.name})),rules:[{required:!0,message:"יש לבחור קטגוריה"}]},{key:"detailes",dataIndex:"actions",width:100,render:(_,v)=>e.jsxs(U,{style:{gap:"0.5em"},align:"middle",justify:"center",children:[e.jsx(Pe,{className:v!=null&&v.isFeatured?"green":"red",children:v!=null&&v.isFeatured?"פעיל":"לא פעיל"}),e.jsx(Pe,{className:v!=null&&v.isOnSale?"blue":"yellow",children:v!=null&&v.isOnSale?"במבצע":"לא במבצע"})]})},{key:"sizes",title:"גדלים",type:"custom",editable:!0,render:(_,v,W="view",B)=>{var V;return(V=v==null?void 0:v.sizes)==null?void 0:V.length}},{key:"variations",title:"ווריאציות",type:"custom",editable:!0,render:(_,v,W="view",B)=>{var V;return(V=v==null?void 0:v.variations)==null?void 0:V.length}},{key:"productSummary",dataIndex:"productSummary",title:"רווח (ממוצע לפי מחיר לצרכן)",width:150,render:(_,v)=>{var W,B;return`${((W=v==null?void 0:v.productSummary)==null?void 0:W.averageProfitMarginInput)||0}% ₪${((B=v==null?void 0:v.productSummary)==null?void 0:B.totalGrossProfitInput)||0}`}},{key:"productSummary",dataIndex:"productSummary",title:"רווח (ממוצע לפי מחיר מומלץ)",width:150,render:(_,v)=>{var W,B;return`${((W=v==null?void 0:v.productSummary)==null?void 0:W.averageProfitMarginSuggested)||0}% ₪${((B=v==null?void 0:v.productSummary)==null?void 0:B.totalGrossProfitSuggested)||0}`}},{key:"actions",dataIndex:"actions",width:200,render:(_,v)=>e.jsx("div",{className:"",style:{display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs(T,{type:"text",onClick:()=>{n("size"),g(v)},children:[e.jsx("p",{children:"גדלים"}),e.jsx(L,{icon:et})]})})}],[y]);return y==null||y.map(_=>({label:_.name,value:_._id})),d.useEffect(()=>{const _=JSON.parse(localStorage.getItem("filtersMenu")||"{}");c(_)},[]),d.useEffect(()=>{if(p){const _=P&&P!=="all"?p.filter(v=>v.category===P):p;m(_),I(_)}},[p,P]),e.jsxs("div",{style:{display:"flex",flexDirection:"column",maxWidth:"100%",height:"100%",width:"100%",overflow:"hidden","- webkit - overflow - scrolling":"touch"},children:[e.jsx(Vr,{categories:y,isMobile:w,selectedCategory:P,setIsCategoryModalVisible:S,setSelectedCategory:q}),e.jsx(Q,{flex:1,children:e.jsx(rt,{title:"תפריט",type:"P",data:N,mobileKeys:l,dataPrint:$,sortKeys:b,tableKeys:F,newTitle:"הוסף מוצר חדש",searchKeys:a,setDataPrint:I,onAdd:t,onEdit:r,onDelete:s,ingredientsArr:C,Dtitle:"אישור מחיקה",Dcontent:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"האם אתה בטוח שברצונך למחוק את המוצר?"}),e.jsx("p",{children:"שים לב! מחיקת מוצר עשויה להשפיע על מכירות ותערובות קשורות."})]}),iconADD:e.jsx(L,{icon:tt}),floatAction:[e.jsx(jt,{type:"primary",onClick:()=>S(!0),icon:e.jsx(L,{icon:et})})],openModalProduct:(_,v)=>{n("product"),h(_),v&&g(v)}})}),e.jsx(Tr,{isCategoryModalVisible:A,setIsCategoryModalVisible:S}),e.jsx(Jr,{})]})}const it="https://menu-server-c2b952e2c698.herokuapp.com/api",Xr=t=>G.post(`${it}/suppliers`,t),Zr=t=>{const r=encodeURIComponent(t._id);return G.put(`${it}/suppliers/${r}`,t)},zr=t=>G.delete(`${it}/suppliers/${t}`),Kr=()=>G.get(`${it}/suppliers`),Ts=d.createContext(),ea=()=>d.useContext(Ts),ta=({children:t})=>{const[r,s]=d.useState(!1),i=async h=>{s(!0);try{await Xr(h),D.success("הספק נוסף בהצלחה"),s(!1)}catch(u){console.error("Error adding supplier:",u),D.error("שגיאה בהוספת הספק"),s(!1)}},n=async h=>{s(!0);try{await Zr(h),D.success("הספק עודכן בהצלחה"),s(!1)}catch(u){console.error("Error updating supplier:",u),D.error("שגיאה בעדכון הספק"),s(!1)}},x=async h=>{s(!0);try{await zr(h),D.success("הספק נמחק בהצלחה"),s(!1)}catch(u){console.error("Error deleting supplier:",u),D.error("שגיאה במחיקת הספק"),s(!1)}};return e.jsx(Ts.Provider,{value:{addSupplier:i,updateSupplier:n,deleteSupplier:x,loading:r},children:t})};function sa(){const{addSupplier:t,updateSupplier:r,deleteSupplier:s}=ea(),i=X(S=>S.suppliers),n=X(S=>S.ingredients),[x,h]=d.useState([]),[u,g]=d.useState([]),[w,N]=d.useState({}),m=["name"],$=["name","phone","email","contact_name","address",,"second_phone","notes"],I=[{key:"name",dataIndex:"name",title:"שם",required:!0},{key:"usedCount",dataIndex:"usedCount",title:"כמות רכיבים"}],P=[{key:"name",dataIndex:"name",title:"שם הספק",editable:!0,type:"text",width:100,rules:[{required:!0,message:"חייב להיות שם ספק"},{min:3,message:"שם ספק חייב להיות לפחות 3 תווים"}]},{key:"usedCount",dataIndex:"usedCount",title:"כמות רכיבים",editable:!1},{key:"phone",dataIndex:"phone",title:"טלפון",editable:!0,type:"text",width:100,rules:[{required:!0,message:"חייב להיות מספר טלפון"},{pattern:/^[0-9]{9,10}$/,message:"טלפון חייב להיות מספר תקין באורך 9-10 ספרות"}]},{key:"email",dataIndex:"email",title:"אימייל",editable:!0,type:"text",width:100,rules:[{required:!0,message:"חייב להיות אימייל"},{type:"email",message:"אימייל לא תקין"}]},{key:"contact_name",dataIndex:"contact_name",title:"איש קשר",editable:!0,type:"text",width:100,rules:[{required:!0,message:"חייב להיות איש קשר"},{min:3,message:"איש קשר חייב להיות לפחות 3 תווים"}]},{key:"address",dataIndex:"address",title:"כתובת",editable:!0,type:"text",width:150,rules:[{required:!0,message:"חייבת להיות כתובת"},{min:5,message:"כתובת חייבת להיות לפחות 5 תווים"}]},{key:"second_phone",dataIndex:"second_phone",title:"טלפון נוסף",editable:!0,type:"text",width:100,rules:[{pattern:/^[0-9]{9,10}$/,message:"טלפון חייב להיות מספר תקין באורך 9-10 ספרות"}]},{key:"notes",dataIndex:"notes",title:"הערות",editable:!0,type:"textArea",maxLength:120,width:150,rules:[{required:!1},{max:120,message:"מקסימום 120 תווים"}],render:(S,f)=>{const c=(f==null?void 0:f.notes)||"—";return e.jsx(st,{title:c,children:e.jsx("span",{style:{display:"inline-block",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",maxWidth:"150px"},children:c})})}}],q=[{name:"רשימת ספקים",value:"name",type:"select",options:i.map(S=>({label:S.name,value:S.name}))},{name:"סטטוס רכיבים",value:"usedCount",type:"slider",min:0,max:Math.max(...x.map(S=>S.usedCount||0))}];d.useEffect(()=>{if(i){const S=i.map(f=>{const c=n==null?void 0:n.filter(p=>p.supplierId===f._id).length;return{...f,usedCount:c}});h(S),g(S)}},[i,n]),d.useEffect(()=>{const S=JSON.parse(localStorage.getItem("filtersSuppliers")||"{}");N(S)},[]);const A=S=>{N(S),localStorage.setItem("filtersSuppliers",JSON.stringify(S))};return e.jsx(rt,{title:"ספקים",titleView:"ספק",data:x,mobileKeys:$,dataPrint:u,sortKeys:I,tableKeys:P,newTitle:"הוסף ספק חדש",searchKeys:m,setDataPrint:g,onAdd:t,onEdit:r,onDelete:s,Dtitle:"אישור מחיקה",filters:w,saveFilters:A,filtersArr:q,iconADD:e.jsx(L,{icon:nt}),Dcontent:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"האם אתה בטוח שברצונך למחוק את הספק?"}),e.jsx("p",{children:"שים לב! במחיקת ספק אתה תמחוק את כל הרכיבים שלו וכן הם כמובן ימחקו מכל התערובות והמוצרים."})]})})}const lt="https://menu-server-c2b952e2c698.herokuapp.com/api",na=t=>G.post(`${lt}/ingredients`,t),ra=t=>{const r=encodeURIComponent(t._id);return G.put(`${lt}/ingredients/${r}`,t)},aa=t=>G.delete(`${lt}/ingredients/${t}`),ia=()=>G.get(`${lt}/ingredients`),Es=d.createContext(),la=()=>d.useContext(Es),oa=({children:t})=>{const[r,s]=d.useState(!1),i=async h=>{s(!0);try{await na(h),D.success("החומר גלם נוסף בהצלחה"),s(!1)}catch{D.error("שגיאה בהוספת חומר הגלם"),s(!1)}},n=async h=>{s(!0);const u=["unitQuantity","unitDescription","unitPrice","processedPrice"],g=Object.keys(h).filter(w=>!u.includes(w)).reduce((w,N)=>(w[N]=h[N],w),{});try{await ra(g),D.success("החומר גלם עודכן בהצלחה")}catch{D.error("שגיאה בעדכון חומר הגלם")}finally{s(!1)}},x=async h=>{s(!0);try{await aa(h),D.success("החומר גלם נמחק בהצלחה"),s(!1)}catch{D.error("שגיאה במחיקת חומר הגלם"),s(!1)}};return e.jsx(Es.Provider,{value:{addIngredient:i,updateIngredient:n,deleteIngredient:x,loading:r},children:t})},Ge="https://menu-server-c2b952e2c698.herokuapp.com/api",da=()=>G.get(`${Ge}/settings`),ca=t=>G.put(`${Ge}/settings`,{settings:t}),ua=t=>G.post(`${Ge}/settings/categories`,t),xa=(t,r)=>G.put(`${Ge}/settings/categories/${t}`,r),ma=t=>G.delete(`${Ge}/settings/categories/${t}`),$s=Ne({name:"settings",initialState:{settings:null,loading:!1},reducers:{setSettings:(t,r)=>{t.settings=r.payload},updateSettingValue:(t,r)=>{const{key:s,value:i}=r.payload;t.settings&&t.settings[s]&&(t.settings[s].value=i,t.settings[s].lastUpdated=new Date().toISOString())},addCategory:(t,r)=>{const s=r.payload;t.settings&&t.settings.materialCategories&&(t.settings.materialCategories.value.push(s),t.settings.materialCategories.lastUpdated=new Date().toISOString())},updateCategory:(t,r)=>{const s=r.payload;if(t.settings&&t.settings.materialCategories){const i=t.settings.materialCategories.value.findIndex(n=>n._id===s._id);i!==-1&&(t.settings.materialCategories.value[i]=s,t.settings.materialCategories.lastUpdated=new Date().toISOString())}},deleteCategory:(t,r)=>{const s=r.payload;t.settings&&t.settings.materialCategories&&(t.settings.materialCategories.value=t.settings.materialCategories.value.filter(i=>i._id!==s),t.settings.materialCategories.lastUpdated=new Date().toISOString())},setLoading:(t,r)=>{t.loading=r.payload}}}),{setSettings:pa,updateSettingValue:Ro,addCategory:ha,updateCategory:ga,deleteCategory:ja,setLoading:je}=$s.actions,fa=$s.reducer,Ms=d.createContext(),As=()=>d.useContext(Ms),ya=({children:t})=>{const r=Ye(),{settings:s,loading:i}=X(w=>w.settings),n=async()=>{r(je(!0));try{const{data:w}=await da();r(pa(w))}catch(w){console.error("Error fetching settings:",w)}finally{r(je(!1))}},x=async w=>{var N;r(je(!0));try{await ca(w);const[m]=await Promise.all([Cs()]);r(_s({products:(N=m.data)==null?void 0:N.reverse()})),D.success("הגדרות נשמרו בהצלחה"),r(je(!1))}catch{D.error("שגיאה בשמירת ההגדרות"),r(je(!1))}},h=async w=>{r(je(!0));try{const{data:N}=await ua(w);r(ha(N)),D.success("הקטגוריה נוספה בהצלחה")}catch(N){console.error("Error adding category:",N),D.error("שגיאה בהוספת הקטגוריה")}finally{r(je(!1))}},u=async(w,N)=>{r(je(!0));try{await xa(w,N),r(ga(N)),D.success("הקטגוריה עודכנה בהצלחה")}catch(m){console.error("Error updating category:",m),D.error("שגיאה בעדכון הקטגוריה")}finally{r(je(!1))}},g=async w=>{r(je(!0));try{await ma(w),r(ja(w)),D.success("הקטגוריה נמחקה בהצלחה")}catch(N){console.error("Error deleting category:",N),D.error("שגיאה במחיקת הקטגוריה")}finally{r(je(!1))}};return d.useEffect(()=>{n()},[]),e.jsx(Ms.Provider,{value:{settings:s,loading:i,fetchSettings:n,updateSetting:x,addCategoryContext:h,updateCategoryContext:u,deleteCategoryContext:g},children:t})},{Text:va}=z;function wa(){var y;const{settings:t}=As(),r=d.useMemo(()=>{var C,a;return((a=(C=t==null?void 0:t.materialCategories)==null?void 0:C.value)==null?void 0:a.map(l=>({value:l==null?void 0:l._id,label:l==null?void 0:l.name,color:(l==null?void 0:l.color)||"blue"})))||[]},[(y=t==null?void 0:t.materialCategories)==null?void 0:y.value]),s=X(C=>C.suppliers),i=X(C=>C.ingredients),n=X(C=>C.products),x=X(C=>C.mixes),{addIngredient:h,updateIngredient:u,deleteIngredient:g}=la(),[w,N]=d.useState([]),[m,$]=d.useState([]),[I,P]=d.useState({});d.useState(!1);const q=["name","type","supplierId"],A=["unit","unitPrice","supplierId","usedInMixes","usedInProducts"],S=[{key:"name",dataIndex:"name",title:"שם",required:!0},{key:"type",dataIndex:"type",title:"סוג"},{key:"usedCount",dataIndex:"usedCount",title:"בשימוש"},{key:"unit",dataIndex:"unit",title:"יחידת מידה"},{key:"supplierName",dataIndex:"supplierName",title:"שם ספק"}],f=[{key:"SKU",dataIndex:"SKU",title:'מק"ט',editable:!0,type:"number",width:100,group:1,rules:[{validator:async(C,a,l)=>a?typeof a!="number"?Promise.reject('מק"ט חייב להיות מספר תקין'):a.toString().length===0?Promise.reject('מק"ט חייב להיות מינימום תו אחד '):w.some(F=>F.SKU===a&&F._id!==(l==null?void 0:l._id))?Promise.reject('מק"ט זה כבר קיים במערכת'):Promise.resolve():Promise.resolve()}]},{key:"name",dataIndex:"name",title:"שם",required:!0,editable:!0,group:1,type:"text",width:200,minWidth:200,rules:[{required:!0,message:"השדה חובה"},{min:3,message:"השם חייב להיות לפחות 3 תווים"},{pattern:/^[א-תa-zA-Z\s0-9%-]+$/,message:"השם יכול להכיל אותיות בעברית או אנגלית, מספרים והתווים הבאים: ' % ', ' - '"}]},{key:"supplierId",dataIndex:"supplierId",title:"שם ספק",editable:!0,group:1,type:"select",required:!0,width:100,render:(C,a,l)=>{var b;return e.jsxs(U,{align:"middle",style:{gap:5},children:[l==="view"&&e.jsx(L,{icon:nt})," ",(b=s==null?void 0:s.find(F=>(F==null?void 0:F._id)===(a==null?void 0:a.supplierId)))==null?void 0:b.name]})},options:s==null?void 0:s.map(C=>({value:C._id,label:C==null?void 0:C.name})),rules:[{required:!0,message:"יש לבחור ספק"},{validator:(C,a)=>(s==null?void 0:s.some(b=>b._id===a))?Promise.resolve():Promise.reject("ספק לא חוקי נבחר")}]},{key:"usedCount",dataIndex:"usedCount",title:"בשימוש",editable:!1,width:100},{key:"is_active",dataIndex:"is_active",title:"פעיל",editable:!0,group:1,type:"custom",render:(C,a,l,b)=>l==="edit"?e.jsx(e.Fragment,{children:e.jsx(M.Item,{name:"is_active",label:"פעיל",children:e.jsx(ft,{checkedChildren:"פעיל",unCheckedChildren:"לא פעיל"})},"is_active")}):e.jsx(Ke,{status:a!=null&&a.is_active?"success":"error",text:a!=null&&a.is_active?"פעיל":"לא פעיל"}),minWidth:120,width:120},{key:"type",dataIndex:"type",title:"סוג",render:(C,a)=>{const l=r.find(b=>b.value===(a==null?void 0:a.type));return e.jsx(Pe,{color:l==null?void 0:l.color,children:l==null?void 0:l.label})},type:"select",required:!0,editable:!0,group:2,options:r,divider:!0,width:100,rules:[{required:!0,message:"יש לבחור סוג"},{validator:(C,a)=>(r==null?void 0:r.some(b=>b.value===a))?Promise.resolve():Promise.reject("סוג לא חוקי נבחר")}]},{key:"unit",dataIndex:"unit",title:"יחידת מידה",editable:!0,group:2,type:"select",options:Ce,width:100,render:(C,a)=>{var l;return e.jsx("p",{children:((l=Ce.find(b=>b.value===(a==null?void 0:a.unit)))==null?void 0:l.label)||(a==null?void 0:a.unit)})},rules:[{required:!0,message:"יש לבחור יחידת מידה"},{validator:(C,a)=>(Ce==null?void 0:Ce.some(b=>b.value===a))?Promise.resolve():Promise.reject("יחידת מידה לא חוקית")}]},{key:"quantity",dataIndex:"quantity",title:"כמות",editable:!0,group:2,type:"custom",width:100,render:(C,a,l,b)=>{if(l=="edit")return e.jsx(M.Item,{name:"quantity",label:"כמות",rules:[{required:!0,message:"אנא הזן כמות"},{validator:(_,v)=>(b.getFieldValue("subUnit"),v==null?Promise.reject("כמות נדרשת"):v<0?Promise.reject("הכמות לא יכולה להיות שלילית"):(b.getFieldValue("subUnit")==="g"||b.getFieldValue("subUnit")==="ml")&&(v<.001||v>999)?Promise.reject('עבור גרם או מ"ל הכמות חייבת להיות בין 0.001 ל-999'):(b.getFieldValue("subUnit")==="kg"||b.getFieldValue("subUnit")==="liter")&&(v<1||v>1e6)?Promise.reject('עבור ק"ג או ליטר הכמות חייבת להיות מ-1 ומעלה, ובתוך הטווח המותר'):Promise.resolve())}],children:e.jsx(oe,{style:{width:"100%"}})},"quantity");let F=a.unit,R="";return F==="weight"?R=a.quantity>=1?'ק"ג':"גרם":F==="volume"?R=a.quantity>=1?"ליטר":'מ"ל':F==="units"&&(R="יחידות"),e.jsxs("p",{children:[a.quantity<1?a.quantity*1e3:a.quantity," ",R]})}},{key:"price",dataIndex:"price",title:"מחיר כולל מעמ",editable:!0,group:2,type:"price",width:100,show:!1,divider:!0,render:(C,a,l,b)=>{var F;if(l!=="edit")return e.jsxs("p",{children:["₪",(F=a==null?void 0:a.price)==null?void 0:F.toFixed(2)]})}},{key:"priceExcludingVAT",dataIndex:"priceExcludingVAT",width:100,title:"מחיר ללא מעמ",render:(C,a)=>e.jsxs("p",{children:["₪",a==null?void 0:a.priceExcludingVAT]}),editable:!1,hiddenInForm:!0},{key:"unitPrice",dataIndex:"unitPrice",title:"כמות מינימלית",width:100,render:(C,a)=>e.jsxs(J,{children:[e.jsxs(U,{children:[e.jsxs("p",{children:[a.unitQuantity<1?a.unitQuantity*1e3:a.unitQuantity," ",a==null?void 0:a.unitDescription]}),e.jsx("br",{})]}),e.jsxs("p",{children:["₪",a==null?void 0:a.unitPrice]})]})},{key:"juiceRatio",dataIndex:"juiceRatio",title:"יחס עיבוד (תפוקת חומר מעובד)",editable:!0,group:2,width:100,type:"custom",render:(C,a,l,b)=>l=="view"||l!=="edit"?e.jsx("p",{children:a!=null&&a.juiceRatio?`${((a==null?void 0:a.juiceRatio)*100).toFixed(0)}%`:""}):e.jsxs(e.Fragment,{children:[e.jsx(M.Item,{name:"isJuice",valuePropName:"checked",style:{marginBottom:0},children:e.jsx(We,{onChange:F=>{b.setFieldsValue({isJuice:F.target.checked}),F.target.checked||b.setFieldsValue({juiceRatio:void 0})},children:"האם הרכיב דורש עיבוד?"})}),e.jsx(M.Item,{noStyle:!0,shouldUpdate:(F,R)=>F.isJuice!==R.isJuice,children:({getFieldValue:F})=>F("isJuice")&&e.jsx(M.Item,{name:"juiceRatio",label:"יחס המיץ (0.1 עד 0.99)",rules:[{required:!0,message:"אנא הזן יחס מיץ"},{type:"number",min:.1,max:.99,message:"היחס חייב להיות בין 0.1 ל-0.99"}],children:e.jsx(oe,{style:{width:"100%"}})})})]})},{key:"processedPrice",dataIndex:"processedPrice",title:"מחיר לכמות מינימלית מעובדת",width:100,render:(C,a)=>e.jsx("p",{children:a!=null&&a.processedPrice?`₪${a==null?void 0:a.processedPrice}`:""}),editable:!1,hiddenInForm:!0},{key:"notes",dataIndex:"notes",title:"הערות",width:100,editable:!0,group:1,render:(C,a)=>{const l=(a==null?void 0:a.notes)||"—";return e.jsx(st,{title:l,children:e.jsx(va,{style:{display:"inline-block",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",maxWidth:"150px",direction:"rtl"},children:l})})},type:"textArea",maxLength:120,rules:[{required:!1},{max:120,message:"מקסימום 120 תווים"}]}],c=[{name:"סוג",value:"type",options:r},{name:"ספק",value:"supplierId",options:s.map(C=>({label:C.name,value:C._id}))},{name:"סטטוס",value:"is_active",options:[{label:"פעיל",value:!0},{label:"לא פעיל",value:!1}]}];d.useEffect(()=>{if(i)if(s){let C=[...i==null?void 0:i.map(a=>{let l=s==null?void 0:s.find(R=>(R==null?void 0:R._id)===(a==null?void 0:a.supplierId));const b=(n==null?void 0:n.reduce((R,_)=>{var v;return R+((v=_.ingredients)==null?void 0:v.filter(W=>W.ingredientId===a._id).length)},0))||0,F=(x==null?void 0:x.reduce((R,_)=>{var v;return R+((v=_.ingredients)==null?void 0:v.filter(W=>W.ingredientId===a._id).length)},0))||0;return{...a,supplierName:l==null?void 0:l.name,usedCount:b+F}})];N(C),$(C)}else N([...i]),$([...i])},[s,i]),d.useEffect(()=>{const C=JSON.parse(localStorage.getItem("filtersIngredients")||"{}");P(C)},[]);const p=C=>{P(C),localStorage.setItem("filtersIngredients",JSON.stringify(C))};return e.jsx(e.Fragment,{children:e.jsx(rt,{title:"חומרי גלם",titleView:"חומר גלם",type:"ingredient",data:w,groups:!0,mobileKeys:A,dataPrint:m,sortKeys:S,tableKeys:f,newTitle:"הוסף חומר גלם חדש",searchKeys:q,setDataPrint:$,onAdd:h,onEdit:u,onDelete:g,Dtitle:"אישור מחיקה",filters:I,saveFilters:p,filtersArr:c,iconADD:e.jsx(L,{icon:Qe}),Dcontent:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"האם אתה בטוח שברצונך למחוק את הרכיב?"}),e.jsx("p",{children:"שים לב! הרכיב יימחק מכל המוצרים והתערובות בהם הוא נמצא."})]})})})}Fn.register(Pn,_n,Tn,En,$n,Mn);const{Text:ba}=z,Ca=["#4E79A7","#F28E2B","#E15759","#76B7B2","#59A14F"];function Sa(){const t=X(I=>I.categories),r=X(I=>I.products),s=X(I=>I.suppliers),i=X(I=>I.ingredients),n=X(I=>I.mixes),x=X(I=>I.employees),h=Te({query:"(max-width: 500px)"}),u=d.useMemo(()=>{const I=r.reduce((P,q)=>{var S;const A=((S=t.find(f=>f._id===q.category))==null?void 0:S.name)||"לא מוגדר";return P[A]=(P[A]||0)+1,P},{});return{labels:Object.keys(I),datasets:[{data:Object.values(I),backgroundColor:Ca}]}},[r,t]),g=d.useMemo(()=>[...i].sort((I,P)=>(P.unitPrice||0)-(I.unitPrice||0)).slice(0,5).map(I=>({name:I.name,price:I.unitPrice})),[i]),w=d.useMemo(()=>[...n].map(I=>{const P=I.totalCost/I.totalWeight;return{name:I.name,costPerLiter:P}}).sort((I,P)=>(P.costPerLiter||0)-(I.costPerLiter||0)).slice(0,5),[n]),N={labels:g.map(I=>I.name),datasets:[{label:"מחיר ל-100 גרם",data:g.map(I=>I.price),backgroundColor:"#FF8042"}]},m={labels:w.map(I=>I.name),datasets:[{label:"עלות לליטר",data:w.map(I=>I.costPerLiter),backgroundColor:"#8884d8"}]},$=d.useMemo(()=>r.filter(I=>I.profitMargin<=90).slice(0,3).map(I=>({key:I._id,name:I.name,profitMargin:I.profitMargin})),[r]);return e.jsxs("div",{className:"dashboard-container",style:{padding:h?"10px":"20px"},children:[e.jsxs(U,{gutter:[5,5],wrap:!0,children:[e.jsx(J,{xs:12,sm:12,md:10,lg:8,xl:6,children:e.jsx(pe,{to:"/menu",children:e.jsxs(ue,{className:"dashboard-card",children:[e.jsx("div",{className:"icon-circle green",children:e.jsx(L,{icon:tt})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-title",children:"מוצרים"}),e.jsx("div",{className:"stat-value",children:r.length})]})]})})}),e.jsx(J,{xs:12,sm:12,md:10,lg:8,xl:6,children:e.jsx(pe,{to:"/suppliers",children:e.jsxs(ue,{className:"dashboard-card",children:[e.jsx("div",{className:"icon-circle red",children:e.jsx(L,{icon:nt})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-title",children:"ספקים"}),e.jsx("div",{className:"stat-value",children:s.length})]})]})})}),e.jsx(J,{xs:12,sm:12,md:10,lg:8,xl:6,children:e.jsx(pe,{to:"/ingredients",children:e.jsxs(ue,{className:"dashboard-card",children:[e.jsx("div",{className:"icon-circle blue",children:e.jsx(L,{icon:Qe})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-title",children:"חומרי גלם"}),e.jsx("div",{className:"stat-value",children:i.length})]})]})})}),e.jsx(J,{xs:12,sm:12,md:10,lg:8,xl:6,children:e.jsx(pe,{to:"/menu",children:e.jsxs(ue,{className:"dashboard-card",children:[e.jsx("div",{className:"icon-circle yellow",children:e.jsx(L,{icon:et})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-title",children:"קטגוריות"}),e.jsx("div",{className:"stat-value",children:t.length})]})]})})}),e.jsx(J,{xs:12,sm:12,md:10,lg:8,xl:6,children:e.jsx(pe,{to:"/mixes",children:e.jsxs(ue,{className:"dashboard-card",children:[e.jsx("div",{className:"icon-circle purple",children:e.jsx(L,{icon:xt})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-title",children:"תערובות"}),e.jsx("div",{className:"stat-value",children:n.length})]})]})})}),e.jsx(J,{xs:12,sm:12,md:10,lg:8,xl:6,children:e.jsx(pe,{to:"/employees",children:e.jsxs(ue,{className:"dashboard-card",children:[e.jsx("div",{className:"icon-circle aqua",children:e.jsx(L,{icon:xt})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-title",children:"עובדים"}),e.jsx("div",{className:"stat-value",children:x==null?void 0:x.length})]})]})})})]}),e.jsx(Z,{className:"no-margin"}),e.jsxs(U,{gutter:[16,16],children:[e.jsx(J,{xs:24,md:12,children:e.jsx(ue,{className:"dashboard-card",title:e.jsxs("span",{children:[e.jsx(L,{icon:et,style:{marginLeft:"8px"}}),"מוצרים לפי קטגוריה"]}),children:e.jsx(kn,{data:u,options:{responsive:!0,maintainAspectRatio:!1}})})}),e.jsx(J,{xs:24,md:12,children:e.jsx(ue,{className:"dashboard-card",title:e.jsxs("span",{children:[e.jsx(L,{icon:Qe,style:{marginLeft:"8px"}}),"חומרי הגלם היקרים ביותר"]}),children:e.jsx(Jt,{data:N,options:{responsive:!0,maintainAspectRatio:!1}})})})]}),e.jsx(Z,{className:"no-margin"}),e.jsxs(U,{gutter:[16,16],children:[e.jsx(J,{xs:24,md:12,children:e.jsx(ue,{className:"dashboard-card",title:e.jsxs("span",{children:[e.jsx(L,{icon:xt,style:{marginLeft:"8px"}}),"התערובות היקרות ביותר"]}),children:e.jsx(Jt,{data:m,options:{responsive:!0,maintainAspectRatio:!1}})})}),e.jsx(J,{xs:24,md:12,children:e.jsx(ue,{className:"dashboard-card",title:e.jsxs("span",{children:[e.jsx(L,{icon:tt,style:{marginLeft:"8px"}}),"מוצרים עם רווחיות נמוכה"]}),children:e.jsx(U,{gutter:[16,16],children:$.map(I=>e.jsx(J,{xs:24,sm:8,children:e.jsxs(ue,{children:[e.jsx(ze,{title:I.name,value:I.profitMargin,suffix:"%",valueStyle:{color:"#cf1322"}}),e.jsx(ba,{type:"secondary",children:"רווחיות"})]})},I.key))})})})]})]})}const ot="https://menu-server-c2b952e2c698.herokuapp.com/api",Ia=t=>G.post(`${ot}/mixes`,t),Na=t=>{const r=encodeURIComponent(t._id);return G.put(`${ot}/mixes/${r}`,t)},ka=t=>G.delete(`${ot}/mixes/${t}`),Fa=()=>G.get(`${ot}/mixes`),Rs=d.createContext(),Pa=()=>d.useContext(Rs),_a=({children:t})=>{const[r,s]=d.useState(!1),i=async h=>{s(!0);try{await Ia(h),D.success("התערובת נוספה בהצלחה"),s(!1)}catch(u){console.error("Error adding mix:",u),D.error("שגיאה בהוספת התערובת"),s(!1)}},n=async h=>{s(!0);try{await Na(h),D.success("התערובת עודכנה בהצלחה"),s(!1)}catch(u){console.error("Error updating mix:",u),D.error("שגיאה בעדכון התערובת"),s(!1)}},x=async h=>{s(!0);try{await ka(h),D.success("התערובת נמחקה בהצלחה"),s(!1)}catch(u){console.error("Error deleting mix:",u),D.error("שגיאה במחיקת התערובת"),s(!1)}};return e.jsx(Rs.Provider,{value:{addMix:i,updateMix:n,deleteMix:x,loading:r},children:t})};function Ta(){var S;const{addMix:t,updateMix:r,deleteMix:s}=Pa(),[i,n]=d.useState([]),[x,h]=d.useState([]),[u,g]=d.useState({}),w=X(f=>f.mixes),N=(S=X(f=>f.ingredients))==null?void 0:S.filter(f=>f.is_active);X(f=>f.products);const m=X(f=>{var c,p;return(p=(c=f.settings.settings)==null?void 0:c.hourlyRate)==null?void 0:p.value}),$=({ingredients:f})=>{const[p,y]=d.useState(!1),C=f.slice(0,2);return f.slice(2).map((l,b)=>e.jsx("div",{style:{marginBottom:"5px"},children:`${l==null?void 0:l.name} (${l.quantity} ${l.unit}) - ₪${l==null?void 0:l.costForQuantity}`},b)),e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"5px",alignItems:"center"},children:[e.jsx("span",{style:{color:"blue",cursor:"pointer",fontWeight:"bold",marginLeft:"5px"},onClick:()=>y(!0),children:e.jsx(Sn,{style:{fontSize:"16px",color:"#000"}})}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"5px",maxWidth:"400px"},children:C.map((l,b)=>e.jsx("span",{style:{backgroundColor:"#f0f0f0",borderRadius:"8px",padding:"5px 10px",fontSize:"0.7vw"},children:`${l==null?void 0:l.name} (${l.quantity} ${l.unit}) - ₪${l==null?void 0:l.costForQuantity}`},b))}),e.jsx(fe,{title:"רשימת מרכיבים",open:p,onCancel:()=>y(!1),footer:[e.jsx(T,{onClick:()=>y(!1),children:"סגור"},"close")],children:f.map((l,b)=>e.jsx("div",{style:{backgroundColor:"#f0f0f0",borderRadius:"8px",padding:"5px 10px",width:"fit-content",fontSize:"0.7vw",marginBottom:".5vw"},children:`${l==null?void 0:l.name} (${l.quantity} ${l.unit}) - ₪${l==null?void 0:l.costForQuantity}`},b))})]})},I=["name","ingredients"],P=["name","preparationTime","totalCost","totalWeight","usedCount"],q=[{key:"name",dataIndex:"name",title:"שם",required:!0},{key:"preparationTime",dataIndex:"preparationTime",title:"זמן הכנה"},{key:"totalCost",dataIndex:"totalCost",title:"עלות כוללת"},{key:"totalWeight",dataIndex:"totalWeight",title:"משקל כולל"},{key:"usedCount",dataIndex:"usedCount",title:"בשימוש"}],A=[{key:"name",dataIndex:"name",title:"שם התערובת",editable:!0,type:"text",minWidth:100,rules:[{required:!0,message:"חייב להיות שם תערובת"},{min:3,message:"שם חייב להיות לפחות 3 תווים"}]},{key:"usedCount",dataIndex:"usedCount",title:"בשימוש",editable:!1,width:100},{key:"preparationTime",dataIndex:"preparationTime",title:"זמן הכנה (דקות)",editable:!0,minWidth:100,type:"number",rules:[{required:!0,message:"זמן הכנה נדרש"},{type:"number",min:0,message:"זמן הכנה חייב להיות מספר חיובי"}]},{key:"unitCost",dataIndex:"unitCost",title:"עלות ל-100 גרם (₪)",minWidth:100,render:(f,c)=>(c==null?void 0:c.totalWeight)!=null&&(c==null?void 0:c.totalCost)!=null?`₪${((Number(c.totalCost)+Number(c.laborCost||0))/(Number(c.totalWeight)*10)).toFixed(2)} / 100 גרם`:"—",editable:!1},{key:"laborCost",dataIndex:"laborCost",title:"עלות עבודה (₪)",minWidth:100,render:(f,c)=>{var p;return`₪${(p=c==null?void 0:c.laborCost)==null?void 0:p.toFixed(2)} (₪${m})`||"—"},editable:!1},{key:"totalCost",dataIndex:"totalCost",title:"עלות כוללת (₪)",minWidth:100,render:(f,c)=>(c==null?void 0:c.totalCost)!=null&&(c==null?void 0:c.laborCost)!=null?`₪${(Number(c.totalCost)+Number(c.laborCost)).toFixed(2)}`:"—",editable:!1},{key:"totalWeight",dataIndex:"totalWeight",title:'משקל כולל (ק"ג)',minWidth:100,render:(f,c)=>{var p;return((p=c.totalWeight)==null?void 0:p.toFixed(2))||"—"},editable:!1},{key:"ingredients",title:"רכיבים",type:"ingredientsManager",editable:!0,width:500,minWidth:500,column:!0,fields:[{key:"ingredientId",type:"select",title:"רכיב",placeholder:"בחר רכיב",options:N.map(f=>({value:f._id,label:f.name})),required:!0,rules:[{required:!0,message:"יש לבחור רכיב"}]},{key:"quantity",type:"number",title:"כמות",placeholder:"הזן כמות",required:!0,rules:[{required:!0,message:"יש להזין כמות"},{type:"number",min:0,message:"כמות חייבת להיות חיובית"}]},{key:"unit",type:"text",title:"יחידה",readonly:!0},{key:"weightOrVolumePerUnit",type:"number",title:"נפח/משקל ליחידה (אם רלוונטי)",placeholder:"הזן נפח ליחידה",required:!1,visible:f=>f.unit==="units",rules:[{type:"number",min:0,message:"ערך חייב להיות חיובי"}]}],render:(f,c,p,y)=>{let C=[...(c==null?void 0:c.ingredients)||[]].sort((a,l)=>l.quantity-a.quantity);return C=C==null?void 0:C.map(a=>{var l;return{name:a==null?void 0:a.ingredientData.name,quantity:((a==null?void 0:a.rawQuantityForJuice)||a.quantity)<1&&a.unit!=="units"?((a==null?void 0:a.rawQuantityForJuice)||a.quantity)*100:(a==null?void 0:a.rawQuantityForJuice)||a.quantity,unit:(l=Ce==null?void 0:Ce.find(b=>b.value===a.unit))==null?void 0:l.display((a==null?void 0:a.rawQuantityForJuice)||a.quantity),costForQuantity:a==null?void 0:a.costForQuantity}}),y?e.jsx("ul",{style:{display:"flex",flexDirection:"column",gap:"5px",padding:0,margin:0,listStyleType:"none"},children:C==null?void 0:C.map((a,l)=>e.jsxs("li",{style:{whiteSpace:"normal",display:"flex"},children:[e.jsx(st,{title:a==null?void 0:a.name,children:e.jsx("span",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",display:"inline-block",maxWidth:"150px"},children:a==null?void 0:a.name})}),` (${a.quantity} ${a.unit}) - ₪${a==null?void 0:a.costForQuantity}`]},l))}):e.jsx($,{ingredients:C})},rules:[{required:!0,message:"יש לבחור לפחות רכיב אחד"}]}];return N==null||N.map(f=>({label:f.name,value:f._id})),d.useEffect(()=>{w&&(n(w),h(w))},[w,N,m]),d.useEffect(()=>{const f=JSON.parse(localStorage.getItem("filtersMenu")||"{}");g(f)},[]),e.jsx(rt,{title:"מתכונים",titleView:"מיקס",type:"mix",data:i,mobileKeys:P,dataPrint:x,sortKeys:q,tableKeys:A,newTitle:"הוסף תערובת חדשה",searchKeys:I,setDataPrint:h,onAdd:t,onEdit:r,onDelete:s,Dtitle:"אישור מחיקה",ingredientsArr:N,iconADD:e.jsx(L,{icon:Et}),Dcontent:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"האם אתה בטוח שברצונך למחוק את התערובת?"}),e.jsx("p",{children:"שים לב! מחיקת תערובת עשויה להשפיע על מוצרים המשתמשים בה."})]})})}const{Text:Ea}=z,{Option:Ze}=de,qs=({addEmployee:t,initialValues:r,onClose:s})=>{const[i]=M.useForm(),n=X(g=>g.employees),[x,h]=d.useState("");d.useEffect(()=>{r&&i.setFieldsValue(r)},[r,i]);const u=g=>{if(n.some(w=>w.name===g.name.trim()&&(!r||w._id!==r._id))){h("קיים כבר עובד בעל שם דומה");return}t({...r,...g}),i.resetFields(),s()};return e.jsx(ue,{className:"employee-form-card",children:e.jsxs(M,{form:i,layout:"vertical",onFinish:u,initialValues:r,children:[e.jsx(M.Item,{label:"שם עובד",name:"name",rules:[{required:!0,message:"אנא הזן שם עובד"}],children:e.jsx(me,{})}),e.jsx(M.Item,{label:"תפקיד",name:"position",children:e.jsx(me,{placeholder:"הזן תפקיד"})}),e.jsx(M.Item,{label:"תעריף שעתי",name:"hourlyRate",rules:[{required:!0,message:"אנא הזן תעריף שעתי"}],children:e.jsx(oe,{min:0,style:{width:"100%"}})}),e.jsx(M.Item,{label:"סטטוס",name:"status",initialValue:"active",rules:[{required:!0}],children:e.jsxs(de,{children:[e.jsx(Ze,{value:"active",children:"פעיל"}),e.jsx(Ze,{value:"inactive",children:"לא פעיל"}),e.jsx(Ze,{value:"on_leave",children:"בחופשה"}),e.jsx(Ze,{value:"terminated",children:"סיים העסקה"})]})}),x&&e.jsx(ln,{style:{display:"block",marginBottom:"10px"},children:e.jsx(Ea,{type:"danger",className:"error-message",children:x})}),e.jsxs(M.Item,{children:[e.jsx(T,{type:"primary",htmlType:"submit",className:"employee-form-button",children:r?"עדכן עובד":"הוסף עובד"}),e.jsx(T,{className:"employee-form-button",onClick:s,style:{marginLeft:"8px"},children:"ביטול"})]})]})})},dt="https://menu-server-c2b952e2c698.herokuapp.com/api",$a=t=>G.post(`${dt}/employees`,t),Ma=t=>{const r=encodeURIComponent(t._id);return G.put(`${dt}/employees/${r}`,t)},Aa=t=>G.delete(`${dt}/employees/${t}`),Ra=(t,r)=>G.get(`${dt}/employees?`),Ds=d.createContext(),Ls=()=>d.useContext(Ds),qa=({children:t})=>{const[r,s]=d.useState(!1),i=async h=>{s(!0);try{await $a(h),D.success("העובד נוסף בהצלחה"),s(!1)}catch(u){console.error("Error adding employee:",u),D.error("שגיאה בהוספת עובד"),s(!1)}},n=async h=>{s(!0);try{await Ma(h),D.success("העובד עודכן בהצלחה"),s(!1)}catch(u){console.error("Error updating employee:",u),D.error("שגיאה בעדכון עובד"),s(!1)}},x=async h=>{s(!0);try{await Aa(h),D.success("העובד נמחק בהצלחה"),s(!1)}catch(u){console.error("Error deleting employee:",u),D.error("שגיאה במחיקת עובד"),s(!1)}};return e.jsx(Ds.Provider,{value:{addEmployee:i,updateEmployee:n,deleteEmployee:x,loading:r},children:t})},{Text:pt}=z,Da=({sortKey:t})=>{const{updateEmployee:r,deleteEmployee:s}=Ls(),i=X(m=>m.employees),[n,x]=d.useState(!1),[h,u]=d.useState(null),g=m=>{u(m),x(!0)},w=()=>{u(null),x(!1)},N=[...i].sort((m,$)=>t==="name"?m.name.localeCompare($.name):0);return e.jsxs(ue,{title:"רשימת עובדים",className:"employee-list-card",children:[e.jsx(xe,{itemLayout:"vertical",dataSource:N,renderItem:m=>e.jsx(xe.Item,{className:"employee-item",actions:[e.jsx(T,{type:"link",onClick:()=>g(m),children:"ערוך"}),e.jsx(_t,{title:"האם אתה בטוח שברצונך למחוק את העובד הנוכחי?",onConfirm:()=>s(m._id),okText:"כן",cancelText:"לא",children:e.jsx(T,{icon:e.jsx(_e,{}),danger:!0})})],children:e.jsx(xe.Item.Meta,{title:e.jsx(pt,{strong:!0,children:m.name}),description:e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx(pt,{strong:!0,children:"תפקיד:"})," ",m.position||"לא הוגדר"]}),e.jsxs("p",{children:[e.jsx(pt,{strong:!0,children:"תעריף שעתי:"})," ",m.hourlyRate," ₪"]}),e.jsx("p",{children:e.jsx(Ke,{color:Oa(m.status),text:La(m.status),style:{marginLeft:"8px"}})})]})})},m._id)}),e.jsx(fe,{title:h?"ערוך עובד":"הוסף עובד חדש",open:n,onCancel:w,footer:null,children:e.jsx(qs,{addEmployee:r,initialValues:h,onClose:w})})]})},La=t=>{switch(t){case"active":return"פעיל";case"inactive":return"לא פעיל";case"on_leave":return"בחופשה";case"terminated":return"סיים העסקה";default:return"לא ידוע"}},Oa=t=>{switch(t){case"active":return"green";case"inactive":return"grey";case"on_leave":return"orange";case"terminated":return"red";default:return"blue"}};function Ua(){const{addEmployee:t}=Ls(),[r,s]=d.useState(!1),[i,n]=d.useState(""),x=()=>{s(!0)},h=()=>{s(!1)};return e.jsxs("div",{style:{padding:"20px"},className:"scrollable-content employees-page-container",children:[e.jsxs("div",{className:"employees-controls",children:[e.jsx(T,{type:"primary",onClick:x,className:"add-employee-button",children:"הוסף עובד חדש"}),e.jsxs(de,{value:i,onChange:u=>n(u),className:"sort-select",children:[e.jsx(de.Option,{value:"",children:"מיין"}),e.jsx(de.Option,{value:"name",children:"מיין לפי שם"})]})]}),e.jsx(Da,{sortKey:i}),e.jsx(fe,{title:"הוסף עובד חדש",open:r,onCancel:h,footer:null,destroyOnClose:!0,children:e.jsx(qs,{addEmployee:t,onClose:h})})]})}const Xe="https://menu-server-c2b952e2c698.herokuapp.com/api",Ha=(t,r)=>G.post(`${Xe}/employees/${t}/hours`,r),Ba=(t,r)=>G.put(`${Xe}/employees/hours/${t}`,r),Wa=t=>G.delete(`${Xe}/employees/hours/${t}`),Qa=t=>G.get(`${Xe}/employees/${t}/hours`),Ya=(t,r)=>G.get(`${Xe}/employees/hours/${r}/${t}`),Os=d.createContext(),Ja=()=>d.useContext(Os),Va=({children:t})=>{const[r,s]=d.useState(!1),i=async(u,g)=>new Promise(async(w,N)=>{var m;s(!0);try{const $=await Ha(u,g);if(($==null?void 0:$.status)===200){D.error((m=$.data)==null?void 0:m.message),N(!1);return}D.success("שעות העבודה נוספו בהצלחה"),w(!0)}catch($){console.error("Error adding employee hours:",$),D.error("שגיאה בהוספת שעות עבודה"),N(!1)}finally{s(!1)}}),n=async(u,g)=>new Promise(async(w,N)=>{s(!0);try{(await Ba(u,g)).status!==201?N(!1):(D.success("שעות העבודה עודכנו בהצלחה"),w(!0))}catch(m){console.error("Error updating employee hours:",m),D.error("שגיאה בעדכון שעות עבודה"),N(!1)}finally{s(!1)}}),x=async u=>{s(!0);try{const g=await Qa(u);return D.success("שעות העבודה נשלפו בהצלחה"),g.data}catch(g){console.error("Error fetching employee hours:",g),D.error("שגיאה בשליפת שעות עבודה")}finally{s(!1)}},h=async u=>{s(!0);try{await Wa(u),D.success("שעות העבודה נמחקו בהצלחה")}catch(g){console.error("Error deleting employee hours:",g),D.error("שגיאה במחיקת שעות עבודה")}finally{s(!1)}};return e.jsx(Os.Provider,{value:{loading:r,addEmployeeHours:i,updateEmployeeHours:n,deleteEmployeeHours:h,fetchEmployeeHours:x},children:t})},{Option:Ga}=de,Xa=({visible:t,onClose:r,dayData:s})=>{const{addEmployeeHours:i,updateEmployeeHours:n,deleteEmployeeHours:x}=Ja(),h=X(c=>c.employees),[u,g]=d.useState(),[w,N]=d.useState(),[m,$]=d.useState(!1),[I]=M.useForm();if(!s)return null;const P=()=>{const c=m?n:i,p=m?w:u;c(m?p==null?void 0:p.hoursId:p.employeeId,p).then(()=>{g(),$(!1),I.resetFields()}).catch(()=>{})},q=c=>{N({...c,employeeId:c.employeeId,startTime:c.hours.start,endTime:c.hours.end,date:s.date}),$(!0)},A=()=>{g(null),$(!1)},S=c=>{x(c)},f=h==null?void 0:h.filter(c=>!s.employees.some(p=>p.employeeId===c._id));return e.jsxs(fe,{title:`ניהול שעות עבודה ליום ${s.date}`,open:t,onCancel:r,footer:null,width:800,style:{top:"1em"},destroyOnClose:!0,children:[e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("h3",{style:{fontWeight:"600",color:"#333"},children:"סיכום יום"}),e.jsxs("p",{children:["תאריך: ",s.date]}),e.jsxs("p",{children:["יום בשבוע: ",s.dayOfWeek]}),e.jsx(Pe,{color:(s==null?void 0:s.status)==="חצי יום"?"orange":"green",children:s==null?void 0:s.status})]}),e.jsx(Z,{}),e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("h3",{style:{fontWeight:"600",color:"#333"},children:m?"עריכת עובד":"הוספת עובד חדש"}),e.jsx(M,{form:I,layout:"vertical",onFinish:P,children:e.jsx(M.Item,{label:"בחר עובד",style:{maxWidth:"400px"},children:e.jsx(de,{showSearch:!0,placeholder:"חיפוש והוספת עובד",optionFilterProp:"children",value:(u==null?void 0:u.employeeId)||null,onChange:c=>{const p=f.find(y=>y._id===c);g({name:p==null?void 0:p.name,startTime:"",endTime:"",date:s==null?void 0:s.date,employeeId:p._id})},filterOption:(c,p)=>p.children.toLowerCase().includes(c.toLowerCase()),children:f==null?void 0:f.map(c=>e.jsx(Ga,{value:c._id,children:c.name},c._id))})})})]}),e.jsx(Z,{}),u&&e.jsxs(M,{layout:"inline",onFinish:P,initialValues:{startTime:u==null?void 0:u.startTime,endTime:u==null?void 0:u.endTime},children:[e.jsx(M.Item,{label:"שעת כניסה",children:e.jsx(me,{placeholder:"HH:mm",value:u==null?void 0:u.startTime,onChange:c=>g(p=>({...p,startTime:c.target.value}))})}),e.jsx(M.Item,{label:"שעת יציאה",children:e.jsx(me,{placeholder:"HH:mm",value:u==null?void 0:u.endTime,onChange:c=>g(p=>({...p,endTime:c.target.value}))})}),!(u!=null&&u._id)&&e.jsx(T,{type:"primary",onClick:P,children:"שמור שעות עבודה"})]}),e.jsx(Z,{}),e.jsxs("div",{style:{marginTop:"20px"},children:[e.jsx("h3",{style:{fontWeight:"600",color:"#333"},children:"עובדים שנוספו"}),e.jsx(xe,{bordered:!0,className:"scroll-content",style:{maxHeight:"25em",overflow:"auto"},dataSource:s==null?void 0:s.employees,renderItem:c=>{var p,y,C;return e.jsx(xe.Item,{children:e.jsxs("div",{style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("h2",{style:{fontWeight:"500",width:"6em"},children:c.name}),m&&c.employeeId===(w==null?void 0:w.employeeId)?e.jsxs(e.Fragment,{children:[e.jsx(me,{placeholder:"שעת כניסה",value:w==null?void 0:w.startTime,onChange:a=>N(l=>({...l,startTime:a.target.value})),style:{width:"100px",marginRight:"10px"}}),e.jsx(me,{placeholder:"שעת יציאה",value:w==null?void 0:w.endTime,onChange:a=>N(l=>({...l,endTime:a.target.value})),style:{width:"100px",marginRight:"10px"}}),e.jsxs(U,{style:{gap:"0.5em"},children:[e.jsx(T,{type:"primary",icon:e.jsx(In,{}),onClick:P}),e.jsx(T,{icon:e.jsx($t,{}),onClick:A,style:{marginLeft:"5px"}})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(ze,{title:"כניסה",value:(p=c==null?void 0:c.hours)==null?void 0:p.start}),e.jsx(ze,{title:"יציאה",value:(y=c==null?void 0:c.hours)==null?void 0:y.end}),e.jsx(ze,{title:"סך שעות",value:(C=c==null?void 0:c.hoursWorked)==null?void 0:C.toFixed(2)}),e.jsxs(U,{style:{gap:"0.5em"},children:[e.jsx(T,{icon:e.jsx(Mt,{}),onClick:()=>q(c)}),e.jsx(_t,{title:"האם אתה בטוח שברצונך למחוק את העובד?",onConfirm:()=>S(c.hoursId),okText:"כן",cancelText:"לא",children:e.jsx(T,{icon:e.jsx(_e,{}),danger:!0})})]})]})]})})}})]})]})},Za=({monthData:t})=>{const[r,s]=d.useState(!1),[i,n]=d.useState(null),x=g=>{n(g),s(!0)},h=[{title:"תאריך",dataIndex:"date",key:"date"},{title:"יום בשבוע",dataIndex:"dayOfWeek",key:"dayOfWeek"},{title:"סטטוס",dataIndex:"status",key:"status",render:g=>e.jsx(Pe,{color:g==="חצי יום"?"orange":"green",children:g})},{title:"מספר עובדים",dataIndex:"employeesCount",key:"employeesCount",render:g=>g??"לא ידוע"},{title:"סך הכל שעות",dataIndex:"totalHours",key:"totalHours",render:g=>(g==null?void 0:g.toFixed(2))??"לא ידוע"}],u=g=>{let w="";return g!=null&&g.hasError&&(w+="workhours-error "),g.isToday?w+="today-row":g.isPast&&(w+="past-row"),w};return e.jsxs(e.Fragment,{children:[e.jsx(is,{columns:h,dataSource:t,rowKey:"date",pagination:!1,rowClassName:u,onRow:(g,w)=>({onClick:()=>(g.isToday||g.isPast)&&x(w)})}),e.jsx(Xa,{visible:r,onClose:()=>s(!1),dayData:t[i]})]})},{MonthPicker:za}=on;Ie.locale("he");const Ka=()=>{const t=Ye(),r=X(n=>n.employeeHours.data),s=X(n=>n.employeeHours.selectedDate),i=n=>{t(Or(n.format("YYYY-MM")))};return e.jsxs("div",{className:"workhours-container",children:[e.jsx("h1",{children:"ניהול שעות עבודה חודשיות"}),e.jsx(za,{onChange:i,placeholder:"בחר חודש ושנה",disabledDate:n=>n&&n>Ie().endOf("month")},s),e.jsx(Za,{monthData:r})," "]})},Us=Ne({name:"suppliers",initialState:[],reducers:{addSuppliersState:(t,r)=>r.payload,addOrUpdateSupplierState:(t,r)=>{const s=r.payload,i=t.findIndex(n=>n._id===s._id);i!==-1?t[i]=s:t.unshift(s)},updateSupplierState:(t,r)=>{const s=r.payload;return t.map(i=>i._id===s._id?s:i)},deleteSupplierState:(t,r)=>{const s=r.payload._id;return t.filter(i=>i._id!==s)}}}),{addSuppliersState:ei,addOrUpdateSupplierState:ti,updateSupplierState:si,deleteSupplierState:ni}=Us.actions,ri=Us.reducer;function ht(t){let r,s,i,n;const x=t.price/1.17;return t.unit==='ק"ג'||t.unit==="weight"?(r=.1,s="גרם",i=x/t.quantity*r):t.unit==="ליטר"||t.unit==="volume"?(r=.1,s='מ"ל',i=x/t.quantity*r):(t.unit==="יחידות"||t.unit==="units")&&(r=1,s="יחידה",i=x/t.quantity),t.isJuice&&(n=i/(t.juiceRatio||1)),{...t,priceExcludingVAT:x.toFixed(2),unitQuantity:r,unitDescription:s,unitPrice:i.toFixed(2),processedPrice:n?n.toFixed(2):null}}const Hs=Ne({name:"ingredients",initialState:[],reducers:{addIngerdientsState:(t,r)=>r.payload.map(ht),addOrUpdateIngredientState:(t,r)=>{const s=ht(r.payload),i=t.findIndex(n=>n._id===s._id);i!==-1?t[i]=s:t.unshift(s)},updateIngredientState:(t,r)=>{const s=ht(r.payload);return t.map(i=>i._id===s._id?s:i)},deleteIngredientState:(t,r)=>{const s=r.payload._id;return t.filter(i=>i._id!==s)}}}),{addIngerdientsState:ai,addOrUpdateIngredientState:ii,updateIngredientState:li,deleteIngredientState:oi}=Hs.actions,di=Hs.reducer,Bs=Ne({name:"mixes",initialState:[],reducers:{setMixesState:(t,r)=>{const{mixes:s,ingredientsState:i}=r.payload;return s},addOrUpdateMixState:(t,r)=>{const{newMix:s,ingredientsState:i}=r.payload,n=s,x=t.findIndex(h=>h._id===s._id);x!==-1?t[x]=n:t.unshift(n)},updateMixState:(t,r)=>{const{updatedMix:s,ingredientsState:i}=r.payload,n=s,x=t.findIndex(h=>h._id===s._id);x!==-1&&(t[x]=n)},deleteMixState:(t,r)=>t.filter(s=>s._id!==r.payload._id)}}),{setMixesState:ci,addOrUpdateMixState:ui,updateMixState:xi,deleteMixState:mi}=Bs.actions,pi=Bs.reducer,Ws=Ne({name:"categories",initialState:[],reducers:{setCategories:(t,r)=>r.payload,addOrUpdateCategory:(t,r)=>{const s=r.payload,i=t.findIndex(n=>n._id===s._id);i!==-1?t[i]=s:t.unshift(s)},updateCategory:(t,r)=>{const s=r.payload,i=t.findIndex(n=>n._id===s._id);i!==-1&&(t[i]=s)},deleteCategory:(t,r)=>{const s=r.payload;return t.filter(i=>i._id!==s)}}}),{setCategories:hi,addOrUpdateCategory:gi,updateCategory:ji,deleteCategory:fi}=Ws.actions,yi=Ws.reducer,Qs=Ne({name:"employees",initialState:[],reducers:{setEmployees:(t,r)=>r.payload,addOrUpdateEmployee:(t,r)=>{const s=r.payload,i=t.findIndex(n=>n._id===s._id);i!==-1?t[i]=s:t.push(s)},updateEmployee:(t,r)=>{const s=r.payload,i=t.findIndex(n=>n._id===s._id);i!==-1&&(t[i]=s)},deleteEmployee:(t,r)=>t.filter(s=>s._id!==r.payload)}}),{setEmployees:vi,addOrUpdateEmployee:wi,updateEmployee:bi,deleteEmployee:Ci}=Qs.actions,Si=Qs.reducer,Ii=(t,r)=>{t.on("ingredientAdded",s=>{r(ii(s))}),t.on("ingredientUpdated",s=>{r(li(s))}),t.on("ingredientDeleted",s=>{r(oi(s))}),t.on("supplierAdded",s=>{r(ti(s))}),t.on("supplierUpdated",s=>{r(si(s))}),t.on("supplierDeleted",s=>{r(ni(s))}),t.on("productAdded",s=>{r((i,n)=>{const x=n().ingredients,h=n().mixes;i(bt({newProduct:s,ingredientsState:x,mixesState:h}))})}),t.on("productUpdated",s=>{r((i,n)=>{const x=n().ingredients,h=n().mixes;i(bt({newProduct:s,ingredientsState:x,mixesState:h}))})}),t.on("productDeleted",s=>{r(Hr(s))}),t.on("categoryAdded",s=>{r(gi(s))}),t.on("categoryUpdated",s=>{r(ji(s))}),t.on("categoryDeleted",s=>{r(fi(s._id))}),t.on("mixAdded",s=>{r((i,n)=>{const x=n().ingredients;i(ui({newMix:s,ingredientsState:x}))})}),t.on("mixUpdated",s=>{r((i,n)=>{const x=n().ingredients;i(xi({updatedMix:s,ingredientsState:x}))})}),t.on("mixDeleted",s=>{r(mi(s))}),t.on("employeeAdded",s=>{r(wi(s))}),t.on("employeeUpdated",s=>{r(bi(s))}),t.on("employeeDeleted",s=>{r(Ci(s._id))}),t.on("employeeHoursAdded",s=>{r(qr(s))}),t.on("employeeHoursUpdated",s=>{r(Dr(s))}),t.on("employeeHoursDeleted",s=>{r(Lr({_id:s._id}))})},ns="https://menu-server-c2b952e2c698.herokuapp.com/",Ni=d.createContext(),ki=({children:t})=>{const r=Ye();return console.log(ns),d.useEffect(()=>{const s=Rn(ns);return Ii(s,r),()=>s.disconnect()},[r]),e.jsx(Ni.Provider,{value:{},children:t})};D.config({prefixCls:"my-message"});const Fi=({children:t,setLoading:r})=>{const s=Ye(),i=X(x=>x.employeeHours.selectedDate),n=X(x=>{var h,u;return(u=(h=x.settings.settings)==null?void 0:h.hourlyRate)==null?void 0:u.value});return d.useEffect(()=>{(async()=>{var g,w;r(!0);const h=Yt(i).year(),u=Yt(i).month()+1;try{const[N,m,$,I,P,q,A]=await Promise.all([ia(),Kr(),Cs(),kr(),Fa(),Ra(),Ya(u,h)]);s(ai((g=N==null?void 0:N.data)==null?void 0:g.reverse())),s((S,f)=>{var p;const c=f().ingredients;S(ci({mixes:(p=P==null?void 0:P.data)==null?void 0:p.reverse(),ingredientsState:c}))}),s((S,f)=>{var y;const c=f().ingredients,p=f().mixes;S(_s({products:(y=$.data)==null?void 0:y.reverse(),ingredientsState:c,mixesState:p,averageHourlyRate:n}))}),s(hi(I.data)),s(ei((w=m==null?void 0:m.data)==null?void 0:w.reverse())),s(vi(q.data)),s(Ar({selectedDate:i,employees:q.data,employeeHours:A==null?void 0:A.data})),r(!1)}catch(N){console.error("Error fetching data:",N),r(!1)}})()},[s,r,i]),e.jsx(ki,{children:e.jsx(oa,{children:e.jsx(ta,{children:e.jsx(jr,{children:e.jsx(_a,{children:e.jsx(Pr,{children:e.jsx(qa,{children:e.jsx(Va,{children:e.jsx(ya,{children:t})})})})})})})})})},Ct="/assets/logo-Ha-8mVYV.png";function ee(...t){return Yn(Qn(t))}const Ys=Ln,Pi=Dn,Js=d.forwardRef(({className:t,...r},s)=>e.jsx(ms,{ref:s,className:ee("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...r}));Js.displayName=ms.displayName;const qt=d.forwardRef(({className:t,children:r,...s},i)=>e.jsxs(Pi,{children:[e.jsx(Js,{}),e.jsxs(ps,{ref:i,className:ee("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...s,children:[r,e.jsxs(qn,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(wt,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));qt.displayName=ps.displayName;const Dt=({className:t,...r})=>e.jsx("div",{className:ee("flex flex-col space-y-1.5 text-center sm:text-left",t),...r});Dt.displayName="DialogHeader";const Lt=d.forwardRef(({className:t,...r},s)=>e.jsx(hs,{ref:s,className:ee("text-lg font-semibold leading-none tracking-tight",t),...r}));Lt.displayName=hs.displayName;const _i=d.forwardRef(({className:t,...r},s)=>e.jsx(gs,{ref:s,className:ee("text-sm text-muted-foreground",t),...r}));_i.displayName=gs.displayName;const Ti=Rt("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),qe=d.forwardRef(({className:t,...r},s)=>e.jsx(js,{ref:s,className:ee(Ti(),t),...r}));qe.displayName=js.displayName;const Ei=tr,Vs=d.createContext({}),He=({...t})=>e.jsx(Vs.Provider,{value:{name:t.name},children:e.jsx(sr,{...t})}),ct=()=>{const t=d.useContext(Vs),r=d.useContext(Gs),{getFieldState:s,formState:i}=er(),n=s(t.name,i);if(!t)throw new Error("useFormField should be used within <FormField>");const{id:x}=r;return{id:x,name:t.name,formItemId:`${x}-form-item`,formDescriptionId:`${x}-form-item-description`,formMessageId:`${x}-form-item-message`,...n}},Gs=d.createContext({}),$e=d.forwardRef(({className:t,...r},s)=>{const i=d.useId();return e.jsx(Gs.Provider,{value:{id:i},children:e.jsx("div",{ref:s,className:ee("space-y-2",t),...r})})});$e.displayName="FormItem";const Me=d.forwardRef(({className:t,...r},s)=>{const{error:i,formItemId:n}=ct();return e.jsx(qe,{ref:s,className:ee(i&&"text-destructive",t),htmlFor:n,...r})});Me.displayName="FormLabel";const Ae=d.forwardRef(({...t},r)=>{const{error:s,formItemId:i,formDescriptionId:n,formMessageId:x}=ct();return e.jsx(fs,{ref:r,id:i,"aria-describedby":s?`${n} ${x}`:`${n}`,"aria-invalid":!!s,...t})});Ae.displayName="FormControl";const $i=d.forwardRef(({className:t,...r},s)=>{const{formDescriptionId:i}=ct();return e.jsx("p",{ref:s,id:i,className:ee("text-[0.8rem] text-muted-foreground",t),...r})});$i.displayName="FormDescription";const Re=d.forwardRef(({className:t,children:r,...s},i)=>{const{error:n,formMessageId:x}=ct(),h=n?String(n==null?void 0:n.message):r;return h?e.jsx("p",{ref:i,id:x,className:ee("text-[0.8rem] font-medium text-destructive",t),...s,children:h}):null});Re.displayName="FormMessage";const St=d.forwardRef(({className:t,...r},s)=>e.jsx("div",{ref:s,className:ee("rounded-xl border bg-card text-card-foreground shadow",t),...r}));St.displayName="Card";const It=d.forwardRef(({className:t,...r},s)=>e.jsx("div",{ref:s,className:ee("flex flex-col space-y-1.5 p-6",t),...r}));It.displayName="CardHeader";const Nt=d.forwardRef(({className:t,...r},s)=>e.jsx("div",{ref:s,className:ee("font-semibold leading-none tracking-tight",t),...r}));Nt.displayName="CardTitle";const Mi=d.forwardRef(({className:t,...r},s)=>e.jsx("div",{ref:s,className:ee("text-sm text-muted-foreground",t),...r}));Mi.displayName="CardDescription";const Be=d.forwardRef(({className:t,...r},s)=>e.jsx("div",{ref:s,className:ee("p-6 pt-0",t),...r}));Be.displayName="CardContent";const Ai=d.forwardRef(({className:t,...r},s)=>e.jsx("div",{ref:s,className:ee("flex items-center p-6 pt-0",t),...r}));Ai.displayName="CardFooter";const Ri=Rt("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),ge=d.forwardRef(({className:t,variant:r,size:s,asChild:i=!1,...n},x)=>{const h=i?fs:"button";return e.jsx(h,{className:ee(Ri({variant:r,size:s,className:t})),ref:x,...n})});ge.displayName="Button";const be=d.forwardRef(({className:t,type:r,...s},i)=>e.jsx("input",{type:r,className:ee("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:i,...s}));be.displayName="Input";const qi=Rt("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),Xs=d.forwardRef(({className:t,variant:r,...s},i)=>e.jsx("div",{ref:i,role:"alert",className:ee(qi({variant:r}),t),...s}));Xs.displayName="Alert";const Di=d.forwardRef(({className:t,...r},s)=>e.jsx("h5",{ref:s,className:ee("mb-1 font-medium leading-none tracking-tight",t),...r}));Di.displayName="AlertTitle";const Zs=d.forwardRef(({className:t,...r},s)=>e.jsx("div",{ref:s,className:ee("text-sm [&_p]:leading-relaxed",t),...r}));Zs.displayName="AlertDescription";const Li=On,zs=d.forwardRef(({className:t,...r},s)=>e.jsx(ys,{ref:s,className:ee("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",t),...r}));zs.displayName=ys.displayName;const kt=d.forwardRef(({className:t,...r},s)=>e.jsx(vs,{ref:s,className:ee("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",t),...r}));kt.displayName=vs.displayName;const Ft=d.forwardRef(({className:t,...r},s)=>e.jsx(ws,{ref:s,className:ee("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...r}));Ft.displayName=ws.displayName;const Oi=Hn,Ui=Bn,Ks=d.forwardRef(({className:t,align:r="center",sideOffset:s=4,...i},n)=>e.jsx(Un,{children:e.jsx(bs,{ref:n,align:r,sideOffset:s,className:ee("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...i})}));Ks.displayName=bs.displayName;const rs=({value:t,onChange:r})=>{const s=["#2196F3","#1976D2","#0D47A1","#4FC3F7","#4CAF50","#2E7D32","#81C784","#26A69A","#F44336","#D32F2F","#FF7043","#FF5722","#9C27B0","#7B1FA2","#E91E63","#6A1B9A"];return e.jsxs(Oi,{children:[e.jsx(Ui,{asChild:!0,children:e.jsxs(ge,{variant:"outline",className:"w-[140px] flex items-center justify-between gap-2 rtl",children:[e.jsx("div",{className:"w-4 h-4 rounded-full shadow-sm border border-zinc-200",style:{backgroundColor:t||"#ffffff"}}),e.jsx("span",{className:"flex-1 text-right",children:"בחר צבע"}),e.jsx(Jn,{className:"h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(Ks,{className:"w-[256px] p-3",align:"start",children:e.jsx("div",{className:"grid grid-cols-4 gap-2",children:s.map(i=>e.jsx("button",{className:ee("h-10 w-10 rounded-md relative","transition-all duration-100 ease-in-out","hover:scale-110 hover:shadow-lg","focus:outline-none focus:ring-2 focus:ring-zinc-400",t===i&&"ring-2 ring-zinc-800"),style:{backgroundColor:i,transform:t===i?"scale(1.1)":"scale(1)"},onClick:()=>r(i),children:t===i&&e.jsx(Vn,{className:ee("absolute inset-0 m-auto","w-4 h-4 text-white","drop-shadow-[0_2px_3px_rgba(0,0,0,0.3)]")})},i))})})]})},Hi=Ee.object({hourlyRate:Ee.number().positive("עלות שעת עבודה חייבת להיות מספר חיובי").min(0),markupMultiplier:Ee.number().min(0,"האחוז חייב להיות בין 0 ל-100").max(100,"האחוז חייב להיות בין 0 ל-100"),fixedExpensesRate:Ee.number().min(0,"האחוז חייב להיות בין 0 ל-100").max(100,"האחוז חייב להיות בין 0 ל-100"),profitRate:Ee.number().min(0,"האחוז חייב להיות בין 0 ל-100").max(100,"האחוז חייב להיות בין 0 ל-100"),vatRate:Ee.number().min(0,'מע"מ חייב להיות מספר חיובי').max(100,'מע"מ חייב להיות מספר חיובי')});function Bi({open:t,onConfirm:r,onCancel:s,itemName:i}){return e.jsx(Ys,{open:t,onOpenChange:s,children:e.jsxs(qt,{className:"max-w-sm",children:[e.jsx(Dt,{children:e.jsx(Lt,{children:"מחיקת קטגוריה"})}),e.jsxs("p",{children:['האם אתה בטוח שברצונך למחוק את הקטגוריה "',i,'"?']}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(ge,{variant:"outline",onClick:s,children:"ביטול"}),e.jsx(ge,{variant:"destructive",onClick:r,children:"מחיקה"})]})]})})}function Wi({flag:t,setFlag:r}){var re,ae,ce,te,k,o;const{settings:s,loading:i,updateSetting:n,fetchSettings:x,addCategoryContext:h,updateCategoryContext:u,deleteCategoryContext:g}=As(),w=nr({resolver:rr(Hi),defaultValues:{hourlyRate:((re=s==null?void 0:s.hourlyRate)==null?void 0:re.value)||0,markupMultiplier:((ae=s==null?void 0:s.markupMultiplier)==null?void 0:ae.value)||0,fixedExpensesRate:((ce=s==null?void 0:s.fixedExpensesRate)==null?void 0:ce.value)||0,profitRate:((te=s==null?void 0:s.profitRate)==null?void 0:te.value)||0,vatRate:parseFloat((k=s==null?void 0:s.vatRate)==null?void 0:k.value)||0}}),[N,m]=d.useState({name:"",description:"",color:""}),[$,I]=d.useState(!1),[P,q]=d.useState(null),[A,S]=d.useState(null),[f,c]=d.useState(!1),[p,y]=d.useState(null),[C,a]=d.useState(null);d.useEffect(()=>{t&&(x(),a(null))},[t]),d.useEffect(()=>{var j,E,H,ie,ve;s&&w.reset({hourlyRate:parseFloat((j=s==null?void 0:s.hourlyRate)==null?void 0:j.value)||0,markupMultiplier:parseFloat((E=s==null?void 0:s.markupMultiplier)==null?void 0:E.value)||0,fixedExpensesRate:parseFloat((H=s==null?void 0:s.fixedExpensesRate)==null?void 0:H.value)||0,profitRate:parseFloat((ie=s==null?void 0:s.profitRate)==null?void 0:ie.value)||0,vatRate:parseFloat((ve=s==null?void 0:s.vatRate)==null?void 0:ve.value)||0})},[s,w]);const l=j=>{q(j),S({name:j.name,description:j.description}),a(null)},b=()=>{q(null),S(null),a(null)},F=(j,E)=>{S(H=>({...H,[j]:E}))},R=async()=>{var j;if(!((j=A==null?void 0:A.name)!=null&&j.trim())){a("שם הקטגוריה הוא שדה חובה");return}try{await u(P._id,{...P,...A}),b(),await x()}catch{a("שגיאה בעדכון הקטגוריה")}},_=async()=>{var j;if(!((j=N.name)!=null&&j.trim())){a("שם הקטגוריה הוא שדה חובה");return}try{await h(N),m({name:"",description:"",color:""}),I(!1),a(null),await x()}catch{a("שגיאה בהוספת הקטגוריה")}},v=j=>{var E;return(E=s==null?void 0:s.materialCategories)==null?void 0:E.value.some(H=>H.color===j)},W=async()=>{try{await g(p._id),await x(),c(!1)}catch{a("שגיאה במחיקת הקטגוריה")}},B=j=>{y(j),c(!0)},V=async j=>{try{const E={hourlyRate:{value:parseFloat(j.hourlyRate)},markupMultiplier:{value:parseFloat(j.markupMultiplier)},fixedExpensesRate:{value:parseFloat(j.fixedExpensesRate)},profitRate:{value:parseFloat(j.profitRate)},vatRate:{value:parseFloat(j.vatRate)}};await n(E)}catch{}};return e.jsxs(Ys,{open:t,onOpenChange:r,className:"rtl",children:[e.jsxs(qt,{className:"max-w-4xl h-[90vh] overflow-hidden",children:[e.jsx(Dt,{children:e.jsx(Lt,{className:"text-2xl font-bold",children:"הגדרות מערכת"})}),e.jsxs(Li,{defaultValue:"general",className:"h-full rtl",children:[e.jsxs(zs,{className:"grid w-full grid-cols-2 rtl",children:[e.jsxs(kt,{value:"general",className:"flex items-center gap-2 rtl",children:[e.jsx(Gn,{className:"w-4 h-4 rtl"}),"הגדרות כלליות"]}),e.jsxs(kt,{value:"categories",className:"flex items-center gap-2",children:[e.jsx(Xn,{className:"w-4 h-4"}),"קטגוריות"]})]}),e.jsxs("div",{className:"px-1 rtl",style:{height:"calc(90vh - 140px)"},children:[C&&e.jsx(Xs,{variant:"destructive",className:"mb-4",children:e.jsx(Zs,{children:C})}),e.jsxs(Ft,{value:"general",className:"mt-4 rtl flex flex-col w-full",children:[e.jsx(It,{className:"rtl",children:e.jsx(Nt,{children:"הגדרות תמחור"})}),e.jsx(Be,{className:"space-y-4 flex-1 rtl",children:e.jsx(Ei,{...w,children:e.jsxs("form",{onSubmit:w.handleSubmit(V),className:"space-y-4",children:[e.jsx(He,{control:w.control,name:"hourlyRate",render:({field:j})=>e.jsxs($e,{children:[e.jsx(Me,{children:"עלות שעת עבודה (₪)"}),e.jsx(Ae,{children:e.jsx(be,{...j,type:"number",step:"0.1",min:"0",placeholder:"הכנס עלות שעת עבודה",onChange:E=>j.onChange(parseFloat(E.target.value)||0)})}),e.jsx(Re,{})]})}),e.jsx(He,{control:w.control,name:"markupMultiplier",render:({field:j})=>e.jsxs($e,{children:[e.jsx(Me,{children:"אחוז המכפיל עבור מחיר ממולץ לצרכן(%)"}),e.jsx(Ae,{children:e.jsx(be,{...j,type:"number",step:"0.01",min:"0",max:"100",placeholder:"הכנס אחוז הוצאות",onChange:E=>j.onChange(parseFloat(E.target.value)||0)})}),e.jsx(Re,{})]})}),e.jsx(He,{control:w.control,name:"fixedExpensesRate",render:({field:j})=>e.jsxs($e,{children:[e.jsx(Me,{children:"אחוז השתתפות בהוצאות קבועות (%)"}),e.jsx(Ae,{children:e.jsx(be,{...j,type:"number",step:"0.1",min:"0",max:"100",placeholder:"הכנס אחוז הוצאות",onChange:E=>j.onChange(parseFloat(E.target.value)||0)})}),e.jsx(Re,{})]})}),e.jsx(He,{control:w.control,name:"profitRate",render:({field:j})=>e.jsxs($e,{children:[e.jsx(Me,{children:"אחוז רווח רצוי (%)"}),e.jsx(Ae,{children:e.jsx(be,{...j,type:"number",step:"0.1",min:"0",max:"100",placeholder:"הכנס אחוז רווח",onChange:E=>j.onChange(parseFloat(E.target.value)||0)})}),e.jsx(Re,{})]})}),e.jsx(He,{control:w.control,name:"vatRate",render:({field:j})=>e.jsxs($e,{children:[e.jsx(Me,{children:' מע"מ (%)'}),e.jsx(Ae,{children:e.jsx(be,{...j,type:"number",step:"0.01",min:"0.10",max:"100",placeholder:'מע"מ',onChange:E=>j.onChange(parseFloat(E.target.value)||0)})}),e.jsx(Re,{})]})}),e.jsx("div",{className:"flex justify-center text-center",children:e.jsxs(ge,{type:"submit",className:"flex items-center gap-2",disabled:i,children:[e.jsx(mt,{className:"w-4 h-4"}),"שמור הגדרות"]})})]})})})]}),e.jsxs(Ft,{value:"categories",className:"mt-4 rtl flex flex-col w-full",children:[e.jsxs(It,{className:"flex flex-row items-center justify-between",children:[e.jsx(Nt,{children:"קטגוריות חומרי גלם"}),!$&&e.jsxs(ge,{variant:"outline",onClick:()=>I(!0),className:"flex items-center gap-2",children:[e.jsx(Zn,{className:"w-4 h-4"}),"הוסף קטגוריה"]})]}),e.jsxs(Be,{className:"space-y-4",children:[$&&e.jsx(St,{className:"border-2 border-zinc-200",children:e.jsxs(Be,{className:"space-y-4 p-4",children:[e.jsxs("div",{children:[e.jsx(qe,{children:"שם הקטגוריה"}),e.jsx(be,{value:N.name,onChange:j=>m({...N,name:j.target.value}),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(qe,{children:"תיאור"}),e.jsx(be,{value:N.description,onChange:j=>m({...N,description:j.target.value}),className:"mt-1"})]}),e.jsx(rs,{value:N.color,onChange:j=>{v(j)?a("צבע זה כבר בשימוש"):m({...N,color:j})}}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsxs(ge,{onClick:_,className:"flex items-center gap-2",disabled:i,children:[e.jsx(mt,{className:"w-4 h-4"}),"שמור"]}),e.jsxs(ge,{variant:"outline",onClick:()=>{I(!1),m({name:"",description:"",color:""})},className:"flex items-center gap-2",disabled:i,children:[e.jsx(wt,{className:"w-4 h-4"}),"ביטול"]})]})]})}),e.jsx("div",{className:"space-y-2 max-h-[59vh] overflow-y-auto pr-2",children:(o=s==null?void 0:s.materialCategories)==null?void 0:o.value.map(j=>e.jsx(St,{className:"border border-zinc-200",children:e.jsx(Be,{className:"p-4",children:(P==null?void 0:P._id)===j._id?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(qe,{children:"שם"}),e.jsx(be,{value:A==null?void 0:A.name,onChange:E=>F("name",E.target.value),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(qe,{children:"תיאור"}),e.jsx(be,{value:A==null?void 0:A.description,onChange:E=>F("description",E.target.value),className:"mt-1"})]}),e.jsx(rs,{value:(A==null?void 0:A.color)||(j==null?void 0:j.color),onChange:E=>{v(E)?a("צבע זה כבר בשימוש"):F("color",E)}}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsxs(ge,{onClick:R,disabled:i,className:"flex items-center gap-2",children:[e.jsx(mt,{className:"w-4 h-4"}),"שמור"]}),e.jsxs(ge,{variant:"outline",onClick:b,disabled:i,className:"flex items-center gap-2",children:[e.jsx(wt,{className:"w-4 h-4"}),"ביטול"]})]})]}):e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium flex flex-row items-center gap-2",style:{},children:[j.name,e.jsx("div",{className:"w-4 h-4 rounded-full shadow-sm border border-zinc-200",style:{backgroundColor:j==null?void 0:j.color}})]}),e.jsx("div",{className:"text-sm text-zinc-500",style:{},children:j.description})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ge,{variant:"outline",size:"sm",onClick:()=>l(j),className:"flex items-center gap-2",children:[e.jsx(zn,{className:"w-4 h-4"}),"ערוך"]}),e.jsxs(ge,{variant:"destructive",size:"sm",onClick:()=>B(j._id),className:"flex items-center gap-2",children:[e.jsx(Kn,{className:"w-4 h-4"}),"מחק"]})]})]})})},j._id))})]})]})]})]})]}),e.jsx(Bi,{open:f,onConfirm:W,onCancel:()=>c(!1),itemName:p==null?void 0:p.name})]})}function Qi({drawerVisible:t,setDrawerVisible:r,isMobile:s}){const[i,n]=d.useState(!1);return e.jsxs("div",{className:"top-bar",children:[e.jsx(pe,{to:"/",children:e.jsx(yt,{className:"logo-mobile",src:Ct,alt:"GainGuard",preview:!1})}),e.jsxs("div",{children:[e.jsx("button",{className:"settings-button",onClick:()=>n(!i),children:e.jsx(L,{icon:gn})}),s&&e.jsx("button",{className:"menu-button",onClick:()=>r(!t),children:e.jsx(L,{icon:jn})}),e.jsx(Wi,{flag:i,setFlag:()=>n(!1)})]})]})}const{Header:Yi,Content:Ji,Footer:Vi}=os;function Gi(){const[t,r]=d.useState(!1),[s,i]=d.useState(!1),n=Te({query:"(max-width: 1200px)"});return e.jsxs(Fi,{setLoading:i,children:[e.jsx(dn,{fullscreen:!0,spinning:s,size:"large"}),e.jsx(An,{children:e.jsxs(os,{className:"app-container",style:{minHeight:n?"85vh":"100vh"},children:[e.jsxs("div",{className:"nav-container",children:[e.jsx("div",{className:"nav-top",children:e.jsx(yt,{className:"logo",src:Ct,alt:"GainGuard",preview:!1})}),e.jsx(as,{})]}),e.jsxs("div",{className:"body-container",children:[e.jsxs(Yi,{className:"header",style:{padding:"0 20px"},children:[e.jsx(Qi,{isMobile:n,drawerVisible:t,setDrawerVisible:r}),e.jsx(Z,{className:"no-margin"})]}),e.jsx(Ji,{className:"content",children:e.jsxs(ar,{children:[e.jsx(Fe,{path:"/",element:e.jsx(Sa,{})}),e.jsx(Fe,{path:"/menu",element:e.jsx(Gr,{})}),e.jsx(Fe,{path:"/suppliers",element:e.jsx(sa,{})}),e.jsx(Fe,{path:"/mixes",element:e.jsx(Ta,{})}),e.jsx(Fe,{path:"/ingredients",element:e.jsx(wa,{})}),e.jsx(Fe,{path:"/employees",element:e.jsx(Ua,{})}),e.jsx(Fe,{path:"/work-hours",element:e.jsx(Ka,{})})]})}),e.jsx(Vi,{className:"footer",children:"© 2024 מערכת ניהול תפריט ועץ מוצר"})]}),e.jsx(ls,{title:e.jsxs(J,{children:[e.jsx(yt,{className:"logo",src:Ct,alt:"GainGuard",preview:!1}),e.jsx("p",{children:"ניווט"})]}),placement:"right",closable:!0,onClose:()=>r(!1),open:t,width:300,children:e.jsx(as,{onClose:()=>r(!1)})})]})})]})}function as({onClose:t}){const r=ir(),s=i=>r.pathname===i?"link-active":"link";return e.jsxs("div",{className:"nav-desktop-child",children:[e.jsx(Z,{}),e.jsx(T,{type:"link",onClick:t,className:s("/"),children:e.jsxs(pe,{to:"/",children:[e.jsx(L,{icon:fn})," ",e.jsx("p",{children:"לוח מחוונים"})]})}),e.jsx(T,{type:"link",onClick:t,className:s("/menu"),children:e.jsxs(pe,{to:"/menu",children:[e.jsx(L,{icon:tt})," ",e.jsx("p",{children:"תפריט"})]})}),e.jsx(T,{type:"link",onClick:t,className:s("/mixes"),children:e.jsxs(pe,{to:"/mixes",children:[e.jsx(L,{icon:Et})," ",e.jsx("p",{children:"מתכונים"})]})}),e.jsx(T,{type:"link",onClick:t,className:s("/ingredients"),children:e.jsxs(pe,{to:"/ingredients",children:[e.jsx(L,{icon:Qe})," ",e.jsx("p",{children:"חומרי גלם"})]})}),e.jsx(T,{type:"link",onClick:t,className:s("/suppliers"),children:e.jsxs(pe,{to:"/suppliers",children:[e.jsx(L,{icon:nt})," ",e.jsx("p",{children:"ספקים"})]})}),e.jsx(T,{type:"link",onClick:t,className:s("/employees"),children:e.jsxs(pe,{to:"/employees",children:[e.jsx(L,{icon:yn})," ",e.jsx("p",{children:"עובדים"})]})}),e.jsx(T,{type:"link",onClick:t,className:s("/work-hours"),children:e.jsxs(pe,{to:"/work-hours",children:[e.jsx(L,{icon:Tt})," ",e.jsx("p",{children:"ניהול שעות עבודה"})]})})]})}const gt=xs("dashboard/fetchDashboardData",async(t,{getState:r})=>(r(),{})),Xi=Ne({name:"dashboard",initialState:[],reducers:{},extraReducers:t=>{t.addCase(gt.pending,r=>{}).addCase(gt.fulfilled,(r,s)=>{}).addCase(gt.rejected,r=>{})}}),Zi=Xi.reducer,zi=Nn({reducer:{suppliers:ri,ingredients:di,products:Br,dashboard:Zi,mixes:pi,categories:yi,employees:Si,employeeHours:Ur,settings:fa}});en.createRoot(document.getElementById("root")).render(e.jsx(Pt.StrictMode,{children:e.jsx(tn,{store:zi,children:e.jsx(Wn,{children:e.jsx(Gi,{})})})}));"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(t=>{console.log("ServiceWorker registration successful with scope: ",t.scope)}).catch(t=>{console.error("ServiceWorker registration failed: ",t)})});
